
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   
      <title>Dive Into Python</title>
      <link rel="stylesheet" href="diveintopython.css" type="text/css">
      <link rev="made" href="mailto:f8dy@diveintopython.org">
      <meta name="generator" content="DocBook XSL Stylesheets V1.52.2">
      <meta name="description" content=" This book lives at .  If you're reading it somewhere else, you may not have the latest version.">
      <meta name="keywords" content="Python, Dive Into Python, tutorial, object-oriented, programming, documentation, book, free">
      <meta name="description" content="Python from novice to pro">
   </head>
   <body>
      <div class="book" lang="en">
         <div class="titlepage">
            <div>
               <div>
                  <h1 class="title"><a name="d0e1"></a>Dive Into <span class="application">Python</span></h1>
               </div>
               <div>
                  <p class="pubdate">20 May 2004</p>
               </div>
               <div>
                  <p class="copyright">Copyright &copy; 2000, 2001, 2002, 2003, 2004 <a href="mailto:mark@diveintopython.org">Mark Pilgrim</a></p>
               </div>
               <div>
                  <div class="abstract">
                     <h3 class="title"></h3>
                     <p>This book lives at <a href="http://diveintopython.org/">http://diveintopython.org/</a>.  If you're reading it somewhere else, you may not have the latest version.
                     </p>
                  </div>
               </div>
               <div>
                  <div class="legalnotice">
                     <p>Permission is granted to copy, distribute, and/or modify this document under the terms of the <span class="acronym">GNU</span> Free Documentation License, Version 1.1 or any later version published by the Free Software Foundation; with no Invariant
                        Sections, no Front-Cover Texts, and no Back-Cover Texts.  A copy of the license is included in <a href="#gfdl" title="Appendix&nbsp;G.&nbsp;GNU Free Documentation License">Appendix&nbsp;G, <i>GNU Free Documentation License</i></a>.
                     </p>
                     <p>The example programs in this book are free software; you can redistribute and/or modify them under the terms of the <span class="application">Python</span> license as published by the <span class="application">Python</span> Software Foundation. A copy of the license is included in <a href="#license" title="Appendix&nbsp;H.&nbsp;Python license">Appendix&nbsp;H, <i>Python license</i></a>.
                     </p>
                  </div>
               </div>
            </div>
            <div></div>
         </div>
         <div class="toc">
            <p><b>Table of Contents</b></p>
            <ul>
               <li><span class="chapter"><a href="#install">1. Installing Python</a></span><ul>
                     <li><span class="section"><a href="#install.choosing">1.1. Which Python is right for you?</a></span></li>
                     <li><span class="section"><a href="#install.windows">1.2. Python on Windows</a></span></li>
                     <li><span class="section"><a href="#install.macosx">1.3. Python on Mac OS X</a></span></li>
                     <li><span class="section"><a href="#install.macos9">1.4. Python on Mac OS 9</a></span></li>
                     <li><span class="section"><a href="#install.redhat">1.5. Python on RedHat Linux</a></span></li>
                     <li><span class="section"><a href="#install.debian">1.6. Python on Debian GNU/Linux</a></span></li>
                     <li><span class="section"><a href="#install.source">1.7. Python Installation from Source</a></span></li>
                     <li><span class="section"><a href="#install.shell">1.8. The Interactive Shell</a></span></li>
                     <li><span class="section"><a href="#install.summary">1.9. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#odbchelper">2. Your First Python Program</a></span><ul>
                     <li><span class="section"><a href="#odbchelper.divein">2.1. Diving in</a></span></li>
                     <li><span class="section"><a href="#odbchelper.funcdef">2.2. Declaring Functions</a></span><ul>
                           <li><span class="section"><a href="#d0e4188">2.2.1. How Python's Datatypes Compare to Other Programming Languages</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#odbchelper.docstring">2.3. Documenting Functions</a></span></li>
                     <li><span class="section"><a href="#odbchelper.objects">2.4. Everything Is an Object</a></span><ul>
                           <li><span class="section"><a href="#d0e4550">2.4.1. The Import Search Path</a></span></li>
                           <li><span class="section"><a href="#d0e4665">2.4.2. What's an Object?</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#odbchelper.indenting">2.5. Indenting Code</a></span></li>
                     <li><span class="section"><a href="#odbchelper.testing">2.6. Testing Modules</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#datatypes">3. Native Datatypes</a></span><ul>
                     <li><span class="section"><a href="#odbchelper.dict">3.1. Introducing Dictionaries</a></span><ul>
                           <li><span class="section"><a href="#d0e5174">3.1.1. Defining Dictionaries</a></span></li>
                           <li><span class="section"><a href="#d0e5269">3.1.2. Modifying Dictionaries</a></span></li>
                           <li><span class="section"><a href="#d0e5450">3.1.3. Deleting Items From Dictionaries</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#odbchelper.list">3.2. Introducing Lists</a></span><ul>
                           <li><span class="section"><a href="#d0e5623">3.2.1. Defining Lists</a></span></li>
                           <li><span class="section"><a href="#d0e5887">3.2.2. Adding Elements to Lists</a></span></li>
                           <li><span class="section"><a href="#d0e6115">3.2.3. Searching Lists</a></span></li>
                           <li><span class="section"><a href="#d0e6277">3.2.4. Deleting List Elements</a></span></li>
                           <li><span class="section"><a href="#d0e6392">3.2.5. Using List Operators</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#odbchelper.tuple">3.3. Introducing Tuples</a></span></li>
                     <li><span class="section"><a href="#odbchelper.vardef">3.4. Declaring variables</a></span><ul>
                           <li><span class="section"><a href="#d0e6873">3.4.1. Referencing Variables</a></span></li>
                           <li><span class="section"><a href="#odbchelper.multiassign">3.4.2. Assigning Multiple Values at Once</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#odbchelper.stringformatting">3.5. Formatting Strings</a></span></li>
                     <li><span class="section"><a href="#odbchelper.map">3.6. Mapping Lists</a></span></li>
                     <li><span class="section"><a href="#odbchelper.join">3.7. Joining Lists and Splitting Strings</a></span><ul>
                           <li><span class="section"><a href="#d0e7982">3.7.1. Historical Note on String Methods</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#odbchelper.summary">3.8. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#apihelper">4. The Power Of Introspection</a></span><ul>
                     <li><span class="section"><a href="#apihelper.divein">4.1. Diving In</a></span></li>
                     <li><span class="section"><a href="#apihelper.optional">4.2. Using Optional and Named Arguments</a></span></li>
                     <li><span class="section"><a href="#apihelper.builtin">4.3. Using type, str, dir, and Other Built-In Functions</a></span><ul>
                           <li><span class="section"><a href="#d0e8510">4.3.1. The type Function</a></span></li>
                           <li><span class="section"><a href="#d0e8609">4.3.2. The str Function</a></span></li>
                           <li><span class="section"><a href="#d0e8958">4.3.3. Built-In Functions</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#apihelper.getattr">4.4. Getting Object References With getattr</a></span><ul>
                           <li><span class="section"><a href="#d0e9194">4.4.1. getattr with Modules</a></span></li>
                           <li><span class="section"><a href="#d0e9362">4.4.2. getattr As a Dispatcher</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#apihelper.filter">4.5. Filtering Lists</a></span></li>
                     <li><span class="section"><a href="#apihelper.andor">4.6. The Peculiar Nature of and and or</a></span><ul>
                           <li><span class="section"><a href="#d0e9975">4.6.1. Using the and-or Trick</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#apihelper.lambda">4.7. Using lambda Functions</a></span><ul>
                           <li><span class="section"><a href="#d0e10403">4.7.1. Real-World lambda Functions</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#apihelper.alltogether">4.8. Putting It All Together</a></span></li>
                     <li><span class="section"><a href="#apihelper.summary">4.9. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#fileinfo">5. Objects and Object-Orientation</a></span><ul>
                     <li><span class="section"><a href="#fileinfo.divein">5.1. Diving In</a></span></li>
                     <li><span class="section"><a href="#fileinfo.fromimport">5.2. Importing Modules Using from module import</a></span></li>
                     <li><span class="section"><a href="#fileinfo.class">5.3. Defining Classes</a></span><ul>
                           <li><span class="section"><a href="#d0e11720">5.3.1. Initializing and Coding Classes</a></span></li>
                           <li><span class="section"><a href="#d0e11896">5.3.2. Knowing When to Use self and __init__</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#fileinfo.create">5.4. Instantiating Classes</a></span><ul>
                           <li><span class="section"><a href="#d0e12165">5.4.1. Garbage Collection</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#fileinfo.userdict">5.5. Exploring UserDict: A Wrapper Class</a></span></li>
                     <li><span class="section"><a href="#fileinfo.specialmethods">5.6. Special Class Methods</a></span><ul>
                           <li><span class="section"><a href="#d0e12822">5.6.1. Getting and Setting Items</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#fileinfo.morespecial">5.7. Advanced Special Class Methods</a></span></li>
                     <li><span class="section"><a href="#fileinfo.classattributes">5.8. Introducing Class Attributes</a></span></li>
                     <li><span class="section"><a href="#fileinfo.private">5.9. Private Functions</a></span></li>
                     <li><span class="section"><a href="#fileinfo.summary">5.10. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#filehandling">6. Exceptions and File Handling</a></span><ul>
                     <li><span class="section"><a href="#fileinfo.exception">6.1. Handling Exceptions</a></span><ul>
                           <li><span class="section"><a href="#d0e14344">6.1.1. Using Exceptions For Other Purposes</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#fileinfo.files">6.2. Working with File Objects</a></span><ul>
                           <li><span class="section"><a href="#d0e14670">6.2.1. Reading Files</a></span></li>
                           <li><span class="section"><a href="#d0e14800">6.2.2. Closing Files</a></span></li>
                           <li><span class="section"><a href="#d0e14928">6.2.3. Handling I/O Errors</a></span></li>
                           <li><span class="section"><a href="#d0e15055">6.2.4. Writing to Files</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#fileinfo.for">6.3. Iterating with for Loops</a></span></li>
                     <li><span class="section"><a href="#fileinfo.modules">6.4. Using sys.modules</a></span></li>
                     <li><span class="section"><a href="#fileinfo.os">6.5. Working with Directories</a></span></li>
                     <li><span class="section"><a href="#fileinfo.alltogether">6.6. Putting It All Together</a></span></li>
                     <li><span class="section"><a href="#fileinfo.summary2">6.7. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#re">7. Regular Expressions</a></span><ul>
                     <li><span class="section"><a href="#re.intro">7.1. Diving In</a></span></li>
                     <li><span class="section"><a href="#re.matching">7.2. Case Study: Street Addresses</a></span></li>
                     <li><span class="section"><a href="#re.roman">7.3. Case Study: Roman Numerals</a></span><ul>
                           <li><span class="section"><a href="#d0e17592">7.3.1. Checking for Thousands</a></span></li>
                           <li><span class="section"><a href="#d0e17785">7.3.2. Checking for Hundreds</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#re.nm">7.4. Using the {n,m} Syntax</a></span><ul>
                           <li><span class="section"><a href="#d0e18326">7.4.1. Checking for Tens and Ones</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#re.verbose">7.5. Verbose Regular Expressions</a></span></li>
                     <li><span class="section"><a href="#re.phone">7.6. Case study: Parsing Phone Numbers</a></span></li>
                     <li><span class="section"><a href="#re.summary">7.7. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#dialect">8. HTML Processing</a></span><ul>
                     <li><span class="section"><a href="#dialect.divein">8.1. Diving in</a></span></li>
                     <li><span class="section"><a href="#dialect.sgmllib">8.2. Introducing sgmllib.py</a></span></li>
                     <li><span class="section"><a href="#dialect.extract">8.3. Extracting data from HTML documents</a></span></li>
                     <li><span class="section"><a href="#dialect.basehtml">8.4. Introducing BaseHTMLProcessor.py</a></span></li>
                     <li><span class="section"><a href="#dialect.locals">8.5. locals and globals</a></span></li>
                     <li><span class="section"><a href="#dialect.dictsub">8.6. Dictionary-based string formatting</a></span></li>
                     <li><span class="section"><a href="#dialect.quoting">8.7. Quoting attribute values</a></span></li>
                     <li><span class="section"><a href="#dialect.dialectizer">8.8. Introducing dialect.py</a></span></li>
                     <li><span class="section"><a href="#dialect.alltogether">8.9. Putting it all together</a></span></li>
                     <li><span class="section"><a href="#dialect.summary">8.10. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#kgp">9. XML Processing</a></span><ul>
                     <li><span class="section"><a href="#kgp.divein">9.1. Diving in</a></span></li>
                     <li><span class="section"><a href="#kgp.packages">9.2. Packages</a></span></li>
                     <li><span class="section"><a href="#kgp.parse">9.3. Parsing XML</a></span></li>
                     <li><span class="section"><a href="#kgp.unicode">9.4. Unicode</a></span></li>
                     <li><span class="section"><a href="#kgp.search">9.5. Searching for elements</a></span></li>
                     <li><span class="section"><a href="#kgp.attributes">9.6. Accessing element attributes</a></span></li>
                     <li><span class="section"><a href="#kgp.segue">9.7. Segue</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#streams">10. Scripts and Streams</a></span><ul>
                     <li><span class="section"><a href="#kgp.openanything">10.1. Abstracting input sources</a></span></li>
                     <li><span class="section"><a href="#kgp.stdio">10.2. Standard input, output, and error</a></span></li>
                     <li><span class="section"><a href="#kgp.cache">10.3. Caching node lookups</a></span></li>
                     <li><span class="section"><a href="#kgp.child">10.4. Finding direct children of a node</a></span></li>
                     <li><span class="section"><a href="#kgp.handler">10.5. Creating separate handlers by node type</a></span></li>
                     <li><span class="section"><a href="#kgp.commandline">10.6. Handling command-line arguments</a></span></li>
                     <li><span class="section"><a href="#kgp.alltogether">10.7. Putting it all together</a></span></li>
                     <li><span class="section"><a href="#kgp.summary">10.8. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#oa">11. HTTP Web Services</a></span><ul>
                     <li><span class="section"><a href="#oa.divein">11.1. Diving in</a></span></li>
                     <li><span class="section"><a href="#oa.review">11.2. How not to fetch data over HTTP</a></span></li>
                     <li><span class="section"><a href="#oa.features">11.3. Features of HTTP</a></span><ul>
                           <li><span class="section"><a href="#d0e27596">11.3.1. User-Agent</a></span></li>
                           <li><span class="section"><a href="#d0e27616">11.3.2. Redirects</a></span></li>
                           <li><span class="section"><a href="#d0e27689">11.3.3. Last-Modified/If-Modified-Since</a></span></li>
                           <li><span class="section"><a href="#d0e27724">11.3.4. ETag/If-None-Match</a></span></li>
                           <li><span class="section"><a href="#d0e27752">11.3.5. Compression</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#oa.debug">11.4. Debugging HTTP web services</a></span></li>
                     <li><span class="section"><a href="#oa.useragent">11.5. Setting the User-Agent</a></span></li>
                     <li><span class="section"><a href="#oa.etags">11.6. Handling Last-Modified and ETag</a></span></li>
                     <li><span class="section"><a href="#oa.redirect">11.7. Handling redirects</a></span></li>
                     <li><span class="section"><a href="#oa.gzip">11.8. Handling compressed data</a></span></li>
                     <li><span class="section"><a href="#oa.alltogether">11.9. Putting it all together</a></span></li>
                     <li><span class="section"><a href="#oa.summary">11.10. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#soap">12. SOAP Web Services</a></span><ul>
                     <li><span class="section"><a href="#soap.divein">12.1. Diving In</a></span></li>
                     <li><span class="section"><a href="#soap.install">12.2. Installing the SOAP Libraries</a></span><ul>
                           <li><span class="section"><a href="#d0e29967">12.2.1. Installing PyXML</a></span></li>
                           <li><span class="section"><a href="#d0e30070">12.2.2. Installing fpconst</a></span></li>
                           <li><span class="section"><a href="#d0e30171">12.2.3. Installing SOAPpy</a></span></li>
                        </ul>
                     </li>
                     <li><span class="section"><a href="#soap.firststeps">12.3. First Steps with SOAP</a></span></li>
                     <li><span class="section"><a href="#soap.debug">12.4. Debugging SOAP Web Services</a></span></li>
                     <li><span class="section"><a href="#soap.wsdl">12.5. Introducing WSDL</a></span></li>
                     <li><span class="section"><a href="#soap.introspection">12.6. Introspecting SOAP Web Services with WSDL</a></span></li>
                     <li><span class="section"><a href="#soap.google">12.7. Searching Google</a></span></li>
                     <li><span class="section"><a href="#soap.troubleshooting">12.8. Troubleshooting SOAP Web Services</a></span></li>
                     <li><span class="section"><a href="#soap.summary">12.9. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#roman">13. Unit Testing</a></span><ul>
                     <li><span class="section"><a href="#roman.intro">13.1. Introduction to Roman numerals</a></span></li>
                     <li><span class="section"><a href="#roman.divein">13.2. Diving in</a></span></li>
                     <li><span class="section"><a href="#roman.romantest">13.3. Introducing romantest.py</a></span></li>
                     <li><span class="section"><a href="#roman.success">13.4. Testing for success</a></span></li>
                     <li><span class="section"><a href="#roman.failure">13.5. Testing for failure</a></span></li>
                     <li><span class="section"><a href="#roman.sanity">13.6. Testing for sanity</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#roman1.5">14. Test-First Programming</a></span><ul>
                     <li><span class="section"><a href="#roman.stage1">14.1. roman.py, stage 1</a></span></li>
                     <li><span class="section"><a href="#roman.stage2">14.2. roman.py, stage 2</a></span></li>
                     <li><span class="section"><a href="#roman.stage3">14.3. roman.py, stage 3</a></span></li>
                     <li><span class="section"><a href="#roman.stage4">14.4. roman.py, stage 4</a></span></li>
                     <li><span class="section"><a href="#roman.stage5">14.5. roman.py, stage 5</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#roman2">15. Refactoring</a></span><ul>
                     <li><span class="section"><a href="#roman.bugs">15.1. Handling bugs</a></span></li>
                     <li><span class="section"><a href="#roman.change">15.2. Handling changing requirements</a></span></li>
                     <li><span class="section"><a href="#roman.refactoring">15.3. Refactoring</a></span></li>
                     <li><span class="section"><a href="#roman.postscript">15.4. Postscript</a></span></li>
                     <li><span class="section"><a href="#roman.summary">15.5. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#regression">16. Functional Programming</a></span><ul>
                     <li><span class="section"><a href="#regression.divein">16.1. Diving in</a></span></li>
                     <li><span class="section"><a href="#regression.path">16.2. Finding the path</a></span></li>
                     <li><span class="section"><a href="#regression.filter">16.3. Filtering lists revisited</a></span></li>
                     <li><span class="section"><a href="#regression.map">16.4. Mapping lists revisited</a></span></li>
                     <li><span class="section"><a href="#regression.datacentric">16.5. Data-centric programming</a></span></li>
                     <li><span class="section"><a href="#regression.import">16.6. Dynamically importing modules</a></span></li>
                     <li><span class="section"><a href="#regression.alltogether">16.7. Putting it all together</a></span></li>
                     <li><span class="section"><a href="#regression.summary">16.8. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#plural">17. Dynamic functions</a></span><ul>
                     <li><span class="section"><a href="#plural.divein">17.1. Diving in</a></span></li>
                     <li><span class="section"><a href="#plural.stage1">17.2. plural.py, stage 1</a></span></li>
                     <li><span class="section"><a href="#plural.stage2">17.3. plural.py, stage 2</a></span></li>
                     <li><span class="section"><a href="#plural.stage3">17.4. plural.py, stage 3</a></span></li>
                     <li><span class="section"><a href="#plural.stage4">17.5. plural.py, stage 4</a></span></li>
                     <li><span class="section"><a href="#plural.stage5">17.6. plural.py, stage 5</a></span></li>
                     <li><span class="section"><a href="#plural.stage6">17.7. plural.py, stage 6</a></span></li>
                     <li><span class="section"><a href="#plural.summary">17.8. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="chapter"><a href="#soundex">18. Performance Tuning</a></span><ul>
                     <li><span class="section"><a href="#soundex.divein">18.1. Diving in</a></span></li>
                     <li><span class="section"><a href="#soundex.timeit">18.2. Using the timeit Module</a></span></li>
                     <li><span class="section"><a href="#soundex.stage1">18.3. Optimizing Regular Expressions</a></span></li>
                     <li><span class="section"><a href="#soundex.stage2">18.4. Optimizing Dictionary Lookups</a></span></li>
                     <li><span class="section"><a href="#soundex.stage3">18.5. Optimizing List Operations</a></span></li>
                     <li><span class="section"><a href="#soundex.stage4">18.6. Optimizing String Manipulation</a></span></li>
                     <li><span class="section"><a href="#soundex.summary">18.7. Summary</a></span></li>
                  </ul>
               </li>
               <li><span class="appendix"><a href="#furtherreading">A. Further reading</a></span></li>
               <li><span class="appendix"><a href="#abstracts">B. A 5-minute review</a></span></li>
               <li><span class="appendix"><a href="#tips">C. Tips and tricks</a></span></li>
               <li><span class="appendix"><a href="#examples">D. List of examples</a></span></li>
               <li><span class="appendix"><a href="#revhistory">E. Revision history</a></span></li>
               <li><span class="appendix"><a href="#about">F. About the book</a></span></li>
               <li><span class="appendix"><a href="#gfdl">G. GNU Free Documentation License</a></span><ul>
                     <li><span class="section"><a href="#d0e40006">G.0. Preamble</a></span></li>
                     <li><span class="section"><a href="#d0e40015">G.1. Applicability and definitions</a></span></li>
                     <li><span class="section"><a href="#d0e40035">G.2. Verbatim copying</a></span></li>
                     <li><span class="section"><a href="#d0e40043">G.3. Copying in quantity</a></span></li>
                     <li><span class="section"><a href="#d0e40055">G.4. Modifications</a></span></li>
                     <li><span class="section"><a href="#d0e40112">G.5. Combining documents</a></span></li>
                     <li><span class="section"><a href="#d0e40122">G.6. Collections of documents</a></span></li>
                     <li><span class="section"><a href="#d0e40130">G.7. Aggregation with independent works</a></span></li>
                     <li><span class="section"><a href="#d0e40138">G.8. Translation</a></span></li>
                     <li><span class="section"><a href="#d0e40144">G.9. Termination</a></span></li>
                     <li><span class="section"><a href="#d0e40150">G.10. Future revisions of this license</a></span></li>
                     <li><span class="section"><a href="#d0e40161">G.11. How to use this License for your documents</a></span></li>
                  </ul>
               </li>
               <li><span class="appendix"><a href="#license">H. Python license</a></span><ul>
                     <li><span class="section"><a href="#d0e40180">H.A. History of the software</a></span></li>
                     <li><span class="section"><a href="#d0e40191">H.B. Terms and conditions for accessing or otherwise using Python</a></span><ul>
                           <li><span class="section"><a href="#d0e40195">H.B.1. PSF license agreement</a></span></li>
                           <li><span class="section"><a href="#d0e40223">H.B.2. BeOpen Python open source license agreement version 1</a></span></li>
                           <li><span class="section"><a href="#d0e40248">H.B.3. CNRI open source GPL-compatible license agreement</a></span></li>
                           <li><span class="section"><a href="#d0e40276">H.B.4. CWI permissions statement and disclaimer</a></span></li>
                        </ul>
                     </li>
                  </ul>
               </li>
            </ul>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="install"></a>Chapter&nbsp;1.&nbsp;Installing <span class="application">Python</span></h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p>Welcome to <span class="application">Python</span>.  Let's dive in.  In this chapter, you'll install the version of <span class="application">Python</span> that's right for you.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.choosing"></a>1.1.&nbsp;Which <span class="application">Python</span> is right for you?
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The first thing you need to do with <span class="application">Python</span> is install it.  Or do you?
                  </p>
               </div>
               <p>If you're using an account on a hosted server, your ISP may have already installed <span class="application">Python</span>.  Most popular Linux distributions come with <span class="application">Python</span> in the default installation.  <span class="abbrev">Mac</span> <span class="acronym">OS</span> X 10.2 and later includes a command-line version of <span class="application">Python</span>, although you'll probably want to install a version that includes a more Mac-like graphical interface.
               </p>
               <p>Windows does not come with any version of <span class="application">Python</span>, but don't despair!  There are several ways to point-and-click your way to <span class="application">Python</span> on Windows.
               </p>
               <p>As you can see already, <span class="application">Python</span> runs on a great many operating systems.  The full list includes Windows, <span class="abbrev">Mac</span> <span class="acronym">OS</span>, <span class="abbrev">Mac</span> <span class="acronym">OS</span> X, and all varieties of free <span class="acronym">UNIX</span>-compatible systems like Linux.  There are also versions that run on Sun Solaris, AS/400, Amiga, OS/2, BeOS, and a plethora
                  of other platforms you've probably never even heard of.
               </p>
               <p>What's more, <span class="application">Python</span> programs written on one platform can, with a little care, run on <span class="emphasis"><em>any</em></span> supported platform.  For instance, I regularly develop <span class="application">Python</span> programs on Windows and later deploy them on Linux.
               </p>
               <p>So back to the question that started this section, &#8220;<span class="quote">Which <span class="application">Python</span> is right for you?</span>&#8221;  The answer is whichever one runs on the computer you already have.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.windows"></a>1.2.&nbsp;<span class="application">Python</span> on Windows
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>On Windows, you have a couple choices for installing <span class="application">Python</span>.
                  </p>
               </div>
               <p>ActiveState makes a Windows installer for <span class="application">Python</span> called <span class="application">ActivePython</span>, which includes a complete version of <span class="application">Python</span>, an <span class="acronym">IDE</span> with a <span class="application">Python</span>-aware code editor, plus some Windows extensions for <span class="application">Python</span> that allow complete access to Windows-specific services, <span class="acronym">API</span>s, and the Windows Registry.
               </p>
               <p><span class="application">ActivePython</span> is freely downloadable, although it is not open source.  It is the <span class="acronym">IDE</span> I used to learn <span class="application">Python</span>, and I recommend you try it unless you have a specific reason not to.  One such reason might be that ActiveState is generally
                  several months behind in updating their <span class="application">ActivePython</span> installer when new version of <span class="application">Python</span> are released.  If you absolutely need the latest version of <span class="application">Python</span> and <span class="application">ActivePython</span> is still a version behind as you read this, you'll want to use the second option for installing <span class="application">Python</span> on Windows.
               </p>
               <p>The second option is the &#8220;<span class="quote">official</span>&#8221; <span class="application">Python</span> installer, distributed by the people who develop <span class="application">Python</span> itself.  It is freely downloadable and open source, and it is always current with the latest version of <span class="application">Python</span>.
               </p>
               <div class="procedure">
                  <h3 class="title">Procedure&nbsp;1.1.&nbsp;Option 1: Installing <span class="application">ActivePython</span></h3>
                  <p>Here is the procedure for installing <span class="application">ActivePython</span>:
                  </p>
                  <ol type="1">
                     <li>
                        <p>Download <span class="application">ActivePython</span> from <a href="http://www.activestate.com/Products/ActivePython/">http://www.activestate.com/Products/ActivePython/</a>.
                        </p>
                     </li>
                     <li>
                        <p>If you are using Windows 95, Windows 98, or Windows ME, you will also need to download and install <a href="http://download.microsoft.com/download/WindowsInstaller/Install/2.0/W9XMe/EN-US/InstMsiA.exe">Windows Installer 2.0</a> before installing <span class="application">ActivePython</span>.
                        </p>
                     </li>
                     <li>
                        <p>Double-click the installer, <tt class="filename">ActivePython-2.2.2-224-win32-ix86.msi</tt>.
                        </p>
                     </li>
                     <li>
                        <p>Step through the installer program.</p>
                     </li>
                     <li>
                        <p>If space is tight, you can do a custom installation and deselect the documentation, but I don't recommend this unless you
                           absolutely can't spare the 14MB.
                        </p>
                     </li>
                     <li>
                        <p>After the installation is complete, close the installer and choose <span class="guimenu">Start</span>-&gt;<span class="guimenuitem">Programs</span>-&gt;<span class="guimenuitem">ActiveState ActivePython 2.2</span>-&gt;<span class="guimenuitem">PythonWin IDE</span>.  You'll see something like the following:
                        </p>
                     </li>
                  </ol>
               </div>
               <div class="informalexample"><pre class="screen">
<span class="computeroutput">PythonWin 2.2.2 (#37, Nov 26 2002, 10:24:37) [MSC 32 bit (Intel)] on win32.
Portions Copyright 1994-2001 Mark Hammond (mhammond@skippinet.com.au) -
see 'Help/About PythonWin' for further copyright information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre></div>
               <div class="procedure">
                  <h3 class="title">Procedure&nbsp;1.2.&nbsp;Option 2: Installing <span class="application">Python</span> from <a href="http://www.python.org/" title="Python language home page">Python.org</a></h3>
                  <ol type="1">
                     <li>
                        <p>Download the latest <span class="application">Python</span> Windows installer by going to <a href="http://www.python.org/ftp/python/">http://www.python.org/ftp/python/</a> and selecting the highest version number listed, then downloading the <tt class="literal">.exe</tt> installer.
                        </p>
                     </li>
                     <li>
                        <p>Double-click the installer, <tt class="filename">Python-2.xxx.yyy.exe</tt>.  The name will depend on the version of <span class="application">Python</span> available when you read this.
                        </p>
                     </li>
                     <li>
                        <p>Step through the installer program.</p>
                     </li>
                     <li>
                        <p>If disk space is tight, you can deselect the HTMLHelp file, the utility scripts (<tt class="filename">Tools/</tt>), and/or the test suite (<tt class="filename">Lib/test/</tt>).
                        </p>
                     </li>
                     <li>
                        <p>If you do not have administrative rights on your machine, you can select <span class="guibutton">Advanced Options</span>, then choose <span class="guilabel">Non-Admin Install</span>.  This just affects where Registry entries and Start menu shortcuts are created.
                        </p>
                     </li>
                     <li>
                        <p>After the installation is complete, close the installer and select <span class="guimenu">Start</span>-&gt;<span class="guimenuitem">Programs</span>-&gt;<span class="guimenuitem">Python 2.3</span>-&gt;<span class="guimenuitem">IDLE (Python GUI)</span>.  You'll see something like the following:
                        </p>
                     </li>
                  </ol>
               </div>
               <div class="informalexample"><pre class="screen">
<span class="computeroutput">Python 2.3.2 (#49, Oct  2 2003, 20:02:00) [MSC v.1200 32 bit (Intel)] on win32
Type "copyright", "credits" or "license()" for more information.

    ****************************************************************
    Personal firewall software may warn about the connection IDLE
    makes to its subprocess using this computer's internal loopback
    interface.  This connection is not visible on any external
    interface and no data is sent to or received from the Internet.
    ****************************************************************
    
IDLE 1.0</span>
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.macosx"></a>1.3.&nbsp;<span class="application">Python</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span> X
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>On <span class="abbrev">Mac</span> <span class="acronym">OS</span> X, you have two choices for installing <span class="application">Python</span>: install it, or don't install it.  You probably want to install it.
                  </p>
               </div>
               <p><span class="abbrev">Mac</span> <span class="acronym">OS</span> X 10.2 and later comes with a command-line version of <span class="application">Python</span> preinstalled.  If you are comfortable with the command line, you can use this version for the first third of the book.  However,
                  the preinstalled version does not come with an <span class="acronym">XML</span> parser, so when you get to the <span class="acronym">XML</span> chapter, you'll need to install the full version.
               </p>
               <p>Rather than using the preinstalled version, you'll probably want to install the latest version, which also comes with a graphical
                  interactive shell.
               </p>
               <div class="procedure">
                  <h3 class="title">Procedure&nbsp;1.3.&nbsp;Running the Preinstalled Version of <span class="application">Python</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span> X
                  </h3>
                  <p>To use the preinstalled version of <span class="application">Python</span>, follow these steps:
                  </p>
                  <ol type="1">
                     <li>
                        <p>Open the <tt class="filename">/Applications</tt> folder.
                        </p>
                     </li>
                     <li>
                        <p>Open the <tt class="filename">Utilities</tt> folder.
                        </p>
                     </li>
                     <li>
                        <p>Double-click <tt class="filename">Terminal</tt> to open a terminal window and get to a command line.
                        </p>
                     </li>
                     <li>
                        <p>Type <b class="userinput"><tt>python</tt></b> at the command prompt.
                        </p>
                     </li>
                  </ol>
               </div>
               <p>Try it out:</p>
               <div class="informalexample"><pre class="screen">
<span class="computeroutput">Welcome to Darwin!</span>
<tt class="prompt">[localhost:~] you% </tt><span class="userinput">python</span>
<span class="computeroutput">Python 2.2 (#1, 07/14/02, 23:25:09)
[GCC Apple cpp-precomp 6.14] on darwin
Type "help", "copyright", "credits", or "license" for more information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[press Ctrl+D to get back to the command prompt]</span>
<tt class="prompt">[localhost:~] you% </tt>
</pre></div>
               <div class="procedure">
                  <h3 class="title">Procedure&nbsp;1.4.&nbsp;Installing the Latest Version of <span class="application">Python</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span> X
                  </h3>
                  <p>Follow these steps to download and install the latest version of <span class="application">Python</span>:
                  </p>
                  <ol type="1">
                     <li>
                        <p>Download the <tt class="filename">MacPython-OSX</tt> disk image from <a href="http://homepages.cwi.nl/~jack/macpython/download.html">http://homepages.cwi.nl/~jack/macpython/download.html</a>.
                        </p>
                     </li>
                     <li>
                        <p>If your browser has not already done so, double-click <tt class="filename">MacPython-OSX-2.3-1.dmg</tt> to mount the disk image on your desktop.
                        </p>
                     </li>
                     <li>
                        <p>Double-click the installer, <tt class="filename">MacPython-OSX.pkg</tt>.
                        </p>
                     </li>
                     <li>
                        <p>The installer will prompt you for your administrative username and password.</p>
                     </li>
                     <li>
                        <p>Step through the installer program.</p>
                     </li>
                     <li>
                        <p>After installation is complete, close the installer and open the <tt class="filename">/Applications</tt> folder.
                        </p>
                     </li>
                     <li>
                        <p>Open the <tt class="filename">MacPython-2.3</tt> folder
                        </p>
                     </li>
                     <li>
                        <p>Double-click <tt class="filename">PythonIDE</tt> to launch <span class="application">Python</span>.
                        </p>
                     </li>
                  </ol>
               </div>
               <p>The <span class="application">MacPython</span> <span class="acronym">IDE</span> should display a splash screen, then take you to the interactive shell.  If the interactive shell does not appear, select
                  <span class="guimenu">Window</span>-&gt;<span class="guimenuitem">Python Interactive</span> (<span><b class="shortcut"><span><b class="keycap">Cmd</b></span>-<span class="keysym">0</span></b></span>).  The opening window will look something like this:
               </p>
               <div class="informalexample"><pre class="screen">
<span class="computeroutput">Python 2.3 (#2, Jul 30 2003, 11:45:28)
[GCC 3.1 20020420 (prerelease)]
Type "copyright", "credits" or "license" for more information.
MacPython IDE 1.0.1</span>
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre></div>
               <p>Note that once you install the latest version, the pre-installed version is still present.  If you are running scripts from
                  the command line, you need to be aware which version of <span class="application">Python</span> you are using.
               </p>
               <div class="example"><a name="d0e3331"></a><h3 class="title">Example&nbsp;1.1.&nbsp;Two versions of <span class="application">Python</span></h3><pre class="screen">
<tt class="prompt">[localhost:~] you% </tt><span class="userinput">python</span>
<span class="computeroutput">Python 2.2 (#1, 07/14/02, 23:25:09)
[GCC Apple cpp-precomp 6.14] on darwin
Type "help", "copyright", "credits", or "license" for more information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[press Ctrl+D to get back to the command prompt]</span>
<tt class="prompt">[localhost:~] you% </tt><span class="userinput">/usr/local/bin/python</span>
<span class="computeroutput">Python 2.3 (#2, Jul 30 2003, 11:45:28)
[GCC 3.1 20020420 (prerelease)] on darwin
Type "help", "copyright", "credits", or "license" for more information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[press Ctrl+D to get back to the command prompt]</span>
<tt class="prompt">[localhost:~] you% </tt>
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.macos9"></a>1.4.&nbsp;<span class="application">Python</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span> 9
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="abbrev">Mac</span> <span class="acronym">OS</span> 9 does not come with any version of <span class="application">Python</span>, but installation is very simple, and there is only one choice.
                  </p>
               </div>
               <div class="procedure">
                  <p>Follow these steps to install <span class="application">Python</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span> 9:
                  </p>
                  <ol type="1">
                     <li>
                        <p>Download the <tt class="filename">MacPython23full.bin</tt> file from <a href="http://homepages.cwi.nl/~jack/macpython/download.html">http://homepages.cwi.nl/~jack/macpython/download.html</a>.
                        </p>
                     </li>
                     <li>
                        <p>If your browser does not decompress the file automatically, double-click <tt class="filename">MacPython23full.bin</tt> to decompress the file with <span class="application">Stuffit Expander</span>.
                        </p>
                     </li>
                     <li>
                        <p>Double-click the installer, <tt class="filename">MacPython23full</tt>.
                        </p>
                     </li>
                     <li>
                        <p>Step through the installer program.</p>
                     </li>
                     <li>
                        <p>AFter installation is complete, close the installer and open the <tt class="filename">/Applications</tt> folder.
                        </p>
                     </li>
                     <li>
                        <p>Open the <tt class="filename">MacPython-OS9 2.3</tt> folder.
                        </p>
                     </li>
                     <li>
                        <p>Double-click <tt class="filename">Python IDE</tt> to launch <span class="application">Python</span>.
                        </p>
                     </li>
                  </ol>
               </div>
               <p>The <span class="application">MacPython</span> <span class="acronym">IDE</span> should display a splash screen, and then take you to the interactive shell.  If the interactive shell does not appear, select
                  <span class="guimenu">Window</span>-&gt;<span class="guimenuitem">Python Interactive</span> (<span><b class="shortcut"><span><b class="keycap">Cmd</b></span>-<span class="keysym">0</span></b></span>).  You'll see a screen like this:
               </p>
               <div class="informalexample"><pre class="screen">
<span class="computeroutput">Python 2.3 (#2, Jul 30 2003, 11:45:28)
[GCC 3.1 20020420 (prerelease)]
Type "copyright", "credits" or "license" for more information.
MacPython IDE 1.0.1</span>
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.redhat"></a>1.5.&nbsp;<span class="application">Python</span> on RedHat Linux
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>Installing under UNIX-compatible operating systems such as Linux is easy if you're willing to install a binary package.  Pre-built
                  binary packages are available for most popular Linux distributions.  Or you can always compile from source.
               </p>
               <div class="abstract">
                  <p>Download the latest <span class="application">Python</span> <span class="acronym">RPM</span> by going to <a href="http://www.python.org/ftp/python/">http://www.python.org/ftp/python/</a> and selecting the highest version number listed, then selecting the <tt class="filename">rpms/</tt> directory within that.  Then download the <span class="acronym">RPM</span> with the highest version number.  You can install it with the <span><b class="command">rpm</b></span> command, as shown here:
                  </p>
               </div>
               <div class="example"><a name="d0e3510"></a><h3 class="title">Example&nbsp;1.2.&nbsp;Installing on RedHat Linux 9</h3><pre class="screen">
<tt class="prompt">localhost:~$ </tt><span class="userinput">su -</span>
<tt class="prompt">Password: </tt><span class="userinput">[enter your root password]</span>
<tt class="prompt">[root@localhost root]# </tt><span class="userinput">wget http://python.org/ftp/python/2.3/rpms/redhat-9/python2.3-2.3-5pydotorg.i386.rpm</span>
<span class="computeroutput">Resolving python.org... done.
Connecting to python.org[194.109.137.226]:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 7,495,111 [application/octet-stream]
...</span>
<tt class="prompt">[root@localhost root]# </tt><span class="userinput">rpm -Uvh python2.3-2.3-5pydotorg.i386.rpm</span>
<span class="computeroutput">Preparing...                ########################################### [100%]
   1:python2.3              ########################################### [100%]</span>
<tt class="prompt">[root@localhost root]# </tt><span class="userinput">python</span>          <a name="install.unix.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">Python 2.2.2 (#1, Feb 24 2003, 19:13:11)
[GCC 3.2.2 20030222 (Red Hat Linux 3.2.2-4)] on linux2
Type "help", "copyright", "credits", or "license" for more information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[press Ctrl+D to exit]</span>
<tt class="prompt">[root@localhost root]# </tt><span class="userinput">python2.3</span>       <a name="install.unix.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">Python 2.3 (#1, Sep 12 2003, 10:53:56)
[GCC 3.2.2 20030222 (Red Hat Linux 3.2.2-5)] on linux2
Type "help", "copyright", "credits", or "license" for more information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[press Ctrl+D to exit]</span>
<tt class="prompt">[root@localhost root]# </tt><span class="userinput">which python2.3</span> <a name="install.unix.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">/usr/bin/python2.3</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#install.unix.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Whoops!  Just typing <b class="userinput"><tt>python</tt></b> gives you the older version of <span class="application">Python</span> -- the one that was installed by default.  That's not the one you want.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#install.unix.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">At the time of this writing, the newest version is called <b class="userinput"><tt>python2.3</tt></b>.  You'll probably want to change the path on the first line of the sample scripts to point to the newer version.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#install.unix.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the complete path of the newer version of <span class="application">Python</span> that you just installed.  Use this on the <tt class="literal">#!</tt> line (the first line of each script) to ensure that scripts are running under the latest version of <span class="application">Python</span>, and be sure to type <b class="userinput"><tt>python2.3</tt></b> to get into the interactive shell.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.debian"></a>1.6.&nbsp;<span class="application">Python</span> on Debian <span class="acronym">GNU</span>/Linux
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>If you are lucky enough to be running Debian <span class="acronym">GNU</span>/Linux, you install <span class="application">Python</span> through the <span><b class="command">apt</b></span> command.
                  </p>
               </div>
               <div class="example"><a name="d0e3634"></a><h3 class="title">Example&nbsp;1.3.&nbsp;Installing on Debian <span class="acronym">GNU</span>/Linux
                  </h3><pre class="screen">
<tt class="prompt">localhost:~$ </tt><span class="userinput">su -</span>
<tt class="prompt">Password: </tt><span class="userinput">[enter your root password]</span>
<tt class="prompt">localhost:~# </tt><span class="userinput">apt-get install python</span>
<span class="computeroutput">Reading Package Lists... Done
Building Dependency Tree... Done
The following extra packages will be installed:
  python2.3
Suggested packages:
  python-tk python2.3-doc
The following NEW packages will be installed:
  python python2.3
0 upgraded, 2 newly installed, 0 to remove and 3 not upgraded.
Need to get 0B/2880kB of archives.
After unpacking 9351kB of additional disk space will be used.</span>
<tt class="prompt">Do you want to continue? [Y/n] </tt><span class="userinput">Y</span>
<span class="computeroutput">Selecting previously deselected package python2.3.
(Reading database ... 22848 files and directories currently installed.)
Unpacking python2.3 (from .../python2.3_2.3.1-1_i386.deb) ...
Selecting previously deselected package python.
Unpacking python (from .../python_2.3.1-1_all.deb) ...
Setting up python (2.3.1-1) ...
Setting up python2.3 (2.3.1-1) ...
Compiling python modules in /usr/lib/python2.3 ...
Compiling optimized python modules in /usr/lib/python2.3 ...</span>
<tt class="prompt">localhost:~# </tt><span class="userinput">exit</span>
<span class="computeroutput">logout</span>
<tt class="prompt">localhost:~$ </tt><span class="userinput">python</span>
<span class="computeroutput">Python 2.3.1 (#2, Sep 24 2003, 11:39:14)
[GCC 3.3.2 20030908 (Debian prerelease)] on linux2
Type "help", "copyright", "credits" or "license" for more information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[press Ctrl+D to exit]</span>
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.source"></a>1.7.&nbsp;<span class="application">Python</span> Installation from Source
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>If you prefer to build from source, you can download the <span class="application">Python</span> source code from <a href="http://www.python.org/ftp/python/">http://www.python.org/ftp/python/</a>.  Select the highest version number listed, download the <tt class="filename">.tgz</tt> file), and then do the usual <b class="userinput"><tt>configure</tt></b>, <b class="userinput"><tt>make</tt></b>, <b class="userinput"><tt>make install</tt></b> dance.
                  </p>
               </div>
               <div class="example"><a name="d0e3716"></a><h3 class="title">Example&nbsp;1.4.&nbsp;Installing from source</h3><pre class="screen">
<tt class="prompt">localhost:~$ </tt><span class="userinput">su -</span>
<tt class="prompt">Password: </tt><span class="userinput">[enter your root password]</span>
<tt class="prompt">localhost:~# </tt><span class="userinput">wget http://www.python.org/ftp/python/2.3/Python-2.3.tgz</span>
<span class="computeroutput">Resolving www.python.org... done.
Connecting to www.python.org[194.109.137.226]:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 8,436,880 [application/x-tar]
...</span>
<tt class="prompt">localhost:~# </tt><span class="userinput">tar xfz Python-2.3.tgz</span>
<tt class="prompt">localhost:~# </tt><span class="userinput">cd Python-2.3</span>
<tt class="prompt">localhost:~/Python-2.3# </tt><span class="userinput">./configure</span>
<span class="computeroutput">checking MACHDEP... linux2
checking EXTRAPLATDIR...
checking for --without-gcc... no
...</span>
<tt class="prompt">localhost:~/Python-2.3# </tt><span class="userinput">make</span>
<span class="computeroutput">gcc -pthread -c -fno-strict-aliasing -DNDEBUG -g -O3 -Wall -Wstrict-prototypes
-I. -I./Include  -DPy_BUILD_CORE -o Modules/python.o Modules/python.c
gcc -pthread -c -fno-strict-aliasing -DNDEBUG -g -O3 -Wall -Wstrict-prototypes
-I. -I./Include  -DPy_BUILD_CORE -o Parser/acceler.o Parser/acceler.c
gcc -pthread -c -fno-strict-aliasing -DNDEBUG -g -O3 -Wall -Wstrict-prototypes
-I. -I./Include  -DPy_BUILD_CORE -o Parser/grammar1.o Parser/grammar1.c
...</span>
<tt class="prompt">localhost:~/Python-2.3# </tt><span class="userinput">make install</span>
<span class="computeroutput">/usr/bin/install -c python /usr/local/bin/python2.3
...</span>
<tt class="prompt">localhost:~/Python-2.3# </tt><span class="userinput">exit</span>
<span class="computeroutput">logout</span>
<tt class="prompt">localhost:~$ </tt><span class="userinput">which python</span>
<span class="computeroutput">/usr/local/bin/python</span>
<tt class="prompt">localhost:~$ </tt><span class="userinput">python</span>
<span class="computeroutput">Python 2.3.1 (#2, Sep 24 2003, 11:39:14)
[GCC 3.3.2 20030908 (Debian prerelease)] on linux2
Type "help", "copyright", "credits" or "license" for more information.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[press Ctrl+D to get back to the command prompt]</span>
<tt class="prompt">localhost:~$ </tt>
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.shell"></a>1.8.&nbsp;The Interactive Shell
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that you have <span class="application">Python</span> installed, what's this interactive shell thing you're running?
                  </p>
               </div>
               <p>It's like this: <span class="application">Python</span> leads a double life.  It's an interpreter for scripts that you can run from the command line or run like applications, by
                  double-clicking the scripts.  But it's also an interactive shell that can evaluate arbitrary statements and expressions. 
                  This is extremely useful for debugging, quick hacking, and testing.  I even know some people who use the <span class="application">Python</span> interactive shell in lieu of a calculator!
               </p>
               <p>Launch the <span class="application">Python</span> interactive shell in whatever way works on your platform, and let's dive in with the steps shown here:
               </p>
               <div class="example"><a name="d0e3829"></a><h3 class="title">Example&nbsp;1.5.&nbsp;First Steps in the Interactive Shell</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">1 + 1</span>               <a name="install.shell.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print 'hello world'</span> <a name="install.shell.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">hello world</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">x = 1</span>               <a name="install.shell.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">y = 2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">x + y</span>
<span class="computeroutput">3</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#install.shell.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <span class="application">Python</span> interactive shell can evaluate arbitrary <span class="application">Python</span> expressions, including any basic arithmetic expression.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#install.shell.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The interactive shell can execute arbitrary <span class="application">Python</span> statements, including the <span><b class="command">print</b></span> statement.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#install.shell.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can also assign values to variables, and the values will be remembered as long as the shell is open (but not any longer
                              than that).
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="install.summary"></a>1.9.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You should now have a version of <span class="application">Python</span> installed that works for you.
                  </p>
               </div>
               <p>Depending on your platform, you may have more than one version of <span class="application">Python</span> intsalled.  If so, you need to be aware of your paths.  If simply typing <span><b class="command">python</b></span> on the command line doesn't run the version of <span class="application">Python</span> that you want to use, you may need to enter the full pathname of your preferred version.
               </p>
               <p>Congratulations, and welcome to <span class="application">Python</span>.
               </p>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="odbchelper"></a>Chapter&nbsp;2.&nbsp;Your First <span class="application">Python</span> Program
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p>You know how other books go on and on about programming fundamentals and finally work up to building a complete, working program?
                  Let's skip all that.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.divein"></a>2.1.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Here is a complete, working <span class="application">Python</span> program.
                  </p>
               </div>
               <p>It probably makes absolutely no sense to you.  Don't worry about that, because you're going to dissect it line by line.  But
                  read through it first and see what, if anything, you can make of it.
               </p>
               <div class="example"><a name="d0e3948"></a><h3 class="title">Example&nbsp;2.1.&nbsp;<tt class="filename">odbchelper.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
def buildConnectionString(params):
    """Build a connection string from a dictionary of parameters.

    Returns string."""
    return ";".join(["%s=%s" % (k, v) for k, v in params.items()])

if __name__ == "__main__":
    myParams = {"server":"mpilgrim", \
                "database":"master", \
                "uid":"sa", \
                "pwd":"secret" \
                }
    print buildConnectionString(myParams)</pre></div>
               <p>Now run this program and see what happens.</p><a name="tip.run.windows"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">ActivePython</span> <span class="acronym">IDE</span> on Windows, you can run the <span class="application">Python</span> program you're editing by choosing
                        <span class="guimenu">File</span>-&gt;<span class="guimenuitem"><span class="accel">R</span>un...</span> (<span><b class="shortcut"><span><b class="keycap">Ctrl</b></span>-<span class="keysym">R</span></b></span>).  Output is displayed in the interactive window.
                     </td>
                  </tr>
               </table><a name="tip.run.mac"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">Python</span> <span class="acronym">IDE</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span>, you can run a <span class="application">Python</span> program with
                        <span class="guimenu">Python</span>-&gt;<span class="guimenuitem">Run window...</span> (<span><b class="shortcut"><span><b class="keycap">Cmd</b></span>-<span class="keysym">R</span></b></span>), but there is an important option you must set first.  Open the <tt class="filename">.py</tt> file in the <span class="acronym">IDE</span>, pop up the options menu by clicking the black triangle in the upper-right corner of the window, and make sure the <span class="guimenuitem">Run as __main__</span> option is checked.  This is a per-file setting, but you'll only need to do it once per file.
                     </td>
                  </tr>
               </table><a name="tip.run.unix"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">On <span class="acronym">UNIX</span>-compatible systems (including <span class="abbrev">Mac</span> <span class="acronym">OS</span> X), you can run a <span class="application">Python</span> program from the command line: <b class="userinput"><tt>python <tt class="filename">odbchelper.py</tt></tt></b></td>
                  </tr>
               </table>
               <div class="informalexample"><a name="odbchelper.output"></a><p>The output of <tt class="filename">odbchelper.py</tt> will look like this:
                  </p><pre class="screen"><span class="computeroutput">server=mpilgrim;uid=sa;database=master;pwd=secret</span></pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.funcdef"></a>2.2.&nbsp;Declaring Functions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> has functions like most other languages, but it does not have separate header files like <span class="application"><span class="acronym">C++</span></span> or <tt class="literal">interface</tt>/<tt class="literal">implementation</tt> sections like <span class="application">Pascal</span>.  When you need a function, just declare it, like this:
                  </p>
               </div>
               <div class="informalexample"><pre class="programlisting">
def buildConnectionString(params):</pre></div>
               <p>Note that the keyword <tt class="literal">def</tt> starts the function declaration, followed by the function name, followed by the arguments in parentheses.  Multiple arguments
                  (not shown here) are separated with commas.
               </p>
               <p>Also note that the function doesn't define a return datatype.  <span class="application">Python</span> functions do not specify the datatype of their return value; they don't even specify whether or not they return a value.
                  In fact, every <span class="application">Python</span> function returns a value; if the function ever executes a <tt class="literal">return</tt> statement, it will return that value, otherwise it will return <tt class="literal">None</tt>, the <span class="application">Python</span> null value.
               </p><a name="compare.funcdef.vb"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Visual Basic</span>, functions (that return a value) start with <tt class="literal">function</tt>, and subroutines (that do not return a value) start with <tt class="literal">sub</tt>.  There are no subroutines in <span class="application">Python</span>.  Everything is a function, all functions return a value (even if it's <tt class="literal">None</tt>), and all functions start with <tt class="literal">def</tt>.
                     </td>
                  </tr>
               </table>
               <p>The argument, <tt class="literal">params</tt>, doesn't specify a datatype.  In <span class="application">Python</span>, variables are never explicitly typed.  <span class="application">Python</span> figures out what type a variable is and keeps track of it internally.
               </p><a name="compare.funcdef.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Java</span>, <span class="application"><span class="acronym">C++</span></span>, and other statically-typed languages, you must specify the datatype of the function return value and each function argument.
                         In <span class="application">Python</span>, you never explicitly specify the datatype of anything.  Based on what value you assign, <span class="application">Python</span> keeps track of the datatype internally.
                     </td>
                  </tr>
               </table>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e4188"></a>2.2.1.&nbsp;How <span class="application">Python</span>'s Datatypes Compare to Other Programming Languages
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>An erudite reader sent me this explanation of how <span class="application">Python</span> compares to other programming languages:
                  </p>
                  <div class="variablelist">
                     <dl>
                        <dt><span class="term">statically typed language</span></dt>
                        <dd>A language in which types are fixed at compile time.  Most statically typed languages enforce this by requiring you to declare
                           all variables with their datatypes before using them.  <span class="application">Java</span> and <span class="application"><span class="acronym">C</span></span> are statically typed languages.
                        </dd>
                        <dt><span class="term">dynamically typed language</span></dt>
                        <dd>A language in which types are discovered at execution time; the opposite of statically typed.  <span class="application">VBScript</span> and <span class="application">Python</span> are dynamically typed, because they figure out what type a variable is when you first assign it a value.
                        </dd>
                        <dt><span class="term">strongly typed language</span></dt>
                        <dd>A language in which types are always enforced.  <span class="application">Java</span> and <span class="application">Python</span> are strongly typed.  If you have an integer, you can't treat it like a string without explicitly converting it.
                        </dd>
                        <dt><span class="term">weakly typed language</span></dt>
                        <dd>A language in which types may be ignored; the opposite of strongly typed.  <span class="application">VBScript</span> is weakly typed.  In <span class="application">VBScript</span>, you can concatenate the string <tt class="literal">'12'</tt> and the integer <tt class="literal">3</tt> to get the string <tt class="literal">'123'</tt>, then treat that as the integer <tt class="literal">123</tt>, all without any explicit conversion.
                        </dd>
                     </dl>
                  </div>
                  <p>So <span class="application">Python</span> is both <span class="emphasis"><em>dynamically typed</em></span> (because it doesn't use explicit datatype declarations) and <span class="emphasis"><em>strongly typed</em></span> (because once a variable has a datatype, it actually matters).
                  </p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.docstring"></a>2.3.&nbsp;Documenting Functions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You can document a <span class="application">Python</span> function by giving it a <tt class="literal">doc string</tt>.
                  </p>
               </div>
               <div class="example"><a name="odbchelper.triplequotes"></a><h3 class="title">Example&nbsp;2.2.&nbsp;Defining the <tt class="function">buildConnectionString</tt> Function's <tt class="literal">doc string</tt></h3><pre class="programlisting">
def buildConnectionString(params):
    """Build a connection string from a dictionary of parameters.

    Returns string."""</pre><p>Triple quotes signify a multi-line string.  Everything between the start and end quotes is part of a single string, including
                     carriage returns and other quote characters.  You can use them anywhere, but you'll see them most often used when defining
                     a <tt class="literal">doc string</tt>.
                  </p>
               </div><a name="compare.quoting.perl"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Triple quotes are also an easy way to define a string with both single and double quotes, like <tt class="literal">qq/.../</tt> in <span class="application">Perl</span>.
                     </td>
                  </tr>
               </table>
               <p>Everything between the triple quotes is the function's <tt class="literal">doc string</tt>, which documents what the function does.  A <tt class="literal">doc string</tt>, if it exists, must be the first thing defined in a function (that is, the first thing after the colon).  You don't technically
                  need to give your function a <tt class="literal">doc string</tt>, but you always should.  I know you've heard this in every programming class you've ever taken, but <span class="application">Python</span> gives you an added incentive: the <tt class="literal">doc string</tt> is available at runtime as an attribute of the function.
               </p><a name="tip.docstring"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Many <span class="application">Python</span> <span class="acronym">IDE</span>s use the <tt class="literal">doc string</tt> to provide context-sensitive documentation, so that when you type a function name, its <tt class="literal">doc string</tt> appears as a tooltip.  This can be incredibly helpful, but it's only as good as the <tt class="literal">doc string</tt>s you write.
                     </td>
                  </tr>
               </table>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Documenting Functions</h3>
                  <ul>
                     <li><a href="http://www.python.org/peps/pep-0257.html">PEP 257</a> defines <tt class="literal">doc string</tt> conventions.
                     </li>
                     <li><a href="http://www.python.org/doc/essays/styleguide.html"><i class="citetitle"><span class="application">Python</span> Style Guide</i></a> discusses how to write a good <tt class="literal">doc string</tt>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses conventions for <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006750000000000000000">spacing in <tt class="literal">doc string</tt>s</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.objects"></a>2.4.&nbsp;Everything Is an Object
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>In case you missed it, I just said that <span class="application">Python</span> functions have attributes, and that those attributes are available at runtime.
               </p>
               <div class="abstract">
                  <p>A function, like everything else in <span class="application">Python</span>, is an object.
                  </p>
               </div>
               <p>Open your favorite <span class="application">Python</span> <span class="acronym">IDE</span> and follow along:
               </p>
               <div class="example"><a name="odbchelper.import"></a><h3 class="title">Example&nbsp;2.3.&nbsp;Accessing the <tt class="function">buildConnectionString</tt> Function's <tt class="literal">doc string</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import odbchelper</span>                              <a name="odbchelper.objects.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params = {"server":"mpilgrim", "database":"master", "uid":"sa", "pwd":"secret"}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print odbchelper.buildConnectionString(params)</span> <a name="odbchelper.objects.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">server=mpilgrim;uid=sa;database=master;pwd=secret</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print odbchelper.buildConnectionString.__doc__</span> <a name="odbchelper.objects.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">Build a connection string from a dictionary

Returns string.</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.objects.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first line imports the <tt class="filename">odbchelper</tt> program as a module -- a chunk of code that you can use interactively, or from a larger <span class="application">Python</span> program.  (You'll see examples of multi-module <span class="application">Python</span> programs in <a href="#apihelper">Chapter 4</a>.)  Once you import a module, you can reference any of its public functions, classes, or attributes.  Modules can do this
                              to access functionality in other modules, and you can do it in the <span class="acronym">IDE</span> too.  This is an important concept, and you'll talk more about it later.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.objects.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When you want to use functions defined in imported modules, you need to include the module name.  So you can't just say <tt class="function">buildConnectionString</tt>; it must be <tt class="function">odbchelper.buildConnectionString</tt>.  If you've used classes in <span class="application">Java</span>, this should feel vaguely familiar.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.objects.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Instead of calling the function as you would expect to, you asked for one of the function's attributes, <tt class="literal">__doc__</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.import.perl"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">import</tt> in <span class="application">Python</span> is like <tt class="literal">require</tt> in <span class="application">Perl</span>.  Once you <tt class="literal">import</tt> a <span class="application">Python</span> module, you access its functions with <tt class="literal"><i class="replaceable">module</i>.<i class="replaceable">function</i></tt>; once you <tt class="literal">require</tt> a <span class="application">Perl</span> module, you access its functions with <tt class="literal"><i class="replaceable">module</i>::<i class="replaceable">function</i></tt>.
                     </td>
                  </tr>
               </table>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e4550"></a>2.4.1.&nbsp;The Import Search Path
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>Before you go any further, I want to briefly mention the library search path.  <span class="application">Python</span> looks in several places when you try to import a module.  Specifically, it looks in all the directories defined in <tt class="varname">sys.path</tt>.  This is just a list, and you can easily view it or modify it with standard list methods.  (You'll learn more about lists
                     later in this chapter.)
                  </p>
                  <div class="example"><a name="odbchelper.objects.sys.path"></a><h3 class="title">Example&nbsp;2.4.&nbsp;Import Search Path</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import sys</span>                 <a name="odbchelper.objects.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys.path</span>                   <a name="odbchelper.objects.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['', '/usr/local/lib/python2.2', '/usr/local/lib/python2.2/plat-linux2', 
'/usr/local/lib/python2.2/lib-dynload', '/usr/local/lib/python2.2/site-packages', 
'/usr/local/lib/python2.2/site-packages/PIL', '/usr/local/lib/python2.2/site-packages/piddle']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys</span>                        <a name="odbchelper.objects.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;module 'sys' (built-in)&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys.path.append('/my/new/path')</span> <a name="odbchelper.objects.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.objects.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Importing the <tt class="filename">sys</tt> module makes all of its functions and attributes available.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.objects.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="varname">sys.path</tt> is a list of directory names that constitute the current search path.  (Yours will look different, depending on your operating
                                 system, what version of <span class="application">Python</span> you're running, and where it was originally installed.)  <span class="application">Python</span> will look through these directories (in this order) for a <tt class="literal">.py</tt> file matching the module name you're trying to import.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.objects.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Actually, I lied; the truth is more complicated than that, because not all modules are stored as <tt class="literal">.py</tt> files.  Some, like the <tt class="filename">sys</tt> module, are "built-in modules"; they are actually baked right into <span class="application">Python</span> itself.  Built-in modules behave just like regular modules, but their <span class="application">Python</span> source code is not available, because they are not written in <span class="application">Python</span>!  (The <tt class="filename">sys</tt> module is written in <span class="application"><span class="acronym">C</span></span>.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.objects.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You can add a new directory to <span class="application">Python</span>'s search path at runtime by appending the directory name to <tt class="varname">sys.path</tt>, and then <span class="application">Python</span> will look in that directory as well, whenever you try to import a module.  The effect lasts as long as <span class="application">Python</span> is running.  (You'll talk more about <tt class="function">append</tt> and other list methods in <a href="#datatypes">Chapter 3</a>.)
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e4665"></a>2.4.2.&nbsp;What's an Object?
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>Everything in <span class="application">Python</span> is an object, and almost everything has attributes and methods.  All functions have a built-in attribute <tt class="literal">__doc__</tt>, which returns the <tt class="literal">doc string</tt> defined in the function's source code.  The <tt class="filename">sys</tt> module is an object which has (among other things) an attribute called <tt class="varname">path</tt>.  And so forth.
                  </p>
                  <p>Still, this begs the question.  What is an object?  Different programming languages define &#8220;<span class="quote">object</span>&#8221; in different ways.  In some, it means that <span class="emphasis"><em>all</em></span> objects <span class="emphasis"><em>must</em></span> have attributes and methods; in others, it means that all objects are subclassable.  In <span class="application">Python</span>, the definition is looser; some objects have neither attributes nor methods (more on this in <a href="#datatypes">Chapter 3</a>), and not all objects are subclassable (more on this in <a href="#fileinfo">Chapter 5</a>).  But everything is an object in the sense that it can be assigned to a variable or passed as an argument to a function
                     (more in this in <a href="#apihelper">Chapter 4</a>).
                  </p>
                  <p>This is so important that I'm going to repeat it in case you missed it the first few times: <span class="emphasis"><em>everything in <span class="application">Python</span> is an object</em></span>.  Strings are objects.  Lists are objects.  Functions are objects.  Even modules are objects.
                  </p>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on Objects</h3>
                     <ul>
                        <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> explains exactly what it means to say that <a href="http://www.python.org/doc/current/ref/objects.html">everything in <span class="application">Python</span> is an object</a>, because some people are pedantic and like to discuss this sort of thing at great length.
                        </li>
                        <li><a href="http://www.effbot.org/guides/">eff-bot</a> summarizes <a href="http://www.effbot.org/guides/python-objects.htm"><span class="application">Python</span> objects</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.indenting"></a>2.5.&nbsp;Indenting Code
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> functions have no explicit <tt class="literal">begin</tt> or <tt class="literal">end</tt>, and no curly braces to mark where the function code starts and stops.  The only delimiter is a colon (<tt class="literal">:</tt>) and the indentation of the code itself.
                  </p>
               </div>
               <div class="example"><a name="d0e4759"></a><h3 class="title">Example&nbsp;2.5.&nbsp;Indenting the <tt class="function">buildConnectionString</tt> Function
                  </h3><pre class="programlisting">
def buildConnectionString(params):
    """Build a connection string from a dictionary of parameters.

    Returns string."""
    return ";".join(["%s=%s" % (k, v) for k, v in params.items()])</pre></div>
               <p>Code blocks are defined by their indentation.  By "code block", I mean functions, <tt class="literal">if</tt> statements, <tt class="literal">for</tt> loops, <tt class="literal">while</tt> loops, and so forth.  Indenting starts a block and unindenting ends it.  There are no explicit braces, brackets, or keywords.
                  This means that whitespace is significant, and must be consistent.  In this example, the function code (including the <tt class="literal">doc string</tt>) is indented four spaces.  It doesn't need to be four spaces, it just needs to be consistent.  The first line that is not
                  indented is outside the function.
               </p>
               <p><a href="#odbchelper.indenting.if" title="Example&nbsp;2.6.&nbsp;if Statements">Example&nbsp;2.6, &#8220;if Statements&#8221;</a> shows an example of code indentation with <tt class="literal">if</tt> statements.
               </p>
               <div class="example"><a name="odbchelper.indenting.if"></a><h3 class="title">Example&nbsp;2.6.&nbsp;<tt class="literal">if</tt> Statements
                  </h3><pre class="programlisting">
def fib(n):                   <a name="odbchelper.indenting.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    print 'n =', n            <a name="odbchelper.indenting.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    if n &gt; 1:                 <a name="odbchelper.indenting.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        return n * fib(n - 1)
    else:                     <a name="odbchelper.indenting.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        print 'end of the line'
        return 1
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.indenting.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a function named <tt class="function">fib</tt> that takes one argument, <tt class="varname">n</tt>.  All the code within the function is indented.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.indenting.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Printing to the screen is very easy in <span class="application">Python</span>, just use <tt class="function">print</tt>.  <tt class="function">print</tt> statements can take any data type, including strings, integers, and other native types like dictionaries and lists that you'll
                              learn about in the next chapter.  You can even mix and match to print several things on one line by using a comma-separated
                              list of values.  Each value is printed on the same line, separated by spaces (the commas don't print).  So when <tt class="function">fib</tt> is called with <tt class="literal">5</tt>, this will print "n = 5".
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.indenting.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">if</tt> statements are a type of code block.  If the <tt class="literal">if</tt> expression evaluates to true, the indented block is executed, otherwise it falls to the <tt class="literal">else</tt> block.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.indenting.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Of course <tt class="literal">if</tt> and <tt class="literal">else</tt> blocks can contain multiple lines, as long as they are all indented the same amount.  This <tt class="literal">else</tt> block has two lines of code in it.  There is no other special syntax for multi-line code blocks.  Just indent and get on
                              with your life.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>After some initial protests and several snide analogies to <span class="application">Fortran</span>, you will make peace with this and start seeing its benefits.  One major benefit is that all <span class="application">Python</span> programs look similar, since indentation is a language requirement and not a matter of style.  This makes it easier to read
                  and understand other people's <span class="application">Python</span> code.
               </p><a name="compare.lineend.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> uses carriage returns to separate statements and a colon and indentation to separate code blocks.  <span class="application"><span class="acronym">C++</span></span> and <span class="application">Java</span> use semicolons to separate statements and curly braces to separate code blocks.
                     </td>
                  </tr>
               </table>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Code Indentation</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> discusses cross-platform indentation issues and <a href="http://www.python.org/doc/current/ref/indentation.html">shows various indentation errors</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/essays/styleguide.html"><i class="citetitle"><span class="application">Python</span> Style Guide</i></a> discusses good indentation style.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.testing"></a>2.6.&nbsp;Testing Modules
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> modules are objects and have several useful attributes.  You can use this to easily test your modules as you write them.
                     Here's an example that uses the <tt class="literal">if</tt> <tt class="literal">__name__</tt> trick.
                  </p>
               </div>
               <div class="informalexample"><a name="odbchelper.ifnametrick"></a><pre class="programlisting">
if __name__ == "__main__":</pre></div>
               <p>Some quick observations before you get to the good stuff.  First, parentheses are not required around the <tt class="literal">if</tt> expression.  Second, the <tt class="literal">if</tt> statement ends with a colon, and is followed by <a href="#odbchelper.indenting" title="2.5.&nbsp;Indenting Code">indented code</a>.
               </p><a name="compare.equals.c"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Like <span class="application"><span class="acronym">C</span></span>, <span class="application">Python</span> uses <tt class="literal">==</tt> for comparison and <tt class="literal">=</tt> for assignment.  Unlike <span class="application"><span class="acronym">C</span></span>, <span class="application">Python</span> does not support in-line assignment, so there's no chance of accidentally assigning the value you thought you were comparing.
                     </td>
                  </tr>
               </table>
               <p>So why is this particular <tt class="literal">if</tt> statement a trick?  Modules are objects, and all modules have a built-in attribute <tt class="literal">__name__</tt>.  A module's <tt class="literal">__name__</tt> depends on how you're using the module.  If you <tt class="literal">import</tt> the module, then <tt class="literal">__name__</tt> is the module's filename, without a directory path or file extension.  But you can also run the module directly as a standalone
                  program, in which case <tt class="literal">__name__</tt> will be a special default value, <tt class="literal">__main__</tt>.
               </p>
               <div class="informalexample"><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import odbchelper</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">odbchelper.<tt class="literal">__name__</tt></span>
<span class="computeroutput">'odbchelper'</span></pre></div>
               <p>Knowing this, you can design a test suite for your module within the module itself by putting it in this <tt class="literal">if</tt> statement.  When you run the module directly, <tt class="literal">__name__</tt> is <tt class="literal">__main__</tt>, so the test suite executes.  When you import the module, <tt class="literal">__name__</tt> is something else, so the test suite is ignored.  This makes it easier to develop and debug new modules before integrating
                  them into a larger program.
               </p><a name="tip.mac.runasmain"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">On <span class="application">MacPython</span>, there is an additional step to make the <tt class="literal">if</tt> <tt class="literal">__name__</tt> trick work.  Pop up the module's options menu by clicking the black triangle in the upper-right corner of the window, and
                        make sure <span class="guimenuitem">Run as __main__</span> is checked.
                     </td>
                  </tr>
               </table>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Importing Modules</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> discusses the low-level details of <a href="http://www.python.org/doc/current/ref/import.html">importing modules</a>.
                     </li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="datatypes"></a>Chapter&nbsp;3.&nbsp;Native Datatypes
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <p>You'll get back to your first <span class="application">Python</span> program in just a minute.  But first, a short digression is in order, because you need to know about dictionaries, tuples,
               and lists (oh my!).  If you're a <span class="application">Perl</span> hacker, you can probably skim the bits about dictionaries and lists, but you should still pay attention to tuples.
            </p>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.dict"></a>3.1.&nbsp;Introducing Dictionaries
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>One of <span class="application">Python</span>'s built-in datatypes is the dictionary, which defines one-to-one relationships between keys and values.
                  </p>
               </div><a name="compare.dict.perl"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">A dictionary in <span class="application">Python</span> is like a hash in <span class="application">Perl</span>.  In <span class="application">Perl</span>, variables that store hashes always start with a <tt class="literal">%</tt> character.  In <span class="application">Python</span>, variables can be named anything, and <span class="application">Python</span> keeps track of the datatype internally.
                     </td>
                  </tr>
               </table><a name="compare.dict.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">A dictionary in <span class="application">Python</span> is like an instance of the <tt class="classname">Hashtable</tt> class in <span class="application">Java</span>.
                     </td>
                  </tr>
               </table><a name="compare.dict.vb"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">A dictionary in <span class="application">Python</span> is like an instance of the <tt class="classname">Scripting.Dictionary</tt> object in <span class="application">Visual Basic</span>.
                     </td>
                  </tr>
               </table>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e5174"></a>3.1.1.&nbsp;Defining Dictionaries
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="odbchelper.dict.define"></a><h3 class="title">Example&nbsp;3.1.&nbsp;Defining a Dictionary</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d = {"server":"mpilgrim", "database":"master"}</span> <a name="odbchelper.dict.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'database': 'master'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["server"]</span>                                    <a name="odbchelper.dict.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'mpilgrim'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["database"]</span>                                  <a name="odbchelper.dict.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'master'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["mpilgrim"]</span>                                  <a name="odbchelper.dict.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
KeyError: mpilgrim</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">First, you create a new dictionary with two elements and assign it to the variable <tt class="varname">d</tt>.  Each element is a key-value pair, and the whole set of elements is enclosed in curly braces.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'server'</tt> is a key, and its associated value, referenced by <tt class="literal">d["server"]</tt>, is <tt class="literal">'mpilgrim'</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'database'</tt> is a key, and its associated value, referenced by <tt class="literal">d["database"]</tt>, is <tt class="literal">'master'</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You can get values by key, but you can't get keys by value.  So <tt class="literal">d["server"]</tt> is <tt class="literal">'mpilgrim'</tt>, but <tt class="literal">d["mpilgrim"]</tt> raises an exception, because <tt class="literal">'mpilgrim'</tt> is not a key.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e5269"></a>3.1.2.&nbsp;Modifying Dictionaries
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="odbchelper.dict.modify"></a><h3 class="title">Example&nbsp;3.2.&nbsp;Modifying a Dictionary</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'database': 'master'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["database"] = "pubs"</span> <a name="odbchelper.dict.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'database': 'pubs'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["uid"] = "sa"</span>        <a name="odbchelper.dict.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'uid': 'sa', 'database': 'pubs'}</span></pre></div>
                  <div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.dict.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can not have duplicate keys in a dictionary.  Assigning a value to an existing key will wipe out the old value.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.dict.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can add new key-value pairs at any time.  This syntax is identical to modifying existing values.  (Yes, this will annoy
                              you someday when you think you are adding new values but are actually just modifying the same value over and over because
                              your key isn't changing the way you think it is.)
                           </td>
                        </tr>
                     </table>
                  </div>
                  <p>Note that the new element (key <tt class="literal">'uid'</tt>, value <tt class="literal">'sa'</tt>) appears to be in the middle.  In fact, it was just a coincidence that the elements appeared to be in order in the first
                     example; it is just as much a coincidence that they appear to be out of order now.
                  </p><a name="tip.dictorder"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Dictionaries have no concept of order among elements.  It is incorrect to say that the elements are &#8220;<span class="quote">out of order</span>&#8221;; they are simply unordered.  This is an important distinction that will annoy you when you want to access the elements of
                           a dictionary in a specific, repeatable order (like alphabetical order by key).  There are ways of doing this, but they're
                           not built into the dictionary.
                        </td>
                     </tr>
                  </table>
                  <p>When working with dictionaries, you need to be aware that dictionary keys are case-sensitive.</p>
                  <div class="example"><a name="odbchelper.dict.case"></a><h3 class="title">Example&nbsp;3.3.&nbsp;Dictionary Keys Are Case-Sensitive</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d = {}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["key"] = "value"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["key"] = "other value"</span> <a name="odbchelper.dict.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'key': 'other value'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["Key"] = "third value"</span> <a name="odbchelper.dict.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'Key': 'third value', 'key': 'other value'}</span>
</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Assigning a value to an existing dictionary key simply replaces the old value with a new one.</td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This is not assigning a value to an existing dictionary key, because strings in <span class="application">Python</span> are case-sensitive, so <tt class="literal">'key'</tt> is not the same as <tt class="literal">'Key'</tt>.  This creates a new key/value pair in the dictionary; it may look similar to you, but as far as <span class="application">Python</span> is concerned, it's completely different.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="example"><a name="odbchelper.dictionarytypes"></a><h3 class="title">Example&nbsp;3.4.&nbsp;Mixing Datatypes in a Dictionary</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'uid': 'sa', 'database': 'pubs'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d["retrycount"] = 3</span> <a name="odbchelper.dict.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'uid': 'sa', 'database': 'master', 'retrycount': 3}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d[42] = "douglas"</span>   <a name="odbchelper.dict.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'uid': 'sa', 'database': 'master',
42: 'douglas', 'retrycount': 3}</span></pre></div>
                  <div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.dict.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Dictionaries aren't just for strings.  Dictionary values can be any datatype, including strings, integers, objects, or even
                              other dictionaries.  And within a single dictionary, the values don't all need to be the same type; you can mix and match
                              as needed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.dict.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Dictionary keys are more restricted, but they can be strings, integers, and a few other types.  You can also mix and match
                              key datatypes within a dictionary.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e5450"></a>3.1.3.&nbsp;Deleting Items From Dictionaries
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="odbchelper.dict.del"></a><h3 class="title">Example&nbsp;3.5.&nbsp;Deleting Items from a Dictionary</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'uid': 'sa', 'database': 'master',
42: 'douglas', 'retrycount': 3}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">del d[42]</span> <a name="odbchelper.dict.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{'server': 'mpilgrim', 'uid': 'sa', 'database': 'master', 'retrycount': 3}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d.clear()</span> <a name="odbchelper.dict.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d</span>
<span class="computeroutput">{}</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">del</tt> lets you delete individual items from a dictionary by key.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.dict.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">clear</tt> deletes all items from a dictionary.  Note that the set of empty curly braces signifies a dictionary without any items.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on Dictionaries</h3>
                     <ul>
                        <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> teaches about dictionaries and shows how to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap10.htm">use dictionaries to model sparse matrices</a>.
                        </li>
                        <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> has a lot of <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/541">example code using dictionaries</a>.
                        </li>
                        <li><a href="http://www.activestate.com/ASPN/Python/Cookbook/" title="growing archive of annotated code samples"><span class="application">Python</span> Cookbook</a> discusses <a href="http://www.activestate.com/ASPN/Python/Cookbook/Recipe/52306">how to sort the values of a dictionary by key</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/typesmapping.html">all the dictionary methods</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.list"></a>3.2.&nbsp;Introducing Lists
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Lists are <span class="application">Python</span>'s workhorse datatype.  If your only experience with lists is arrays in <span class="application">Visual Basic</span> or (God forbid) the datastore in <span class="application">Powerbuilder</span>, brace yourself for <span class="application">Python</span> lists.
                  </p>
               </div><a name="compare.list.perl"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">A list in <span class="application">Python</span> is like an array in <span class="application">Perl</span>.  In <span class="application">Perl</span>, variables that store arrays always start with the <tt class="literal">@</tt> character; in <span class="application">Python</span>, variables can be named anything, and <span class="application">Python</span> keeps track of the datatype internally.
                     </td>
                  </tr>
               </table><a name="compare.list.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">A list in <span class="application">Python</span> is much more than an array in <span class="application">Java</span> (although it can be used as one if that's really all you want out of life).  A better analogy would be to the <tt class="classname">ArrayList</tt> class, which can hold arbitrary objects and can expand dynamically as new items are added.
                     </td>
                  </tr>
               </table>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e5623"></a>3.2.1.&nbsp;Defining Lists
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="d0e5626"></a><h3 class="title">Example&nbsp;3.6.&nbsp;Defining a List</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ["a", "b", "mpilgrim", "z", "example"]</span> <a name="odbchelper.list.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'z', 'example']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[0]</span>                                       <a name="odbchelper.list.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'a'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[4]</span>                                       <a name="odbchelper.list.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'example'</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">First, you define a list of five elements.  Note that they retain their original order.  This is not an accident.  A list
                                 is an ordered set of elements enclosed in square brackets.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">A list can be used like a zero-based array.  The first element of any non-empty list is always <tt class="literal">li[0]</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The last element of this five-element list is <tt class="literal">li[4]</tt>, because lists are always zero-based.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="example"><a name="odbchelper.negative.example"></a><h3 class="title">Example&nbsp;3.7.&nbsp;Negative List Indices</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'z', 'example']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[-1]</span> <a name="odbchelper.list.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'example'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[-3]</span> <a name="odbchelper.list.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'mpilgrim'</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">A negative index accesses elements from the end of the list counting backwards.  The last element of any non-empty list is
                                 always <tt class="literal">li[-1]</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">If the negative index is confusing to you, think of it this way: <tt class="literal">li[-n] == li[len(li) - n]</tt>.  So in this list, <tt class="literal">li[-3] == li[5 - 3] == li[2]</tt>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="example"><a name="odbchelper.list.slice"></a><h3 class="title">Example&nbsp;3.8.&nbsp;Slicing a List</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'z', 'example']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[1:3]</span>  <a name="odbchelper.list.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['b', 'mpilgrim']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[1:-1]</span> <a name="odbchelper.list.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['b', 'mpilgrim', 'z']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[0:3]</span>  <a name="odbchelper.list.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['a', 'b', 'mpilgrim']</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You can get a subset of a list, called a &#8220;<span class="quote">slice</span>&#8221;, by specifying two indices.  The return value is a new list containing all the elements of the list, in order, starting with
                                 the first slice index (in this case <tt class="literal">li[1]</tt>), up to but not including the second slice index (in this case <tt class="literal">li[3]</tt>).
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Slicing works if one or both of the slice indices is negative.  If it helps, you can think of it this way: reading the list
                                 from left to right, the first slice index specifies the first element you want, and the second slice index specifies the first
                                 element you don't want.  The return value is everything in between.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Lists are zero-based, so <tt class="literal">li[0:3]</tt> returns the first three elements of the list, starting at <tt class="literal">li[0]</tt>, up to but not including <tt class="literal">li[3]</tt>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="example"><a name="odbchelper.list.slicing.example"></a><h3 class="title">Example&nbsp;3.9.&nbsp;Slicing Shorthand</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'z', 'example']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[:3]</span> <a name="odbchelper.list.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['a', 'b', 'mpilgrim']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[3:]</span> <a name="odbchelper.list.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"> <a name="odbchelper.list.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['z', 'example']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[:]</span>  <a name="odbchelper.list.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">['a', 'b', 'mpilgrim', 'z', 'example']</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">If the left slice index is 0, you can leave it out, and 0 is implied.  So <tt class="literal">li[:3]</tt> is the same as <tt class="literal">li[0:3]</tt> from <a href="#odbchelper.list.slice" title="Example&nbsp;3.8.&nbsp;Slicing a List">Example&nbsp;3.8, &#8220;Slicing a List&#8221;</a>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Similarly, if the right slice index is the length of the list, you can leave it out.  So <tt class="literal">li[3:]</tt> is the same as <tt class="literal">li[3:5]</tt>, because this list has five elements.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Note the symmetry here.  In this five-element list, <tt class="literal">li[:3]</tt> returns the first 3 elements, and <tt class="literal">li[3:]</tt> returns the last two elements.  In fact, <tt class="literal">li[:n]</tt> will always return the first <tt class="literal">n</tt> elements, and <tt class="literal">li[n:]</tt> will return the rest, regardless of the length of the list.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">If both slice indices are left out, all elements of the list are included.  But this is not the same as the original <tt class="varname">li</tt> list; it is a new list that happens to have all the same elements.  <tt class="literal">li[:]</tt> is shorthand for making a complete copy of a list.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e5887"></a>3.2.2.&nbsp;Adding Elements to Lists
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="d0e5890"></a><h3 class="title">Example&nbsp;3.10.&nbsp;Adding Elements to a List</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'z', 'example']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.append("new")</span>               <a name="odbchelper.list.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'z', 'example', 'new']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.insert(2, "new")</span>            <a name="odbchelper.list.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'new', 'mpilgrim', 'z', 'example', 'new']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.extend(["two", "elements"])</span> <a name="odbchelper.list.5.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'new', 'mpilgrim', 'z', 'example', 'new', 'two', 'elements']</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">append</tt> adds a single element to the end of the list.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">insert</tt> inserts a single element into a list.  The numeric argument is the index of the first element that gets bumped out of position.
                                  Note that list elements do not need to be unique; there are now two separate elements with the value <tt class="literal">'new'</tt>, <tt class="literal">li[2]</tt> and <tt class="literal">li[6]</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.5.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">extend</tt> concatenates lists.  Note that you do not call <tt class="function">extend</tt> with multiple arguments; you call it with one argument, a list.  In this case, that list has two elements.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="example"><a name="odbchelper.list.append.vs.extend"></a><h3 class="title">Example&nbsp;3.11.&nbsp;The Difference between <tt class="function">extend</tt> and <tt class="function">append</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ['a', 'b', 'c']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.extend(['d', 'e', 'f'])</span> <a name="odbchelper.list.5.4"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'c', 'd', 'e', 'f']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">len(li)</span>                    <a name="odbchelper.list.5.5"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">6</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[-1]</span>
<span class="computeroutput">'f'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ['a', 'b', 'c']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.append(['d', 'e', 'f'])</span> <a name="odbchelper.list.5.6"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'c', ['d', 'e', 'f']]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">len(li)</span>                    <a name="odbchelper.list.5.7"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">4</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li[-1]</span>
<span class="computeroutput">['d', 'e', 'f']</span>
</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.5.4"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Lists have two methods, <tt class="function">extend</tt> and <tt class="function">append</tt>, that look like they do the same thing, but are in fact completely different.  <tt class="function">extend</tt> takes a single argument, which is always a list, and adds each of the elements of that list to the original list.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.5.5"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Here you started with a list of three elements (<tt class="literal">'a'</tt>, <tt class="literal">'b'</tt>, and <tt class="literal">'c'</tt>), and you extended the list with a list of another three elements (<tt class="literal">'d'</tt>, <tt class="literal">'e'</tt>, and <tt class="literal">'f'</tt>), so you now have a list of six elements.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.5.6"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">On the other hand, <tt class="function">append</tt> takes one argument, which can be any data type, and simply adds it to the end of the list.  Here, you're calling the <tt class="function">append</tt> method with a single argument, which is a list of three elements.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.5.7"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Now the original list, which started as a list of three elements, contains four elements.  Why four?  Because the last element
                                 that you just appended <span class="emphasis"><em>is itself a list</em></span>.  Lists can contain any type of data, including other lists.  That may be what you want, or maybe not.  Don't use <tt class="function">append</tt> if you mean <tt class="function">extend</tt>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e6115"></a>3.2.3.&nbsp;Searching Lists
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="odbchelper.list.search"></a><h3 class="title">Example&nbsp;3.12.&nbsp;Searching a List</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'new', 'mpilgrim', 'z', 'example', 'new', 'two', 'elements']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.index("example")</span> <a name="odbchelper.list.6.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">5</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.index("new")</span>     <a name="odbchelper.list.6.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.index("c")</span>       <a name="odbchelper.list.6.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
ValueError: list.index(x): x not in list</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">"c" in li</span>           <a name="odbchelper.list.6.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">False</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.6.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">index</tt> finds the first occurrence of a value in the list and returns the index.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.6.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">index</tt> finds the <span class="emphasis"><em>first</em></span> occurrence of a value in the list.  In this case, <tt class="literal">'new'</tt> occurs twice in the list, in <tt class="literal">li[2]</tt> and <tt class="literal">li[6]</tt>, but <tt class="function">index</tt> will return only the first index, <tt class="literal">2</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.6.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">If the value is not found in the list, <span class="application">Python</span> raises an exception.  This is notably different from most languages, which will return some invalid index.  While this may
                                 seem annoying, it is a good thing, because it means your program will crash at the source of the problem, rather than later
                                 on when you try to use the invalid index.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.6.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">To test whether a value is in the list, use <tt class="function">in</tt>, which returns <tt class="constant">True</tt> if the value is found or <tt class="constant">False</tt> if it is not.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div><a name="tip.boolean"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Before version 2.2.1, <span class="application">Python</span> had no separate boolean datatype.  To compensate for this, <span class="application">Python</span> accepted almost anything in a boolean context (like an <tt class="literal">if</tt> statement), according to the following rules:
                           <div class="itemizedlist">
                              <ul>
                                 <li><tt class="constant">0</tt> is false; all other numbers are true.
                                 </li>
                                 <li>An empty string (<tt class="literal">""</tt>) is false, all other strings are true.
                                 </li>
                                 <li>An empty list (<tt class="literal">[]</tt>) is false; all other lists are true.
                                 </li>
                                 <li>An empty tuple (<tt class="literal">()</tt>) is false; all other tuples are true.
                                 </li>
                                 <li>An empty dictionary (<tt class="literal">{}</tt>) is false; all other dictionaries are true.
                                 </li>
                              </ul>
                           </div>These rules still apply in <span class="application">Python</span> 2.2.1 and beyond, but now you can also use an actual boolean, which has a value of <tt class="literal">True</tt> or <tt class="literal">False</tt>.  Note the capitalization; these values, like everything else in <span class="application">Python</span>, are case-sensitive.
                        </td>
                     </tr>
                  </table>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e6277"></a>3.2.4.&nbsp;Deleting List Elements
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="odbchelper.list.removingelements"></a><h3 class="title">Example&nbsp;3.13.&nbsp;Removing Elements from a List</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'new', 'mpilgrim', 'z', 'example', 'new', 'two', 'elements']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.remove("z")</span>   <a name="odbchelper.list.7.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'new', 'mpilgrim', 'example', 'new', 'two', 'elements']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.remove("new")</span> <a name="odbchelper.list.7.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'example', 'new', 'two', 'elements']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.remove("c")</span>   <a name="odbchelper.list.7.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
ValueError: list.remove(x): x not in list</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.pop()</span>         <a name="odbchelper.list.7.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'elements'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'example', 'new', 'two']</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.7.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">remove</tt> removes the first occurrence of a value from a list.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.7.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">remove</tt> removes <span class="emphasis"><em>only</em></span> the first occurrence of a value.  In this case, <tt class="literal">'new'</tt> appeared twice in the list, but <tt class="literal">li.remove("new")</tt> removed only the first occurrence.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.7.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">If the value is not found in the list, <span class="application">Python</span> raises an exception.  This mirrors the behavior of the <tt class="function">index</tt> method.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.7.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">pop</tt> is an interesting beast.  It does two things: it removes the last element of the list, and it returns the value that it removed.
                                  Note that this is different from <tt class="literal">li[-1]</tt>, which returns a value but does not change the list, and different from <tt class="literal">li.remove(<i class="replaceable">value</i>)</tt>, which changes the list but does not return a value.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e6392"></a>3.2.5.&nbsp;Using List Operators
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="odbchelper.list.operators"></a><h3 class="title">Example&nbsp;3.14.&nbsp;List Operators</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ['a', 'b', 'mpilgrim']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = li + ['example', 'new']</span> <a name="odbchelper.list.8.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'example', 'new']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li += ['two']</span>                <a name="odbchelper.list.8.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">['a', 'b', 'mpilgrim', 'example', 'new', 'two']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = [1, 2] * 3</span>              <a name="odbchelper.list.8.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">[1, 2, 1, 2, 1, 2]</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.8.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Lists can also be concatenated with the <tt class="literal">+</tt> operator.  <tt class="literal"><i class="replaceable">list</i> = <i class="replaceable">list</i> + <i class="replaceable">otherlist</i></tt> has the same result as <tt class="literal"><i class="replaceable">list</i>.extend(<i class="replaceable">otherlist</i>)</tt>.  But the <tt class="literal">+</tt> operator returns a new (concatenated) list as a value, whereas <tt class="function">extend</tt> only alters an existing list.  This means that <tt class="function">extend</tt> is faster, especially for large lists.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.8.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><span class="application">Python</span> supports the <tt class="literal">+=</tt> operator.  <tt class="literal">li += ['two']</tt> is equivalent to <tt class="literal">li.extend(['two'])</tt>.  The <tt class="literal">+=</tt> operator works for lists, strings, and integers, and it can be overloaded to work for user-defined classes as well.  (More
                                 on classes in <a href="#fileinfo">Chapter 5</a>.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.list.8.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="literal">*</tt> operator works on lists as a repeater.  <tt class="literal">li = [1, 2] * 3</tt> is equivalent to <tt class="literal">li = [1, 2] + [1, 2] + [1, 2]</tt>, which concatenates the three lists into one.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on Lists</h3>
                     <ul>
                        <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> teaches about lists and makes an important point about <a href="http://www.ibiblio.org/obp/thinkCSpy/chap08.htm">passing lists as function arguments</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007110000000000000000">use lists as stacks and queues</a>.
                        </li>
                        <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/534">common questions about lists</a> and has a lot of <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/540">example code using lists</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/typesseq-mutable.html">all the list methods</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.tuple"></a>3.3.&nbsp;Introducing Tuples
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>A tuple is an immutable list.  A tuple can not be changed in any way once it is created.</p>
               </div>
               <div class="example"><a name="d0e6568"></a><h3 class="title">Example&nbsp;3.15.&nbsp;Defining a tuple</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t = ("a", "b", "mpilgrim", "z", "example")</span> <a name="odbchelper.tuple.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t</span>
<span class="computeroutput">('a', 'b', 'mpilgrim', 'z', 'example')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t[0]</span>                                       <a name="odbchelper.tuple.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'a'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t[-1]</span>                                      <a name="odbchelper.tuple.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'example'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t[1:3]</span>                                     <a name="odbchelper.tuple.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">('b', 'mpilgrim')</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">A tuple is defined in the same way as a list, except that the whole set of elements is enclosed in parentheses instead of
                              square brackets.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The elements of a tuple have a defined order, just like a list.  Tuples indices are zero-based, just like a list, so the first
                              element of a non-empty tuple is always <tt class="literal">t[0]</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Negative indices count from the end of the tuple, just as with a list.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Slicing works too, just like a list.  Note that when you slice a list, you get a new list; when you slice a tuple, you get
                              a new tuple.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="odbchelper.tuplemethods"></a><h3 class="title">Example&nbsp;3.16.&nbsp;Tuples Have No Methods</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t</span>
<span class="computeroutput">('a', 'b', 'mpilgrim', 'z', 'example')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t.append("new")</span>    <a name="odbchelper.tuple.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
AttributeError: 'tuple' object has no attribute 'append'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t.remove("z")</span>      <a name="odbchelper.tuple.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
AttributeError: 'tuple' object has no attribute 'remove'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t.index("example")</span> <a name="odbchelper.tuple.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
AttributeError: 'tuple' object has no attribute 'index'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">"z" in t</span>           <a name="odbchelper.tuple.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">True</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can't add elements to a tuple.  Tuples have no <tt class="function">append</tt> or <tt class="function">extend</tt> method.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can't remove elements from a tuple.  Tuples have no <tt class="function">remove</tt> or <tt class="function">pop</tt> method.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can't find elements in a tuple.  Tuples have no <tt class="function">index</tt> method.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.tuple.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can, however, use <tt class="function">in</tt> to see if an element exists in the tuple.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So what are tuples good for?</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Tuples are faster than lists.  If you're defining a constant set of values and all you're ever going to do with it is iterate
                        through it, use a tuple instead of a list.
                     </li>
                     <li>It makes your code safer if you &#8220;<span class="quote">write-protect</span>&#8221; data that does not need to be changed.  Using a tuple instead of a list is like having an implied <tt class="literal">assert</tt> statement that shows this data is constant, and that special thought (and a specific function) is required to override that.
                     </li>
                     <li>Remember that I said that <a href="#odbchelper.dictionarytypes" title="Example&nbsp;3.4.&nbsp;Mixing Datatypes in a Dictionary">dictionary keys</a> can be integers, strings, and &#8220;<span class="quote">a few other types</span>&#8221;?  Tuples are one of those types.  Tuples can be used as keys in a dictionary, but lists can't be used this way.Actually, it's more complicated than that.  Dictionary keys must be immutable.  Tuples themselves are immutable, but if you
                        have a tuple of lists, that counts as mutable and isn't safe to use as a dictionary key.  Only tuples of strings, numbers,
                        or other dictionary-safe tuples can be used as dictionary keys.
                     </li>
                     <li>Tuples are used in string formatting, as you'll see shortly.</li>
                  </ul>
               </div><a name="tip.tuple"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Tuples can be converted into lists, and vice-versa.  The built-in <tt class="function">tuple</tt> function takes a list and returns a tuple with the same elements, and the <tt class="function">list</tt> function takes a tuple and returns a list.  In effect, <tt class="function">tuple</tt> freezes a list, and <tt class="function">list</tt> thaws a tuple.
                     </td>
                  </tr>
               </table>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Tuples</h3>
                  <ul>
                     <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> teaches about tuples and shows how to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap10.htm">concatenate tuples</a>.
                     </li>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> shows how to <a href="http://www.faqts.com/knowledge-base/view.phtml/aid/4553/fid/587">sort a tuple</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007300000000000000000">define a tuple with one element</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.vardef"></a>3.4.&nbsp;Declaring variables
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>Now that you know something about dictionaries, tuples, and lists (oh my!), let's get back to the sample program from <a href="#odbchelper">Chapter 2</a>, <tt class="filename">odbchelper.py</tt>.
               </p>
               <div class="abstract">
                  <p><span class="application">Python</span> has local and global variables like most other languages, but it has no explicit variable declarations.  Variables spring
                     into existence by being assigned a value, and they are automatically destroyed when they go out of scope.
                  </p>
               </div>
               <div class="example"><a name="myparamsdef"></a><h3 class="title">Example&nbsp;3.17.&nbsp;Defining the <tt class="varname">myParams</tt> Variable
                  </h3><pre class="programlisting">
if __name__ == "__main__":
    myParams = {"server":"mpilgrim", \
                "database":"master", \
                "uid":"sa", \
                "pwd":"secret" \
                }</pre></div>
               <p>Notice the indentation.  An <tt class="literal">if</tt> statement is a code block and needs to be indented just like a function.
               </p>
               <p>Also notice that the variable assignment is one command split over several lines, with a backslash (&#8220;<span class="quote"><tt class="literal">\</tt></span>&#8221;) serving as a line-continuation marker.
               </p><a name="tip.multiline"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">When a command is split among several lines with the line-continuation marker (&#8220;<span class="quote"><tt class="literal">\</tt></span>&#8221;), the continued lines can be indented in any manner; <span class="application">Python</span>'s normally stringent indentation rules do not apply.  If your <span class="application">Python</span> <span class="acronym">IDE</span> auto-indents the continued line, you should probably accept its default unless you have a burning reason not to.
                     </td>
                  </tr>
               </table>
               <p><a name="tip.implicitmultiline"></a>Strictly speaking, expressions in parentheses, straight brackets, or curly braces (like <a href="#myparamsdef" title="Example&nbsp;3.17.&nbsp;Defining the myParams Variable">defining a dictionary</a>) can be split into multiple lines with or without the line continuation character (&#8220;<span class="quote"><tt class="literal">\</tt></span>&#8221;).  I like to include the backslash even when it's not required because I think it makes the code easier to read, but that's
                  a matter of style.
               </p>
               <p>Third, you never declared the variable <tt class="varname">myParams</tt>, you just assigned a value to it.  This is like <span class="application">VBScript</span> without the <tt class="option">option explicit</tt> option.  Luckily, unlike <span class="application">VBScript</span>, <span class="application">Python</span> will not allow you to reference a variable that has never been assigned a value; trying to do so will raise an exception.
               </p>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e6873"></a>3.4.1.&nbsp;Referencing Variables
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="odbchelper.unboundvariable"></a><h3 class="title">Example&nbsp;3.18.&nbsp;Referencing an Unbound Variable</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">x</span>
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
NameError: There is no variable named 'x'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">x = 1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">x</span>
<span class="computeroutput">1</span></pre></div>
                  <p>You will thank <span class="application">Python</span> for this one day.
                  </p>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="odbchelper.multiassign"></a>3.4.2.&nbsp;Assigning Multiple Values at Once
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>One of the cooler programming shortcuts in <span class="application">Python</span> is using sequences to assign multiple values at once.
                  </p>
                  <div class="example"><a name="d0e6913"></a><h3 class="title">Example&nbsp;3.19.&nbsp;Assigning multiple values at once</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">v = ('a', 'b', 'e')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">(x, y, z) = v</span>     <a name="odbchelper.multiassign.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">x</span>
<span class="computeroutput">'a'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">y</span>
<span class="computeroutput">'b'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">z</span>
<span class="computeroutput">'e'</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.multiassign.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="varname">v</tt> is a tuple of three elements, and <tt class="literal">(x, y, z)</tt> is a tuple of three variables.  Assigning one to the other assigns each of the values of <tt class="varname">v</tt> to each of the variables, in order.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>This has all sorts of uses.  I often want to assign names to a range of values.  In <span class="application"><span class="acronym">C</span></span>, you would use <tt class="literal">enum</tt> and manually list each constant and its associated value, which seems especially tedious when the values are consecutive.
                     In <span class="application">Python</span>, you can use the built-in <tt class="function">range</tt> function with multi-variable assignment to quickly assign consecutive values.
                  </p>
                  <div class="example"><a name="odbchelper.multiassign.range"></a><h3 class="title">Example&nbsp;3.20.&nbsp;Assigning Consecutive Values</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">range(7)</span>                                                                    <a name="odbchelper.multiassign.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[0, 1, 2, 3, 4, 5, 6]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">(MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY) = range(7)</span> <a name="odbchelper.multiassign.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">MONDAY</span>                                                                      <a name="odbchelper.multiassign.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">0</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">TUESDAY</span>
<span class="computeroutput">1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">SUNDAY</span>
<span class="computeroutput">6</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.multiassign.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The built-in <tt class="function">range</tt> function returns a list of integers.  In its simplest form, it takes an upper limit and returns a zero-based list counting
                                 up to but not including the upper limit.  (If you like, you can pass other parameters to specify a base other than <tt class="constant">0</tt> and a step other than <tt class="constant">1</tt>.  You can <tt class="literal">print range.__doc__</tt> for details.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.multiassign.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="varname">MONDAY</tt>, <tt class="varname">TUESDAY</tt>, <tt class="varname">WEDNESDAY</tt>, <tt class="varname">THURSDAY</tt>, <tt class="varname">FRIDAY</tt>, <tt class="varname">SATURDAY</tt>, and <tt class="varname">SUNDAY</tt> are the variables you're defining.  (This example came from the <tt class="filename">calendar</tt> module, a fun little module that prints calendars, like the <span class="acronym">UNIX</span> program <tt class="filename">cal</tt>.  The <tt class="filename">calendar</tt> module defines integer constants for days of the week.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#odbchelper.multiassign.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Now each variable has its value: <tt class="varname">MONDAY</tt> is <tt class="constant">0</tt>, <tt class="varname">TUESDAY</tt> is <tt class="constant">1</tt>, and so forth.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>You can also use multi-variable assignment to build functions that return multiple values, simply by returning a tuple of
                     all the values.  The caller can treat it as a tuple, or assign the values to individual variables.  Many standard <span class="application">Python</span> libraries do this, including the <tt class="filename">os</tt> module, which you'll discuss in <a href="#filehandling">Chapter 6</a>.
                  </p>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on Variables</h3>
                     <ul>
                        <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> shows examples of <a href="http://www.python.org/doc/current/ref/implicit-joining.html">when you can skip the line continuation character</a> and <a href="http://www.python.org/doc/current/ref/explicit-joining.html">when you need to use it</a>.
                        </li>
                        <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> shows how to use multi-variable assignment to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap09.htm">swap the values of two variables</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.stringformatting"></a>3.5.&nbsp;Formatting Strings
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> supports formatting values into strings.  Although this can include very complicated expressions, the most basic usage is
                     to insert values into a string with the <tt class="literal">%s</tt> placeholder.
                  </p>
               </div><a name="compare.stringformatting.c"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">String formatting in <span class="application">Python</span> uses the same syntax as the <tt class="function">sprintf</tt> function in <span class="application"><span class="acronym">C</span></span>.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="d0e7165"></a><h3 class="title">Example&nbsp;3.21.&nbsp;Introducing String Formatting</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">k = "uid"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">v = "sa"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">"%s=%s" % (k, v)</span> <a name="odbchelper.stringformatting.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'uid=sa'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The whole expression evaluates to a string.  The first <tt class="literal">%s</tt> is replaced by the value of <tt class="varname">k</tt>; the second <tt class="literal">%s</tt> is replaced by the value of <tt class="varname">v</tt>.  All other characters in the string (in this case, the equal sign) stay as they are.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Note that <tt class="literal">(k, v)</tt> is a tuple.  I told you they were good for something.
               </p>
               <p>You might be thinking that this is a lot of work just to do simple string concatentation, and you would be right, except that
                  string formatting isn't just concatenation.  It's not even just formatting.  It's also type coercion.
               </p>
               <div class="example"><a name="odbchelper.stringformatting.coerce"></a><h3 class="title">Example&nbsp;3.22.&nbsp;String Formatting vs. Concatenating</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">uid = "sa"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pwd = "secret"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print pwd + " is not a good password for " + uid</span>      <a name="odbchelper.stringformatting.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">secret is not a good password for sa</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "%s is not a good password for %s" % (pwd, uid)</span> <a name="odbchelper.stringformatting.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">secret is not a good password for sa</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">userCount = 6</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "Users connected: %d" % (userCount, )</span>           <a name="odbchelper.stringformatting.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"> <a name="odbchelper.stringformatting.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">Users connected: 6</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "Users connected: " + userCount</span>                 <a name="odbchelper.stringformatting.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
TypeError: cannot concatenate 'str' and 'int' objects</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">+</tt> is the string concatenation operator.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In this trivial case, string formatting accomplishes the same result as concatentation.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">(userCount, )</tt> is a tuple with one element.  Yes, the syntax is a little strange, but there's a good reason for it: it's unambiguously a
                              tuple.  In fact, you can always include a comma after the last element when defining a list, tuple, or dictionary, but the
                              comma is required when defining a tuple with one element.  If the comma weren't required, <span class="application">Python</span> wouldn't know whether <tt class="literal">(userCount)</tt> was a tuple with one element or just the value of <tt class="varname">userCount</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">String formatting works with integers by specifying <tt class="literal">%d</tt> instead of <tt class="literal">%s</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Trying to concatenate a string with a non-string raises an exception.  Unlike string formatting, string concatenation works
                              only when everything is already a string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>As with <tt class="function">printf</tt> in <span class="application"><span class="acronym">C</span></span>, string formatting in <span class="application">Python</span> is like a Swiss Army knife.  There are options galore, and modifier strings to specially format many different types of values.
               </p>
               <div class="example"><a name="odbchelper.stringformatting.numbers"></a><h3 class="title">Example&nbsp;3.23.&nbsp;Formatting Numbers</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "Today's stock price: %f" % 50.4625</span>   <a name="odbchelper.stringformatting.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">50.462500</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "Today's stock price: %.2f" % 50.4625</span> <a name="odbchelper.stringformatting.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">50.46</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "Change since yesterday: %+.2f" % 1.5</span> <a name="odbchelper.stringformatting.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">+1.50</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="literal">%f</tt> string formatting option treats the value as a decimal, and prints it to six decimal places.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The ".2" modifier of the <tt class="literal">%f</tt> option truncates the value to two decimal places.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.stringformatting.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can even combine modifiers.  Adding the <tt class="literal">+</tt> modifier displays a plus or minus sign before the value.   Note that the ".2" modifier is still in place, and is padding
                              the value to exactly two decimal places.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on String Formatting</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/typesseq-strings.html">all the string formatting format characters</a>.
                     </li>
                     <li><a href="http://www-gnats.gnu.org:8080/cgi-bin/info2www?(gawk)Top"><i class="citetitle">Effective <span class="acronym">AWK</span> Programming</i></a> discusses <a href="http://www-gnats.gnu.org:8080/cgi-bin/info2www?(gawk)Control+Letters">all the format characters</a> and advanced string formatting techniques like <a href="http://www-gnats.gnu.org:8080/cgi-bin/info2www?(gawk)Format+Modifiers">specifying width, precision, and zero-padding</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.map"></a>3.6.&nbsp;Mapping Lists
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>One of the most powerful features of <span class="application">Python</span> is the list comprehension, which provides a compact way of mapping a list into another list by applying a function to each
                     of the elements of the list.
                  </p>
               </div>
               <div class="example"><a name="d0e7412"></a><h3 class="title">Example&nbsp;3.24.&nbsp;Introducing List Comprehensions</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = [1, 9, 8, 4]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[elem*2 for elem in li]</span>      <a name="odbchelper.map.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[2, 18, 16, 8]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>                           <a name="odbchelper.map.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">[1, 9, 8, 4]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = [elem*2 for elem in li]</span> <a name="odbchelper.map.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">[2, 18, 16, 8]</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To make sense of this, look at it from right to left.  <tt class="varname">li</tt> is the list you're mapping.  <span class="application">Python</span> loops through <tt class="varname">li</tt> one element at a time, temporarily assigning the value of each element to the variable <tt class="varname">elem</tt>.  <span class="application">Python</span> then applies the function <tt class="literal"><tt class="varname">elem</tt>*2</tt> and appends that result to the returned list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that list comprehensions do not change the original list.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">It is safe to assign the result of a list comprehension to the variable that you're mapping.  <span class="application">Python</span> constructs the new list in memory, and when the list comprehension is complete, it assigns the result to the variable.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="informalexample">
                  <p>Here are the list comprehensions in the <tt class="function">buildConnectionString</tt> function that you declared in <a href="#odbchelper">Chapter 2</a>:
                  </p><pre class="programlisting">
["%s=%s" % (k, v) for k, v in params.items()]</pre></div>
               <p>First, notice that you're calling the <tt class="function">items</tt> function of the <tt class="varname">params</tt> dictionary.  This function returns a list of tuples of all the data in the dictionary.
               </p>
               <div class="example"><a name="odbchelper.items"></a><h3 class="title">Example&nbsp;3.25.&nbsp;The <tt class="function">keys</tt>, <tt class="function">values</tt>, and <tt class="function">items</tt> Functions
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params = {"server":"mpilgrim", "database":"master", "uid":"sa", "pwd":"secret"}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params.keys()</span>   <a name="odbchelper.map.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['server', 'uid', 'database', 'pwd']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params.values()</span> <a name="odbchelper.map.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['mpilgrim', 'sa', 'master', 'secret']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params.items()</span>  <a name="odbchelper.map.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">[('server', 'mpilgrim'), ('uid', 'sa'), ('database', 'master'), ('pwd', 'secret')]</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">keys</tt> method of a dictionary returns a list of all the keys.  The list is not in the order in which the dictionary was defined
                              (remember that elements in a dictionary are unordered), but it is a list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">values</tt> method returns a list of all the values.  The list is in the same order as the list returned by <tt class="function">keys</tt>, so <tt class="literal">params.values()[n] == params[params.keys()[n]]</tt> for all values of <tt class="varname">n</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">items</tt> method returns a list of tuples of the form <tt class="literal">(<i class="replaceable">key</i>, <i class="replaceable">value</i>)</tt>.  The list contains all the data in the dictionary.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now let's see what <tt class="function">buildConnectionString</tt> does.  It takes a list, <tt class="literal"><tt class="varname">params</tt>.<tt class="function">items</tt>()</tt>, and maps it to a new list by applying string formatting to each element.  The new list will have the same number of elements
                  as <tt class="literal"><tt class="varname">params</tt>.<tt class="function">items</tt>()</tt>, but each element in the new list will be a string that contains both a key and its associated value from the <tt class="varname">params</tt> dictionary.
               </p>
               <div class="example"><a name="d0e7615"></a><h3 class="title">Example&nbsp;3.26.&nbsp;List Comprehensions in <tt class="function">buildConnectionString</tt>, Step by Step
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params = {"server":"mpilgrim", "database":"master", "uid":"sa", "pwd":"secret"}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params.items()</span>
<span class="computeroutput">[('server', 'mpilgrim'), ('uid', 'sa'), ('database', 'master'), ('pwd', 'secret')]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[k for k, v in params.items()]</span>                <a name="odbchelper.map.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['server', 'uid', 'database', 'pwd']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[v for k, v in params.items()]</span>                <a name="odbchelper.map.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['mpilgrim', 'sa', 'master', 'secret']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">["%s=%s" % (k, v) for k, v in params.items()]</span> <a name="odbchelper.map.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['server=mpilgrim', 'uid=sa', 'database=master', 'pwd=secret']</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that you're using two variables to iterate through the <tt class="literal">params.items()</tt> list.  This is another use of <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">multi-variable assignment</a>.  The first element of <tt class="literal">params.items()</tt> is <tt class="literal">('server', 'mpilgrim')</tt>, so in the first iteration of the list comprehension, <tt class="varname">k</tt> will get <tt class="literal">'server'</tt> and <tt class="varname">v</tt> will get <tt class="literal">'mpilgrim'</tt>.  In this case, you're ignoring the value of <tt class="varname">v</tt> and only including the value of <tt class="varname">k</tt> in the returned list, so this list comprehension ends up being equivalent to <tt class="literal"><tt class="varname">params</tt>.<tt class="function">keys</tt>()</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here you're doing the same thing, but ignoring the value of <tt class="varname">k</tt>, so this list comprehension ends up being equivalent to <tt class="literal"><tt class="varname">params</tt>.<tt class="function">values</tt>()</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.map.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Combining the previous two examples with some simple <a href="#odbchelper.stringformatting" title="3.5.&nbsp;Formatting Strings">string formatting</a>, you get a list of strings that include both the key and value of each element of the dictionary.  This looks suspiciously
                              like the <a href="#odbchelper.output">output</a> of the program.  All that remains is to join the elements in this list into a single string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on List Comprehensions</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses another way to map lists <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007130000000000000000">using the built-in <tt class="function">map</tt> function</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007140000000000000000">do nested list comprehensions</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.join"></a>3.7.&nbsp;Joining Lists and Splitting Strings
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You have a list of key-value pairs in the form <tt class="literal"><i class="replaceable">key</i>=<i class="replaceable">value</i></tt>, and you want to join them into a single string.  To join any list of strings into a single string, use the <tt class="function">join</tt> method of a string object.
                  </p>
               </div>
               <div class="informalexample">
                  <p>Here is an example of joining a list from the <tt class="function">buildConnectionString</tt> function:
                  </p><pre class="programlisting">
    return ";".join(["%s=%s" % (k, v) for k, v in params.items()])</pre></div>
               <p>One interesting note before you continue.  I keep repeating that functions are objects, strings are objects... everything
                  is an object.  You might have thought I meant that string <span class="emphasis"><em>variables</em></span> are objects.  But no, look closely at this example and you'll see that the string <tt class="literal">";"</tt> itself is an object, and you are calling its <tt class="function">join</tt> method.
               </p>
               <p>The <tt class="function">join</tt> method joins the elements of the list into a single string, with each element separated by a semi-colon.  The delimiter doesn't
                  need to be a semi-colon; it doesn't even need to be a single character.  It can be any string.
               </p><a name="tip.join"></a><table class="caution" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/caution.png" alt="Caution" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="function">join</tt> works only on lists of strings; it does not do any type coercion.  Joining a list that has one or more non-string elements
                        will raise an exception.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="odbchelper.join.example"></a><h3 class="title">Example&nbsp;3.27.&nbsp;Output of <tt class="filename">odbchelper.py</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params = {"server":"mpilgrim", "database":"master", "uid":"sa", "pwd":"secret"}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">["%s=%s" % (k, v) for k, v in params.items()]</span>
<span class="computeroutput">['server=mpilgrim', 'uid=sa', 'database=master', 'pwd=secret']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">";".join(["%s=%s" % (k, v) for k, v in params.items()])</span>
<span class="computeroutput">'server=mpilgrim;uid=sa;database=master;pwd=secret'</span></pre></div>
               <p>This string is then returned from the <tt class="function">odbchelper</tt> function and printed by the calling block, which gives you the output that you marveled at when you started reading this
                  chapter.
               </p>
               <p>You're probably wondering if there's an analogous method to split a string into a list.  And of course there is, and it's
                  called <tt class="function">split</tt>.
               </p>
               <div class="example"><a name="odbchelper.split.example"></a><h3 class="title">Example&nbsp;3.28.&nbsp;Splitting a String</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ['server=mpilgrim', 'uid=sa', 'database=master', 'pwd=secret']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = ";".join(li)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s</span>
<span class="computeroutput">'server=mpilgrim;uid=sa;database=master;pwd=secret'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s.split(";")</span>    <a name="odbchelper.join.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['server=mpilgrim', 'uid=sa', 'database=master', 'pwd=secret']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s.split(";", 1)</span> <a name="odbchelper.join.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['server=mpilgrim', 'uid=sa;database=master;pwd=secret']</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.join.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">split</tt> reverses <tt class="function">join</tt> by splitting a string into a multi-element list.  Note that the delimiter (&#8220;<span class="quote"><tt class="literal">;</tt></span>&#8221;) is stripped out completely; it does not appear in any of the elements of the returned list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#odbchelper.join.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">split</tt> takes an optional second argument, which is the number of times to split.  (&#8220;<span class="quote">"Oooooh, optional arguments...</span>&#8221;  You'll learn how to do this in your own functions in the next chapter.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="tip.split"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="literal"><i class="replaceable">anystring</i>.<tt class="function">split</tt>(<i class="replaceable">delimiter</i>, 1)</tt> is a useful technique when you want to search a string for a substring and then work with everything before the substring
                        (which ends up in the first element of the returned list) and everything after it (which ends up in the second element).
                     </td>
                  </tr>
               </table>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on String Methods</h3>
                  <ul>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/480">common questions about strings</a> and has a lot of <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/539">example code using strings</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/string-methods.html">all the string methods</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-string.html"><tt class="filename">string</tt> module</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/FAQ.html"><i class="citetitle">The Whole <span class="application">Python</span> <span class="acronym">FAQ</span></i></a> explains <a href="http://www.python.org/cgi-bin/faqw.py?query=4.96&amp;querytype=simple&amp;casefold=yes&amp;req=search">why <tt class="function">join</tt> is a string method</a> instead of a list method.
                     </li>
                  </ul>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e7982"></a>3.7.1.&nbsp;Historical Note on String Methods
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>When I first learned <span class="application">Python</span>, I expected <tt class="function">join</tt> to be a method of a list, which would take the delimiter as an argument.  Many people feel the same way, and there's a story
                     behind the <tt class="function">join</tt> method.  Prior to <span class="application">Python</span> 1.6, strings didn't have all these useful methods.  There was a separate <tt class="filename">string</tt> module that contained all the string functions; each function took a string as its first argument.  The functions were deemed
                     important enough to put onto the strings themselves, which made sense for functions like <tt class="function">lower</tt>, <tt class="function">upper</tt>, and <tt class="function">split</tt>.  But many hard-core <span class="application">Python</span> programmers objected to the new <tt class="function">join</tt> method, arguing that it should be a method of the list instead, or that it shouldn't move at all but simply stay a part of
                     the old <tt class="filename">string</tt> module (which still has a lot of useful stuff in it).  I use the new <tt class="function">join</tt> method exclusively, but you will see code written either way, and if it really bothers you, you can use the old <tt class="function">string.join</tt> function instead.
                  </p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="odbchelper.summary"></a>3.8.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <tt class="filename">odbchelper.py</tt> program and its output should now make perfect sense.
                  </p>
               </div>
               <div class="informalexample"><pre class="programlisting">
def buildConnectionString(params):
    """Build a connection string from a dictionary of parameters.

    Returns string."""
    return ";".join(["%s=%s" % (k, v) for k, v in params.items()])

if __name__ == "__main__":
    myParams = {"server":"mpilgrim", \
                "database":"master", \
                "uid":"sa", \
                "pwd":"secret" \
                }
    print buildConnectionString(myParams)</pre></div>
               <div class="informalexample">
                  <p>Here is the output of <tt class="filename">odbchelper.py</tt>:
                  </p><pre class="screen"><span class="computeroutput">server=mpilgrim;uid=sa;database=master;pwd=secret</span></pre></div>
               <div class="highlights">
                  <p>Before diving into the next chapter, make sure you're comfortable doing all of these things:</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>Using the <span class="application">Python</span> <span class="acronym">IDE</span> to test expressions interactively
                        </li>
                        <li>Writing <span class="application">Python</span> programs and <a href="#odbchelper.testing" title="2.6.&nbsp;Testing Modules">running them from within your <span class="acronym">IDE</span></a>, or from the command line
                        </li>
                        <li><a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string">Importing modules</a> and calling their functions
                        </li>
                        <li><a href="#odbchelper.funcdef" title="2.2.&nbsp;Declaring Functions">Declaring functions</a> and using <a href="#odbchelper.docstring" title="2.3.&nbsp;Documenting Functions"><tt class="literal">doc string</tt>s</a>, <a href="#odbchelper.vardef" title="3.4.&nbsp;Declaring variables">local variables</a>, and <a href="#odbchelper.indenting" title="2.5.&nbsp;Indenting Code">proper indentation</a></li>
                        <li>Defining <a href="#odbchelper.dict" title="3.1.&nbsp;Introducing Dictionaries">dictionaries</a>, <a href="#odbchelper.tuple" title="3.3.&nbsp;Introducing Tuples">tuples</a>, and <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">lists</a></li>
                        <li>Accessing attributes and methods of <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">any object</a>, including strings, lists, dictionaries, functions, and modules
                        </li>
                        <li>Concatenating values through <a href="#odbchelper.stringformatting" title="3.5.&nbsp;Formatting Strings">string formatting</a></li>
                        <li><a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">Mapping lists</a> into other lists using list comprehensions
                        </li>
                        <li><a href="#odbchelper.join" title="3.7.&nbsp;Joining Lists and Splitting Strings">Splitting strings</a> into lists and joining lists into strings
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="apihelper"></a>Chapter&nbsp;4.&nbsp;The Power Of Introspection
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p>This chapter covers one of <span class="application">Python</span>'s strengths: introspection.  As you know, <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">everything in <span class="application">Python</span> is an object</a>, and introspection is code looking at other modules and functions in memory as objects, getting information about them, and
                  manipulating them.  Along the way, you'll define functions with no name, call functions with arguments out of order, and reference
                  functions whose names you don't even know ahead of time.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.divein"></a>4.1.&nbsp;Diving In
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Here is a complete, working <span class="application">Python</span> program.  You should understand a good deal about it just by looking at it.  The numbered lines illustrate concepts covered
                     in <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>.  Don't worry if the rest of the code looks intimidating; you'll learn all about it throughout this chapter.
                  </p>
               </div>
               <div class="example"><a name="d0e8158"></a><h3 class="title">Example&nbsp;4.1.&nbsp;<tt class="filename">apihelper.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
def info(object, spacing=10, collapse=1): <a name="apihelper.intro.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"> <a name="apihelper.intro.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"> <a name="apihelper.intro.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
    """Print methods and doc strings.
    
    Takes module, class, list, dictionary, or string."""
    methodList = [method for method in dir(object) if callable(getattr(object, method))]
    processFunc = collapse and (lambda s: " ".join(s.split())) or (lambda s: s)
    print "\n".join(["%s %s" %
                      (method.ljust(spacing),
                       processFunc(str(getattr(object, method).__doc__)))
                     for method in methodList])

if __name__ == "__main__":                <a name="apihelper.intro.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"> <a name="apihelper.intro.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
    print info.__doc__</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.intro.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This module has one function, <tt class="function">info</tt>.  According to its <a href="#odbchelper.funcdef" title="2.2.&nbsp;Declaring Functions">function declaration</a>, it takes three parameters: <tt class="varname">object</tt>, <tt class="varname">spacing</tt>, and <tt class="varname">collapse</tt>.  The last two are actually optional parameters, as you'll see shortly.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.intro.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">info</tt> function has a multi-line <a href="#odbchelper.docstring" title="2.3.&nbsp;Documenting Functions"><tt class="literal">doc string</tt></a> that succinctly describes the function's purpose.  Note that no return value is mentioned; this function will be used solely
                              for its effects, rather than its value.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.intro.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Code within the function is <a href="#odbchelper.indenting" title="2.5.&nbsp;Indenting Code">indented</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.intro.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="literal"><span class="literal">if</span> <span class="literal">__name__</span></tt> <a href="#odbchelper.ifnametrick">trick</a> allows this program do something useful when run by itself, without interfering with its use as a module for other programs.
                               In this case, the program simply prints out the <tt class="literal">doc string</tt> of the <tt class="function">info</tt> function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.intro.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><a href="#odbchelper.ifnametrick"><tt class="literal">if</tt> statements</a> use <tt class="literal">==</tt> for comparison, and parentheses are not required.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The <tt class="function">info</tt> function is designed to be used by you, the programmer, while working in the <span class="application">Python</span> <span class="acronym">IDE</span>.  It takes any object that has functions or methods (like a module, which has functions, or a list, which has methods) and
                  prints out the functions and their <tt class="literal">doc string</tt>s.
               </p>
               <div class="example"><a name="d0e8257"></a><h3 class="title">Example&nbsp;4.2.&nbsp;Sample Usage of <tt class="filename">apihelper.py</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from apihelper import info</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = []</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">info(li)</span>
<span class="computeroutput">append     L.append(object) -- append object to end
count      L.count(value) -&gt; integer -- return number of occurrences of value
extend     L.extend(list) -- extend list by appending list elements
index      L.index(value) -&gt; integer -- return index of first occurrence of value
insert     L.insert(index, object) -- insert object before index
pop        L.pop([index]) -&gt; item -- remove and return item at index (default last)
remove     L.remove(value) -- remove first occurrence of value
reverse    L.reverse() -- reverse *IN PLACE*
sort       L.sort([cmpfunc]) -- sort *IN PLACE*; if given, cmpfunc(x, y) -&gt; -1, 0, 1</span></pre></div>
               <p>By default the output is formatted to be easy to read.  Multi-line <tt class="literal">doc string</tt>s are collapsed into a single long line, but this option can be changed by specifying <tt class="constant">0</tt> for the <i class="parameter"><tt>collapse</tt></i> argument.  If the function names are longer than 10 characters, you can specify a larger value for the <i class="parameter"><tt>spacing</tt></i> argument to make the output easier to read.
               </p>
               <div class="example"><a name="d0e8294"></a><h3 class="title">Example&nbsp;4.3.&nbsp;Advanced Usage of <tt class="filename">apihelper.py</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import odbchelper</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">info(odbchelper)</span>
<span class="computeroutput">buildConnectionString Build a connection string from a dictionary Returns string.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">info(odbchelper, 30)</span>
<span class="computeroutput">buildConnectionString          Build a connection string from a dictionary Returns string.</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">info(odbchelper, 30, 0)</span>
<span class="computeroutput">buildConnectionString          Build a connection string from a dictionary
    
    Returns string.
</span></pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.optional"></a>4.2.&nbsp;Using Optional and Named Arguments
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> allows function arguments to have default values; if the function is called without the argument, the argument gets its default
                     value.  Futhermore, arguments can be specified in any order by using named arguments.  Stored procedures in <span class="application">SQL Server</span> Transact/<span class="acronym">SQL</span> can do this, so if you're a <span class="application">SQL Server</span> scripting guru, you can skim this part.
                  </p>
               </div>
               <div class="informalexample">
                  <p>Here is an example of <tt class="function">info</tt>, a function with two optional arguments:
                  </p><pre class="programlisting">
def info(object, spacing=10, collapse=1):</pre></div>
               <p><tt class="varname">spacing</tt> and <tt class="varname">collapse</tt> are optional, because they have default values defined.  <tt class="varname">object</tt> is required, because it has no default value.  If <tt class="function">info</tt> is called with only one argument, <tt class="varname">spacing</tt> defaults to <tt class="constant">10</tt> and <tt class="varname">collapse</tt> defaults to <tt class="constant">1</tt>.  If <tt class="function">info</tt> is called with two arguments, <tt class="varname">collapse</tt> still defaults to <tt class="constant">1</tt>.
               </p>
               <p>Say you want to specify a value for <tt class="varname">collapse</tt> but want to accept the default value for <tt class="varname">spacing</tt>.  In most languages, you would be out of luck, because you would need to call the function with three arguments.  But in
                  <span class="application">Python</span>, arguments can be specified by name, in any order.
               </p>
               <div class="example"><a name="d0e8401"></a><h3 class="title">Example&nbsp;4.4.&nbsp;Valid Calls of <tt class="function">info</tt></h3><pre class="programlisting">
info(odbchelper)                    <a name="apihelper_args.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
info(odbchelper, 12)                <a name="apihelper_args.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
info(odbchelper, collapse=0)        <a name="apihelper_args.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
info(spacing=15, object=odbchelper) <a name="apihelper_args.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper_args.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">With only one argument, <tt class="varname">spacing</tt> gets its default value of <tt class="literal">10</tt> and <tt class="varname">collapse</tt> gets its default value of <tt class="constant">1</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper_args.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">With two arguments, <tt class="varname">collapse</tt> gets its default value of <tt class="constant">1</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper_args.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here you are naming the <tt class="varname">collapse</tt> argument explicitly and specifying its value.  <tt class="varname">spacing</tt> still gets its default value of <tt class="literal">10</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper_args.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Even required arguments (like <tt class="varname">object</tt>, which has no default value) can be named, and named arguments can appear in any order.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>This looks totally whacked until you realize that arguments are simply a dictionary.  The &#8220;<span class="quote">normal</span>&#8221; method of calling functions without argument names is actually just a shorthand where <span class="application">Python</span> matches up the values with the argument names in the order they're specified in the function declaration.  And most of the
                  time, you'll call functions the &#8220;<span class="quote">normal</span>&#8221; way, but you always have the additional flexibility if you need it.
               </p><a name="tip.arguments"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">The only thing you need to do to call a function is specify a value (somehow) for each required argument; the manner and order
                        in which you do that is up to you.
                     </td>
                  </tr>
               </table>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Optional Arguments</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses exactly <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006710000000000000000">when and how default arguments are evaluated</a>, which matters when the default value is a list or an expression with side effects.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.builtin"></a>4.3.&nbsp;Using <tt class="function">type</tt>, <tt class="function">str</tt>, <tt class="function">dir</tt>, and Other Built-In Functions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> has a small set of extremely useful built-in functions.  All other functions are partitioned off into modules.  This was
                     actually a conscious design decision, to keep the core language from getting bloated like other scripting languages (cough
                     cough, <span class="application">Visual Basic</span>).
                  </p>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8510"></a>4.3.1.&nbsp;The <tt class="function">type</tt> Function
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The <tt class="function">type</tt> function returns the datatype of any arbitrary object.  The possible types are listed in the <tt class="filename">types</tt> module.  This is useful for helper functions that can handle several types of data.
                  </p>
                  <div class="example"><a name="apihelper.type.intro"></a><h3 class="title">Example&nbsp;4.5.&nbsp;Introducing <tt class="function">type</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">type(1)</span>           <a name="apihelper.builtin.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;type 'int'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = []</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">type(li)</span>          <a name="apihelper.builtin.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;type 'list'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import odbchelper</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">type(odbchelper)</span>  <a name="apihelper.builtin.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;type 'module'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import types</span>      <a name="apihelper.builtin.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">type(odbchelper) == types.ModuleType</span>
<span class="computeroutput">True</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">type</tt> takes anything -- and I mean anything -- and returns its datatype.  Integers, strings, lists, dictionaries, tuples, functions,
                                 classes, modules, even types are acceptable.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">type</tt> can take a variable and return its datatype.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">type</tt> also works on modules.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You can use the constants in the <tt class="filename">types</tt> module to compare types of objects.  This is what the <tt class="function">info</tt> function does, as you'll see shortly.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8609"></a>4.3.2.&nbsp;The <tt class="function">str</tt> Function
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The <tt class="function">str</tt> coerces data into a string.  Every datatype can be coerced into a string.
                  </p>
                  <div class="example"><a name="apihelper.str.intro"></a><h3 class="title">Example&nbsp;4.6.&nbsp;Introducing <tt class="function">str</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">str(1)</span>          <a name="apihelper.builtin.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'1'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">horsemen = ['war', 'pestilence', 'famine']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">horsemen</span>
<span class="computeroutput">['war', 'pestilence', 'famine']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">horsemen.append('<span class="application">Powerbuilder</span>')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">str(horsemen)</span>   <a name="apihelper.builtin.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">"['war', 'pestilence', 'famine', '<span class="application">Powerbuilder</span>']"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">str(odbchelper)</span> <a name="apihelper.builtin.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">"&lt;module 'odbchelper' from 'c:\\docbook\\dip\\py\\odbchelper.py'&gt;"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">str(None)</span>       <a name="apihelper.builtin.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'None'</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">For simple datatypes like integers, you would expect <tt class="function">str</tt> to work, because almost every language has a function to convert an integer to a string.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">However, <tt class="function">str</tt> works on any object of any type.  Here it works on a list which you've constructed in bits and pieces.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">str</tt> also works on modules.  Note that the string representation of the module includes the pathname of the module on disk, so
                                 yours will be different.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">A subtle but important behavior of <tt class="function">str</tt> is that it works on <tt class="literal">None</tt>, the <span class="application">Python</span> null value.  It returns the string <tt class="literal">'None'</tt>.  You'll use this to your advantage in the <tt class="function">info</tt> function, as you'll see shortly.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>At the heart of the <tt class="function">info</tt> function is the powerful <tt class="function">dir</tt> function.  <tt class="function">dir</tt> returns a list of the attributes and methods of any object: modules, functions, strings, lists, dictionaries... pretty much
                     anything.
                  </p>
                  <div class="example"><a name="apihelper.dir.intro"></a><h3 class="title">Example&nbsp;4.7.&nbsp;Introducing <tt class="function">dir</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = []</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">dir(li)</span>           <a name="apihelper.builtin.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['append', 'count', 'extend', 'index', 'insert',
'pop', 'remove', 'reverse', 'sort']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d = {}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">dir(d)</span>            <a name="apihelper.builtin.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['clear', 'copy', 'get', 'has_key', 'items', 'keys', 'setdefault', 'update', 'values']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import odbchelper</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">dir(odbchelper)</span>   <a name="apihelper.builtin.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['__builtins__', '__doc__', '__file__', '__name__', 'buildConnectionString']</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="varname">li</tt> is a list, so <tt class="literal"><tt class="function">dir</tt>(<tt class="varname">li</tt>)</tt> returns a list of all the methods of a list.  Note that the returned list contains the names of the methods as strings, not
                                 the methods themselves.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="varname">d</tt> is a dictionary, so <tt class="literal"><tt class="function">dir</tt>(<tt class="varname">d</tt>)</tt> returns a list of the names of dictionary methods.  At least one of these, <a href="#odbchelper.items" title="Example&nbsp;3.25.&nbsp;The keys, values, and items Functions"><tt class="function">keys</tt></a>, should look familiar.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This is where it really gets interesting. <tt class="filename">odbchelper</tt> is a module, so <tt class="literal"><tt class="function">dir</tt>(<tt class="filename">odbchelper</tt>)</tt> returns a list of all kinds of stuff defined in the module, including built-in attributes, like <a href="#odbchelper.ifnametrick"><tt class="literal">__name__</tt></a>, <a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string"><tt class="literal">__doc__</tt></a>, and whatever other attributes and methods you define.  In this case, <tt class="filename">odbchelper</tt> has only one user-defined method, the <tt class="function">buildConnectionString</tt> function described in <a href="#odbchelper">Chapter 2</a>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Finally, the <tt class="function">callable</tt> function takes any object and returns <tt class="constant">True</tt> if the object can be called, or <tt class="constant">False</tt> otherwise.  Callable objects include functions, class methods, even classes themselves.  (More on classes in the next chapter.)
                  </p>
                  <div class="example"><a name="apihelper.builtin.callable"></a><h3 class="title">Example&nbsp;4.8.&nbsp;Introducing <tt class="function">callable</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import string</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">string.punctuation</span>           <a name="apihelper.builtin.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'!"#$%&amp;\'()*+,-./:;&lt;=&gt;?@[\\]^_`{|}~'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">string.join</span>                  <a name="apihelper.builtin.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;function join at 00C55A7C&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callable(string.punctuation)</span> <a name="apihelper.builtin.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">False</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callable(string.join)</span>        <a name="apihelper.builtin.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">True</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print string.join.__doc__</span>    <a name="apihelper.builtin.4.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">join(list [,sep]) -&gt; string

    Return a string composed of the words in list, with
    intervening occurrences of sep.  The default separator is a
    single space.

    (joinfields and join are synonymous)</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The functions in the <tt class="filename">string</tt> module are deprecated (although many people still use the <tt class="function">join</tt> function), but the module contains a lot of useful constants like this <tt class="varname">string.punctuation</tt>, which contains all the standard punctuation characters.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><a href="#odbchelper.join" title="3.7.&nbsp;Joining Lists and Splitting Strings"><tt class="function">string.join</tt></a> is a function that joins a list of strings.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="varname">string.punctuation</tt> is not callable; it is a string.  (A string does have callable methods, but the string itself is not callable.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">string.join</tt> is callable; it's a function that takes two arguments.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.builtin.4.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Any callable object may have a <tt class="literal">doc string</tt>.  By using the <tt class="function">callable</tt> function on each of an object's attributes, you can determine which attributes you care about (methods, functions, classes)
                                 and which you want to ignore (constants and so on) without knowing anything about the object ahead of time.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e8958"></a>4.3.3.&nbsp;Built-In Functions
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p><tt class="function">type</tt>, <tt class="function">str</tt>, <tt class="function">dir</tt>, and all the rest of <span class="application">Python</span>'s built-in functions are grouped into a special module called <tt class="filename">__builtin__</tt>.  (That's two underscores before and after.)  If it helps, you can think of <span class="application">Python</span> automatically executing <tt class="literal">from __builtin__ import *</tt> on startup, which imports all the &#8220;<span class="quote">built-in</span>&#8221; functions into the namespace so you can use them directly.
                  </p>
                  <p>The advantage of thinking like this is that you can access all the built-in functions and attributes as a group by getting
                     information about the <tt class="filename">__builtin__</tt> module.  And guess what, <span class="application">Python</span> has a function called <tt class="function">info</tt>.  Try it yourself and skim through the list now.  We'll dive into some of the more important functions later.  (Some of the
                     built-in error classes, like <a href="#odbchelper.tuplemethods" title="Example&nbsp;3.16.&nbsp;Tuples Have No Methods"><tt class="errorcode">AttributeError</tt></a>, should already look familiar.)
                  </p>
                  <div class="example"><a name="apihelper.builtin.list"></a><h3 class="title">Example&nbsp;4.9.&nbsp;Built-in Attributes and Functions</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from apihelper import info</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import __builtin__</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">info(__builtin__, 20)</span>
<span class="computeroutput">ArithmeticError      Base class for arithmetic errors.
AssertionError       Assertion failed.
AttributeError       Attribute not found.
EOFError             Read beyond end of file.
EnvironmentError     Base class for I/O related errors.
Exception            Common base class for all exceptions.
FloatingPointError   Floating point operation failed.
IOError              I/O operation failed.

[...snip...]</span></pre></div><a name="tip.manuals"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> comes with excellent reference manuals, which you should peruse thoroughly to learn all the modules <span class="application">Python</span> has to offer.  But unlike most languages, where you would find yourself referring back to the manuals or man pages to remind
                           yourself how to use these modules, <span class="application">Python</span> is largely self-documenting.
                        </td>
                     </tr>
                  </table>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on Built-In Functions</h3>
                     <ul>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents <a href="http://www.python.org/doc/current/lib/built-in-funcs.html">all the built-in functions</a> and <a href="http://www.python.org/doc/current/lib/module-exceptions.html">all the built-in exceptions</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.getattr"></a>4.4.&nbsp;Getting Object References With <tt class="function">getattr</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You already know that <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object"><span class="application">Python</span> functions are objects</a>.  What you don't know is that you can get a reference to a function without knowing its name until run-time, by using the
                     <tt class="function">getattr</tt> function.
                  </p>
               </div>
               <div class="example"><a name="apihelper.getattr.intro"></a><h3 class="title">Example&nbsp;4.10.&nbsp;Introducing <tt class="function">getattr</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ["Larry", "Curly"]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li.pop</span>                       <a name="apihelper.getattr.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;built-in method pop of list object at 010DF884&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">getattr(li, "pop")</span>           <a name="apihelper.getattr.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;built-in method pop of list object at 010DF884&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">getattr(li, "append")("Moe")</span> <a name="apihelper.getattr.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li</span>
<span class="computeroutput">["Larry", "Curly", "Moe"]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">getattr({}, "clear")</span>         <a name="apihelper.getattr.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;built-in method clear of dictionary object at 00F113D4&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">getattr((), "pop")</span>           <a name="apihelper.getattr.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
AttributeError: 'tuple' object has no attribute 'pop'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This gets a reference to the <tt class="function">pop</tt> method of the list.  Note that this is not calling the <tt class="function">pop</tt> method; that would be <tt class="literal">li.pop()</tt>.  This is the method itself.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This also returns a reference to the <tt class="function">pop</tt> method, but this time, the method name is specified as a string argument to the <tt class="function">getattr</tt> function.  <tt class="function">getattr</tt> is an incredibly useful built-in function that returns any attribute of any object.  In this case, the object is a list,
                              and the attribute is the <tt class="function">pop</tt> method.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In case it hasn't sunk in just how incredibly useful this is, try this: the return value of <tt class="function">getattr</tt> <span class="emphasis"><em>is</em></span> the method, which you can then call just as if you had said <tt class="literal">li.append("Moe")</tt> directly.  But you didn't call the function directly; you specified the function name as a string instead.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">getattr</tt> also works on dictionaries.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In theory, <tt class="function">getattr</tt> would work on tuples, except that <a href="#odbchelper.tuplemethods" title="Example&nbsp;3.16.&nbsp;Tuples Have No Methods">tuples have no methods</a>, so <tt class="function">getattr</tt> will raise an exception no matter what attribute name you give.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e9194"></a>4.4.1.&nbsp;<tt class="function">getattr</tt> with Modules
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p><tt class="function">getattr</tt> isn't just for built-in datatypes.  It also works on modules.
                  </p>
                  <div class="example"><a name="apihelper.getattr.example"></a><h3 class="title">Example&nbsp;4.11.&nbsp;The <tt class="function">getattr</tt> Function in <tt class="filename">apihelper.py</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import odbchelper</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">odbchelper.buildConnectionString</span>             <a name="apihelper.getattr.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;function buildConnectionString at 00D18DD4&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">getattr(odbchelper, "buildConnectionString")</span> <a name="apihelper.getattr.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;function buildConnectionString at 00D18DD4&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">object = odbchelper</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">method = "buildConnectionString"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">getattr(object, method)</span>                      <a name="apihelper.getattr.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;function buildConnectionString at 00D18DD4&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">type(getattr(object, method))</span>                <a name="apihelper.getattr.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;type 'function'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import types</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">type(getattr(object, method)) == types.FunctionType</span>
<span class="computeroutput">True</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callable(getattr(object, method))</span>            <a name="apihelper.getattr.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">True</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.getattr.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This returns a reference to the <tt class="function">buildConnectionString</tt> function in the <tt class="filename">odbchelper</tt> module, which you studied in <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>.  (The hex address you see is specific to my machine; your output will be different.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.getattr.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Using <tt class="function">getattr</tt>, you can get the same reference to the same function.  In general, <tt class="literal"><tt class="function">getattr</tt>(<i class="replaceable">object</i>, "<i class="replaceable">attribute</i>")</tt> is equivalent to <tt class="literal"><i class="replaceable">object</i>.<i class="replaceable">attribute</i></tt>.  If <i class="replaceable"><tt>object</tt></i> is a module, then <i class="replaceable"><tt>attribute</tt></i> can be anything defined in the module: a function, class, or global variable.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.getattr.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">And this is what you actually use in the <tt class="function">info</tt> function.  <tt class="varname">object</tt> is passed into the function as an argument; <tt class="varname">method</tt> is a string which is the name of a method or function.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.getattr.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">In this case, <tt class="varname">method</tt> is the name of a function, which you can prove by getting its <a href="#apihelper.type.intro" title="Example&nbsp;4.5.&nbsp;Introducing type"><tt class="function">type</tt></a>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.getattr.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Since <tt class="varname">method</tt> is a function, it is <a href="#apihelper.builtin.callable" title="Example&nbsp;4.8.&nbsp;Introducing callable">callable</a>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e9362"></a>4.4.2.&nbsp;<tt class="function">getattr</tt> As a Dispatcher
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>A common usage pattern of <tt class="function">getattr</tt> is as a dispatcher.  For example, if you had a program that could output data in a variety of different formats, you could
                     define separate functions for each output format and use a single dispatch function to call the right one.
                  </p>
                  <p>For example, let's imagine a program that prints site statistics in <span class="acronym">HTML</span>, <span class="acronym">XML</span>, and plain text formats.  The choice of output format could be specified on the command line, or stored in a configuration
                     file.  A <tt class="filename">statsout</tt> module defines three functions, <tt class="function">output_html</tt>, <tt class="function">output_xml</tt>, and <tt class="function">output_text</tt>.  Then the main program defines a single output function, like this:
                  </p>
                  <div class="example"><a name="apihelper.getattr.dispatch"></a><h3 class="title">Example&nbsp;4.12.&nbsp;Creating a Dispatcher with <tt class="function">getattr</tt></h3><pre class="programlisting">
import statsout

def output(data, format="text"):                              <a name="apihelper.getattr.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    output_function = getattr(statsout, "output_%s" % format) <a name="apihelper.getattr.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    return output_function(data)                              <a name="apihelper.getattr.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
</pre></div>
                  <div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">output</tt> function takes one required argument, <tt class="varname">data</tt>, and one optional argument, <tt class="varname">format</tt>.  If <tt class="varname">format</tt> is not specified, it defaults to <tt class="literal">text</tt>, and you will end up calling the plain text output function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You concatenate the <tt class="varname">format</tt> argument with "output_" to produce a function name, and then go get that function from the <tt class="filename">statsout</tt> module.  This allows you to easily extend the program later to support other output formats, without changing this dispatch
                              function.  Just add another function to <tt class="filename">statsout</tt> named, for instance, <tt class="function">output_pdf</tt>, and pass "pdf" as the <tt class="varname">format</tt> into the <tt class="function">output</tt> function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.getattr.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you can simply call the output function in the same way as any other function.  The <tt class="varname">output_function</tt> variable is a reference to the appropriate function from the <tt class="filename">statsout</tt> module.
                           </td>
                        </tr>
                     </table>
                  </div>
                  <p>Did you see the bug in the previous example?  This is a very loose coupling of strings and functions, and there is no error
                     checking.  What happens if the user passes in a format that doesn't have a corresponding function defined in <tt class="filename">statsout</tt>?  Well, <tt class="function">getattr</tt> will return <tt class="literal">None</tt>, which will be assigned to <tt class="varname">output_function</tt> instead of a valid function, and the next line that attempts to call that function will crash and raise an exception.  That's
                     bad.
                  </p>
                  <p>Luckily, <tt class="function">getattr</tt> takes an optional third argument, a default value.
                  </p>
                  <div class="example"><a name="apihelper.getattr.default"></a><h3 class="title">Example&nbsp;4.13.&nbsp;<tt class="function">getattr</tt> Default Values
                     </h3><pre class="programlisting">
import statsout

def output(data, format="text"):
    output_function = getattr(statsout, "output_%s" % format, statsout.output_text)
    return output_function(data) <a name="apihelper.getattr.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.getattr.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This function call is guaranteed to work, because you added a third argument to the call to <tt class="function">getattr</tt>.  The third argument is a default value that is returned if the attribute or method specified by the second argument wasn't
                                 found.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>As you can see, <tt class="function">getattr</tt> is quite powerful.  It is the heart of introspection, and you'll see even more powerful examples of it in later chapters.
                  </p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.filter"></a>4.5.&nbsp;Filtering Lists
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>As you know, <span class="application">Python</span> has powerful capabilities for mapping lists into other lists, via list comprehensions (<a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">Section&nbsp;3.6, &#8220;Mapping Lists&#8221;</a>).  This can be combined with a filtering mechanism, where some elements in the list are mapped while others are skipped entirely.
                  </p>
               </div>
               <div class="informalexample">
                  <p>Here is the list filtering syntax:</p><pre class="programlisting">
[<i class="replaceable"><tt>mapping-expression</tt></i> for <i class="replaceable"><tt>element</tt></i> in <i class="replaceable"><tt>source-list</tt></i> if <i class="replaceable"><tt>filter-expression</tt></i>]</pre></div>
               <p>This is an extension of the <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehensions</a> that you know and love.  The first two thirds are the same; the last part, starting with the <tt class="literal">if</tt>, is the filter expression.  A filter expression can be any expression that evaluates true or false (which in <span class="application">Python</span> can be <a href="#tip.boolean">almost anything</a>).  Any element for which the filter expression evaluates true will be included in the mapping.  All other elements are ignored,
                  so they are never put through the mapping expression and are not included in the output list.
               </p>
               <div class="example"><a name="d0e9539"></a><h3 class="title">Example&nbsp;4.14.&nbsp;Introducing List Filtering</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ["a", "mpilgrim", "foo", "b", "c", "b", "d", "d"]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[elem for elem in li if len(elem) &gt; 1]</span>       <a name="apihelper.filter.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['mpilgrim', 'foo']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[elem for elem in li if elem != "b"]</span>         <a name="apihelper.filter.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['a', 'mpilgrim', 'foo', 'c', 'd', 'd']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[elem for elem in li if li.count(elem) == 1]</span> <a name="apihelper.filter.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['a', 'mpilgrim', 'foo', 'c']</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.filter.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The mapping expression here is simple (it just returns the value of each element), so concentrate on the filter expression.
                               As <span class="application">Python</span> loops through the list, it runs each element through the filter expression.  If the filter expression is true, the element
                              is mapped and the result of the mapping expression is included in the returned list.  Here, you are filtering out all the
                              one-character strings, so you're left with a list of all the longer strings.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.filter.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here, you are filtering out a specific value, <tt class="literal">b</tt>.  Note that this filters all occurrences of <tt class="literal">b</tt>, since each time it comes up, the filter expression will be false.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.filter.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">count</tt> is a list method that returns the number of times a value occurs in a list.  You might think that this filter would eliminate
                              duplicates from a list, returning a list containing only one copy of each value in the original list.  But it doesn't, because
                              values that appear twice in the original list (in this case, <tt class="literal">b</tt> and <tt class="literal">d</tt>) are excluded completely.  There are ways of eliminating duplicates from a list, but filtering is not the solution.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="informalexample"><a name="apihelper.filter.care"></a><p>Let's get back to this line from <tt class="filename">apihelper.py</tt>:
                  </p><pre class="programlisting">
    methodList = [method for method in dir(object) if callable(getattr(object, method))]</pre></div>
               <p>This looks complicated, and it is complicated, but the basic structure is the same.  The whole filter expression returns a
                  list, which is assigned to the <tt class="varname">methodList</tt> variable.  The first half of the expression is the list mapping part.  The mapping expression is an identity expression,
                  which it returns the value of each element.  <tt class="literal"><tt class="function">dir</tt>(<tt class="varname">object</tt>)</tt> returns a list of <tt class="varname">object</tt>'s attributes and methods -- that's the list you're mapping.  So the only new part is the filter expression after the <tt class="literal">if</tt>.
               </p>
               <p>The filter expression looks scary, but it's not.  You already know about <a href="#apihelper.builtin.callable" title="Example&nbsp;4.8.&nbsp;Introducing callable"><tt class="function">callable</tt></a>, <a href="#apihelper.getattr.intro" title="Example&nbsp;4.10.&nbsp;Introducing getattr"><tt class="function">getattr</tt></a>, and <a href="#odbchelper.tuplemethods" title="Example&nbsp;3.16.&nbsp;Tuples Have No Methods"><tt class="literal">in</tt></a>.  As you saw in the <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr">previous section</a>, the expression <tt class="literal">getattr(object, method)</tt> returns a function object if <tt class="varname">object</tt> is a module and <tt class="varname">method</tt> is the name of a function in that module.
               </p>
               <p>So this expression takes an object (named <tt class="varname">object</tt>).  Then it gets a list of the names of the object's attributes, methods, functions, and a few other things.  Then it filters
                  that list to weed out all the stuff that you don't care about.  You do the weeding out by taking the name of each attribute/method/function
                  and getting a reference to the real thing, via the <tt class="function">getattr</tt> function.  Then you check to see if that object is callable, which will be any methods and functions, both built-in (like
                  the <tt class="function">pop</tt> method of a list) and user-defined (like the <tt class="function">buildConnectionString</tt> function of the <tt class="filename">odbchelper</tt> module).  You don't care about other attributes, like the <tt class="literal">__name__</tt> attribute that's built in to every module.
               </p>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Filtering Lists</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses another way to filter lists <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007130000000000000000">using the built-in <tt class="function">filter</tt> function</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.andor"></a>4.6.&nbsp;The Peculiar Nature of <tt class="literal">and</tt> and <tt class="literal">or</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>In <span class="application">Python</span>, <tt class="literal">and</tt> and <tt class="literal">or</tt> perform boolean logic as you would expect, but they do not return boolean values; instead, they return one of the actual
                     values they are comparing.
                  </p>
               </div>
               <div class="example"><a name="apihelper.andor.intro.example"></a><h3 class="title">Example&nbsp;4.15.&nbsp;Introducing <tt class="literal">and</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">'a' and 'b'</span>         <a name="apihelper.andor.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'b'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">'' and 'b'</span>          <a name="apihelper.andor.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">''</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">'a' and 'b' and 'c'</span> <a name="apihelper.andor.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'c'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.andor.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When using <tt class="literal">and</tt>, values are evaluated in a boolean context from left to right.  <tt class="constant">0</tt>, <tt class="literal">''</tt>, <tt class="literal">[]</tt>, <tt class="literal">()</tt>, <tt class="literal">{}</tt>, and <tt class="literal">None</tt> are false in a boolean context; everything else is true.  Well, almost everything.  By default, instances of classes are
                              true in a boolean context, but you can define special methods in your class to make an instance evaluate to false.  You'll
                              learn all about classes and special methods in <a href="#fileinfo">Chapter 5</a>.  If all values are true in a boolean context, <tt class="literal">and</tt> returns the last value.  In this case, <tt class="literal">and</tt> evaluates <tt class="literal">'a'</tt>, which is true, then <tt class="literal">'b'</tt>, which is true, and returns <tt class="literal">'b'</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.andor.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If any value is false in a boolean context, <tt class="literal">and</tt> returns the first false value.  In this case, <tt class="literal">''</tt> is the first false value.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.andor.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">All values are true, so <tt class="literal">and</tt> returns the last value, <tt class="literal">'c'</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e9812"></a><h3 class="title">Example&nbsp;4.16.&nbsp;Introducing <tt class="literal">or</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">'a' or 'b'</span>          <a name="apihelper.andor.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'a'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">'' or 'b'</span>           <a name="apihelper.andor.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'b'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">'' or [] or {}</span>      <a name="apihelper.andor.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">{}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def sidefx():</span>
<tt class="prompt">...     </tt><span class="userinput">print "in sidefx()"</span>
<tt class="prompt">...     </tt><span class="userinput">return 1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">'a' or sidefx()</span>     <a name="apihelper.andor.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'a'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.andor.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When using <tt class="literal">or</tt>, values are evaluated in a boolean context from left to right, just like <tt class="literal">and</tt>.  If any value is true, <tt class="literal">or</tt> returns that value immediately.  In this case, <tt class="literal">'a'</tt> is the first true value.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.andor.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">or</tt> evaluates <tt class="literal">''</tt>, which is false, then <tt class="literal">'b'</tt>, which is true, and returns <tt class="literal">'b'</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.andor.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If all values are false, <tt class="literal">or</tt> returns the last value.  <tt class="literal">or</tt> evaluates <tt class="literal">''</tt>, which is false, then <tt class="literal">[]</tt>, which is false, then <tt class="literal">{}</tt>, which is false, and returns <tt class="literal">{}</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.andor.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that <tt class="literal">or</tt> evaluates values only until it finds one that is true in a boolean context, and then it ignores the rest.  This distinction
                              is important if some values can have side effects.  Here, the function <tt class="function">sidefx</tt> is never called, because <tt class="literal">or</tt> evaluates <tt class="literal">'a'</tt>, which is true, and returns <tt class="literal">'a'</tt> immediately.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>If you're a <span class="application"><span class="acronym">C</span></span> hacker, you are certainly familiar with the <tt class="literal"><i class="replaceable">bool</i> ? <tt class="varname">a</tt> : <tt class="varname">b</tt></tt> expression, which evaluates to <tt class="varname">a</tt> if <i class="replaceable"><tt>bool</tt></i> is true, and <tt class="varname">b</tt> otherwise.  Because of the way <tt class="literal">and</tt> and <tt class="literal">or</tt> work in <span class="application">Python</span>, you can accomplish the same thing.
               </p>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e9975"></a>4.6.1.&nbsp;Using the <tt class="literal">and-or</tt> Trick
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="apihelper.andortrick.intro"></a><h3 class="title">Example&nbsp;4.17.&nbsp;Introducing the <tt class="literal">and-or</tt> Trick
                     </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">a = "first"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">b = "second"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">1 and a or b</span> <a name="apihelper.andor.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'first'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">0 and a or b</span> <a name="apihelper.andor.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'second'</span>
</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.andor.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This syntax looks similar to the <tt class="literal"><i class="replaceable">bool</i> ? <tt class="varname">a</tt> : <tt class="varname">b</tt></tt> expression in <span class="application"><span class="acronym">C</span></span>.  The entire expression is evaluated from left to right, so the <tt class="literal">and</tt> is evaluated first.  <tt class="literal">1 and 'first'</tt> evalutes to <tt class="literal">'first'</tt>, then <tt class="literal">'first' or 'second'</tt> evalutes to <tt class="literal">'first'</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.andor.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">0 and 'first'</tt> evalutes to <tt class="constant">False</tt>, and then <tt class="literal">0 or 'second'</tt> evaluates to <tt class="literal">'second'</tt>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>However, since this <span class="application">Python</span> expression is simply boolean logic, and not a special construct of the language, there is one extremely important difference
                     between this <tt class="literal">and-or</tt> trick in <span class="application">Python</span> and the <tt class="literal"><i class="replaceable">bool</i> ? <tt class="varname">a</tt> : <tt class="varname">b</tt></tt> syntax in <span class="application"><span class="acronym">C</span></span>.  If the value of <tt class="varname">a</tt> is false, the expression will not work as you would expect it to.  (Can you tell I was bitten by this?  More than once?)
                  </p>
                  <div class="example"><a name="d0e10093"></a><h3 class="title">Example&nbsp;4.18.&nbsp;When the <tt class="literal">and-or</tt> Trick Fails
                     </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">a = ""</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">b = "second"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">1 and a or b</span>         <a name="apihelper.andor.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'second'</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.andor.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Since <tt class="varname">a</tt> is an empty string, which <span class="application">Python</span> considers false in a boolean context, <tt class="literal">1 and ''</tt> evalutes to <tt class="literal">''</tt>, and then <tt class="literal">'' or 'second'</tt> evalutes to <tt class="literal">'second'</tt>.  Oops!  That's not what you wanted.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>The <tt class="literal">and-or</tt> trick, <tt class="literal"><i class="replaceable">bool</i> and <tt class="varname">a</tt> or <tt class="varname">b</tt></tt>, will not work like the <span class="application"><span class="acronym">C</span></span> expression <tt class="literal"><i class="replaceable">bool</i> ? <tt class="varname">a</tt> : <tt class="varname">b</tt></tt> when <tt class="varname">a</tt> is false in a boolean context.
                  </p>
                  <p>The real trick behind the <tt class="literal">and-or</tt> trick, then, is to make sure that the value of <tt class="varname">a</tt> is never false.  One common way of doing this is to turn <tt class="varname">a</tt> into <tt class="literal">[<tt class="varname">a</tt>]</tt> and <tt class="varname">b</tt> into <tt class="literal">[<tt class="varname">b</tt>]</tt>, then taking the first element of the returned list, which will be either <tt class="varname">a</tt> or <tt class="varname">b</tt>.
                  </p>
                  <div class="example"><a name="d0e10205"></a><h3 class="title">Example&nbsp;4.19.&nbsp;Using the <tt class="literal">and-or</tt> Trick Safely
                     </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">a = ""</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">b = "second"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">(1 and [a] or [b])[0]</span> <a name="apihelper.andor.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">''</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.andor.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Since <tt class="literal">[<tt class="varname">a</tt>]</tt> is a non-empty list, it is never false.  Even if <tt class="varname">a</tt> is <tt class="constant">0</tt> or <tt class="literal">''</tt> or some other false value, the list <tt class="literal">[<tt class="varname">a</tt>]</tt> is true because it has one element.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>By now, this trick may seem like more trouble than it's worth.  You could, after all, accomplish the same thing with an <tt class="literal">if</tt> statement, so why go through all this fuss?  Well, in many cases, you are choosing between two constant values, so you can
                     use the simpler syntax and not worry, because you know that the <tt class="varname">a</tt> value will always be true.  And even if you need to use the more complicated safe form, there are good reasons to do so.
                     For example, there are some cases in <span class="application">Python</span> where <tt class="literal">if</tt> statements are not allowed, such as in <tt class="literal">lambda</tt> functions.
                  </p>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on the <tt class="literal">and-or</tt> Trick
                     </h3>
                     <ul>
                        <li><a href="http://www.activestate.com/ASPN/Python/Cookbook/" title="growing archive of annotated code samples"><span class="application">Python</span> Cookbook</a> discusses <a href="http://www.activestate.com/ASPN/Python/Cookbook/Recipe/52310">alternatives to the <tt class="literal">and-or</tt> trick</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.lambda"></a>4.7.&nbsp;Using <tt class="literal">lambda</tt> Functions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> supports an interesting syntax that lets you define one-line mini-functions on the fly.  Borrowed from <span class="application">Lisp</span>, these so-called <tt class="literal">lambda</tt> functions can be used anywhere a function is required.
                  </p>
               </div>
               <div class="example"><a name="d0e10311"></a><h3 class="title">Example&nbsp;4.20.&nbsp;Introducing <tt class="literal">lambda</tt> Functions
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def f(x):</span>
<tt class="prompt">...     </tt><span class="userinput">return x*2</span>
<tt class="prompt">...     </tt><span class="userinput"></span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f(3)</span>
<span class="computeroutput">6</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">g = lambda x: x*2</span>  <a name="apihelper.lambda.1.2"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">g(3)</span>
<span class="computeroutput">6</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">(lambda x: x*2)(3)</span> <a name="apihelper.lambda.1.3"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">6</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.lambda.1.2"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a <tt class="literal">lambda</tt> function that accomplishes the same thing as the normal function above it.  Note the abbreviated syntax here: there are no
                              parentheses around the argument list, and the <tt class="literal">return</tt> keyword is missing (it is implied, since the entire function can only be one expression).  Also, the function has no name,
                              but it can be called through the variable it is assigned to.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.lambda.1.3"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can use a <tt class="literal">lambda</tt> function without even assigning it to a variable.  This may not be the most useful thing in the world, but it just goes to
                              show that a lambda is just an in-line function.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>To generalize, a <tt class="literal">lambda</tt> function is a function that takes any number of arguments (including <a href="#apihelper.optional" title="4.2.&nbsp;Using Optional and Named Arguments">optional arguments</a>) and returns the value of a single expression.  <tt class="literal">lambda</tt> functions can not contain commands, and they can not contain more than one expression.  Don't try to squeeze too much into
                  a <tt class="literal">lambda</tt> function; if you need something more complex, define a normal function instead and make it as long as you want.
               </p><a name="tip.lambda"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">lambda</tt> functions are a matter of style.  Using them is never required; anywhere you could use them, you could define a separate
                        normal function and use that instead.  I use them in places where I want to encapsulate specific, non-reusable code without
                        littering my code with a lot of little one-line functions.
                     </td>
                  </tr>
               </table>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e10403"></a>4.7.1.&nbsp;Real-World <tt class="literal">lambda</tt> Functions
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="informalexample">
                     <p>Here are the <tt class="literal">lambda</tt> functions in <tt class="filename">apihelper.py</tt>:
                     </p><pre class="programlisting">
    processFunc = collapse and (lambda s: " ".join(s.split())) or (lambda s: s)</pre></div>
                  <p>Notice that this uses the simple form of the <a href="#apihelper.andor" title="4.6.&nbsp;The Peculiar Nature of and and or"><tt class="literal">and-or</tt></a> trick, which is okay, because a <tt class="literal">lambda</tt> function is always true <a href="#tip.boolean">in a boolean context</a>.  (That doesn't mean that a <tt class="literal">lambda</tt> function can't return a false value.  The function is always true; its return value could be anything.)
                  </p>
                  <p>Also notice that you're using the <tt class="function">split</tt> function with no arguments.  You've already seen it used with <a href="#odbchelper.split.example" title="Example&nbsp;3.28.&nbsp;Splitting a String">one or two arguments</a>, but without any arguments it splits on whitespace.
                  </p>
                  <div class="example"><a name="d0e10444"></a><h3 class="title">Example&nbsp;4.21.&nbsp;<tt class="function">split</tt> With No Arguments
                     </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = "this   is\na\ttest"</span>  <a name="apihelper.split.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print s</span>
<span class="computeroutput">this   is
a	test</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print s.split()</span>           <a name="apihelper.split.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['this', 'is', 'a', 'test']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print " ".join(s.split())</span> <a name="apihelper.split.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'this is a test'</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.split.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This is a multiline string, defined by escape characters instead of <a href="#odbchelper.triplequotes" title="Example&nbsp;2.2.&nbsp;Defining the buildConnectionString Function's doc string">triple quotes</a>.  <tt class="literal">\n</tt> is a carriage return, and <tt class="literal">\t</tt> is a tab character.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.split.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">split</tt> without any arguments splits on whitespace.  So three spaces, a carriage return, and a tab character are all the same.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#apihelper.split.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You can normalize whitespace by splitting a string with <tt class="function">split</tt> and then rejoining it with <tt class="function">join</tt>, using a single space as a delimiter.  This is what the <tt class="function">info</tt> function does to collapse multi-line <tt class="literal">doc string</tt>s into a single line.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>So what is the <tt class="function">info</tt> function actually doing with these <tt class="literal">lambda</tt> functions, <tt class="function">split</tt>s, and <tt class="literal">and-or</tt> tricks?
                  </p>
                  <div class="informalexample"><a name="apihelper.funcassign"></a><pre class="programlisting">
    processFunc = collapse and (lambda s: " ".join(s.split())) or (lambda s: s)</pre></div>
                  <p><tt class="varname">processFunc</tt> is now a function, but which function it is depends on the value of the <tt class="varname">collapse</tt> variable.  If <tt class="varname">collapse</tt> is true, <tt class="literal"><tt class="varname">processFunc</tt>(<i class="replaceable">string</i>)</tt> will collapse whitespace; otherwise, <tt class="literal"><tt class="varname">processFunc</tt>(<i class="replaceable">string</i>)</tt> will return its argument unchanged.
                  </p>
                  <p>To do this in a less robust language, like <span class="application">Visual Basic</span>, you would probably create a function that took a string and a <i class="parameter"><tt>collapse</tt></i> argument and used an <tt class="literal">if</tt> statement to decide whether to collapse the whitespace or not, then returned the appropriate value.  This would be inefficient,
                     because the function would need to handle every possible case.  Every time you called it, it would need to decide whether
                     to collapse whitespace before it could give you what you wanted.  In <span class="application">Python</span>, you can take that decision logic out of the function and define a <tt class="literal">lambda</tt> function that is custom-tailored to give you exactly (and only) what you want.  This is more efficient, more elegant, and
                     less prone to those nasty oh-I-thought-those-arguments-were-reversed kinds of errors.
                  </p>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on <tt class="literal">lambda</tt> Functions
                     </h3>
                     <ul>
                        <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> discusses using <tt class="literal">lambda</tt> to <a href="http://www.faqts.com/knowledge-base/view.phtml/aid/6081/fid/241">call functions indirectly</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006740000000000000000">access outside variables from inside a <tt class="literal">lambda</tt> function</a>.  (<a href="http://python.sourceforge.net/peps/pep-0227.html"><span class="acronym">PEP</span> 227</a> explains how this will change in future versions of <span class="application">Python</span>.)
                        </li>
                        <li><a href="http://www.python.org/doc/FAQ.html"><i class="citetitle">The Whole <span class="application">Python</span> <span class="acronym">FAQ</span></i></a> has examples of <a href="http://www.python.org/cgi-bin/faqw.py?query=4.15&amp;querytype=simple&amp;casefold=yes&amp;req=search">obfuscated one-liners using <tt class="literal">lambda</tt></a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.alltogether"></a>4.8.&nbsp;Putting It All Together
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The last line of code, the only one you haven't deconstructed yet, is the one that does all the work.  But by now the work
                     is easy, because everything you need is already set up just the way you need it.  All the dominoes are in place; it's time
                     to knock them down.
                  </p>
               </div>
               <div class="informalexample">
                  <p>This is the meat of <tt class="filename">apihelper.py</tt>:
                  </p><pre class="programlisting">
    print "\n".join(["%s %s" %
                      (method.ljust(spacing),
                       processFunc(str(getattr(object, method).__doc__)))
                     for method in methodList])</pre></div>
               <p>Note that this is one command, split over multiple lines, but it doesn't use the line continuation character (<tt class="literal">\</tt>).  Remember when I said that <a href="#tip.implicitmultiline">some expressions can be split into multiple lines</a> without using a backslash?  A list comprehension is one of those expressions, since the entire expression is contained in
                  square brackets.
               </p>
               <p>Now, let's take it from the end and work backwards.  The </p><pre class="programlisting">
for method in methodList</pre><p>shows that this is a <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehension</a>.  As you know, <tt class="varname">methodList</tt> is a list of <a href="#apihelper.filter.care">all the methods you care about</a> in <tt class="varname">object</tt>.  So you're looping through that list with <tt class="varname">method</tt>.
               </p>
               <div class="example"><a name="d0e10681"></a><h3 class="title">Example&nbsp;4.22.&nbsp;Getting a <tt class="literal">doc string</tt> Dynamically
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import odbchelper</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">object = odbchelper</span>                   <a name="apihelper.alltogether.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">method = 'buildConnectionString'</span>      <a name="apihelper.alltogether.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">getattr(object, method)</span>               <a name="apihelper.alltogether.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;function buildConnectionString at 010D6D74&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print getattr(object, method).__doc__</span> <a name="apihelper.alltogether.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">Build a connection string from a dictionary of parameters.

    Returns string.</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In the <tt class="function">info</tt> function, <tt class="varname">object</tt> is the object you're getting help on, passed in as an argument.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you're looping through <tt class="varname">methodList</tt>, <tt class="varname">method</tt> is the name of the current method.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using the <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr"><tt class="function">getattr</tt></a> function, you're getting a reference to the <i class="replaceable"><tt>method</tt></i> function in the <i class="replaceable"><tt>object</tt></i> module.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now, printing the actual <tt class="literal">doc string</tt> of the method is easy.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The next piece of the puzzle is the use of <tt class="function">str</tt> around the <tt class="literal">doc string</tt>.  As you may recall, <tt class="function">str</tt> is a built-in function that <a href="#apihelper.builtin" title="4.3.&nbsp;Using type, str, dir, and Other Built-In Functions">coerces data into a string</a>.  But a <tt class="literal">doc string</tt> is always a string, so why bother with the <tt class="function">str</tt> function?  The answer is that not every function has a <tt class="literal">doc string</tt>, and if it doesn't, its <tt class="literal">__doc__</tt> attribute is <tt class="literal">None</tt>.
               </p>
               <div class="example"><a name="d0e10793"></a><h3 class="title">Example&nbsp;4.23.&nbsp;Why Use <tt class="function">str</tt> on a <tt class="literal">doc string</tt>?
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">&gt;&gt;&gt; def foo(): print 2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">&gt;&gt;&gt; foo()</span>
<span class="computeroutput">2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">&gt;&gt;&gt; foo.__doc__</span>     <a name="apihelper.alltogether.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">foo.__doc__ == None</span> <a name="apihelper.alltogether.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">True</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">str(foo.__doc__)</span>    <a name="apihelper.alltogether.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'None'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can easily define a function that has no <tt class="literal">doc string</tt>, so its <tt class="literal">__doc__</tt> attribute is <tt class="literal">None</tt>.  Confusingly, if you evaluate the <tt class="literal">__doc__</tt> attribute directly, the <span class="application">Python</span> <span class="acronym">IDE</span> prints nothing at all, which makes sense if you think about it, but is still unhelpful.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can verify that the value of the <tt class="literal">__doc__</tt> attribute is actually <tt class="literal">None</tt> by comparing it directly.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">str</tt> function takes the null value and returns a string representation of it, <tt class="literal">'None'</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.isnull.sql"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="acronym">SQL</span>, you must use <tt class="literal">IS NULL</tt> instead of <tt class="literal">= NULL</tt> to compare a null value.  In <span class="application">Python</span>, you can use either <tt class="literal">== None</tt> or <tt class="literal">is None</tt>, but <tt class="literal">is None</tt> is faster.
                     </td>
                  </tr>
               </table>
               <p>Now that you are guaranteed to have a string, you can pass the string to <tt class="varname">processFunc</tt>, which you have <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions">already defined</a> as a function that either does or doesn't collapse whitespace.  Now you see why it was important to use <tt class="function">str</tt> to convert a <tt class="literal">None</tt> value into a string representation.  <tt class="varname">processFunc</tt> is assuming a string argument and calling its <tt class="function">split</tt> method, which would crash if you passed it <tt class="literal">None</tt> because <tt class="literal">None</tt> doesn't have a <tt class="function">split</tt> method.
               </p>
               <p>Stepping back even further, you see that you're using string formatting again to concatenate the return value of <tt class="varname">processFunc</tt> with the return value of <tt class="varname">method</tt>'s <tt class="function">ljust</tt> method.  This is a new string method that you haven't seen before.
               </p>
               <div class="example"><a name="d0e10958"></a><h3 class="title">Example&nbsp;4.24.&nbsp;Introducing <tt class="function">ljust</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = 'buildConnectionString'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s.ljust(30)</span> <a name="apihelper.alltogether.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'buildConnectionString         '</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s.ljust(20)</span> <a name="apihelper.alltogether.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'buildConnectionString'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">ljust</tt> pads the string with spaces to the given length.  This is what the <tt class="function">info</tt> function uses to make two columns of output and line up all the <tt class="literal">doc string</tt>s in the second column.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If the given length is smaller than the length of the string, <tt class="function">ljust</tt> will simply return the string unchanged.  It never truncates the string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>You're almost finished.  Given the padded method name from the <tt class="function">ljust</tt> method and the (possibly collapsed) <tt class="literal">doc string</tt> from the call to <tt class="varname">processFunc</tt>, you concatenate the two and get a single string.  Since you're mapping <tt class="varname">methodList</tt>, you end up with a list of strings.  Using the <tt class="function">join</tt> method of the string <tt class="literal">"\n"</tt>, you join this list into a single string, with each element of the list on a separate line, and print the result.
               </p>
               <div class="example"><a name="d0e11026"></a><h3 class="title">Example&nbsp;4.25.&nbsp;Printing a List</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ['a', 'b', 'c']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "\n".join(li)</span> <a name="apihelper.alltogether.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">a
b
c</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#apihelper.alltogether.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is also a useful debugging trick when you're working with lists.  And in <span class="application">Python</span>, you're always working with lists.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>That's the last piece of the puzzle.  You should now understand this code.</p>
               <div class="informalexample"><pre class="programlisting">
    print "\n".join(["%s %s" %
                      (method.ljust(spacing),
                       processFunc(str(getattr(object, method).__doc__)))
                     for method in methodList])</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="apihelper.summary"></a>4.9.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <tt class="filename">apihelper.py</tt> program and its output should now make perfect sense.
                  </p>
               </div>
               <div class="informalexample"><pre class="programlisting">
def info(object, spacing=10, collapse=1):
    """Print methods and doc strings.
    
    Takes module, class, list, dictionary, or string."""
    methodList = [method for method in dir(object) if callable(getattr(object, method))]
    processFunc = collapse and (lambda s: " ".join(s.split())) or (lambda s: s)
    print "\n".join(["%s %s" %
                      (method.ljust(spacing),
                       processFunc(str(getattr(object, method).__doc__)))
                     for method in methodList])

if __name__ == "__main__":
    print info.__doc__</pre></div>
               <div class="informalexample">
                  <p>Here is the output of <tt class="filename">apihelper.py</tt>:
                  </p><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from apihelper import info</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = []</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">info(li)</span>
<span class="computeroutput">append     L.append(object) -- append object to end
count      L.count(value) -&gt; integer -- return number of occurrences of value
extend     L.extend(list) -- extend list by appending list elements
index      L.index(value) -&gt; integer -- return index of first occurrence of value
insert     L.insert(index, object) -- insert object before index
pop        L.pop([index]) -&gt; item -- remove and return item at index (default last)
remove     L.remove(value) -- remove first occurrence of value
reverse    L.reverse() -- reverse *IN PLACE*
sort       L.sort([cmpfunc]) -- sort *IN PLACE*; if given, cmpfunc(x, y) -&gt; -1, 0, 1</span></pre></div>
               <div class="highlights">
                  <p>Before diving into the next chapter, make sure you're comfortable doing all of these things:</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>Defining and calling functions with <a href="#apihelper.optional" title="4.2.&nbsp;Using Optional and Named Arguments">optional and named arguments</a></li>
                        <li>Using <a href="#apihelper.str.intro" title="Example&nbsp;4.6.&nbsp;Introducing str"><tt class="function">str</tt></a> to coerce any arbitrary value into a string representation
                        </li>
                        <li>Using <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr"><tt class="function">getattr</tt></a> to get references to functions and other attributes dynamically
                        </li>
                        <li>Extending the list comprehension syntax to do <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">list filtering</a></li>
                        <li>Recognizing <a href="#apihelper.andor" title="4.6.&nbsp;The Peculiar Nature of and and or">the <tt class="literal">and-or</tt> trick</a> and using it safely
                        </li>
                        <li>Defining <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions"><tt class="literal">lambda</tt> functions</a></li>
                        <li><a href="#apihelper.funcassign">Assigning functions to variables</a> and calling the function by referencing the variable.  I can't emphasize this enough, because this mode of thought is vital
                           to advancing your understanding of <span class="application">Python</span>.  You'll see more complex applications of this concept throughout this book.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="fileinfo"></a>Chapter&nbsp;5.&nbsp;Objects and Object-Orientation
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p>This chapter, and pretty much every chapter after this, deals with object-oriented <span class="application">Python</span> programming.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.divein"></a>5.1.&nbsp;Diving In
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Here is a complete, working <span class="application">Python</span> program.  Read the <a href="#odbchelper.docstring" title="2.3.&nbsp;Documenting Functions"><tt class="literal">doc string</tt>s</a> of the module, the classes, and the functions to get an overview of what this program does and how it works.  As usual, don't
                     worry about the stuff you don't understand; that's what the rest of the chapter is for.
                  </p>
               </div>
               <div class="example"><a name="d0e11177"></a><h3 class="title">Example&nbsp;5.1.&nbsp;<tt class="filename">fileinfo.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Framework for getting filetype-specific metadata.

Instantiate appropriate class with filename.  Returned object acts like a
dictionary, with key-value pairs for each piece of metadata.
    import fileinfo
    info = fileinfo.MP3FileInfo("/music/ap/mahadeva.mp3")
    print "\\n".join(["%s=%s" % (k, v) for k, v in info.items()])

Or use listDirectory function to get info on all files in a directory.
    for info in fileinfo.listDirectory("/music/ap/", [".mp3"]):
        ...

Framework can be extended by adding classes for particular file types, e.g.
HTMLFileInfo, MPGFileInfo, DOCFileInfo.  Each class is completely responsible for
parsing its files appropriately; see MP3FileInfo for example.
"""
import os
import sys
from UserDict import UserDict

def stripnulls(data):
    "strip whitespace and nulls"
    return data.replace("\00", "").strip()

class FileInfo(UserDict):
    "store file metadata"
    def __init__(self, filename=None):
        UserDict.__init__(self)
        self["name"] = filename

class MP3FileInfo(FileInfo):
    "store ID3v1.0 MP3 tags"
    tagDataMap = {"title"   : (  3,  33, stripnulls),
                  "artist"  : ( 33,  63, stripnulls),
                  "album"   : ( 63,  93, stripnulls),
                  "year"    : ( 93,  97, stripnulls),
                  "comment" : ( 97, 126, stripnulls),
                  "genre"   : (127, 128, ord)}

    def __parse(self, filename):
        "parse ID3v1.0 tags from MP3 file"
        self.clear()
        try:                               
            fsock = open(filename, "rb", 0)
            try:                           
                fsock.seek(-128, 2)        
                tagdata = fsock.read(128)  
            finally:                       
                fsock.close()              
            if tagdata[:3] == "TAG":
                for tag, (start, end, parseFunc) in self.tagDataMap.items():
                    self[tag] = parseFunc(tagdata[start:end])               
        except IOError:                    
            pass                           

    def __setitem__(self, key, item):
        if key == "name" and item:
            self.__parse(item)
        FileInfo.__setitem__(self, key, item)

def listDirectory(directory, fileExtList):                                        
    "get list of file info objects for files of particular extensions"
    fileList = [os.path.normcase(f)
                for f in os.listdir(directory)]           
    fileList = [os.path.join(directory, f) 
               for f in fileList
                if os.path.splitext(f)[1] in fileExtList] 
    def getFileInfoClass(filename, module=sys.modules[FileInfo.__module__]):      
        "get file info class from filename extension"                             
        subclass = "%sFileInfo" % os.path.splitext(filename)[1].upper()[1:]       
        return hasattr(module, subclass) and getattr(module, subclass) or FileInfo
    return [getFileInfoClass(f)(f) for f in fileList]                             

if __name__ == "__main__":
    for info in listDirectory("/music/_singles/", [".mp3"]): <a name="fileinfo_divein.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        print "\n".join(["%s=%s" % (k, v) for k, v in info.items()])
        print</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo_divein.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This program's output depends on the files on your hard drive.  To get meaningful output, you'll need to change the directory
                              path to point to a directory of MP3 files on your own machine.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="informalexample">
                  <p>This is the output I got on my machine.  Your output will be different, unless, by some startling coincidence, you share my
                     exact taste in music.
                  </p><pre class="screen"><span class="computeroutput">album=
artist=Ghost in the Machine
title=A Time Long Forgotten (Concept
genre=31
name=/music/_singles/a_time_long_forgotten_con.mp3
year=1999
comment=http://mp3.com/ghostmachine

album=Rave Mix
artist=***DJ MARY-JANE***
title=HELLRAISER****Trance from Hell
genre=31
name=/music/_singles/hellraiser.mp3
year=2000
comment=http://mp3.com/DJMARYJANE

album=Rave Mix
artist=***DJ MARY-JANE***
title=KAIRO****THE BEST GOA
genre=31
name=/music/_singles/kairo.mp3
year=2000
comment=http://mp3.com/DJMARYJANE

album=Journeys
artist=Masters of Balance
title=Long Way Home
genre=31
name=/music/_singles/long_way_home1.mp3
year=2000
comment=http://mp3.com/MastersofBalan

album=
artist=The Cynic Project
title=Sidewinder
genre=18
name=/music/_singles/sidewinder.mp3
year=2000
comment=http://mp3.com/cynicproject

album=Digitosis@128k
artist=VXpanded
title=Spinning
genre=255
name=/music/_singles/spinning.mp3
year=2000
comment=http://mp3.com/artists/95/vxp</span></pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.fromimport"></a>5.2.&nbsp;Importing Modules Using <tt class="literal">from <i class="replaceable">module</i> import</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> has two ways of importing modules.  Both are useful, and you should know when to use each.  One way, <tt class="literal">import <i class="replaceable">module</i></tt>, you've already seen in <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">Section&nbsp;2.4, &#8220;Everything Is an Object&#8221;</a>.  The other way accomplishes the same thing, but it has subtle and important differences.
                  </p>
               </div>
               <div class="informalexample">
                  <p>Here is the basic <tt class="literal">from <i class="replaceable">module</i> import</tt> syntax:
                  </p><pre class="programlisting">
from UserDict import UserDict
</pre></div>
               <p>This is similar to the <a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string"><tt class="literal">import <i class="replaceable">module</i></tt></a> syntax that you know and love, but with an important difference: the attributes and methods of the imported module <tt class="filename">types</tt> are imported directly into the local namespace, so they are available directly, without qualification by module name.  You
                  can import individual items or use <tt class="literal">from <i class="replaceable">module</i> import *</tt> to import everything.
               </p><a name="compare.fromimport.perl"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">from <i class="replaceable">module</i> import *</tt> in <span class="application">Python</span> is like <tt class="literal">use <i class="replaceable">module</i></tt> in <span class="application">Perl</span>; <tt class="literal">import <i class="replaceable">module</i></tt> in <span class="application">Python</span> is like <tt class="literal">require <i class="replaceable">module</i></tt> in <span class="application">Perl</span>.
                     </td>
                  </tr>
               </table><a name="compare.fromimport.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">from <i class="replaceable">module</i> import *</tt> in <span class="application">Python</span> is like <tt class="literal">import <i class="replaceable">module</i>.*</tt> in <span class="application">Java</span>; <tt class="literal">import <i class="replaceable">module</i></tt> in <span class="application">Python</span> is like <tt class="literal">import <i class="replaceable">module</i></tt> in <span class="application">Java</span>.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="d0e11355"></a><h3 class="title">Example&nbsp;5.2.&nbsp;<tt class="literal">import <i class="replaceable">module</i></tt> <span class="foreignphrase"><i class="foreignphrase"><span class="acronym">vs.</span></i></span> <tt class="literal">from <i class="replaceable">module</i> import</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import types</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">types.FunctionType</span>             <a name="fileinfo.import.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;type 'function'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">FunctionType</span>                   <a name="fileinfo.import.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
NameError: There is no variable named 'FunctionType'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from types import FunctionType</span> <a name="fileinfo.import.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">FunctionType</span>                   <a name="fileinfo.import.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;type 'function'&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.import.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="filename">types</tt> module contains no methods; it just has attributes for each <span class="application">Python</span> object type.  Note that the attribute, <tt class="constant">FunctionType</tt>, must be qualified by the module name, <tt class="filename">types</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.import.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="constant">FunctionType</tt> by itself has not been defined in this namespace; it exists only in the context of <tt class="filename">types</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.import.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This syntax imports the attribute <tt class="constant">FunctionType</tt> from the <tt class="filename">types</tt> module directly into the local namespace.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.import.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now <tt class="constant">FunctionType</tt> can be accessed directly, without reference to <tt class="filename">types</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>When should you use <tt class="literal">from <i class="replaceable">module</i> import</tt>?
               </p>
               <div class="itemizedlist">
                  <ul>
                     <li>If you will be accessing attributes and methods often and don't want to type the module name over and over, use <tt class="literal">from <i class="replaceable">module</i> import</tt>.
                     </li>
                     <li>If you want to selectively import some attributes and methods but not others, use <tt class="literal">from <i class="replaceable">module</i> import</tt>.
                     </li>
                     <li>If the module contains attributes or functions with the same name as ones in your module, you must use <tt class="literal">import <i class="replaceable">module</i></tt> to avoid name conflicts.
                     </li>
                  </ul>
               </div>
               <p>Other than that, it's just a matter of style, and you will see <span class="application">Python</span> code written both ways.
               </p><a name="d0e11495"></a><table class="caution" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/caution.png" alt="Caution" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Use <tt class="literal">from module import *</tt> sparingly, because it makes it difficult to determine where a particular function or attribute came from, and that makes
                        debugging and refactoring more difficult.
                     </td>
                  </tr>
               </table>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Module Importing Techniques</h3>
                  <ul>
                     <li><a href="http://www.effbot.org/guides/">eff-bot</a> has more to say on <a href="http://www.effbot.org/guides/import-confusion.htm"><tt class="literal">import <i class="replaceable">module</i></tt> <span class="foreignphrase"><i class="foreignphrase"><span class="acronym">vs.</span></i></span> <tt class="literal">from <i class="replaceable">module</i> import</tt></a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses advanced import techniques, including <a href="http://www.python.org/doc/current/tut/node8.html#SECTION008410000000000000000"><tt class="literal">from <i class="replaceable">module</i> import *</tt></a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.class"></a>5.3.&nbsp;Defining Classes
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> is fully object-oriented: you can define your own classes, inherit from your own or built-in classes, and instantiate the
                     classes you've defined.
                  </p>
               </div>
               <p>Defining a class in <span class="application">Python</span> is simple.  As with functions, there is no separate interface definition.  Just define the class and start coding.  A <span class="application">Python</span> class starts with the reserved word <tt class="literal">class</tt>, followed by the class name.  Technically, that's all that's required, since a class doesn't need to inherit from any other
                  class.
               </p>
               <div class="example"><a name="fileinfo.class.simplest"></a><h3 class="title">Example&nbsp;5.3.&nbsp;The Simplest <span class="application">Python</span> Class
                  </h3><pre class="programlisting">
class Loaf: <a name="fileinfo.class.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    pass    <a name="fileinfo.class.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"> <a name="fileinfo.class.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.class.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The name of this class is <tt class="classname">Loaf</tt>, and it doesn't inherit from any other class.  Class names are usually capitalized, <tt class="classname">EachWordLikeThis</tt>, but this is only a convention, not a requirement.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.class.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This class doesn't define any methods or attributes, but syntactically, there needs to be something in the definition, so
                              you use <tt class="literal">pass</tt>.  This is a <span class="application">Python</span> reserved word that just means &#8220;<span class="quote">move along, nothing to see here</span>&#8221;.  It's a statement that does nothing, and it's a good placeholder when you're stubbing out functions or classes.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.class.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You probably guessed this, but everything in a class is indented, just like the code within a function, <tt class="literal">if</tt> statement, <tt class="literal">for</tt> loop, and so forth.  The first thing not indented is not in the class.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.pass.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">The <tt class="literal">pass</tt> statement in <span class="application">Python</span> is like an empty set of braces (<tt class="literal">{}</tt>) in <span class="application">Java</span> or <span class="application"><span class="acronym">C</span></span>.
                     </td>
                  </tr>
               </table>
               <p>Of course, realistically, most classes will be inherited from other classes, and they will define their own class methods
                  and attributes.  But as you've just seen, there is nothing that a class absolutely must have, other than a name.  In particular,
                  <span class="application"><span class="acronym">C++</span></span> programmers may find it odd that <span class="application">Python</span> classes don't have explicit constructors and destructors.  <span class="application">Python</span> classes do have something similar to a constructor: the <tt class="function">__init__</tt> method.
               </p>
               <div class="example"><a name="fileinfo.class.example"></a><h3 class="title">Example&nbsp;5.4.&nbsp;Defining the <tt class="classname">FileInfo</tt> Class
                  </h3><pre class="programlisting">
from UserDict import UserDict

class FileInfo(UserDict): <a name="fileinfo.class.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In <span class="application">Python</span>, the ancestor of a class is simply listed in parentheses immediately after the class name.  So the <tt class="classname">FileInfo</tt> class is inherited from the <tt class="classname">UserDict</tt> class (which was <a href="#fileinfo.fromimport" title="5.2.&nbsp;Importing Modules Using from module import">imported from the <tt class="filename">UserDict</tt> module</a>).  <tt class="classname">UserDict</tt> is a class that acts like a dictionary, allowing you to essentially subclass the dictionary datatype and add your own behavior.
                               (There are similar classes <tt class="classname">UserList</tt> and <tt class="classname">UserString</tt> which allow you to subclass lists and strings.)  There is a bit of black magic behind this, which you will demystify later
                              in this chapter when you explore the <tt class="classname">UserDict</tt> class in more depth.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.extends.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Python</span>, the ancestor of a class is simply listed in parentheses immediately after the class name.  There is no special keyword like
                        <tt class="literal">extends</tt> in <span class="application">Java</span>.
                     </td>
                  </tr>
               </table>
               <p><span class="application">Python</span> supports multiple inheritance.  In the parentheses following the class name, you can list as many ancestor classes as you
                  like, separated by commas.
               </p>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e11720"></a>5.3.1.&nbsp;Initializing and Coding Classes
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>This example shows the initialization of the <tt class="classname">FileInfo</tt> class using the <tt class="function">__init__</tt> method.
                  </p>
                  <div class="example"><a name="fileinfo.init.example"></a><h3 class="title">Example&nbsp;5.5.&nbsp;Initializing the <tt class="classname">FileInfo</tt> Class
                     </h3><pre class="programlisting">
class FileInfo(UserDict):
    "store file metadata"              <a name="fileinfo.class.2.2"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    def __init__(self, filename=None): <a name="fileinfo.class.2.3"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"> <a name="fileinfo.class.2.4"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"> <a name="fileinfo.class.2.5"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.2"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Classes can (and <a href="#tip.docstring">should</a>) have <tt class="literal">doc string</tt>s too, just like modules and functions.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.3"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">__init__</tt> is called immediately after an instance of the class is created.  It would be tempting but incorrect to call this the constructor
                                 of the class.  It's tempting, because it looks like a constructor (by convention, <tt class="function">__init__</tt> is the first method defined for the class), acts like one (it's the first piece of code executed in a newly created instance
                                 of the class), and even sounds like one (&#8220;<span class="quote">init</span>&#8221; certainly suggests a constructor-ish nature).  Incorrect, because the object has already been constructed by the time <tt class="function">__init__</tt> is called, and you already have a valid reference to the new instance of the class.  But <tt class="function">__init__</tt> is the closest thing you're going to get to a constructor in <span class="application">Python</span>, and it fills much the same role.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.4"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The first argument of every class method, including <tt class="function">__init__</tt>, is always a reference to the current instance of the class.  By convention, this argument is always named <tt class="literal">self</tt>.  In the <tt class="function">__init__</tt> method, <tt class="literal">self</tt> refers to the newly created object; in other class methods, it refers to the instance whose method was called.  Although
                                 you need to specify <tt class="literal">self</tt> explicitly when defining the method, you do <span class="emphasis"><em>not</em></span> specify it when calling the method; <span class="application">Python</span> will add it for you automatically.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.5"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">__init__</tt> methods can take any number of arguments, and just like functions, the arguments can be defined with default values, making
                                 them optional to the caller.  In this case, <tt class="varname">filename</tt> has a default value of <tt class="literal">None</tt>, which is the <span class="application">Python</span> null value.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div><a name="compare.self.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">By convention, the first argument of any <span class="application">Python</span> class method (the reference to the current instance) is called <tt class="literal">self</tt>.  This argument fills the role of the reserved word <tt class="literal">this</tt> in <span class="application"><span class="acronym">C++</span></span> or <span class="application">Java</span>, but <tt class="literal">self</tt> is not a reserved word in <span class="application">Python</span>, merely a naming convention.  Nonetheless, please don't call it anything but <tt class="literal">self</tt>; this is a very strong convention.
                        </td>
                     </tr>
                  </table>
                  <div class="example"><a name="fileinfo.init.code.example"></a><h3 class="title">Example&nbsp;5.6.&nbsp;Coding the <tt class="classname">FileInfo</tt> Class
                     </h3><pre class="programlisting">
class FileInfo(UserDict):
    "store file metadata"
    def __init__(self, filename=None):
        UserDict.__init__(self)        <a name="fileinfo.class.2.6"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        self["name"] = filename        <a name="fileinfo.class.2.7"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
                                       <a name="fileinfo.class.2.8"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.6"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Some pseudo-object-oriented languages like <span class="application">Powerbuilder</span> have a concept of &#8220;<span class="quote">extending</span>&#8221; constructors and other events, where the ancestor's method is called automatically before the descendant's method is executed.
                                  <span class="application">Python</span> does not do this; you must always explicitly call the appropriate method in the ancestor class.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.7"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">I told you that this class acts like a dictionary, and here is the first sign of it.  You're assigning the argument <tt class="varname">filename</tt> as the value of this object's <tt class="literal">name</tt> key.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.class.2.8"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Note that the <tt class="function">__init__</tt> method never returns a value.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e11896"></a>5.3.2.&nbsp;Knowing When to Use <tt class="literal">self</tt> and <tt class="function">__init__</tt></h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>When defining your class methods, you <span class="emphasis"><em>must</em></span> explicitly list <tt class="literal">self</tt> as the first argument for each method, including <tt class="function">__init__</tt>.  When you call a method of an ancestor class from within your class, you <span class="emphasis"><em>must</em></span> include the <tt class="literal">self</tt> argument.  But when you call your class method from outside, you do not specify anything for the <tt class="literal">self</tt> argument; you skip it entirely, and <span class="application">Python</span> automatically adds the instance reference for you.  I am aware that this is confusing at first; it's not really inconsistent,
                     but it may appear inconsistent because it relies on a distinction (between bound and unbound methods) that you don't know
                     about yet.
                  </p>
                  <p>Whew.  I realize that's a lot to absorb, but you'll get the hang of it.  All <span class="application">Python</span> classes work the same way, so once you learn one, you've learned them all.  If you forget everything else, remember this
                     one thing, because I promise it will trip you up:
                  </p><a name="tip.initoptional"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="function">__init__</tt> methods are optional, but when you define one, you must remember to explicitly call the ancestor's <tt class="function">__init__</tt> method (if it defines one).  This is more generally true: whenever a descendant wants to extend the behavior of the ancestor,
                           the descendant method must explicitly call the ancestor method at the proper time, with the proper arguments.
                        </td>
                     </tr>
                  </table>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on <span class="application">Python</span> Classes
                     </h3>
                     <ul>
                        <li><a href="http://www.freenetpages.co.uk/hp/alan.gauld/" title="Python book for first-time programmers"><i class="citetitle">Learning to Program</i></a> has a gentler <a href="http://www.freenetpages.co.uk/hp/alan.gauld/tutclass.htm">introduction to classes</a>.
                        </li>
                        <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> shows how to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap12.htm">use classes to model compound datatypes</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> has an in-depth look at <a href="http://www.python.org/doc/current/tut/node11.html">classes, namespaces, and inheritance</a>.
                        </li>
                        <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/242">common questions about classes</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.create"></a>5.4.&nbsp;Instantiating Classes
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Instantiating classes in <span class="application">Python</span> is straightforward.  To instantiate a class, simply call the class as if it were a function, passing the arguments that the
                     <tt class="function">__init__</tt> method defines.  The return value will be the newly created object.
                  </p>
               </div>
               <div class="example"><a name="d0e12003"></a><h3 class="title">Example&nbsp;5.7.&nbsp;Creating a <tt class="classname">FileInfo</tt> Instance
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import fileinfo</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = fileinfo.FileInfo("/music/_singles/kairo.mp3")</span> <a name="fileinfo.create.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.__class__</span>                                        <a name="fileinfo.create.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;class fileinfo.FileInfo at 010EC204&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.__doc__</span>                                          <a name="fileinfo.create.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'store file metadata'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>                                                  <a name="fileinfo.create.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">{'name': '/music/_singles/kairo.mp3'}</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.create.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You are creating an instance of the <tt class="classname">FileInfo</tt> class (defined in the <tt class="filename">fileinfo</tt> module) and assigning the newly created instance to the variable <tt class="varname">f</tt>.  You are passing one parameter, <tt class="literal">/music/_singles/kairo.mp3</tt>, which will end up as the <tt class="varname">filename</tt> argument in <tt class="classname">FileInfo</tt>'s <tt class="function">__init__</tt> method.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.create.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Every class instance has a built-in attribute, <tt class="literal">__class__</tt>, which is the object's class.  (Note that the representation of this includes the physical address of the instance on my
                              machine; your representation will be different.)  <span class="application">Java</span> programmers may be familiar with the <tt class="classname">Class</tt> class, which contains methods like <tt class="function">getName</tt> and <tt class="function">getSuperclass</tt> to get metadata information about an object.  In <span class="application">Python</span>, this kind of metadata is available directly on the object itself through attributes like <tt class="literal">__class__</tt>, <tt class="literal">__name__</tt>, and <tt class="literal">__bases__</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.create.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can access the instance's <tt class="literal">doc string</tt> just as with a function or a module.  All instances of a class share the same <tt class="literal">doc string</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.create.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember when the <tt class="function">__init__</tt> method <a href="#fileinfo.class.example" title="Example&nbsp;5.4.&nbsp;Defining the FileInfo Class">assigned its <tt class="varname">filename</tt> argument to <tt class="literal">self["name"]</tt></a>?  Well, here's the result.  The arguments you pass when you create the class instance get sent right along to the <tt class="function">__init__</tt> method (along with the object reference, <tt class="literal">self</tt>, which <span class="application">Python</span> adds for free).
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.new.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Python</span>, simply call a class as if it were a function to create a new instance of the class.  There is no explicit <tt class="literal">new</tt> operator like <span class="application"><span class="acronym">C++</span></span> or <span class="application">Java</span>.
                     </td>
                  </tr>
               </table>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e12165"></a>5.4.1.&nbsp;Garbage Collection
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>If creating new instances is easy, destroying them is even easier.  In general, there is no need to explicitly free instances,
                     because they are freed automatically when the variables assigned to them go out of scope.  Memory leaks are rare in <span class="application">Python</span>.
                  </p>
                  <div class="example"><a name="fileinfo.scope"></a><h3 class="title">Example&nbsp;5.8.&nbsp;Trying to Implement a Memory Leak</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def leakmem():</span>
<tt class="prompt">...     </tt><span class="userinput">f = fileinfo.FileInfo('/music/_singles/kairo.mp3')</span> <a name="fileinfo.create.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for i in range(100):</span>
<tt class="prompt">...     </tt><span class="userinput">leakmem()</span>                                          <a name="fileinfo.create.2.3"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.create.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Every time the <tt class="function">leakmem</tt> function is called, you are creating an instance of <tt class="classname">FileInfo</tt> and assigning it to the variable <tt class="varname">f</tt>, which is a local variable within the function.  Then the function ends without ever freeing <tt class="varname">f</tt>, so you would expect a memory leak, but you would be wrong.  When the function ends, the local variable <tt class="varname">f</tt> goes out of scope.  At this point, there are no longer any references to the newly created instance of <tt class="classname">FileInfo</tt> (since you never assigned it to anything other than <tt class="varname">f</tt>), so <span class="application">Python</span> destroys the instance for us.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.create.2.3"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">No matter how many times you call the <tt class="function">leakmem</tt> function, it will never leak memory, because every time, <span class="application">Python</span> will destroy the newly created <tt class="classname">FileInfo</tt> class before returning from <tt class="function">leakmem</tt>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>The technical term for this form of garbage collection is &#8220;<span class="quote">reference counting</span>&#8221;.  <span class="application">Python</span> keeps a list of references to every instance created.  In the above example, there was only one reference to the <tt class="classname">FileInfo</tt> instance: the local variable <tt class="varname">f</tt>.  When the function ends, the variable <tt class="varname">f</tt> goes out of scope, so the reference count drops to <tt class="constant">0</tt>, and <span class="application">Python</span> destroys the instance automatically.
                  </p>
                  <p>In previous versions of <span class="application">Python</span>, there were situations where reference counting failed, and <span class="application">Python</span> couldn't clean up after you.  If you created two instances that referenced each other (for instance, a doubly-linked list,
                     where each node has a pointer to the previous and next node in the list), neither instance would ever be destroyed automatically
                     because <span class="application">Python</span> (correctly) believed that there is always a reference to each instance.  <span class="application">Python</span> 2.0 has an additional form of garbage collection called &#8220;<span class="quote">mark-and-sweep</span>&#8221; which is smart enough to notice this virtual gridlock and clean up circular references correctly.
                  </p>
                  <p>As a former philosophy major, it disturbs me to think that things disappear when no one is looking at them, but that's exactly
                     what happens in <span class="application">Python</span>.  In general, you can simply forget about memory management and let <span class="application">Python</span> clean up after you.
                  </p>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on Garbage Collection</h3>
                     <ul>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/specialattrs.html">built-in attributes like <tt class="literal">__class__</tt></a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-gc.html"><tt class="filename">gc</tt> module</a>, which gives you low-level control over <span class="application">Python</span>'s garbage collection.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.userdict"></a>5.5.&nbsp;Exploring <tt class="classname">UserDict</tt>: A Wrapper Class
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>As you've seen, <tt class="classname">FileInfo</tt> is a class that acts like a dictionary.  To explore this further, let's look at the <tt class="classname">UserDict</tt> class in the <tt class="filename">UserDict</tt> module, which is the ancestor of the <tt class="classname">FileInfo</tt> class.  This is nothing special; the class is written in <span class="application">Python</span> and stored in a <tt class="literal">.py</tt> file, just like any other <span class="application">Python</span> code.  In particular, it's stored in the <tt class="filename">lib</tt> directory in your <span class="application">Python</span> installation.
                  </p>
               </div><a name="tip.locate"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">ActivePython</span> <span class="acronym">IDE</span> on Windows, you can quickly open any module in your library path by selecting
                        <span class="guimenu">File</span>-&gt;<span class="guimenuitem"><span class="accel">L</span>ocate...</span> (<span><b class="shortcut"><span><b class="keycap">Ctrl</b></span>-<span class="keysym">L</span></b></span>).
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="fileinfo.userdict.init.example"></a><h3 class="title">Example&nbsp;5.9.&nbsp;Defining the <tt class="classname">UserDict</tt> Class
                  </h3><pre class="programlisting">
class UserDict:                                <a name="fileinfo.userdict.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    def __init__(self, dict=None):             <a name="fileinfo.userdict.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        self.data = {}                         <a name="fileinfo.userdict.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        if dict is not None: self.update(dict) <a name="fileinfo.userdict.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"> <a name="fileinfo.userdict.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that <tt class="classname">UserDict</tt> is a base class, not inherited from any other class.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the <tt class="function">__init__</tt> method that you <a href="#fileinfo.class.example" title="Example&nbsp;5.4.&nbsp;Defining the FileInfo Class">overrode in the <tt class="classname">FileInfo</tt> class</a>.  Note that the argument list in this ancestor class is different than the descendant.  That's okay; each subclass can have
                              its own set of arguments, as long as it calls the ancestor with the correct arguments.  Here the ancestor class has a way
                              to define initial values (by passing a dictionary in the <tt class="varname">dict</tt> argument) which the <tt class="classname">FileInfo</tt> does not use.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><span class="application">Python</span> supports data attributes (called &#8220;<span class="quote">instance variables</span>&#8221; in <span class="application">Java</span> and <span class="application">Powerbuilder</span>, and &#8220;<span class="quote">member variables</span>&#8221; in <span class="application"><span class="acronym">C++</span></span>).  Data attributes are pieces of data held by a specific instance of a class.  In this case, each instance of <tt class="classname">UserDict</tt> will have a data attribute <tt class="varname">data</tt>.  To reference this attribute from code outside the class, you qualify it with the instance name, <tt class="literal"><i class="replaceable">instance</i>.data</tt>, in the same way that you qualify a function with its module name.  To reference a data attribute from within the class,
                              you use <tt class="literal">self</tt> as the qualifier.  By convention, all data attributes are initialized to reasonable values in the <tt class="function">__init__</tt> method.  However, this is not required, since data attributes, like local variables, <a href="#odbchelper.vardef" title="3.4.&nbsp;Declaring variables">spring into existence</a> when they are first assigned a value.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">update</tt> method is a dictionary duplicator: it copies all the keys and values from one dictionary to another.  This does <span class="emphasis"><em>not</em></span> clear the target dictionary first; if the target dictionary already has some keys, the ones from the source dictionary will
                              be overwritten, but others will be left untouched.  Think of <tt class="function">update</tt> as a merge function, not a copy function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a syntax you may not have seen before (I haven't used it in the examples in this book).  It's an <tt class="literal">if</tt> statement, but instead of having an indented block starting on the next line, there is just a single statement on the same
                              line, after the colon.  This is perfectly legal syntax, which is just a shortcut you can use when you have only one statement
                              in a block.  (It's like specifying a single statement without braces in <span class="application"><span class="acronym">C++</span></span>.)  You can use this syntax, or you can have indented code on subsequent lines, but you can't do both for the same block.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.overloading"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><span class="application">Java</span> and <span class="application">Powerbuilder</span> support function overloading by argument list, <span class="foreignphrase"><i class="foreignphrase"><span class="acronym">i.e.</span></i></span> one class can have multiple methods with the same name but a different number of arguments, or arguments of different types.
                         Other languages (most notably <span class="acronym">PL/SQL</span>) even support function overloading by argument name; <span class="foreignphrase"><i class="foreignphrase"><span class="acronym">i.e.</span></i></span> one class can have multiple methods with the same name and the same number of arguments of the same type but different argument
                        names.  <span class="application">Python</span> supports neither of these; it has no form of function overloading whatsoever.  Methods are defined solely by their name,
                        and there can be only one method per class with a given name.  So if a descendant class has an <tt class="function">__init__</tt> method, it <span class="emphasis"><em>always</em></span> overrides the ancestor <tt class="function">__init__</tt> method, even if the descendant defines it with a different argument list.  And the same rule applies to any other method.
                     </td>
                  </tr>
               </table><a name="fileinfo.derivedclasses"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Guido, the original author of <span class="application">Python</span>, explains method overriding this way: "Derived classes may override methods of their base classes. Because methods have no
                        special privileges when calling other methods of the same object, a method of a base class that calls another method defined
                        in the same base class, may in fact end up calling a method of a derived class that overrides it. (For <span class="application"><span class="acronym">C++</span></span> programmers: all methods in <span class="application">Python</span> are effectively virtual.)"  If that doesn't make sense to you (it confuses the hell out of me), feel free to ignore it. 
                        I just thought I'd pass it along.
                     </td>
                  </tr>
               </table><a name="note.dataattributes"></a><table class="caution" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/caution.png" alt="Caution" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Always assign an initial value to all of an instance's data attributes in the <tt class="function">__init__</tt> method.  It will save you hours of debugging later, tracking down <tt class="classname">AttributeError</tt> exceptions because you're referencing uninitialized (and therefore non-existent) attributes.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="fileinfo.userdict.normalmethods"></a><h3 class="title">Example&nbsp;5.10.&nbsp;<tt class="classname">UserDict</tt> Normal Methods
                  </h3><pre class="programlisting">
    def clear(self): self.data.clear()          <a name="fileinfo.userdict.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    def copy(self):                             <a name="fileinfo.userdict.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        if self.__class__ is UserDict:          <a name="fileinfo.userdict.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
            return UserDict(self.data)         
        import copy                             <a name="fileinfo.userdict.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        return copy.copy(self)                 
    def keys(self): return self.data.keys()     <a name="fileinfo.userdict.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
    def items(self): return self.data.items()  
    def values(self): return self.data.values()
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">clear</tt> is a normal class method; it is publicly available to be called by anyone at any time.  Notice that <tt class="function">clear</tt>, like all class methods, has <tt class="literal">self</tt> as its first argument.  (Remember that you don't include <tt class="literal">self</tt> when you call the method; it's something that <span class="application">Python</span> adds for you.)  Also note the basic technique of this wrapper class: store a real dictionary (<tt class="varname">data</tt>) as a data attribute, define all the methods that a real dictionary has, and have each class method redirect to the corresponding
                              method on the real dictionary.  (In case you'd forgotten, a dictionary's <tt class="function">clear</tt> method <a href="#odbchelper.dict.del" title="Example&nbsp;3.5.&nbsp;Deleting Items from a Dictionary">deletes all of its keys</a> and their associated values.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="filename">copy</tt> method of a real dictionary returns a new dictionary that is an exact duplicate of the original (all the same key-value pairs).
                               But <tt class="classname">UserDict</tt> can't simply redirect to <tt class="function">self.data.copy</tt>, because that method returns a real dictionary, and what you want is to return a new instance that is the same class as <tt class="literal">self</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You use the <tt class="literal">__class__</tt> attribute to see if <tt class="literal">self</tt> is a <tt class="classname">UserDict</tt>; if so, you're golden, because you know how to copy a <tt class="classname">UserDict</tt>: just create a new <tt class="classname">UserDict</tt> and give it the real dictionary that you've squirreled away in <tt class="varname">self.data</tt>.  Then you immediately return the new <tt class="classname">UserDict</tt> you don't even get to the <tt class="literal">import copy</tt> on the next line.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If <tt class="literal"><span class="literal">self</span>.<span class="literal">__class__</span></tt> is not <tt class="classname">UserDict</tt>, then <tt class="literal">self</tt> must be some subclass of <tt class="classname">UserDict</tt> (like maybe <tt class="classname">FileInfo</tt>), in which case life gets trickier.  <tt class="classname">UserDict</tt> doesn't know how to make an exact copy of one of its descendants; there could, for instance, be other data attributes defined
                              in the subclass, so you would need to iterate through them and make sure to copy all of them.  Luckily, <span class="application">Python</span> comes with a module to do exactly this, and it's called <tt class="filename">copy</tt>.  I won't go into the details here (though it's a wicked cool module, if you're ever inclined to dive into it on your own).
                               Suffice it to say that <tt class="filename">copy</tt> can copy arbitrary <span class="application">Python</span> objects, and that's how you're using it here.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The rest of the methods are straightforward, redirecting the calls to the built-in methods on <tt class="varname">self.data</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e12692"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In versions of <span class="application">Python</span> prior to 2.2, you could not directly subclass built-in datatypes like strings, lists, and dictionaries.  To compensate for
                        this, <span class="application">Python</span> comes with wrapper classes that mimic the behavior of these built-in datatypes: <tt class="classname">UserString</tt>, <tt class="classname">UserList</tt>, and <tt class="classname">UserDict</tt>.  Using a combination of normal and special methods, the <tt class="classname">UserDict</tt> class does an excellent imitation of a dictionary.  In <span class="application">Python</span> 2.2 and later, you can inherit classes directly from built-in datatypes like <tt class="classname">dict</tt>.  An example of this is given in the examples that come with this book, in <tt class="filename">fileinfo_fromdict.py</tt>.
                     </td>
                  </tr>
               </table>
               <p>In <span class="application">Python</span>, you can inherit directly from the <tt class="classname">dict</tt> built-in datatype, as shown in this example.  There are three differences here compared to the <tt class="filename">UserDict</tt> version.
               </p>
               <div class="example"><a name="fileinfo.userdict.fromdict"></a><h3 class="title">Example&nbsp;5.11.&nbsp;Inheriting Directly from Built-In Datatype <tt class="classname">dict</tt></h3><pre class="programlisting">
class FileInfo(dict):                  <a name="fileinfo.userdict.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    "store file metadata"
    def __init__(self, filename=None): <a name="fileinfo.userdict.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        self["name"] = filename
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first difference is that you don't need to import the <tt class="filename">UserDict</tt> module, since <tt class="classname">dict</tt> is a built-in datatype and is always available.  The second is that you are inheriting from <tt class="classname">dict</tt> directly, instead of from <tt class="function">UserDict.UserDict</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.userdict.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The third difference is subtle but important.  Because of the way <tt class="filename">UserDict</tt> works internally, it requires you to manually call its <tt class="function">__init__</tt> method to properly initialize its internal data structures.  <tt class="classname">dict</tt> does not work like this; it is not a wrapper, and it requires no explicit initialization.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on <tt class="filename">UserDict</tt></h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-UserDict.html"><tt class="filename">UserDict</tt> module</a> and the <a href="http://www.python.org/doc/current/lib/module-copy.html"><tt class="filename">copy</tt> module</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.specialmethods"></a>5.6.&nbsp;Special Class Methods
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>In addition to normal class methods, there are a number of special methods that <span class="application">Python</span> classes can define.  Instead of being called directly by your code (like normal methods), special methods are called for
                     you by <span class="application">Python</span> in particular circumstances or when specific syntax is used.
                  </p>
               </div>
               <p>As you saw in the <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">previous section</a>, normal methods go a long way towards wrapping a dictionary in a class.  But normal methods alone are not enough, because
                  there are a lot of things you can do with dictionaries besides call methods on them.  For starters, you can <a href="#odbchelper.dict.define" title="Example&nbsp;3.1.&nbsp;Defining a Dictionary">get</a> and <a href="#odbchelper.dict.modify" title="Example&nbsp;3.2.&nbsp;Modifying a Dictionary">set</a> items with a syntax that doesn't include explicitly invoking methods.  This is where special class methods come in: they
                  provide a way to map non-method-calling syntax into method calls.
               </p>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e12822"></a>5.6.1.&nbsp;Getting and Setting Items
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="example"><a name="d0e12825"></a><h3 class="title">Example&nbsp;5.12.&nbsp;The <tt class="function">__getitem__</tt> Special Method
                     </h3><pre class="programlisting">
    def __getitem__(self, key): return self.data[key]</pre><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = fileinfo.FileInfo("/music/_singles/kairo.mp3")</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>
<span class="computeroutput">{'name':'/music/_singles/kairo.mp3'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.__getitem__("name")</span> <a name="fileinfo.specialmethods.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'/music/_singles/kairo.mp3'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f["name"]</span>             <a name="fileinfo.specialmethods.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'/music/_singles/kairo.mp3'</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">__getitem__</tt> special method looks simple enough.  Like the normal methods <tt class="function">clear</tt>, <tt class="function">keys</tt>, and <tt class="function">values</tt>, it just redirects to the dictionary to return its value.  But how does it get called?  Well, you can call <tt class="function">__getitem__</tt> directly, but in practice you wouldn't actually do that; I'm just doing it here to show you how it works.  The right way
                                 to use <tt class="function">__getitem__</tt> is to get <span class="application">Python</span> to call it for you.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This looks just like the syntax you would use to <a href="#odbchelper.dict.define" title="Example&nbsp;3.1.&nbsp;Defining a Dictionary">get a dictionary value</a>, and in fact it returns the value you would expect.  But here's the missing link: under the covers, <span class="application">Python</span> has converted this syntax to the method call <tt class="literal">f.__getitem__("name")</tt>.  That's why <tt class="function">__getitem__</tt> is a special class method; not only can you call it yourself, you can get <span class="application">Python</span> to call it for you by using the right syntax.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Of course, <span class="application">Python</span> has a <tt class="function">__setitem__</tt> special method to go along with <tt class="function">__getitem__</tt>, as shown in the next example.
                  </p>
                  <div class="example"><a name="fileinfo.specialmethods.setitem.example"></a><h3 class="title">Example&nbsp;5.13.&nbsp;The <tt class="function">__setitem__</tt> Special Method
                     </h3><pre class="programlisting">
    def __setitem__(self, key, item): self.data[key] = item</pre><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>
<span class="computeroutput">{'name':'/music/_singles/kairo.mp3'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.__setitem__("genre", 31)</span> <a name="fileinfo.specialmethods.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>
<span class="computeroutput">{'name':'/music/_singles/kairo.mp3', 'genre':31}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f["genre"] = 32</span>            <a name="fileinfo.specialmethods.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>
<span class="computeroutput">{'name':'/music/_singles/kairo.mp3', 'genre':32}</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Like the <tt class="function">__getitem__</tt> method, <tt class="function">__setitem__</tt> simply redirects to the real dictionary <tt class="varname">self.data</tt> to do its work.  And like <tt class="function">__getitem__</tt>, you wouldn't ordinarily call it directly like this; <span class="application">Python</span> calls <tt class="function">__setitem__</tt> for you when you use the right syntax.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This looks like regular dictionary syntax, except of course that <tt class="varname">f</tt> is really a class that's trying very hard to masquerade as a dictionary, and <tt class="function">__setitem__</tt> is an essential part of that masquerade.  This line of code actually calls <tt class="literal">f.__setitem__("genre", 32)</tt> under the covers.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p><tt class="function">__setitem__</tt> is a special class method because it gets called for you, but it's still a class method.  Just as easily as the <tt class="function">__setitem__</tt> method was defined in <tt class="classname">UserDict</tt>, you can redefine it in the descendant class to override the ancestor method.  This allows you to define classes that act
                     like dictionaries in some ways but define their own behavior above and beyond the built-in dictionary.
                  </p>
                  <p>This concept is the basis of the entire framework you're studying in this chapter.  Each file type can have a handler class
                     that knows how to get metadata from a particular type of file.  Once some attributes (like the file's name and location) are
                     known, the handler class knows how to derive other attributes automatically.  This is done by overriding the <tt class="function">__setitem__</tt> method, checking for particular keys, and adding additional processing when they are found.
                  </p>
                  <p>For example, <tt class="classname">MP3FileInfo</tt> is a descendant of <tt class="classname">FileInfo</tt>.  When an <tt class="classname">MP3FileInfo</tt>'s <tt class="literal">name</tt> is set, it doesn't just set the <tt class="literal">name</tt> key (like the ancestor <tt class="classname">FileInfo</tt> does); it also looks in the file itself for <span class="abbrev">MP3</span> tags and populates a whole set of keys.  The next example shows how this works.
                  </p>
                  <div class="example"><a name="d0e13038"></a><h3 class="title">Example&nbsp;5.14.&nbsp;Overriding <tt class="function">__setitem__</tt> in <tt class="classname">MP3FileInfo</tt></h3><pre class="programlisting">
    def __setitem__(self, key, item):         <a name="fileinfo.specialmethods.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        if key == "name" and item:            <a name="fileinfo.specialmethods.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
            self.__parse(item)                <a name="fileinfo.specialmethods.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        FileInfo.__setitem__(self, key, item) <a name="fileinfo.specialmethods.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Notice that this <tt class="function">__setitem__</tt> method is defined exactly the same way as the ancestor method.  This is important, since <span class="application">Python</span> will be calling the method for you, and it expects it to be defined with a certain number of arguments.  (Technically speaking,
                                 the names of the arguments don't matter; only the number of arguments is important.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Here's the crux of the entire <tt class="classname">MP3FileInfo</tt> class: if you're assigning a value to the <tt class="literal">name</tt> key, you want to do something extra.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The extra processing you do for <tt class="literal">name</tt>s is encapsulated in the <tt class="function">__parse</tt> method.  This is another class method defined in <tt class="classname">MP3FileInfo</tt>, and when you call it, you qualify it with <tt class="varname">self</tt>.  Just calling <tt class="function">__parse</tt> would look for a normal function defined outside the class, which is not what you want.  Calling <tt class="function">self.__parse</tt> will look for a class method defined within the class.  This isn't anything new; you reference <a href="#fileinfo.userdict.normalmethods" title="Example&nbsp;5.10.&nbsp;UserDict Normal Methods">data attributes</a> the same way.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">After doing this extra processing, you want to call the ancestor method.  Remember that this is never done for you in <span class="application">Python</span>; you must do it manually.  Note that you're calling the immediate ancestor, <tt class="classname">FileInfo</tt>, even though it doesn't have a <tt class="function">__setitem__</tt> method.  That's okay, because <span class="application">Python</span> will walk up the ancestor tree until it finds a class with the method you're calling, so this line of code will eventually
                                 find and call the <tt class="function">__setitem__</tt> defined in <tt class="classname">UserDict</tt>.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div><a name="tip.self.call"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">When accessing data attributes within a class, you need to qualify the attribute name: <tt class="literal">self.<i class="replaceable">attribute</i></tt>.  When calling other methods within a class, you need to qualify the method name: <tt class="literal">self.<i class="replaceable">method</i></tt>.
                        </td>
                     </tr>
                  </table>
                  <div class="example"><a name="fileinfo.specialmethods.setname"></a><h3 class="title">Example&nbsp;5.15.&nbsp;Setting an <tt class="classname">MP3FileInfo</tt>'s <tt class="literal">name</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import fileinfo</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">mp3file = fileinfo.MP3FileInfo()</span>                   <a name="fileinfo.specialmethods.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">mp3file</span>
<span class="computeroutput">{'name':None}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">mp3file["name"] = "/music/_singles/kairo.mp3"</span>      <a name="fileinfo.specialmethods.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">mp3file</span>
<span class="computeroutput">{'album': 'Rave Mix', 'artist': '***DJ MARY-JANE***', 'genre': 31,
'title': 'KAIRO****THE BEST GOA', 'name': '/music/_singles/kairo.mp3',
'year': '2000', 'comment': 'http://mp3.com/DJMARYJANE'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">mp3file["name"] = "/music/_singles/sidewinder.mp3"</span> <a name="fileinfo.specialmethods.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">mp3file</span>
<span class="computeroutput">{'album': '', 'artist': 'The Cynic Project', 'genre': 18, 'title': 'Sidewinder', 
'name': '/music/_singles/sidewinder.mp3', 'year': '2000', 
'comment': 'http://mp3.com/cynicproject'}</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">First, you create an instance of <tt class="classname">MP3FileInfo</tt>, without passing it a filename.  (You can get away with this because the <tt class="varname">filename</tt> argument of the <tt class="function">__init__</tt> method is <a href="#apihelper.optional" title="4.2.&nbsp;Using Optional and Named Arguments">optional</a>.)  Since <tt class="classname">MP3FileInfo</tt> has no <tt class="function">__init__</tt> method of its own, <span class="application">Python</span> walks up the ancestor tree and finds the <tt class="function">__init__</tt> method of <tt class="classname">FileInfo</tt>.  This <tt class="function">__init__</tt> method manually calls the <tt class="function">__init__</tt> method of <tt class="classname">UserDict</tt> and then sets the <tt class="literal">name</tt> key to <tt class="varname">filename</tt>, which is <tt class="literal">None</tt>, since you didn't pass a filename.  Thus, <tt class="varname">mp3file</tt> initially looks like a dictionary with one key, <tt class="literal">name</tt>, whose value is <tt class="literal">None</tt>.
                                 
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Now the real fun begins.  Setting the <tt class="literal">name</tt> key of <tt class="varname">mp3file</tt> triggers the <tt class="function">__setitem__</tt> method on <tt class="classname">MP3FileInfo</tt> (not <tt class="classname">UserDict</tt>), which notices that you're setting the <tt class="literal">name</tt> key with a real value and calls <tt class="function">self.__parse</tt>.  Although you haven't traced through the <tt class="function">__parse</tt> method yet, you can see from the output that it sets several other keys: <tt class="literal">album</tt>, <tt class="literal">artist</tt>, <tt class="literal">genre</tt>, <tt class="literal">title</tt>, <tt class="literal">year</tt>, and <tt class="literal">comment</tt>.
                                 
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.specialmethods.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Modifying the <tt class="literal">name</tt> key will go through the same process again: <span class="application">Python</span> calls <tt class="function">__setitem__</tt>, which calls <tt class="function">self.__parse</tt>, which sets all the other keys.
                                 
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.morespecial"></a>5.7.&nbsp;Advanced Special Class Methods
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> has more special methods than just <tt class="function">__getitem__</tt> and <tt class="function">__setitem__</tt>.  Some of them let you emulate functionality that you may not even know about.
                  </p>
               </div>
               <p>This example shows some of the other special methods in <tt class="filename">UserDict</tt>.
               </p>
               <div class="example"><a name="fileinfo.morespecial.example"></a><h3 class="title">Example&nbsp;5.16.&nbsp;More Special Methods in <tt class="classname">UserDict</tt></h3><pre class="programlisting">
    def __repr__(self): return repr(self.data)     <a name="fileinfo.morespecial.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    def __cmp__(self, dict):                       <a name="fileinfo.morespecial.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        if isinstance(dict, UserDict):            
            return cmp(self.data, dict.data)      
        else:                                     
            return cmp(self.data, dict)           
    def __len__(self): return len(self.data)       <a name="fileinfo.morespecial.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
    def __delitem__(self, key): del self.data[key] <a name="fileinfo.morespecial.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.morespecial.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">__repr__</tt> is a special method that is called when you call <tt class="literal">repr(<i class="replaceable">instance</i>)</tt>.  The <tt class="function">repr</tt> function is a built-in function that returns a string representation of an object.  It works on any object, not just class
                              instances.  You're already intimately familiar with <tt class="function">repr</tt> and you don't even know it.  In the interactive window, when you type just a variable name and press the <span><b class="keycap">ENTER</b></span> key, <span class="application">Python</span> uses <tt class="function">repr</tt> to display the variable's value.  Go create a dictionary <tt class="varname">d</tt> with some data and then <tt class="literal">print repr(d)</tt> to see for yourself.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.morespecial.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">__cmp__</tt> is called when you compare class instances.  In general, you can compare any two <span class="application">Python</span> objects, not just class instances, by using <tt class="literal">==</tt>.  There are rules that define when built-in datatypes are considered equal; for instance, dictionaries are equal when they
                              have all the same keys and values, and strings are equal when they are the same length and contain the same sequence of characters.
                               For class instances, you can define the <tt class="function">__cmp__</tt> method and code the comparison logic yourself, and then you can use <tt class="literal">==</tt> to compare instances of your class and <span class="application">Python</span> will call your <tt class="function">__cmp__</tt> special method for you.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.morespecial.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">__len__</tt> is called when you call <tt class="literal">len(<i class="replaceable">instance</i>)</tt>.  The <tt class="function">len</tt> function is a built-in function that returns the length of an object.  It works on any object that could reasonably be thought
                              of as having a length.  The <tt class="function">len</tt> of a string is its number of characters; the <tt class="function">len</tt> of a dictionary is its number of keys; the <tt class="function">len</tt> of a list or tuple is its number of elements.  For class instances, define the <tt class="function">__len__</tt> method and code the length calculation yourself, and then call <tt class="literal">len(<i class="replaceable">instance</i>)</tt> and <span class="application">Python</span> will call your <tt class="function">__len__</tt> special method for you.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.morespecial.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">__delitem__</tt> is called when you call <tt class="literal">del <i class="replaceable">instance</i>[<i class="replaceable">key</i>]</tt>, which you may remember as the way to <a href="#odbchelper.dict.del" title="Example&nbsp;3.5.&nbsp;Deleting Items from a Dictionary">delete individual items from a dictionary</a>.  When you use <tt class="function">del</tt> on a class instance, <span class="application">Python</span> calls the <tt class="function">__delitem__</tt> special method for you.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.strequals.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Java</span>, you determine whether two string variables reference the same physical memory location by using <tt class="literal">str1 == str2</tt>.  This is called <span class="emphasis"><em>object identity</em></span>, and it is written in <span class="application">Python</span> as <tt class="literal">str1 is str2</tt>.  To compare string values in <span class="application">Java</span>, you would use <tt class="literal">str1.equals(str2)</tt>; in <span class="application">Python</span>, you would use <tt class="literal">str1 == str2</tt>.  <span class="application">Java</span> programmers who have been taught to believe that the world is a better place because <tt class="literal">==</tt> in <span class="application">Java</span> compares by identity instead of by value may have a difficult time adjusting to <span class="application">Python</span>'s lack of such &#8220;<span class="quote">gotchas</span>&#8221;.
                     </td>
                  </tr>
               </table>
               <p>At this point, you may be thinking, &#8220;<span class="quote">All this work just to do something in a class that I can do with a built-in datatype.</span>&#8221;  And it's true that life would be easier (and the entire <tt class="classname">UserDict</tt> class would be unnecessary) if you could inherit from built-in datatypes like a dictionary.  But even if you could, special
                  methods would still be useful, because they can be used in any class, not just wrapper classes like <tt class="classname">UserDict</tt>.
               </p>
               <p>Special methods mean that <span class="emphasis"><em>any class</em></span> can store key/value pairs like a dictionary, just by defining the <tt class="function">__setitem__</tt> method.  <span class="emphasis"><em>Any class</em></span> can act like a sequence, just by defining the <tt class="function">__getitem__</tt> method.  Any class that defines the <tt class="function">__cmp__</tt> method can be compared with <tt class="literal">==</tt>.  And if your class represents something that has a length, don't define a <tt class="function">GetLength</tt> method; define the <tt class="function">__len__</tt> method and use <tt class="literal">len(<i class="replaceable">instance</i>)</tt>.
               </p><a name="note.physical.v.logical"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">While other object-oriented languages only let you define the physical model of an object (&#8220;<span class="quote">this object has a <tt class="function">GetLength</tt> method</span>&#8221;), <span class="application">Python</span>'s special class methods like <tt class="function">__len__</tt> allow you to define the logical model of an object (&#8220;<span class="quote">this object has a length</span>&#8221;).
                     </td>
                  </tr>
               </table>
               <p><span class="application">Python</span> has a lot of other special methods.  There's a whole set of them that let classes act like numbers, allowing you to add,
                  subtract, and do other arithmetic operations on class instances.  (The canonical example of this is a class that represents
                  complex numbers, numbers with both real and imaginary components.)  The <tt class="function">__call__</tt> method lets a class act like a function, allowing you to call a class instance directly.  And there are other special methods
                  that allow classes to have read-only and write-only data attributes; you'll talk more about those in later chapters.
               </p>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Special Class Methods</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> documents <a href="http://www.python.org/doc/current/ref/specialnames.html">all the special class methods</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.classattributes"></a>5.8.&nbsp;Introducing Class Attributes
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You already know about <a href="#fileinfo.userdict.init.example" title="Example&nbsp;5.9.&nbsp;Defining the UserDict Class">data attributes</a>, which are variables owned by a specific instance of a class.  <span class="application">Python</span> also supports class attributes, which are variables owned by the class itself.
                  </p>
               </div>
               <div class="example"><a name="fileinfo.classattributes.intro"></a><h3 class="title">Example&nbsp;5.17.&nbsp;Introducing Class Attributes</h3><pre class="programlisting">
class MP3FileInfo(FileInfo):
    "store ID3v1.0 MP3 tags"
    tagDataMap = {"title"   : (  3,  33, stripnulls),
                  "artist"  : ( 33,  63, stripnulls),
                  "album"   : ( 63,  93, stripnulls),
                  "year"    : ( 93,  97, stripnulls),
                  "comment" : ( 97, 126, stripnulls),
                  "genre"   : (127, 128, ord)}</pre><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import fileinfo</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">fileinfo.MP3FileInfo</span>            <a name="fileinfo.classattributes.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;class fileinfo.MP3FileInfo at 01257FDC&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">fileinfo.MP3FileInfo.tagDataMap</span> <a name="fileinfo.classattributes.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">{'title': (3, 33, &lt;function stripnulls at 0260C8D4&gt;), 
'genre': (127, 128, &lt;built-in function ord&gt;), 
'artist': (33, 63, &lt;function stripnulls at 0260C8D4&gt;), 
'year': (93, 97, &lt;function stripnulls at 0260C8D4&gt;), 
'comment': (97, 126, &lt;function stripnulls at 0260C8D4&gt;), 
'album': (63, 93, &lt;function stripnulls at 0260C8D4&gt;)}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">m = fileinfo.MP3FileInfo()</span>      <a name="fileinfo.classattributes.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">m.tagDataMap</span>
<span class="computeroutput">{'title': (3, 33, &lt;function stripnulls at 0260C8D4&gt;), 
'genre': (127, 128, &lt;built-in function ord&gt;), 
'artist': (33, 63, &lt;function stripnulls at 0260C8D4&gt;), 
'year': (93, 97, &lt;function stripnulls at 0260C8D4&gt;), 
'comment': (97, 126, &lt;function stripnulls at 0260C8D4&gt;), 
'album': (63, 93, &lt;function stripnulls at 0260C8D4&gt;)}</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="classname">MP3FileInfo</tt> is the class itself, not any particular instance of the class.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">tagDataMap</tt> is a class attribute: literally, an attribute of the class.  It is available before creating any instances of the class.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Class attributes are available both through direct reference to the class and through any instance of the class.</td>
                        </tr>
                     </table>
                  </div>
               </div><a name="compare.classattr.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Java</span>, both static variables (called class attributes in <span class="application">Python</span>) and instance variables (called data attributes in <span class="application">Python</span>) are defined immediately after the class definition (one with the <tt class="literal">static</tt> keyword, one without).  In <span class="application">Python</span>, only class attributes can be defined here; data attributes are defined in the <tt class="function">__init__</tt> method.
                     </td>
                  </tr>
               </table>
               <p>Class attributes can be used as class-level constants (which is how you use them in <tt class="classname">MP3FileInfo</tt>), but they are not really constants.  You can also change them.
               </p><a name="d0e13711"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">There are no constants in <span class="application">Python</span>.  Everything can be changed if you try hard enough.  This fits with one of the core principles of <span class="application">Python</span>: bad behavior should be discouraged but not banned.  If you really want to change the value of <tt class="literal">None</tt>, you can do it, but don't come running to me when your code is impossible to debug.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="fileinfo.classattributes.writeable.example"></a><h3 class="title">Example&nbsp;5.18.&nbsp;Modifying Class Attributes</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">class counter:</span>
<tt class="prompt">...     </tt><span class="userinput">count = 0</span>                     <a name="fileinfo.classattributes.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">def __init__(self):</span>
<tt class="prompt">...     </tt><span class="userinput">    self.__class__.count += 1</span> <a name="fileinfo.classattributes.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter</span>
<span class="computeroutput">&lt;class __main__.counter at 010EAECC&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter.count</span>                     <a name="fileinfo.classattributes.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">0</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">c = counter()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">c.count</span>                           <a name="fileinfo.classattributes.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter.count</span>
<span class="computeroutput">1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d = counter()</span>                     <a name="fileinfo.classattributes.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">d.count</span>
<span class="computeroutput">2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">c.count</span>
<span class="computeroutput">2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter.count</span>
<span class="computeroutput">2</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">count</tt> is a class attribute of the <tt class="classname">counter</tt> class.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">__class__</tt> is a built-in attribute of every class instance (of every class).  It is a reference to the class that <tt class="varname">self</tt> is an instance of (in this case, the <tt class="classname">counter</tt> class).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Because <tt class="varname">count</tt> is a class attribute, it is available through direct reference to the class, before you have created any instances of the
                              class.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Creating an instance of the class calls the <tt class="function">__init__</tt> method, which increments the class attribute <tt class="varname">count</tt> by <tt class="constant">1</tt>.  This affects the class itself, not just the newly created instance.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.classattributes.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Creating a second instance will increment the class attribute <tt class="varname">count</tt> again.  Notice how the class attribute is shared by the class and all instances of the class.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.private"></a>5.9.&nbsp;Private Functions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>Like most languages, <span class="application">Python</span> has the concept of private elements:
               </p>
               <div class="itemizedlist">
                  <ul>
                     <li>Private functions, which can't be called from outside their module</li>
                     <li>Private class methods, which can't be called from outside their class</li>
                     <li>Private attributes, which can't be accessed from outside their class.</li>
                  </ul>
               </div>
               <div class="abstract">
                  <p>Unlike in most languages, whether a <span class="application">Python</span> function, method, or attribute is private or public is determined entirely by its name.
                  </p>
               </div>
               <p>If the name of a <span class="application">Python</span> function, class method, or attribute starts with (but doesn't end with) two underscores, it's private; everything else is
                  public.  <span class="application">Python</span> has no concept of <span class="emphasis"><em>protected</em></span> class methods (accessible only in their own class and descendant classes).  Class methods are either private (accessible
                  only in their own class) or public (accessible from anywhere).
               </p>
               <p>In <tt class="classname">MP3FileInfo</tt>, there are two methods: <tt class="function">__parse</tt> and <tt class="function">__setitem__</tt>.  As you have already discussed, <tt class="function">__setitem__</tt> is a <a href="#fileinfo.specialmethods.setitem.example" title="Example&nbsp;5.13.&nbsp;The __setitem__ Special Method">special method</a>; normally, you would call it indirectly by using the dictionary syntax on a class instance, but it is public, and you could
                  call it directly (even from outside the <tt class="filename">fileinfo</tt> module) if you had a really good reason.  However, <tt class="function">__parse</tt> is private, because it has two underscores at the beginning of its name.
               </p><a name="tip.specialmethodnames"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Python</span>, all special methods (like <a href="#fileinfo.specialmethods.setitem.example" title="Example&nbsp;5.13.&nbsp;The __setitem__ Special Method"><tt class="function">__setitem__</tt></a>) and built-in attributes (like <a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string"><tt class="literal">__doc__</tt></a>) follow a standard naming convention: they both start with and end with two underscores.  Don't name your own methods and
                        attributes this way, because it will only confuse you (and others) later.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="d0e13946"></a><h3 class="title">Example&nbsp;5.19.&nbsp;Trying to Call a Private Method</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import fileinfo</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">m = fileinfo.MP3FileInfo()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">m.__parse("/music/_singles/kairo.mp3")</span> <a name="fileinfo.private.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
AttributeError: 'MP3FileInfo' instance has no attribute '__parse'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.private.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If you try to call a private method, <span class="application">Python</span> will raise a slightly misleading exception, saying that the method does not exist.  Of course it does exist, but it's private,
                              so it's not accessible outside the class.Strictly speaking, private methods are accessible outside their class, just not <span class="emphasis"><em>easily</em></span> accessible.  Nothing in <span class="application">Python</span> is truly private; internally, the names of private methods and attributes are mangled and unmangled on the fly to make them
                              seem inaccessible by their given names.  You can access the <tt class="function">__parse</tt> method of the <tt class="classname">MP3FileInfo</tt> class by the name <tt class="function">_MP3FileInfo__parse</tt>.  Acknowledge that this is interesting, but promise to never, ever do it in real code.  Private methods are private for a
                              reason, but like many other things in <span class="application">Python</span>, their privateness is ultimately a matter of convention, not force.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Private Functions</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses the inner workings of <a href="http://www.python.org/doc/current/tut/node11.html#SECTION0011600000000000000000">private variables</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.summary"></a>5.10.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>That's it for the hard-core object trickery.  You'll see a real-world application of special class methods in <a href="#soap">Chapter 12</a>, which uses <tt class="function">getattr</tt> to create a proxy to a remote web service.
                  </p>
               </div>
               <p>The next chapter will continue using this code sample to explore other <span class="application">Python</span> concepts, such as exceptions, file objects, and <tt class="literal">for</tt> loops.
               </p>
               <p>Before diving into the next chapter, make sure you're comfortable doing all of these things:</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Importing modules using either <a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string"><tt class="literal">import <i class="replaceable">module</i></tt></a> or <a href="#fileinfo.fromimport" title="5.2.&nbsp;Importing Modules Using from module import"><tt class="literal">from <i class="replaceable">module</i> import</tt></a></li>
                     <li><a href="#fileinfo.class" title="5.3.&nbsp;Defining Classes">Defining</a> and <a href="#fileinfo.create" title="5.4.&nbsp;Instantiating Classes">instantiating</a> classes
                     </li>
                     <li>Defining <a href="#fileinfo.class.example" title="Example&nbsp;5.4.&nbsp;Defining the FileInfo Class"><tt class="function">__init__</tt> methods</a> and other <a href="#fileinfo.specialmethods" title="5.6.&nbsp;Special Class Methods">special class methods</a>, and understanding when they are called
                     </li>
                     <li>Subclassing <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class"><tt class="classname">UserDict</tt></a> to define classes that act like dictionaries
                     </li>
                     <li>Defining <a href="#fileinfo.userdict.init.example" title="Example&nbsp;5.9.&nbsp;Defining the UserDict Class">data attributes</a> and <a href="#fileinfo.classattributes" title="5.8.&nbsp;Introducing Class Attributes">class attributes</a>, and understanding the differences between them
                     </li>
                     <li>Defining <a href="#fileinfo.private" title="5.9.&nbsp;Private Functions">private attributes and methods</a></li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="filehandling"></a>Chapter&nbsp;6.&nbsp;Exceptions and File Handling
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p>In this chapter, you will dive into exceptions, file objects, <tt class="literal">for</tt> loops, and the <tt class="filename">os</tt> and <tt class="filename">sys</tt> modules.  If you've used exceptions in another programming language, you can skim the first section to get a sense of <span class="application">Python</span>'s syntax.  Be sure to tune in again for file handling.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.exception"></a>6.1.&nbsp;Handling Exceptions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Like many other programming languages, <span class="application">Python</span> has exception handling via <tt class="literal">try...except</tt> blocks.
                  </p>
               </div><a name="compare.exceptions.java"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> uses <tt class="literal">try...except</tt> to handle exceptions and <tt class="literal">raise</tt> to generate them.  <span class="application">Java</span> and <span class="application"><span class="acronym">C++</span></span> use <tt class="literal">try...catch</tt> to handle exceptions, and <tt class="literal">throw</tt> to generate them.
                     </td>
                  </tr>
               </table>
               <p>Exceptions are everywhere in <span class="application">Python</span>.  Virtually every module in the standard <span class="application">Python</span> library uses them, and <span class="application">Python</span> itself will raise them in a lot of different circumstances.  You've already seen them repeatedly throughout this book.
               </p>
               <div class="itemizedlist">
                  <ul>
                     <li><a href="#odbchelper.dict.define" title="Example&nbsp;3.1.&nbsp;Defining a Dictionary">Accessing a non-existent dictionary key</a> will raise a <tt class="errorcode">KeyError</tt> exception.
                     </li>
                     <li><a href="#odbchelper.list.search" title="Example&nbsp;3.12.&nbsp;Searching a List">Searching a list for a non-existent value</a> will raise a <tt class="errorcode">ValueError</tt> exception.
                     </li>
                     <li><a href="#odbchelper.tuplemethods" title="Example&nbsp;3.16.&nbsp;Tuples Have No Methods">Calling a non-existent method</a> will raise an <tt class="errorcode">AttributeError</tt> exception.
                     </li>
                     <li><a href="#odbchelper.unboundvariable" title="Example&nbsp;3.18.&nbsp;Referencing an Unbound Variable">Referencing a non-existent variable</a> will raise a <tt class="errorcode">NameError</tt> exception.
                     </li>
                     <li><a href="#odbchelper.stringformatting.coerce" title="Example&nbsp;3.22.&nbsp;String Formatting vs. Concatenating">Mixing datatypes without coercion</a> will raise a <tt class="errorcode">TypeError</tt> exception.
                     </li>
                  </ul>
               </div>
               <p>In each of these cases, you were simply playing around in the <span class="application">Python</span> <span class="acronym">IDE</span>: an error occurred, the exception was printed (depending on your <span class="acronym">IDE</span>, perhaps in an intentionally jarring shade of red), and that was that.  This is called an <span class="emphasis"><em>unhandled</em></span> exception.  When the exception was raised, there was no code to explicitly notice it and deal with it, so it bubbled its
                  way back to the default behavior built in to <span class="application">Python</span>, which is to spit out some debugging information and give up.  In the <span class="acronym">IDE</span>, that's no big deal, but if that happened while your actual <span class="application">Python</span> program was running, the entire program would come to a screeching halt.
               </p>
               <p>An exception doesn't need result in a complete program crash, though.  Exceptions, when raised, can be <span class="emphasis"><em>handled</em></span>.  Sometimes an exception is really because you have a bug in your code (like accessing a variable that doesn't exist), but
                  many times, an exception is something you can anticipate.  If you're opening a file, it might not exist.  If you're connecting
                  to a database, it might be unavailable, or you might not have the correct security credentials to access it.  If you know
                  a line of code may raise an exception, you should handle the exception using a <tt class="literal">try...except</tt> block.
               </p>
               <div class="example"><a name="d0e14243"></a><h3 class="title">Example&nbsp;6.1.&nbsp;Opening a Non-Existent File</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">fsock = open("/notthere", "r")</span>      <a name="fileinfo.exceptions.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
IOError: [Errno 2] No such file or directory: '/notthere'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">try:</span>
<tt class="prompt">...     </tt><span class="userinput">fsock = open("/notthere")</span>       <a name="fileinfo.exceptions.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">... </tt><span class="userinput">except IOError:</span>                     <a name="fileinfo.exceptions.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">print "The file does not exist, exiting gracefully"</span>
<tt class="prompt">... </tt><span class="userinput">print "This line will always print"</span> <a name="fileinfo.exceptions.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">The file does not exist, exiting gracefully
This line will always print</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using the built-in <tt class="function">open</tt> function, you can try to open a file for reading (more on <tt class="function">open</tt> in the next section).  But the file doesn't exist, so this raises the <tt class="errorcode">IOError</tt> exception.  Since you haven't provided any explicit check for an <tt class="errorcode">IOError</tt> exception, <span class="application">Python</span> just prints out some debugging information about what happened and then gives up.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You're trying to open the same non-existent file, but this time you're doing it within a <tt class="literal">try...except</tt> block.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When the <tt class="function">open</tt> method raises an <tt class="errorcode">IOError</tt> exception, you're ready for it.  The <tt class="literal">except IOError:</tt> line catches the exception and executes your own block of code, which in this case just prints a more pleasant error message.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Once an exception has been handled, processing continues normally on the first line after the <tt class="literal">try...except</tt> block.  Note that this line will always print, whether or not an exception occurs.  If you really did have a file called
                              <tt class="filename">notthere</tt> in your root directory, the call to <tt class="function">open</tt> would succeed, the <tt class="literal">except</tt> clause would be ignored, and this line would still be executed.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Exceptions may seem unfriendly (after all, if you don't catch the exception, your entire program will crash), but consider
                  the alternative.  Would you rather get back an unusable file object to a non-existent file?  You'd need to check its validity
                  somehow anyway, and if you forgot, somewhere down the line, your program would give you strange errors somewhere down the
                  line that you would need to trace back to the source.  I'm sure you've experienced this, and you know it's not fun.  With
                  exceptions, errors occur immediately, and you can handle them in a standard way at the source of the problem.
               </p>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e14344"></a>6.1.1.&nbsp;Using Exceptions For Other Purposes
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>There are a lot of other uses for exceptions besides handling actual error conditions.  A common use in the standard <span class="application">Python</span> library is to try to import a module, and then check whether it worked.  Importing a module that does not exist will raise
                     an <tt class="errorcode">ImportError</tt> exception.  You can use this to define multiple levels of functionality based on which modules are available at run-time,
                     or to support multiple platforms (where platform-specific code is separated into different modules).
                  </p>
                  <p>You can also define your own exceptions by creating a class that inherits from the built-in <tt class="classname">Exception</tt> class, and then raise your exceptions with the <tt class="function">raise</tt> command.  See the further reading section if you're interested in doing this.
                  </p>
                  <p>The next example demonstrates how to use an exception to support platform-specific functionality.  This code comes from the
                     <tt class="filename">getpass</tt> module, a wrapper module for getting a password from the user.  Getting a password is accomplished differently on <span class="acronym">UNIX</span>, Windows, and <span class="abbrev">Mac</span> <span class="acronym">OS</span> platforms, but this code encapsulates all of those differences.
                  </p>
                  <div class="example"><a name="crossplatform.example"></a><h3 class="title">Example&nbsp;6.2.&nbsp;Supporting Platform-Specific Functionality</h3><pre class="programlisting">
  # Bind the name getpass to the appropriate function
  try:
      import termios, TERMIOS                     <a name="fileinfo.exceptions.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
  except ImportError:
      try:
          import msvcrt                           <a name="fileinfo.exceptions.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
      except ImportError:
          try:
              from EasyDialogs import AskPassword <a name="fileinfo.exceptions.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
          except ImportError:
              getpass = default_getpass           <a name="fileinfo.exceptions.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
          else:                                   <a name="fileinfo.exceptions.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
              getpass = AskPassword
      else:
          getpass = win_getpass
  else:
      getpass = unix_getpass</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="filename">termios</tt> is a <span class="acronym">UNIX</span>-specific module that provides low-level control over the input terminal.  If this module is not available (because it's not
                                 on your system, or your system doesn't support it), the import fails and <span class="application">Python</span> raises an <tt class="errorcode">ImportError</tt>, which you catch.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">OK, you didn't have <tt class="filename">termios</tt>, so let's try <tt class="filename">msvcrt</tt>, which is a Windows-specific module that provides an <span class="acronym">API</span> to many useful functions in the Microsoft <span class="application">Visual C++</span> runtime services.  If this import fails, <span class="application">Python</span> will raise an <tt class="errorcode">ImportError</tt>, which you catch.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">If the first two didn't work, you try to import a function from <tt class="filename">EasyDialogs</tt>, which is a <span class="abbrev">Mac</span> <span class="acronym">OS</span>-specific module that provides functions to pop up dialog boxes of various types.  Once again, if this import fails, <span class="application">Python</span> will raise an <tt class="errorcode">ImportError</tt>, which you catch.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">None of these platform-specific modules is available (which is possible, since <span class="application">Python</span> has been ported to a lot of different platforms), so you need to fall back on a default password input function (which is
                                 defined elsewhere in the <tt class="filename">getpass</tt> module).  Notice what you're doing here: assigning the function <tt class="function">default_getpass</tt> to the variable <tt class="varname">getpass</tt>.  If you read the official <tt class="filename">getpass</tt> documentation, it tells you that the <tt class="filename">getpass</tt> module defines a <tt class="function">getpass</tt> function.  It does this by binding <tt class="varname">getpass</tt> to the correct function for your platform.  Then when you call the <tt class="function">getpass</tt> function, you're really calling a platform-specific function that this code has set up for you.  You don't need to know or
                                 care which platform your code is running on -- just call <tt class="function">getpass</tt>, and it will always do the right thing.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.exceptions.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">A <tt class="literal">try...except</tt> block can have an <tt class="literal">else</tt> clause, like an <tt class="literal">if</tt> statement.  If no exception is raised during the <tt class="literal">try</tt> block, the <tt class="literal">else</tt> clause is executed afterwards.  In this case, that means that the <tt class="literal">from EasyDialogs import AskPassword</tt> import worked, so you should bind <tt class="varname">getpass</tt> to the <tt class="function">AskPassword</tt> function.  Each of the other <tt class="literal">try...except</tt> blocks has similar <tt class="literal">else</tt> clauses to bind <tt class="varname">getpass</tt> to the appropriate function when you find an <tt class="literal">import</tt> that works.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on Exception Handling</h3>
                     <ul>
                        <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses <a href="http://www.python.org/doc/current/tut/node10.html#SECTION0010400000000000000000">defining and raising your own exceptions, and handling multiple exceptions at once</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/module-exceptions.html">all the built-in exceptions</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-getpass.html">getpass</a> module.
                        </li>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-traceback.html"><tt class="filename">traceback</tt> module</a>, which provides low-level access to exception attributes after an exception is raised.
                        </li>
                        <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> discusses the inner workings of the <a href="http://www.python.org/doc/current/ref/try.html"><tt class="literal">try...except</tt> block</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.files"></a>6.2.&nbsp;Working with File Objects
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> has a built-in function, <tt class="function">open</tt>, for opening a file on disk.  <tt class="function">open</tt> returns a file object, which has methods and attributes for getting information about and manipulating the opened file.
                  </p>
               </div>
               <div class="example"><a name="d0e14596"></a><h3 class="title">Example&nbsp;6.3.&nbsp;Opening a File</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = open("/music/_singles/kairo.mp3", "rb")</span> <a name="fileinfo.files.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>                                           <a name="fileinfo.files.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;open file '/music/_singles/kairo.mp3', mode 'rb' at 010E3988&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.mode</span>                                      <a name="fileinfo.files.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'rb'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.name</span>                                      <a name="fileinfo.files.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'/music/_singles/kairo.mp3'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.files.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">open</tt> method can take up to three parameters: a filename, a mode, and a buffering parameter.  Only the first one, the filename,
                              is required; the other two are <a href="#apihelper.optional" title="4.2.&nbsp;Using Optional and Named Arguments">optional</a>.  If not specified, the file is opened for reading in text mode.  Here you are opening the file for reading in binary mode.
                               (<tt class="literal">print open.__doc__</tt> displays a great explanation of all the possible modes.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.files.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">open</tt> function returns an object (by now, <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">this should not surprise you</a>).  A file object has several useful attributes.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.files.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="varname">mode</tt> attribute of a file object tells you in which mode the file was opened.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.files.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="varname">name</tt> attribute of a file object tells you the name of the file that the file object has open.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e14670"></a>6.2.1.&nbsp;Reading Files
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>After you open a file, the first thing you'll want to do is read from it, as shown in the next example.</p>
                  <div class="example"><a name="d0e14675"></a><h3 class="title">Example&nbsp;6.4.&nbsp;Reading a File</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>
<span class="computeroutput">&lt;open file '/music/_singles/kairo.mp3', mode 'rb' at 010E3988&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.tell()</span>              <a name="fileinfo.files.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">0</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.seek(-128, 2)</span>       <a name="fileinfo.files.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.tell()</span>              <a name="fileinfo.files.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">7542909</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">tagData = f.read(128)</span> <a name="fileinfo.files.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">tagData</span>
<span class="computeroutput">'TAGKAIRO****THE BEST GOA         ***DJ MARY-JANE***            
Rave Mix                      2000http://mp3.com/DJMARYJANE     \037'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.tell()</span>              <a name="fileinfo.files.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">7543037</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">A file object maintains state about the file it has open.  The <tt class="function">tell</tt> method of a file object tells you your current position in the open file.  Since you haven't done anything with this file
                                 yet, the current position is <tt class="constant">0</tt>, which is the beginning of the file.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">seek</tt> method of a file object moves to another position in the open file.  The second parameter specifies what the first one means;
                                 <tt class="constant">0</tt> means move to an absolute position (counting from the start of the file), <tt class="constant">1</tt> means move to a relative position (counting from the current position), and <tt class="literal">2</tt> means move to a position relative to the end of the file.  Since the <span class="abbrev">MP3</span> tags you're looking for are stored at the end of the file, you use <tt class="literal">2</tt> and tell the file object to move to a position <tt class="literal">128</tt> bytes from the end of the file.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">tell</tt> method confirms that the current file position has moved.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">read</tt> method reads a specified number of bytes from the open file and returns a string with the data that was read.  The optional
                                 parameter specifies the maximum number of bytes to read.  If no parameter is specified, <tt class="function">read</tt> will read until the end of the file.  (You could have simply said <tt class="literal">read()</tt> here, since you know exactly where you are in the file and you are, in fact, reading the last 128 bytes.)  The read data
                                 is assigned to the <tt class="varname">tagData</tt> variable, and the current position is updated based on how many bytes were read.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">tell</tt> method confirms that the current position has moved.  If you do the math, you'll see that after reading 128 bytes, the position
                                 has been incremented by 128.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e14800"></a>6.2.2.&nbsp;Closing Files
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>Open files consume system resources, and depending on the file mode, other programs may not be able to access them.  It's
                     important to close files as soon as you're finished with them.
                  </p>
                  <div class="example"><a name="d0e14805"></a><h3 class="title">Example&nbsp;6.5.&nbsp;Closing a File</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>
<span class="computeroutput">&lt;open file '/music/_singles/kairo.mp3', mode 'rb' at 010E3988&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.closed</span>       <a name="fileinfo.files.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">False</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.close()</span>      <a name="fileinfo.files.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f</span>
<span class="computeroutput">&lt;closed file '/music/_singles/kairo.mp3', mode 'rb' at 010E3988&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.closed</span>       <a name="fileinfo.files.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">True</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.seek(0)</span>      <a name="fileinfo.files.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
ValueError: I/O operation on closed file</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.tell()</span>
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
ValueError: I/O operation on closed file</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.read()</span>
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
ValueError: I/O operation on closed file</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.close()</span>      <a name="fileinfo.files.3.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="varname">closed</tt> attribute of a file object indicates whether the object has a file open or not.  In this case, the file is still open (<tt class="varname">closed</tt> is <tt class="constant">False</tt>).
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">To close a file, call the <tt class="function">close</tt> method of the file object.  This frees the lock (if any) that you were holding on the file, flushes buffered writes (if any)
                                 that the system hadn't gotten around to actually writing yet, and releases the system resources.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="varname">closed</tt> attribute confirms that the file is closed.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Just because a file is closed doesn't mean that the file object ceases to exist.  The variable <tt class="varname">f</tt> will continue to exist until it <a href="#fileinfo.scope" title="Example&nbsp;5.8.&nbsp;Trying to Implement a Memory Leak">goes out of scope</a> or gets manually deleted.  However, none of the methods that manipulate an open file will work once the file has been closed;
                                 they all raise an exception.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.3.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Calling <tt class="function">close</tt> on a file object whose file is already closed does <span class="emphasis"><em>not</em></span> raise an exception; it fails silently.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e14928"></a>6.2.3.&nbsp;Handling <span class="acronym">I/O</span> Errors
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>Now you've seen enough to understand the file handling code in the <tt class="filename">fileinfo.py</tt> sample code from teh previous chapter.  This example shows how to safely open and read from a file and gracefully handle
                     errors.
                  </p>
                  <div class="example"><a name="fileinfo.files.incode"></a><h3 class="title">Example&nbsp;6.6.&nbsp;File Objects in <tt class="classname">MP3FileInfo</tt></h3><pre class="programlisting">
        try:                                <a name="fileinfo.files.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
            fsock = open(filename, "rb", 0) <a name="fileinfo.files.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
            try:                           
                fsock.seek(-128, 2)         <a name="fileinfo.files.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
                tagdata = fsock.read(128)   <a name="fileinfo.files.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
            finally:                        <a name="fileinfo.files.4.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
                fsock.close()              
            .
            .
            .
        except IOError:                     <a name="fileinfo.files.4.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
            pass                           </pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Because opening and reading files is risky and may raise an exception, all of this code is wrapped in a <tt class="literal">try...except</tt> block.  (Hey, isn't <a href="#odbchelper.indenting" title="2.5.&nbsp;Indenting Code">standardized indentation</a> great?  This is where you start to appreciate it.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">open</tt> function may raise an <tt class="errorcode">IOError</tt>.  (Maybe the file doesn't exist.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">seek</tt> method may raise an <tt class="errorcode">IOError</tt>.  (Maybe the file is smaller than 128 bytes.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The <tt class="function">read</tt> method may raise an <tt class="errorcode">IOError</tt>.  (Maybe the disk has a bad sector, or it's on a network drive and the network just went down.)
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.4.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This is new: a <tt class="literal">try...finally</tt> block.  Once the file has been opened successfully by the <tt class="function">open</tt> function, you want to make absolutely sure that you close it, even if an exception is raised by the <tt class="function">seek</tt> or <tt class="function">read</tt> methods.  That's what a <tt class="literal">try...finally</tt> block is for: code in the <tt class="literal">finally</tt> block will <span class="emphasis"><em>always</em></span> be executed, even if something in the <tt class="literal">try</tt> block raises an exception.  Think of it as code that gets executed on the way out, regardless of what happened before.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.4.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">At last, you handle your <tt class="errorcode">IOError</tt> exception.  This could be the <tt class="errorcode">IOError</tt> exception raised by the call to <tt class="function">open</tt>, <tt class="function">seek</tt>, or <tt class="function">read</tt>.  Here, you really don't care, because all you're going to do is ignore it silently and continue.  (Remember, <tt class="literal">pass</tt> is a <span class="application">Python</span> statement that <a href="#fileinfo.class.simplest" title="Example&nbsp;5.3.&nbsp;The Simplest Python Class">does nothing</a>.)  That's perfectly legal; &#8220;<span class="quote">handling</span>&#8221; an exception can mean explicitly doing nothing.  It still counts as handled, and processing will continue normally on the
                                 next line of code after the <tt class="literal">try...except</tt> block.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e15055"></a>6.2.4.&nbsp;Writing to Files
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>As you would expect, you can also write to files in much the same way that you read from them.  There are two basic file modes:</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>"Append" mode will add data to the end of the file.</li>
                        <li>"write" mode will overwrite the file.</li>
                     </ul>
                  </div>
                  <p>Either mode will create the file automatically if it doesn't already exist, so there's never a need for any sort of fiddly
                     "if the log file doesn't exist yet, create a new empty file just so you can open it for the first time" logic.  Just open
                     it and start writing.
                  </p>
                  <div class="example"><a name="fileinfo.files.writeandappend"></a><h3 class="title">Example&nbsp;6.7.&nbsp;Writing to Files</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">logfile = open('test.log', 'w')</span> <a name="fileinfo.files.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">logfile.write('test succeeded')</span> <a name="fileinfo.files.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">logfile.close()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print file('test.log').read()</span>   <a name="fileinfo.files.5.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">test succeeded</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">logfile = open('test.log', 'a')</span> <a name="fileinfo.files.5.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">logfile.write('line 2')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">logfile.close()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print file('test.log').read()</span>   <a name="fileinfo.files.5.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">test succeededline 2</span>
</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You start boldly by creating either the new file <tt class="filename">test.log</tt> or overwrites the existing file, and opening the file for writing.  (The second parameter <tt class="literal">"w"</tt> means open the file for writing.)  Yes, that's all as dangerous as it sounds.  I hope you didn't care about the previous
                                 contents of that file, because it's gone now.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You can add data to the newly opened file with the <tt class="function">write</tt> method of the file object returned by <tt class="function">open</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.5.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="function">file</tt> is a synonym for <tt class="function">open</tt>.  This one-liner opens the file, reads its contents, and prints them.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.5.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">You happen to know that <tt class="filename">test.log</tt> exists (since you just finished writing to it), so you can open it and append to it.  (The <tt class="literal">"a"</tt> parameter means open the file for appending.)  Actually you could do this even if the file didn't exist, because opening
                                 the file for appending will create the file if necessary.  But appending will <span class="emphasis"><em>never</em></span> harm the existing contents of the file.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#fileinfo.files.5.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">As you can see, both the original line you wrote and the second line you appended are now in <tt class="filename">test.log</tt>.  Also note that carriage returns are not included.  Since you didn't write them explicitly to the file either time, the
                                 file doesn't include them.  You can write a carriage return with the <tt class="literal">"\n"</tt> character.  Since you didn't do this, everything you wrote to the file ended up smooshed together on the same line.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <div class="itemizedlist">
                     <h3 class="title">Further Reading on File Handling</h3>
                     <ul>
                        <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses reading and writing files, including how to <a href="http://www.python.org/doc/current/tut/node9.html#SECTION009210000000000000000">read a file one line at a time into a list</a>.
                        </li>
                        <li><a href="http://www.effbot.org/guides/">eff-bot</a> discusses efficiency and performance of <a href="http://www.effbot.org/guides/readline-performance.htm">various ways of reading a file</a>.
                        </li>
                        <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/552">common questions about files</a>.
                        </li>
                        <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/bltin-file-objects.html">all the file object methods</a>.
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.for"></a>6.3.&nbsp;Iterating with <tt class="literal">for</tt> Loops
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Like most other languages, <span class="application">Python</span> has <tt class="literal">for</tt> loops.  The only reason you haven't seen them until now is that <span class="application">Python</span> is good at so many other things that you don't need them as often.
                  </p>
               </div>
               <p>Most other languages don't have a powerful list datatype like <span class="application">Python</span>, so you end up doing a lot of manual work, specifying a start, end, and step to define a range of integers or characters
                  or other iteratable entities.  But in <span class="application">Python</span>, a <tt class="literal">for</tt> loop simply iterates over a list, the same way <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehensions</a> work.
               </p>
               <div class="example"><a name="d0e15255"></a><h3 class="title">Example&nbsp;6.8.&nbsp;Introducing the <tt class="literal">for</tt> Loop
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ['a', 'b', 'e']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for s in li:</span>         <a name="fileinfo.for.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">print s</span>          <a name="fileinfo.for.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">a
b
e</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "\n".join(li)</span>  <a name="fileinfo.for.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">a
b
e</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The syntax for a <tt class="literal">for</tt> loop is similar to <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehensions</a>.  <tt class="varname">li</tt> is a list, and <tt class="varname">s</tt> will take the value of each element in turn, starting from the first element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Like an <tt class="literal">if</tt> statement or any other <a href="#odbchelper.indenting" title="2.5.&nbsp;Indenting Code">indented block</a>, a <tt class="literal">for</tt> loop can have any number of lines of code in it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the reason you haven't seen the <tt class="literal">for</tt> loop yet: you haven't needed it yet.  It's amazing how often you use <tt class="literal">for</tt> loops in other languages when all you really want is a <tt class="function">join</tt> or a list comprehension.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Doing a &#8220;<span class="quote">normal</span>&#8221; (by <span class="application">Visual Basic</span> standards) counter <tt class="literal">for</tt> loop is also simple.
               </p>
               <div class="example"><a name="fileinfo.for.counter"></a><h3 class="title">Example&nbsp;6.9.&nbsp;Simple Counters</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for i in range(5):</span>             <a name="fileinfo.for.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">print i</span>
<span class="computeroutput">0
1
2
3
4</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = ['a', 'b', 'c', 'd', 'e']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for i in range(len(li)):</span>       <a name="fileinfo.for.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">print li[i]</span>
<span class="computeroutput">a
b
c
d
e</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#odbchelper.multiassign.range" title="Example&nbsp;3.20.&nbsp;Assigning Consecutive Values">Example&nbsp;3.20, &#8220;Assigning Consecutive Values&#8221;</a>, <tt class="function">range</tt> produces a list of integers, which you then loop through.  I know it looks a bit odd, but it is occasionally (and I stress
                              <span class="emphasis"><em>occasionally</em></span>) useful to have a counter loop.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Don't ever do this.  This is <span class="application">Visual Basic</span>-style thinking.  Break out of it.  Just iterate through the list, as shown in the previous example.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p><tt class="literal">for</tt> loops are not just for simple counters.  They can iterate through all kinds of things.  Here is an example of using a <tt class="literal">for</tt> loop to iterate through a dictionary.
               </p>
               <div class="example"><a name="dictionaryiter.example"></a><h3 class="title">Example&nbsp;6.10.&nbsp;Iterating Through a Dictionary</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import os</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for k, v in os.environ.items():</span>      <a name="fileinfo.for.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"> <a name="fileinfo.for.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">print "%s=%s" % (k, v)</span>
<span class="computeroutput">USERPROFILE=C:\Documents and Settings\mpilgrim
OS=Windows_NT
COMPUTERNAME=MPILGRIM
USERNAME=mpilgrim

[...snip...]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print "\n".join(["%s=%s" % (k, v)</span>
<tt class="prompt">...     </tt><span class="userinput">for k, v in os.environ.items()])</span> <a name="fileinfo.for.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">USERPROFILE=C:\Documents and Settings\mpilgrim
OS=Windows_NT
COMPUTERNAME=MPILGRIM
USERNAME=mpilgrim

[...snip...]</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">os.environ</tt> is a dictionary of the environment variables defined on your system.  In Windows, these are your user and system variables
                              accessible from <span class="acronym">MS-DOS</span>.  In <span class="acronym">UNIX</span>, they are the variables exported in your shell's startup scripts.  In <span class="abbrev">Mac</span> <span class="acronym">OS</span>, there is no concept of environment variables, so this dictionary is empty.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">os.environ.items()</tt> returns a list of tuples: <tt class="literal">[(<i class="replaceable">key1</i>, <i class="replaceable">value1</i>), (<i class="replaceable">key2</i>, <i class="replaceable">value2</i>), ...]</tt>.  The <tt class="literal">for</tt> loop iterates through this list.  The first round, it assigns <tt class="literal"><i class="replaceable">key1</i></tt> to <tt class="varname">k</tt> and <tt class="literal"><i class="replaceable">value1</i></tt> to <tt class="varname">v</tt>, so <tt class="varname">k</tt> = <tt class="literal">USERPROFILE</tt> and <tt class="varname">v</tt> = <tt class="literal">C:\Documents and Settings\mpilgrim</tt>.  In the second round, <tt class="varname">k</tt> gets the second key, <tt class="literal">OS</tt>, and <tt class="varname">v</tt> gets the corresponding value, <tt class="literal">Windows_NT</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.for.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">With <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">multi-variable assignment</a> and <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehensions</a>, you can replace the entire <tt class="literal">for</tt> loop with a single statement.  Whether you actually do this in real code is a matter of personal coding style.  I like it
                              because it makes it clear that what I'm doing is mapping a dictionary into a list, then joining the list into a single string.
                               Other programmers prefer to write this out as a <tt class="literal">for</tt> loop.  The output is the same in either case, although this version is slightly faster, because there is only one <tt class="function">print</tt> statement instead of many.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now we can look at the <tt class="literal">for</tt> loop in <tt class="classname">MP3FileInfo</tt>, from the sample <tt class="filename">fileinfo.py</tt> program introduced in <a href="#fileinfo">Chapter 5</a>.
               </p>
               <div class="example"><a name="fileinfo.multiassign.for.example"></a><h3 class="title">Example&nbsp;6.11.&nbsp;<tt class="literal">for</tt> Loop in <tt class="classname">MP3FileInfo</tt></h3><pre class="programlisting">
    tagDataMap = {"title"   : (  3,  33, stripnulls),
                  "artist"  : ( 33,  63, stripnulls),
                  "album"   : ( 63,  93, stripnulls),
                  "year"    : ( 93,  97, stripnulls),
                  "comment" : ( 97, 126, stripnulls),
                  "genre"   : (127, 128, ord)}                               <a name="fileinfo.multiassign.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    .
    .
    .
            if tagdata[:3] == "TAG":
                for tag, (start, end, parseFunc) in self.tagDataMap.items(): <a name="fileinfo.multiassign.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
                    self[tag] = parseFunc(tagdata[start:end])                <a name="fileinfo.multiassign.5.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.multiassign.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">tagDataMap</tt> is a <a href="#fileinfo.classattributes" title="5.8.&nbsp;Introducing Class Attributes">class attribute</a> that defines the tags you're looking for in an <span class="abbrev">MP3</span> file.  Tags are stored in fixed-length fields.  Once you read the last 128 bytes of the file, bytes 3 through 32 of those
                              are always the song title, 33 through 62 are always the artist name, 63 through 92 are the album name, and so forth.  Note
                              that <tt class="varname">tagDataMap</tt> is a dictionary of tuples, and each tuple contains two integers and a function reference.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.multiassign.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This looks complicated, but it's not.  The structure of the <tt class="literal">for</tt> variables matches the structure of the elements of the list returned by <tt class="function">items</tt>.  Remember that <tt class="function">items</tt> returns a list of tuples of the form <tt class="literal">(<i class="replaceable">key</i>, <i class="replaceable">value</i>)</tt>.  The first element of that list is <tt class="literal">("title", (3, 33, &lt;function stripnulls&gt;))</tt>, so the first time around the loop, <tt class="varname">tag</tt> gets <tt class="literal">"title"</tt>, <tt class="varname">start</tt> gets <tt class="literal">3</tt>, <tt class="varname">end</tt> gets <tt class="literal">33</tt>, and <tt class="varname">parseFunc</tt> gets the function <tt class="function">stripnulls</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.multiassign.5.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now that you've extracted all the parameters for a single <span class="abbrev">MP3</span> tag, saving the tag data is easy.  You <a href="#odbchelper.list.slice" title="Example&nbsp;3.8.&nbsp;Slicing a List">slice</a> <tt class="varname">tagdata</tt> from <tt class="varname">start</tt> to <tt class="varname">end</tt> to get the actual data for this tag, call <tt class="varname">parseFunc</tt> to post-process the data, and assign this as the value for the key <tt class="varname">tag</tt> in the pseudo-dictionary <tt class="varname">self</tt>.  After iterating through all the elements in <tt class="varname">tagDataMap</tt>, <tt class="varname">self</tt> has the values for all the tags, and <a href="#fileinfo.specialmethods.setname" title="Example&nbsp;5.15.&nbsp;Setting an MP3FileInfo's name">you know what that looks like</a>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.modules"></a>6.4.&nbsp;Using <tt class="literal"><tt class="filename">sys</tt>.modules</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Modules, like everything else in <span class="application">Python</span>, are objects.  Once imported, you can always get a reference to a module through the global dictionary <tt class="literal"><tt class="filename">sys</tt>.modules</tt>.
                  </p>
               </div>
               <div class="example"><a name="d0e15693"></a><h3 class="title">Example&nbsp;6.12.&nbsp;Introducing <tt class="literal"><tt class="filename">sys</tt>.modules</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import sys</span>                          <a name="fileinfo.modules.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print '\n'.join(sys.modules.keys())</span> <a name="fileinfo.modules.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">win32api
os.path
os
exceptions
__main__
ntpath
nt
sys
__builtin__
site
signal
UserDict
stat</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="filename">sys</tt> module contains system-level information, such as the version of <span class="application">Python</span> you're running (<tt class="literal"><tt class="filename">sys</tt>.version</tt> or <tt class="literal"><tt class="filename">sys</tt>.version_info</tt>), and system-level options such as the maximum allowed recursion depth (<tt class="literal"><tt class="filename">sys</tt>.getrecursionlimit()</tt> and <tt class="literal"><tt class="filename">sys</tt>.setrecursionlimit()</tt>).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal"><tt class="filename">sys</tt>.modules</tt> is a dictionary containing all the modules that have ever been imported since <span class="application">Python</span> was started; the key is the module name, the value is the module object.  Note that this is more than just the modules <span class="emphasis"><em>your</em></span> program has imported.  <span class="application">Python</span> preloads some modules on startup, and if you're using a <span class="application">Python</span> <span class="acronym">IDE</span>, <tt class="literal"><tt class="filename">sys</tt>.modules</tt> contains all the modules imported by all the programs you've run within the <span class="acronym">IDE</span>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>This example demonstrates how to use <tt class="literal"><tt class="filename">sys</tt>.modules</tt>.
               </p>
               <div class="example"><a name="d0e15784"></a><h3 class="title">Example&nbsp;6.13.&nbsp;Using <tt class="literal"><tt class="filename">sys</tt>.modules</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import fileinfo</span>         <a name="fileinfo.modules.1.3"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print '\n'.join(sys.modules.keys())</span>
<span class="computeroutput">win32api
os.path
os
fileinfo
exceptions
__main__
ntpath
nt
sys
__builtin__
site
signal
UserDict
stat</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">fileinfo</span>
<span class="computeroutput">&lt;module 'fileinfo' from 'fileinfo.pyc'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys.modules["fileinfo"]</span> <a name="fileinfo.modules.1.4"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;module 'fileinfo' from 'fileinfo.pyc'&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.1.3"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As new modules are imported, they are added to <tt class="literal"><tt class="filename">sys</tt>.modules</tt>.  This explains why importing the same module twice is very fast: <span class="application">Python</span> has already loaded and cached the module in <tt class="literal"><tt class="filename">sys</tt>.modules</tt>, so importing the second time is simply a dictionary lookup.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.1.4"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Given the name (as a string) of any previously-imported module, you can get a reference to the module itself through the <tt class="literal"><tt class="filename">sys</tt>.modules</tt> dictionary.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The next example shows how to use the <tt class="literal">__module__</tt> class attribute with the <tt class="literal"><tt class="filename">sys</tt>.modules</tt> dictionary to get a reference to the module in which a class is defined.
               </p>
               <div class="example"><a name="d0e15859"></a><h3 class="title">Example&nbsp;6.14.&nbsp;The <tt class="literal">__module__</tt> Class Attribute
                  </h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from fileinfo import MP3FileInfo</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">MP3FileInfo.__module__</span>              <a name="fileinfo.modules.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'fileinfo'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys.modules[MP3FileInfo.__module__]</span> <a name="fileinfo.modules.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;module 'fileinfo' from 'fileinfo.pyc'&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Every <span class="application">Python</span> class has a built-in <a href="#fileinfo.classattributes" title="5.8.&nbsp;Introducing Class Attributes">class attribute</a> <tt class="literal">__module__</tt>, which is the name of the module in which the class is defined.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Combining this with the <tt class="literal"><tt class="filename">sys</tt>.modules</tt> dictionary, you can get a reference to the module in which a class is defined.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now you're ready to see how <tt class="literal"><tt class="filename">sys</tt>.modules</tt> is used in <tt class="filename">fileinfo.py</tt>, the sample program introduced in <a href="#fileinfo">Chapter 5</a>.  This example shows that portion of the code.
               </p>
               <div class="example"><a name="d0e15923"></a><h3 class="title">Example&nbsp;6.15.&nbsp;<tt class="literal"><tt class="filename">sys</tt>.modules</tt> in <tt class="filename">fileinfo.py</tt></h3><pre class="programlisting">
    def getFileInfoClass(filename, module=sys.modules[FileInfo.__module__]):       <a name="fileinfo.modules.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        "get file info class from filename extension"                             
        subclass = "%sFileInfo" % os.path.splitext(filename)[1].upper()[1:]        <a name="fileinfo.modules.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        return hasattr(module, subclass) and getattr(module, subclass) or FileInfo <a name="fileinfo.modules.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a function with two arguments; <tt class="varname">filename</tt> is required, but <tt class="varname">module</tt> is <a href="#apihelper.optional" title="4.2.&nbsp;Using Optional and Named Arguments">optional</a> and defaults to the module that contains the <tt class="classname">FileInfo</tt> class.  This looks inefficient, because you might expect <span class="application">Python</span> to evaluate the <tt class="literal"><tt class="filename">sys</tt>.modules</tt> expression every time the function is called.  In fact, <span class="application">Python</span> evaluates default expressions only once, the first time the module is imported.  As you'll see later, you never call this
                              function with a <tt class="varname">module</tt> argument, so <tt class="varname">module</tt> serves as a function-level constant.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You'll plow through this line later, after you dive into the <tt class="filename">os</tt> module.  For now, take it on faith that <tt class="varname">subclass</tt> ends up as the name of a class, like <tt class="classname">MP3FileInfo</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.modules.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You already know about <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr"><tt class="function">getattr</tt></a>, which gets a reference to an object by name.  <tt class="function">hasattr</tt> is a complementary function that checks whether an object has a particular attribute; in this case, whether a module has
                              a particular class (although it works for any object and any attribute, just like <tt class="function">getattr</tt>).  In English, this line of code says, &#8220;<span class="quote">If this module has the class named by <tt class="varname">subclass</tt> then return it, otherwise return the base class <tt class="classname">FileInfo</tt>.</span>&#8221;
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Modules</h3>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses exactly <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006710000000000000000">when and how default arguments are evaluated</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-sys.html"><tt class="filename">sys</tt></a> module.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.os"></a>6.5.&nbsp;Working with Directories
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <tt class="filename">os.path</tt> module has several functions for manipulating files and directories.  Here, we're looking at handling pathnames and listing
                     the contents of a directory.
                  </p>
               </div>
               <div class="example"><a name="fileinfo.os.path.join.example"></a><h3 class="title">Example&nbsp;6.16.&nbsp;Constructing Pathnames</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import os</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.join("c:\\music\\ap\\", "mahadeva.mp3")</span> <a name="fileinfo.os.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"> <a name="fileinfo.os.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'c:\\music\\ap\\mahadeva.mp3'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.join("c:\\music\\ap", "mahadeva.mp3")</span>   <a name="fileinfo.os.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'c:\\music\\ap\\mahadeva.mp3'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.expanduser("~")</span>                         <a name="fileinfo.os.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'c:\\Documents and Settings\\mpilgrim\\My Documents'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.join(os.path.expanduser("~"), "Python")</span> <a name="fileinfo.os.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">'c:\\Documents and Settings\\mpilgrim\\My Documents\\Python'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">os.path</tt> is a reference to a module -- which module depends on your platform.  Just as <a href="#crossplatform.example" title="Example&nbsp;6.2.&nbsp;Supporting Platform-Specific Functionality"><tt class="filename">getpass</tt></a> encapsulates differences between platforms by setting <tt class="varname">getpass</tt> to a platform-specific function, <tt class="filename">os</tt> encapsulates differences between platforms by setting <tt class="varname">path</tt> to a platform-specific module.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">join</tt> function of <tt class="filename">os.path</tt> constructs a pathname out of one or more partial pathnames.  In this case, it simply concatenates strings.  (Note that dealing
                              with pathnames on Windows is annoying because the backslash character must be escaped.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In this slightly less trivial case, <tt class="function">join</tt> will add an extra backslash to the pathname before joining it to the filename.  I was overjoyed when I discovered this, since
                              <tt class="function">addSlashIfNecessary</tt> is one of the stupid little functions I always need to write when building up my toolbox in a new language.  <span class="emphasis"><em>Do not</em></span> write this stupid little function in <span class="application">Python</span>; smart people have already taken care of it for you.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">expanduser</tt> will expand a pathname that uses <tt class="literal">~</tt> to represent the current user's home directory.  This works on any platform where users have a home directory, like Windows,
                              <span class="acronym">UNIX</span>, and <span class="abbrev">Mac</span> <span class="acronym">OS</span> X; it has no effect on <span class="abbrev">Mac</span> <span class="acronym">OS</span>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Combining these techniques, you can easily construct pathnames for directories and files under the user's home directory.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="splittingpathnames.example"></a><h3 class="title">Example&nbsp;6.17.&nbsp;Splitting Pathnames</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.split("c:\\music\\ap\\mahadeva.mp3")</span>                        <a name="fileinfo.os.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">('c:\\music\\ap', 'mahadeva.mp3')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">(filepath, filename) = os.path.split("c:\\music\\ap\\mahadeva.mp3")</span> <a name="fileinfo.os.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filepath</span>                                                            <a name="fileinfo.os.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'c:\\music\\ap'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filename</span>                                                            <a name="fileinfo.os.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'mahadeva.mp3'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">(shortname, extension) = os.path.splitext(filename)</span>                 <a name="fileinfo.os.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">shortname</span>
<span class="computeroutput">'mahadeva'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">extension</span>
<span class="computeroutput">'.mp3'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">split</tt> function splits a full pathname and returns a tuple containing the path and filename.  Remember when I said you could use
                              <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">multi-variable assignment</a> to return multiple values from a function?  Well, <tt class="function">split</tt> is such a function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You assign the return value of the <tt class="function">split</tt> function into a tuple of two variables.  Each variable receives the value of the corresponding element of the returned tuple.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first variable, <tt class="varname">filepath</tt>, receives the value of the first element of the tuple returned from <tt class="function">split</tt>, the file path.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The second variable, <tt class="varname">filename</tt>, receives the value of the second element of the tuple returned from <tt class="function">split</tt>, the filename.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">os.path</tt> also contains a function <tt class="function">splitext</tt>, which splits a filename and returns a tuple containing the filename and the file extension.   You use the same technique
                              to assign each of them to separate variables.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="fileinfo.listdir.example"></a><h3 class="title">Example&nbsp;6.18.&nbsp;Listing Directories</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.listdir("c:\\music\\_singles\\")</span>              <a name="fileinfo.os.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['a_time_long_forgotten_con.mp3', 'hellraiser.mp3',
'kairo.mp3', 'long_way_home1.mp3', 'sidewinder.mp3', 
'spinning.mp3']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">dirname = "c:\\"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.listdir(dirname)</span>                              <a name="fileinfo.os.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['AUTOEXEC.BAT', 'boot.ini', 'CONFIG.SYS', 'cygwin',
'docbook', 'Documents and Settings', 'Incoming', 'Inetpub', 'IO.SYS',
'MSDOS.SYS', 'Music', 'NTDETECT.COM', 'ntldr', 'pagefile.sys',
'Program Files', 'Python20', 'RECYCLER',
'System Volume Information', 'TEMP', 'WINNT']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[f for f in os.listdir(dirname)</span>
<tt class="prompt">...     </tt><span class="userinput">if os.path.isfile(os.path.join(dirname, f))]</span> <a name="fileinfo.os.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['AUTOEXEC.BAT', 'boot.ini', 'CONFIG.SYS', 'IO.SYS', 'MSDOS.SYS',
'NTDETECT.COM', 'ntldr', 'pagefile.sys']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[f for f in os.listdir(dirname)</span>
<tt class="prompt">...     </tt><span class="userinput">if os.path.isdir(os.path.join(dirname, f))]</span>  <a name="fileinfo.os.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">['cygwin', 'docbook', 'Documents and Settings', 'Incoming',
'Inetpub', 'Music', 'Program Files', 'Python20', 'RECYCLER',
'System Volume Information', 'TEMP', 'WINNT']</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">listdir</tt> function takes a pathname and returns a list of the contents of the directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">listdir</tt> returns both files and folders, with no indication of which is which.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can use <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">list filtering</a> and the <tt class="function">isfile</tt> function of the <tt class="filename">os.path</tt> module to separate the files from the folders.  <tt class="function">isfile</tt> takes a pathname and returns 1 if the path represents a file, and 0 otherwise.  Here you're using <tt class="literal"><tt class="filename">os.path</tt>.<tt class="function">join</tt></tt> to ensure a full pathname, but <tt class="function">isfile</tt> also works with a partial path, relative to the current working directory.  You can use <tt class="literal">os.getcwd()</tt> to get the current working directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">os.path</tt> also has a <tt class="function">isdir</tt> function which returns 1 if the path represents a directory, and 0 otherwise.  You can use this to get a list of the subdirectories
                              within a directory.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e16376"></a><h3 class="title">Example&nbsp;6.19.&nbsp;Listing Directories in <tt class="filename">fileinfo.py</tt></h3><pre class="programlisting">
def listDirectory(directory, fileExtList):                                        
    "get list of file info objects for files of particular extensions" 
    fileList = [os.path.normcase(f)
                for f in os.listdir(directory)]            <a name="fileinfo.os.3a.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"> <a name="fileinfo.os.3a.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    fileList = [os.path.join(directory, f) 
               for f in fileList
                if os.path.splitext(f)[1] in fileExtList]  <a name="fileinfo.os.3a.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"> <a name="fileinfo.os.3a.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"> <a name="fileinfo.os.3a.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3a.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">os.listdir(directory)</tt> returns a list of all the files and folders in <tt class="varname">directory</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3a.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Iterating through the list with <tt class="varname">f</tt>, you use <tt class="literal">os.path.normcase(f)</tt> to normalize the case according to operating system defaults.  <tt class="function">normcase</tt> is a useful little function that compensates for case-insensitive operating systems that think that <tt class="filename">mahadeva.mp3</tt> and <tt class="filename">mahadeva.MP3</tt> are the same file.  For instance, on Windows and <span class="abbrev">Mac</span> <span class="acronym">OS</span>, <tt class="function">normcase</tt> will convert the entire filename to lowercase; on <span class="acronym">UNIX</span>-compatible systems, it will return the filename unchanged.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3a.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Iterating through the normalized list with <tt class="varname">f</tt> again, you use <tt class="literal">os.path.splitext(f)</tt> to split each filename into name and extension.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3a.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">For each file, you see if the extension is in the list of file extensions you care about (<tt class="varname">fileExtList</tt>, which was passed to the <tt class="function">listDirectory</tt> function).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.3a.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">For each file you care about, you use <tt class="literal">os.path.join(directory, f)</tt> to construct the full pathname of the file, and return a list of the full pathnames.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="tip.os"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Whenever possible, you should use the functions in <tt class="filename">os</tt> and <tt class="filename">os.path</tt> for file, directory, and path manipulations.  These modules are wrappers for platform-specific modules, so functions like
                        <tt class="function">os.path.split</tt> work on <span class="acronym">UNIX</span>, Windows, <span class="abbrev">Mac</span> <span class="acronym">OS</span>, and any other platform supported by <span class="application">Python</span>.
                     </td>
                  </tr>
               </table>
               <p>There is one other way to get the contents of a directory.  It's very powerful, and it uses the sort of wildcards that you
                  may already be familiar with from working on the command line.
               </p>
               <div class="example"><a name="fileinfo.os.glob.example"></a><h3 class="title">Example&nbsp;6.20.&nbsp;Listing Directories with <tt class="filename">glob</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.listdir("c:\\music\\_singles\\")</span>               <a name="fileinfo.os.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['a_time_long_forgotten_con.mp3', 'hellraiser.mp3',
'kairo.mp3', 'long_way_home1.mp3', 'sidewinder.mp3',
'spinning.mp3']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import glob</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">glob.glob('c:\\music\\_singles\\*.mp3')</span>           <a name="fileinfo.os.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">['c:\\music\\_singles\\a_time_long_forgotten_con.mp3',
'c:\\music\\_singles\\hellraiser.mp3',
'c:\\music\\_singles\\kairo.mp3',
'c:\\music\\_singles\\long_way_home1.mp3',
'c:\\music\\_singles\\sidewinder.mp3',
'c:\\music\\_singles\\spinning.mp3']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">glob.glob('c:\\music\\_singles\\s*.mp3')</span>          <a name="fileinfo.os.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['c:\\music\\_singles\\sidewinder.mp3',
'c:\\music\\_singles\\spinning.mp3']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">glob.glob('c:\\music\\*\\*.mp3')</span>                  <a name="fileinfo.os.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw earlier, <tt class="function">os.listdir</tt> simply takes a directory path and lists all files and directories in that directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="filename">glob</tt> module, on the other hand, takes a wildcard and returns the full path of all files and directories matching the wildcard.
                               Here the wildcard is a directory path plus "*.mp3", which will match all <tt class="filename">.mp3</tt> files.  Note that each element of the returned list already includes the full path of the file.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If you want to find all the files in a specific directory that start with "s" and end with ".mp3", you can do that too.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.os.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now consider this scenario: you have a <tt class="filename">music</tt> directory, with several subdirectories within it, with <tt class="filename">.mp3</tt> files within each subdirectory.  You can get a list of all of those with a single call to <tt class="filename">glob</tt>, by using two wildcards at once.  One wildcard is the <tt class="literal">"*.mp3"</tt> (to match <tt class="filename">.mp3</tt> files), and one wildcard is <span class="emphasis"><em>within the directory path itself</em></span>, to match any subdirectory within <tt class="filename">c:\music</tt>.  That's a crazy amount of power packed into one deceptively simple-looking function!
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on the <tt class="filename">os</tt> Module
                  </h3>
                  <ul>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/240">questions about the <tt class="filename">os</tt> module</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-os.html"><tt class="filename">os</tt></a> module and the <a href="http://www.python.org/doc/current/lib/module-os.path.html"><tt class="filename">os.path</tt></a> module.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.alltogether"></a>6.6.&nbsp;Putting It All Together
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Once again, all the dominoes are in place.  You've seen how each line of code works.  Now let's step back and see how it all
                     fits together.
                  </p>
               </div>
               <div class="example"><a name="fileinfo.nested"></a><h3 class="title">Example&nbsp;6.21.&nbsp;<tt class="function">listDirectory</tt></h3><pre class="programlisting">
def listDirectory(directory, fileExtList):                                         <a name="fileinfo.alltogether.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    "get list of file info objects for files of particular extensions"
    fileList = [os.path.normcase(f)
                for f in os.listdir(directory)]           
    fileList = [os.path.join(directory, f) 
               for f in fileList
                if os.path.splitext(f)[1] in fileExtList]                          <a name="fileinfo.alltogether.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    def getFileInfoClass(filename, module=sys.modules[FileInfo.__module__]):       <a name="fileinfo.alltogether.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        "get file info class from filename extension"                             
        subclass = "%sFileInfo" % os.path.splitext(filename)[1].upper()[1:]        <a name="fileinfo.alltogether.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        return hasattr(module, subclass) and getattr(module, subclass) or FileInfo <a name="fileinfo.alltogether.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
    return [getFileInfoClass(f)(f) for f in fileList]                              <a name="fileinfo.alltogether.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.alltogether.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">listDirectory</tt> is the main attraction of this entire module.  It takes a directory (like <tt class="filename">c:\music\_singles\</tt> in my case) and a list of interesting file extensions (like <tt class="literal">['.mp3']</tt>), and it returns a list of class instances that act like dictionaries that contain metadata about each interesting file in
                              that directory.  And it does it in just a few straightforward lines of code.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.alltogether.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in the <a href="#fileinfo.os" title="6.5.&nbsp;Working with Directories">previous section</a>, this line of code gets a list of the full pathnames of all the files in <tt class="varname">directory</tt> that have an interesting file extension (as specified by <tt class="varname">fileExtList</tt>).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.alltogether.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Old-school <span class="application">Pascal</span> programmers may be familiar with them, but most people give me a blank stare when I tell them that <span class="application">Python</span> supports <span class="emphasis"><em>nested functions</em></span> -- literally, a function within a function.  The nested function <tt class="function">getFileInfoClass</tt> can be called only from the function in which it is defined, <tt class="function">listDirectory</tt>.  As with any other function, you don't need an interface declaration or anything fancy; just define the function and code
                              it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.alltogether.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now that you've seen the <a href="#fileinfo.os" title="6.5.&nbsp;Working with Directories"><tt class="filename">os</tt></a> module, this line should make more sense.  It gets the extension of the file (<tt class="literal">os.path.splitext(filename)[1]</tt>), forces it to uppercase (<tt class="literal">.upper()</tt>), slices off the dot (<tt class="literal">[1:]</tt>), and constructs a class name out of it with string formatting.  So <tt class="filename">c:\music\ap\mahadeva.mp3</tt> becomes <tt class="literal">.mp3</tt> becomes <tt class="literal">.MP3</tt> becomes <tt class="literal">MP3</tt> becomes <tt class="literal">MP3FileInfo</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.alltogether.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Having constructed the name of the handler class that would handle this file, you check to see if that handler class actually
                              exists in this module.  If it does, you return the class, otherwise you return the base class <tt class="classname">FileInfo</tt>.  This is a very important point: <span class="emphasis"><em>this function returns a class</em></span>.  Not an instance of a class, but the class itself.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#fileinfo.alltogether.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">For each file in the &#8220;<span class="quote">interesting files</span>&#8221; list (<tt class="varname">fileList</tt>), you call <tt class="function">getFileInfoClass</tt> with the filename (<tt class="varname">f</tt>).  Calling <tt class="literal">getFileInfoClass(f)</tt> returns a class; you don't know exactly which class, but you don't care.  You then create an instance of this class (whatever
                              it is) and pass the filename (<tt class="varname">f</tt> again), to the <tt class="function">__init__</tt> method.  As you saw <a href="#fileinfo.specialmethods.setname" title="Example&nbsp;5.15.&nbsp;Setting an MP3FileInfo's name">earlier in this chapter</a>, the <tt class="function">__init__</tt> method of <tt class="classname">FileInfo</tt> sets <tt class="literal">self["name"]</tt>, which triggers <tt class="function">__setitem__</tt>, which is overridden in the descendant (<tt class="classname">MP3FileInfo</tt>) to parse the file appropriately to pull out the file's metadata.  You do all that for each interesting file and return a
                              list of the resulting instances.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Note that <tt class="function">listDirectory</tt> is completely generic.  It doesn't know ahead of time which types of files it will be getting, or which classes are defined
                  that could potentially handle those files.  It inspects the directory for the files to process, and then introspects its own
                  module to see what special handler classes (like <tt class="classname">MP3FileInfo</tt>) are defined.  You can extend this program to handle other types of files simply by defining an appropriately-named class:
                  <tt class="classname">HTMLFileInfo</tt> for <span class="acronym">HTML</span> files, <tt class="classname">DOCFileInfo</tt> for <span class="application">Word</span> <tt class="literal">.doc</tt> files, and so forth.  <tt class="function">listDirectory</tt> will handle them all, without modification, by handing off the real work to the appropriate classes and collating the results.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="fileinfo.summary2"></a>6.7.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <tt class="filename">fileinfo.py</tt> program introduced in <a href="#fileinfo">Chapter 5</a> should now make perfect sense.
                  </p>
               </div>
               <div class="informalexample"><pre class="programlisting">
"""Framework for getting filetype-specific metadata.

Instantiate appropriate class with filename.  Returned object acts like a
dictionary, with key-value pairs for each piece of metadata.
    import fileinfo
    info = fileinfo.MP3FileInfo("/music/ap/mahadeva.mp3")
    print "\\n".join(["%s=%s" % (k, v) for k, v in info.items()])

Or use listDirectory function to get info on all files in a directory.
    for info in fileinfo.listDirectory("/music/ap/", [".mp3"]):
        ...

Framework can be extended by adding classes for particular file types, e.g.
HTMLFileInfo, MPGFileInfo, DOCFileInfo.  Each class is completely responsible for
parsing its files appropriately; see MP3FileInfo for example.
"""
import os
import sys
from UserDict import UserDict

def stripnulls(data):
    "strip whitespace and nulls"
    return data.replace("\00", "").strip()

class FileInfo(UserDict):
    "store file metadata"
    def __init__(self, filename=None):
        UserDict.__init__(self)
        self["name"] = filename

class MP3FileInfo(FileInfo):
    "store ID3v1.0 MP3 tags"
    tagDataMap = {"title"   : (  3,  33, stripnulls),
                  "artist"  : ( 33,  63, stripnulls),
                  "album"   : ( 63,  93, stripnulls),
                  "year"    : ( 93,  97, stripnulls),
                  "comment" : ( 97, 126, stripnulls),
                  "genre"   : (127, 128, ord)}

    def __parse(self, filename):
        "parse ID3v1.0 tags from MP3 file"
        self.clear()
        try:                               
            fsock = open(filename, "rb", 0)
            try:                           
                fsock.seek(-128, 2)        
                tagdata = fsock.read(128)  
            finally:                       
                fsock.close()              
            if tagdata[:3] == "TAG":
                for tag, (start, end, parseFunc) in self.tagDataMap.items():
                    self[tag] = parseFunc(tagdata[start:end])               
        except IOError:                    
            pass                           

    def __setitem__(self, key, item):
        if key == "name" and item:
            self.__parse(item)
        FileInfo.__setitem__(self, key, item)

def listDirectory(directory, fileExtList):                                        
    "get list of file info objects for files of particular extensions"
    fileList = [os.path.normcase(f)
                for f in os.listdir(directory)]           
    fileList = [os.path.join(directory, f) 
               for f in fileList
                if os.path.splitext(f)[1] in fileExtList] 
    def getFileInfoClass(filename, module=sys.modules[FileInfo.__module__]):      
        "get file info class from filename extension"                             
        subclass = "%sFileInfo" % os.path.splitext(filename)[1].upper()[1:]       
        return hasattr(module, subclass) and getattr(module, subclass) or FileInfo
    return [getFileInfoClass(f)(f) for f in fileList]                             

if __name__ == "__main__":
    for info in listDirectory("/music/_singles/", [".mp3"]):
        print "\n".join(["%s=%s" % (k, v) for k, v in info.items()])
        print</pre></div>
               <div class="highlights">
                  <p>Before diving into the next chapter, make sure you're comfortable doing the following things:</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>Catching exceptions with <a href="#fileinfo.exception" title="6.1.&nbsp;Handling Exceptions"><tt class="literal">try...except</tt></a></li>
                        <li>Protecting external resources with <a href="#fileinfo.files.incode" title="Example&nbsp;6.6.&nbsp;File Objects in MP3FileInfo"><tt class="literal">try...finally</tt></a></li>
                        <li>Reading from <a href="#fileinfo.files" title="6.2.&nbsp;Working with File Objects">files</a></li>
                        <li>Assigning multiple values at once in a <a href="#fileinfo.multiassign.for.example" title="Example&nbsp;6.11.&nbsp;for Loop in MP3FileInfo"><tt class="literal">for</tt> loop</a></li>
                        <li>Using the <a href="#fileinfo.os" title="6.5.&nbsp;Working with Directories"><tt class="filename">os</tt></a> module for all your cross-platform file manipulation needs
                        </li>
                        <li>Dynamically <a href="#fileinfo.alltogether" title="6.6.&nbsp;Putting It All Together">instantiating classes of unknown type</a> by treating classes as objects and passing them around
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="re"></a>Chapter&nbsp;7.&nbsp;Regular Expressions
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p>Regular expressions are a powerful and standardized way of searching, replacing, and parsing text with complex patterns of
                  characters.  If you've used regular expressions in other languages (like <span class="application">Perl</span>), the syntax will be very familiar, and you get by just reading the summary of the <a href="http://www.python.org/doc/current/lib/module-re.html"><tt class="filename">re</tt> module</a> to get an overview of the available functions and their arguments.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="re.intro"></a>7.1.&nbsp;Diving In
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>Strings have methods for searching (<tt class="function">index</tt>, <tt class="function">find</tt>, and <tt class="function">count</tt>), replacing (<tt class="function">replace</tt>), and parsing (<tt class="function">split</tt>), but they are limited to the simplest of cases.  The search methods look for a single, hard-coded substring, and they are
                  always case-sensitive.  To do case-insensitive searches of a string <tt class="varname">s</tt>, you must call <tt class="function">s.lower()</tt> or <tt class="function">s.upper()</tt> and make sure your search strings are the appropriate case to match.  The <tt class="function">replace</tt> and <tt class="function">split</tt> methods have the same limitations.
               </p>
               <div class="abstract">
                  <p>If what you're trying to do can be accomplished with string functions, you should use them.  They're fast and simple and easy
                     to read, and there's a lot to be said for fast, simple, readable code.  But if you find yourself using a lot of different
                     string functions with <tt class="literal">if</tt> statements to handle special cases, or if you're combining them with <tt class="function">split</tt> and <tt class="function">join</tt> and list comprehensions in weird unreadable ways, you may need to move up to regular expressions.
                  </p>
               </div>
               <p>Although the regular expression syntax is tight and unlike normal code, the result can end up being <span class="emphasis"><em>more</em></span> readable than a hand-rolled solution that uses a long chain of string functions.  There are even ways of embedding comments
                  within regular expressions to make them practically self-documenting.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="re.matching"></a>7.2.&nbsp;Case Study: Street Addresses
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>This series of examples was inspired by a real-life problem I had in my day job several years ago, when I needed to scrub
                     and standardize street addresses exported from a legacy system before importing them into a newer system.  (See, I don't just
                     make this stuff up; it's actually useful.)  This example shows how I approached the problem.
                  </p>
               </div>
               <div class="example"><a name="d0e16923"></a><h3 class="title">Example&nbsp;7.1.&nbsp;Matching at the End of a String</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = '100 NORTH MAIN ROAD'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s.replace('ROAD', 'RD.')</span>               <a name="re.matching.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'100 NORTH MAIN RD.'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = '100 NORTH BROAD ROAD'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s.replace('ROAD', 'RD.')</span>               <a name="re.matching.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'100 NORTH BRD. RD.'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s[:-4] + s[-4:].replace('ROAD', 'RD.')</span> <a name="re.matching.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'100 NORTH BROAD RD.'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import re</span>                              <a name="re.matching.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('ROAD$', 'RD.', s)</span>              <a name="re.matching.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"> <a name="re.matching.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
<span class="computeroutput">'100 NORTH BROAD RD.'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">My goal is to standardize a street address so that <tt class="literal">'ROAD'</tt> is always abbreviated as <tt class="literal">'RD.'</tt>.  At first glance, I thought this was simple enough that I could just use the string method <tt class="function">replace</tt>.  After all, all the data was already uppercase, so case mismatches would not be a problem.  And the search string, <tt class="literal">'ROAD'</tt>, was a constant.  And in this deceptively simple example, <tt class="function">s.replace</tt> does indeed work.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Life, unfortunately, is full of counterexamples, and I quickly discovered this one.  The problem here is that <tt class="literal">'ROAD'</tt> appears twice in the address, once as part of the street name <tt class="literal">'BROAD'</tt> and once as its own word.  The <tt class="function">replace</tt> method sees these two occurrences and blindly replaces both of them; meanwhile, I see my addresses getting destroyed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To solve the problem of addresses with more than one <tt class="literal">'ROAD'</tt> substring, you could resort to something like this: only search and replace <tt class="literal">'ROAD'</tt> in the last four characters of the address (<tt class="literal">s[-4:]</tt>), and leave the string alone (<tt class="literal">s[:-4]</tt>).  But you can see that this is already getting unwieldy.  For example, the pattern is dependent on the length of the string
                              you're replacing (if you were replacing <tt class="literal">'STREET'</tt> with <tt class="literal">'ST.'</tt>, you would need to use <tt class="literal">s[:-6]</tt> and <tt class="literal">s[-6:].replace(...)</tt>).  Would you like to come back in six months and debug this?  I know I wouldn't.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">It's time to move up to regular expressions.  In <span class="application">Python</span>, all functionality related to regular expressions is contained in the <tt class="filename">re</tt> module.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Take a look at the first parameter: <tt class="literal">'ROAD$'</tt>.  This is a simple regular expression that matches <tt class="literal">'ROAD'</tt> only when it occurs at the end of a string.  The <tt class="literal">$</tt> means &#8220;<span class="quote">end of the string</span>&#8221;.  (There is a corresponding character, the caret <tt class="literal">^</tt>, which means &#8220;<span class="quote">beginning of the string</span>&#8221;.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using the <tt class="function">re.sub</tt> function, you search the string <tt class="varname">s</tt> for the regular expression <tt class="literal">'ROAD$'</tt> and replace it with <tt class="literal">'RD.'</tt>.  This matches the <tt class="literal">ROAD</tt> at the end of the string <tt class="varname">s</tt>, but does <span class="emphasis"><em>not</em></span> match the <tt class="literal">ROAD</tt> that's part of the word <tt class="literal">BROAD</tt>, because that's in the middle of <tt class="varname">s</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Continuing with my story of scrubbing addresses, I soon discovered that the previous example, matching <tt class="literal">'ROAD'</tt> at the end of the address, was not good enough, because not all addresses included a street designation at all; some just
                  ended with the street name.  Most of the time, I got away with it, but if the street name was <tt class="literal">'BROAD'</tt>, then the regular expression would match <tt class="literal">'ROAD'</tt> at the end of the string as part of the word <tt class="literal">'BROAD'</tt>, which is not what I wanted.
               </p>
               <div class="example"><a name="d0e17121"></a><h3 class="title">Example&nbsp;7.2.&nbsp;Matching Whole Words</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = '100 BROAD'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('ROAD$', 'RD.', s)</span>
<span class="computeroutput">'100 BRD.'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('\\bROAD$', 'RD.', s)</span>  <a name="re.matching.2.2"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'100 BROAD'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub(r'\bROAD$', 'RD.', s)</span>  <a name="re.matching.2.3"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'100 BROAD'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = '100 BROAD ROAD APT. 3'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub(r'\bROAD$', 'RD.', s)</span>  <a name="re.matching.2.4"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'100 BROAD ROAD APT. 3'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub(r'\bROAD\b', 'RD.', s)</span> <a name="re.matching.2.5"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'100 BROAD RD. APT 3'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.2.2"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">What I <span class="emphasis"><em>really</em></span> wanted was to match <tt class="literal">'ROAD'</tt> when it was at the end of the string <span class="emphasis"><em>and</em></span> it was its own whole word, not a part of some larger word.  To express this in a regular expression, you use <tt class="literal">\b</tt>, which means &#8220;<span class="quote">a word boundary must occur right here</span>&#8221;.  In <span class="application">Python</span>, this is complicated by the fact that the <tt class="literal">'\'</tt> character in a string must itself be escaped.  This is sometimes referred to as the backslash plague, and it is one reason
                              why regular expressions are easier in <span class="application">Perl</span> than in <span class="application">Python</span>.  On the down side, <span class="application">Perl</span> mixes regular expressions with other syntax, so if you have a bug, it may be hard to tell whether it's a bug in syntax or
                              a bug in your regular expression.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.2.3"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To work around the backslash plague, you can use what is called a raw string, by prefixing the string with the letter <tt class="literal">r</tt>.  This tells <span class="application">Python</span> that nothing in this string should be escaped; <tt class="literal">'\t'</tt> is a tab character, but <tt class="literal">r'\t'</tt> is really the backslash character <tt class="literal">\</tt> followed by the letter <tt class="literal">t</tt>.  I recommend always using raw strings when dealing with regular expressions; otherwise, things get too confusing too quickly
                              (and regular expressions get confusing quickly enough all by themselves).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.2.4"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><span class="emphasis"><em>*sigh*</em></span>  Unfortunately, I soon found more cases that contradicted my logic.  In this case, the street address contained the word
                              <tt class="literal">'ROAD'</tt> as a whole word by itself, but it wasn't at the end, because the address had an apartment number after the street designation.
                               Because <tt class="literal">'ROAD'</tt> isn't at the very end of the string, it doesn't match, so the entire call to <tt class="function">re.sub</tt> ends up replacing nothing at all, and you get the original string back, which is not what you want.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.matching.2.5"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To solve this problem, I removed the <tt class="literal">$</tt> character and added another <tt class="literal">\b</tt>.  Now the regular expression reads &#8220;<span class="quote">match <tt class="literal">'ROAD'</tt> when it's a whole word by itself anywhere in the string,</span>&#8221; whether at the end, the beginning, or somewhere in the middle.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="re.roman"></a>7.3.&nbsp;Case Study: Roman Numerals
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You've most likely seen Roman numerals, even if you didn't recognize them.  You may have seen them in copyrights of old movies
                     and television shows (&#8220;<span class="quote">Copyright <tt class="literal">MCMXLVI</tt></span>&#8221; instead of &#8220;<span class="quote">Copyright <tt class="literal">1946</tt></span>&#8221;), or on the dedication walls of libraries or universities (&#8220;<span class="quote">established <tt class="literal">MDCCCLXXXVIII</tt></span>&#8221; instead of &#8220;<span class="quote">established <tt class="literal">1888</tt></span>&#8221;).  You may also have seen them in outlines and bibliographical references.  It's a system of representing numbers that really
                     does date back to the ancient Roman empire (hence the name).
                  </p>
               </div>
               <p>In Roman numerals, there are seven characters that are repeated and combined in various ways to represent numbers.</p>
               <div class="itemizedlist">
                  <ul>
                     <li><tt class="literal">I</tt> = <tt class="literal">1</tt></li>
                     <li><tt class="literal">V</tt> = <tt class="literal">5</tt></li>
                     <li><tt class="literal">X</tt> = <tt class="literal">10</tt></li>
                     <li><tt class="literal">L</tt> = <tt class="literal">50</tt></li>
                     <li><tt class="literal">C</tt> = <tt class="literal">100</tt></li>
                     <li><tt class="literal">D</tt> = <tt class="literal">500</tt></li>
                     <li><tt class="literal">M</tt> = <tt class="literal">1000</tt></li>
                  </ul>
               </div>
               <p>The following are some general rules for constructing Roman numerals:</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Characters are additive.  <tt class="literal">I</tt> is <tt class="constant">1</tt>, <tt class="literal">II</tt> is <tt class="literal">2</tt>, and <tt class="literal">III</tt> is <tt class="literal">3</tt>.  <tt class="literal">VI</tt> is <tt class="literal">6</tt> (literally, &#8220;<span class="quote"><tt class="literal">5</tt> and <tt class="literal">1</tt></span>&#8221;), <tt class="literal">VII</tt> is <tt class="literal">7</tt>, and <tt class="literal">VIII</tt> is <tt class="literal">8</tt>.
                     </li>
                     <li>The tens characters (<tt class="literal">I</tt>, <tt class="literal">X</tt>, <tt class="literal">C</tt>, and <tt class="literal">M</tt>) can be repeated up to three times.  At <tt class="literal">4</tt>, you need to subtract from the next highest fives character.  You can't represent <tt class="literal">4</tt> as <tt class="literal">IIII</tt>; instead, it is represented as <tt class="literal">IV</tt> (&#8220;<span class="quote"><tt class="literal">1</tt> less than <tt class="literal">5</tt></span>&#8221;).  The number <tt class="literal">40</tt> is written as <tt class="literal">XL</tt> (<tt class="literal">10</tt> less than <tt class="literal">50</tt>), <tt class="literal">41</tt> as <tt class="literal">XLI</tt>, <tt class="literal">42</tt> as <tt class="literal">XLII</tt>, <tt class="literal">43</tt> as <tt class="literal">XLIII</tt>, and then <tt class="literal">44</tt> as <tt class="literal">XLIV</tt> (<tt class="literal">10</tt> less than <tt class="literal">50</tt>, then <tt class="literal">1</tt> less than <tt class="literal">5</tt>).
                     </li>
                     <li>Similarly, at <tt class="literal">9</tt>, you need to subtract from the next highest tens character: <tt class="literal">8</tt> is <tt class="literal">VIII</tt>, but <tt class="literal">9</tt> is <tt class="literal">IX</tt> (<tt class="literal">1</tt> less than <tt class="literal">10</tt>), not <tt class="literal">VIIII</tt> (since the <tt class="literal">I</tt> character can not be repeated four times).  The number <tt class="literal">90</tt> is <tt class="literal">XC</tt>, <tt class="literal">900</tt> is <tt class="literal">CM</tt>.
                     </li>
                     <li>The fives characters can not be repeated.  The number <tt class="literal">10</tt> is always represented as <tt class="literal">X</tt>, never as <tt class="literal">VV</tt>.  The number <tt class="literal">100</tt> is always <tt class="literal">C</tt>, never <tt class="literal">LL</tt>.
                     </li>
                     <li>Roman numerals are always written highest to lowest, and read left to right, so the order the of characters matters very much.
                         <tt class="literal">DC</tt> is <tt class="literal">600</tt>; <tt class="literal">CD</tt> is a completely different number (<tt class="literal">400</tt>, <tt class="literal">100</tt> less than <tt class="literal">500</tt>).  <tt class="literal">CI</tt> is <tt class="literal">101</tt>; <tt class="literal">IC</tt> is not even a valid Roman numeral (because you can't subtract <tt class="literal">1</tt> directly from <tt class="literal">100</tt>; you would need to write it as <tt class="literal">XCIX</tt>, for <tt class="literal">10</tt> less than <tt class="literal">100</tt>, then <tt class="literal">1</tt> less than <tt class="literal">10</tt>).
                     </li>
                  </ul>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e17592"></a>7.3.1.&nbsp;Checking for Thousands
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>What would it take to validate that an arbitrary string is a valid Roman numeral?  Let's take it one digit at a time.  Since
                     Roman numerals are always written highest to lowest, let's start with the highest: the thousands place.  For numbers 1000
                     and higher, the thousands are represented by a series of <tt class="literal">M</tt> characters.
                  </p>
                  <div class="example"><a name="d0e17600"></a><h3 class="title">Example&nbsp;7.3.&nbsp;Checking for Thousands</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import re</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?$'</span>       <a name="re.roman.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'M')</span>    <a name="re.roman.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 0106FB58&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MM')</span>   <a name="re.roman.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 0106C290&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMM')</span>  <a name="re.roman.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 0106AA38&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMMM')</span> <a name="re.roman.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, '')</span>     <a name="re.roman.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 0106F4A8&gt;</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This pattern has three parts:
                                 <div class="itemizedlist">
                                    <ul>
                                       <li><tt class="literal">^</tt> to match what follows only at the beginning of the string.  If this were not specified, the pattern would match no matter
                                          where the <tt class="literal">M</tt> characters were, which is not what you want.  You want to make sure that the <tt class="literal">M</tt> characters, if they're there, are at the beginning of the string.
                                       </li>
                                       <li><tt class="literal">M?</tt> to optionally match a single <tt class="literal">M</tt> character.  Since this is repeated three times, you're matching anywhere from zero to three <tt class="literal">M</tt> characters in a row.
                                       </li>
                                       <li><tt class="literal">$</tt> to match what precedes only at the end of the string.  When combined with the <tt class="literal">^</tt> character at the beginning, this means that the pattern must match the entire string, with no other characters before or
                                          after the <tt class="literal">M</tt> characters.
                                       </li>
                                    </ul>
                                 </div>
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">The essence of the <tt class="filename">re</tt> module is the <tt class="function">search</tt> function, that takes a regular expression (<tt class="varname">pattern</tt>) and a string (<tt class="literal">'M'</tt>) to try to match against the regular expression.  If a match is found, <tt class="function">search</tt> returns an object which has various methods to describe the match; if no match is found, <tt class="function">search</tt> returns <tt class="literal">None</tt>, the <span class="application">Python</span> null value.  All you care about at the moment is whether the pattern matches, which you can tell by just looking at the return
                                 value of <tt class="function">search</tt>.  <tt class="literal">'M'</tt> matches this regular expression, because the first optional <tt class="literal">M</tt> matches and the second and third optional <tt class="literal">M</tt> characters are ignored.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'MM'</tt> matches because the first and second optional <tt class="literal">M</tt> characters match and the third <tt class="literal">M</tt> is ignored.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'MMM'</tt> matches because all three <tt class="literal">M</tt> characters match.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'MMMM'</tt> does not match.  All three <tt class="literal">M</tt> characters match, but then the regular expression insists on the string ending (because of the <tt class="literal">$</tt> character), and the string doesn't end yet (because of the fourth <tt class="literal">M</tt>).  So <tt class="function">search</tt> returns <tt class="literal">None</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Interestingly, an empty string also matches this regular expression, since all the <tt class="literal">M</tt> characters are optional.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e17785"></a>7.3.2.&nbsp;Checking for Hundreds
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The hundreds place is more difficult than the thousands, because there are several mutually exclusive ways it could be expressed,
                     depending on its value.
                  </p>
                  <div class="itemizedlist">
                     <ul>
                        <li><tt class="literal">100</tt> = <tt class="literal">C</tt></li>
                        <li><tt class="literal">200</tt> = <tt class="literal">CC</tt></li>
                        <li><tt class="literal">300</tt> = <tt class="literal">CCC</tt></li>
                        <li><tt class="literal">400</tt> = <tt class="literal">CD</tt></li>
                        <li><tt class="literal">500</tt> = <tt class="literal">D</tt></li>
                        <li><tt class="literal">600</tt> = <tt class="literal">DC</tt></li>
                        <li><tt class="literal">700</tt> = <tt class="literal">DCC</tt></li>
                        <li><tt class="literal">800</tt> = <tt class="literal">DCCC</tt></li>
                        <li><tt class="literal">900</tt> = <tt class="literal">CM</tt></li>
                     </ul>
                  </div>
                  <p>So there are four possible patterns:</p>
                  <div class="itemizedlist">
                     <ul>
                        <li><tt class="literal">CM</tt></li>
                        <li><tt class="literal">CD</tt></li>
                        <li>Zero to three <tt class="literal">C</tt> characters (zero if the hundreds place is 0)
                        </li>
                        <li><tt class="literal">D</tt>, followed by zero to three <tt class="literal">C</tt> characters
                        </li>
                     </ul>
                  </div>
                  <p>The last two patterns can be combined:</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>an optional <tt class="literal">D</tt>, followed by zero to three <tt class="literal">C</tt> characters
                        </li>
                     </ul>
                  </div>
                  <p>This example shows how to validate the hundreds place of a Roman numeral.</p>
                  <div class="example"><a name="re.roman.hundreds"></a><h3 class="title">Example&nbsp;7.4.&nbsp;Checking for Hundreds</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import re</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?(CM|CD|D?C?C?C?)$'</span> <a name="re.roman.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCM')</span>            <a name="re.roman.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 01070390&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MD')</span>             <a name="re.roman.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 01073A50&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMMCCC')</span>         <a name="re.roman.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 010748A8&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCMC')</span>           <a name="re.roman.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, '')</span>               <a name="re.roman.2.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 01071D98&gt;</span></pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This pattern starts out the same as the previous one, checking for the beginning of the string (<tt class="literal">^</tt>), then the thousands place (<tt class="literal">M?M?M?</tt>).  Then it has the new part, in parentheses, which defines a set of three mutually exclusive patterns, separated by vertical
                                 bars: <tt class="literal">CM</tt>, <tt class="literal">CD</tt>, and <tt class="literal">D?C?C?C?</tt> (which is an optional <tt class="literal">D</tt> followed by zero to three optional <tt class="literal">C</tt> characters).  The regular expression parser checks for each of these patterns in order (from left to right), takes the first
                                 one that matches, and ignores the rest.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'MCM'</tt> matches because the first <tt class="literal">M</tt> matches, the second and third <tt class="literal">M</tt> characters are ignored, and the <tt class="literal">CM</tt> matches (so the <tt class="literal">CD</tt> and <tt class="literal">D?C?C?C?</tt> patterns are never even considered).  <tt class="literal">MCM</tt> is the Roman numeral representation of <tt class="literal">1900</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'MD'</tt> matches because the first <tt class="literal">M</tt> matches, the second and third <tt class="literal">M</tt> characters are ignored, and the <tt class="literal">D?C?C?C?</tt> pattern matches <tt class="literal">D</tt> (each of the three <tt class="literal">C</tt> characters are optional and are ignored).  <tt class="literal">MD</tt> is the Roman numeral representation of <tt class="literal">1500</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'MMMCCC'</tt> matches because all three <tt class="literal">M</tt> characters match, and the <tt class="literal">D?C?C?C?</tt> pattern matches <tt class="literal">CCC</tt> (the <tt class="literal">D</tt> is optional and is ignored).  <tt class="literal">MMMCCC</tt> is the Roman numeral representation of <tt class="literal">3300</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left"><tt class="literal">'MCMC'</tt> does not match.  The first <tt class="literal">M</tt> matches, the second and third <tt class="literal">M</tt> characters are ignored, and the <tt class="literal">CM</tt> matches, but then the <tt class="literal">$</tt> does not match because you're not at the end of the string yet (you still have an unmatched <tt class="literal">C</tt> character).  The <tt class="literal">C</tt> does <span class="emphasis"><em>not</em></span> match as part of the <tt class="literal">D?C?C?C?</tt> pattern, because the mutually exclusive <tt class="literal">CM</tt> pattern has already matched.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.roman.2.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Interestingly, an empty string still matches this pattern, because all the <tt class="literal">M</tt> characters are optional and ignored, and the empty string matches the <tt class="literal">D?C?C?C?</tt> pattern where all the characters are optional and ignored.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>Whew!  See how quickly regular expressions can get nasty?  And you've only covered the thousands and hundreds places of Roman
                     numerals.  But if you followed all that, the tens and ones places are easy, because they're exactly the same pattern.  But
                     let's look at another way to express the pattern.
                  </p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="re.nm"></a>7.4.&nbsp;Using the <tt class="literal">{n,m}</tt> Syntax
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>In <a href="#re.roman" title="7.3.&nbsp;Case Study: Roman Numerals">the previous section</a>, you were dealing with a pattern where the same character could be repeated up to three times.  There is another way to express
                     this in regular expressions, which some people find more readable.  First look at the method we already used in the previous
                     example.
                  </p>
               </div>
               <div class="example"><a name="d0e18113"></a><h3 class="title">Example&nbsp;7.5.&nbsp;The Old Way: Every Character Optional</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import re</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?$'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'M')</span>    <a name="re.nm.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EE090&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?$'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MM')</span>   <a name="re.nm.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?$'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMM')</span>  <a name="re.nm.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EE090&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMMM')</span> <a name="re.nm.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, and then the first optional <tt class="literal">M</tt>, but not the second and third <tt class="literal">M</tt> (but that's okay because they're optional), and then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, and then the first and second optional <tt class="literal">M</tt>, but not the third <tt class="literal">M</tt> (but that's okay because it's optional), and then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, and then all three optional <tt class="literal">M</tt>, and then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, and then all three optional <tt class="literal">M</tt>, but then does not match the the end of the string (because there is still one unmatched <tt class="literal">M</tt>), so the pattern does not match and returns <tt class="literal">None</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e18215"></a><h3 class="title">Example&nbsp;7.6.&nbsp;The New Way: From <tt class="literal">n</tt> o <tt class="literal">m</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M{0,3}$'</span>       <a name="re.nm.2.0"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'M')</span>    <a name="re.nm.2.1"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MM')</span>   <a name="re.nm.2.2"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EE090&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMM')</span>  <a name="re.nm.2.3"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEDA8&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMMM')</span> <a name="re.nm.2.4"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.2.0"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This pattern says: &#8220;<span class="quote">Match the start of the string, then anywhere from zero to three <tt class="literal">M</tt> characters, then the end of the string.</span>&#8221;  The 0 and 3 can be any numbers; if you want to match at least one but no more than three <tt class="literal">M</tt> characters, you could say <tt class="literal">M{1,3}</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.2.1"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, then one <tt class="literal">M</tt> out of a possible three, then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.2.2"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, then two <tt class="literal">M</tt> out of a possible three, then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.2.3"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, then three <tt class="literal">M</tt> out of a possible three, then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.nm.2.4"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, then three <tt class="literal">M</tt> out of a possible three, but then <span class="emphasis"><em>does not match</em></span> the end of the string.  The regular expression allows for up to only three <tt class="literal">M</tt> characters before the end of the string, but you have four, so the pattern does not match and returns <tt class="literal">None</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e18321"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">There is no way to programmatically determine that two regular expressions are equivalent.  The best you can do is write a
                        lot of test cases to make sure they behave the same way on all relevant inputs.  You'll talk more about writing test cases
                        later in this book.
                     </td>
                  </tr>
               </table>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e18326"></a>7.4.1.&nbsp;Checking for Tens and Ones
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>Now let's expand the Roman numeral regular expression to cover the tens and ones place.  This example shows the check for
                     tens.
                  </p>
                  <div class="example"><a name="re.tens.example"></a><h3 class="title">Example&nbsp;7.7.&nbsp;Checking for Tens</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)$'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCMXL')</span>    <a name="re.nm.3.3"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCML')</span>     <a name="re.nm.3.4"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCMLX')</span>    <a name="re.nm.3.5"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCMLXXX')</span>  <a name="re.nm.3.7"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCMLXXXX')</span> <a name="re.nm.3.8"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.3.3"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then the first optional <tt class="literal">M</tt>, then <tt class="literal">CM</tt>, then <tt class="literal">XL</tt>, then the end of the string.  Remember, the <tt class="literal">(A|B|C)</tt> syntax means &#8220;<span class="quote">match exactly one of A, B, or C</span>&#8221;.  You match <tt class="literal">XL</tt>, so you ignore the <tt class="literal">XC</tt> and <tt class="literal">L?X?X?X?</tt> choices, and then move on to the end of the string.  <tt class="literal">MCML</tt> is the Roman numeral representation of <tt class="literal">1940</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.3.4"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then the first optional <tt class="literal">M</tt>, then <tt class="literal">CM</tt>, then <tt class="literal">L?X?X?X?</tt>.  Of the <tt class="literal">L?X?X?X?</tt>, it matches the <tt class="literal">L</tt> and skips all three optional <tt class="literal">X</tt> characters.  Then you move to the end of the string.  <tt class="literal">MCML</tt> is the Roman numeral representation of <tt class="literal">1950</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.3.5"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then the first optional <tt class="literal">M</tt>, then <tt class="literal">CM</tt>, then the optional <tt class="literal">L</tt> and the first optional <tt class="literal">X</tt>, skips the second and third optional <tt class="literal">X</tt>, then the end of the string.  <tt class="literal">MCMLX</tt> is the Roman numeral representation of <tt class="literal">1960</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.3.7"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then the first optional <tt class="literal">M</tt>, then <tt class="literal">CM</tt>, then the optional <tt class="literal">L</tt> and all three optional <tt class="literal">X</tt> characters, then the end of the string.  <tt class="literal">MCMLXXX</tt> is the Roman numeral representation of <tt class="literal">1980</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.3.8"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then the first optional <tt class="literal">M</tt>, then <tt class="literal">CM</tt>, then the optional <tt class="literal">L</tt> and all three optional <tt class="literal">X</tt> characters, then <span class="emphasis"><em>fails to match</em></span> the end of the string because there is still one more <tt class="literal">X</tt> unaccounted for.  So the entire pattern fails to match, and returns <tt class="literal">None</tt>.  <tt class="literal">MCMLXXXX</tt> is not a valid Roman numeral.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>The expression for the ones place follows the same pattern.  I'll spare you the details and show you the end result.</p>
                  <div class="informalexample"><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)(IX|IV|V?I?I?I?)$'</span>
</pre></div>
                  <p>So what does that look like using this alternate <tt class="literal">{n,m}</tt> syntax?  This example shows the new syntax.
                  </p>
                  <div class="example"><a name="re.nm.example"></a><h3 class="title">Example&nbsp;7.8.&nbsp;Validating Roman Numerals with <tt class="literal">{n,m}</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MDLV')</span>             <a name="re.nm.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMDCLXVI')</span>         <a name="re.nm.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMMMDCCCLXXXVIII')</span> <a name="re.nm.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'I')</span>                <a name="re.nm.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
</pre><div class="calloutlist">
                        <table border="0" summary="Callout list">
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then one of a possible four <tt class="literal">M</tt> characters, then <tt class="literal">D?C{0,3}</tt>.  Of that, it matches the optional <tt class="literal">D</tt> and zero of three possible <tt class="literal">C</tt> characters.  Moving on, it matches <tt class="literal">L?X{0,3}</tt> by matching the optional <tt class="literal">L</tt> and zero of three possible <tt class="literal">X</tt> characters.  Then it matches <tt class="literal">V?I{0,3}</tt> by matching the optional V and zero of three possible <tt class="literal">I</tt> characters, and finally the end of the string.  <tt class="literal">MDLV</tt> is the Roman numeral representation of <tt class="literal">1555</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then two of a possible four <tt class="literal">M</tt> characters, then the <tt class="literal">D?C{0,3}</tt> with a <tt class="literal">D</tt> and one of three possible <tt class="literal">C</tt> characters; then <tt class="literal">L?X{0,3}</tt> with an <tt class="literal">L</tt> and one of three possible <tt class="literal">X</tt> characters; then <tt class="literal">V?I{0,3}</tt> with a <tt class="literal">V</tt> and one of three possible <tt class="literal">I</tt> characters; then the end of the string.  <tt class="literal">MMDCLXVI</tt> is the Roman numeral representation of <tt class="literal">2666</tt>.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">This matches the start of the string, then four out of four <tt class="literal">M</tt> characters, then <tt class="literal">D?C{0,3}</tt> with a <tt class="literal">D</tt> and three out of three <tt class="literal">C</tt> characters; then <tt class="literal">L?X{0,3}</tt> with an <tt class="literal">L</tt> and three out of three <tt class="literal">X</tt> characters; then <tt class="literal">V?I{0,3}</tt> with a <tt class="literal">V</tt> and three out of three <tt class="literal">I</tt> characters; then the end of the string.  <tt class="literal">MMMMDCCCLXXXVIII</tt> is the Roman numeral representation of <tt class="literal">3888</tt>, and it's the longest Roman numeral you can write without extended syntax.
                              </td>
                           </tr>
                           <tr>
                              <td width="12" valign="top" align="left"><a href="#re.nm.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                              </td>
                              <td valign="top" align="left">Watch closely.  (I feel like a magician.  &#8220;<span class="quote">Watch closely, kids, I'm going to pull a rabbit out of my hat.</span>&#8221;)  This matches the start of the string, then zero out of four <tt class="literal">M</tt>, then matches <tt class="literal">D?C{0,3}</tt> by skipping the optional <tt class="literal">D</tt> and matching zero out of three <tt class="literal">C</tt>, then matches <tt class="literal">L?X{0,3}</tt> by skipping the optional <tt class="literal">L</tt> and matching zero out of three <tt class="literal">X</tt>, then matches <tt class="literal">V?I{0,3}</tt> by skipping the optional <tt class="literal">V</tt> and matching one out of three <tt class="literal">I</tt>.  Then the end of the string.  Whoa.
                              </td>
                           </tr>
                        </table>
                     </div>
                  </div>
                  <p>If you followed all that and understood it on the first try, you're doing better than I did.  Now imagine trying to understand
                     someone else's regular expressions, in the middle of a critical function of a large program.  Or even imagine coming back
                     to your own regular expressions a few months later.  I've done it, and it's not a pretty sight.
                  </p>
                  <p>In the next section you'll explore an alternate syntax that can help keep your expressions maintainable.</p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="re.verbose"></a>7.5.&nbsp;Verbose Regular Expressions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>So far you've just been dealing with what I'll call &#8220;<span class="quote">compact</span>&#8221; regular expressions.  As you've seen, they are difficult to read, and even if you figure out what one does, that's no guarantee
                     that you'll be able to understand it six months later.  What you really need is inline documentation.
                  </p>
               </div>
               <p><span class="application">Python</span> allows you to do this with something called <span class="emphasis"><em>verbose regular expressions</em></span>.  A verbose regular expression is different from a compact regular expression in two ways:
               </p>
               <div class="itemizedlist">
                  <ul>
                     <li>Whitespace is ignored.  Spaces, tabs, and carriage returns are not matched as spaces, tabs, and carriage returns.  They're
                        not matched at all.  (If you want to match a space in a verbose regular expression, you'll need to escape it by putting a
                        backslash in front of it.)
                     </li>
                     <li>Comments are ignored.  A comment in a verbose regular expression is just like a comment in Python code: it starts with a <tt class="literal">#</tt> character and goes until the end of the line.  In this case it's a comment within a multi-line string instead of within your
                        source code, but it works the same way.
                     </li>
                  </ul>
               </div>
               <p>This will be more clear with an example.  Let's revisit the compact regular expression you've been working with, and make
                  it a verbose regular expression.  This example shows how.
               </p>
               <div class="example"><a name="d0e18777"></a><h3 class="title">Example&nbsp;7.9.&nbsp;Regular Expressions with Inline Comments</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = """
    ^                   # beginning of string
    M{0,4}              # thousands - 0 to 4 M's
    (CM|CD|D?C{0,3})    # hundreds - 900 (CM), 400 (CD), 0-300 (0 to 3 C's),
                        #            or 500-800 (D, followed by 0 to 3 C's)
    (XC|XL|L?X{0,3})    # tens - 90 (XC), 40 (XL), 0-30 (0 to 3 X's),
                        #        or 50-80 (L, followed by 0 to 3 X's)
    (IX|IV|V?I{0,3})    # ones - 9 (IX), 4 (IV), 0-3 (0 to 3 I's),
                        #        or 5-8 (V, followed by 0 to 3 I's)
    $                   # end of string
    """</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'M', re.VERBOSE)</span>                <a name="re.verbose.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MCMLXXXIX', re.VERBOSE)</span>        <a name="re.verbose.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'MMMMDCCCLXXXVIII', re.VERBOSE)</span> <a name="re.verbose.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x008EEB48&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'M')</span>                            <a name="re.verbose.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.verbose.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The most important thing to remember when using verbose regular expressions is that you need to pass an extra argument when
                              working with them: <tt class="literal">re.VERBOSE</tt> is a constant defined in the <tt class="filename">re</tt> module that signals that the pattern should be treated as a verbose regular expression.  As you can see, this pattern has
                              quite a bit of whitespace (all of which is ignored), and several comments (all of which are ignored).  Once you ignore the
                              whitespace and the comments, this is exactly the same regular expression as you saw in <a href="#re.nm" title="7.4.&nbsp;Using the {n,m} Syntax">the previous section</a>, but it's a lot more readable.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.verbose.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, then one of a possible four <tt class="literal">M</tt>, then <tt class="literal">CM</tt>, then <tt class="literal">L</tt> and three of a possible three <tt class="literal">X</tt>, then <tt class="literal">IX</tt>, then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.verbose.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This matches the start of the string, then four of a possible four <tt class="literal">M</tt>, then <tt class="literal">D</tt> and three of a possible three <tt class="literal">C</tt>, then <tt class="literal">L</tt> and three of a possible three <tt class="literal">X</tt>, then <tt class="literal">V</tt> and three of a possible three <tt class="literal">I</tt>, then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.verbose.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This does not match.  Why?  Because it doesn't have the <tt class="literal">re.VERBOSE</tt> flag, so the <tt class="function">re.search</tt> function is treating the pattern as a compact regular expression, with significant whitespace and literal hash marks.  <span class="application">Python</span> can't auto-detect whether a regular expression is verbose or not.  <span class="application">Python</span> assumes every regular expression is compact unless you explicitly state that it is verbose.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="re.phone"></a>7.6.&nbsp;Case study: Parsing Phone Numbers
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>So far you've concentrated on matching whole patterns.  Either the pattern matches, or it doesn't.  But regular expressions
                     are much more powerful than that.  When a regular expression <span class="emphasis"><em>does</em></span> match, you can pick out specific pieces of it.  You can find out what matched where.
                  </p>
               </div>
               <p>This example came from another real-world problem I encountered, again from a previous day job.  The problem: parsing an American
                  phone number.  The client wanted to be able to enter the number free-form (in a single field), but then wanted to store the
                  area code, trunk, number, and optionally an extension separately in the company's database.  I scoured the Web and found many
                  examples of regular expressions that purported to do this, but none of them were permissive enough.
               </p>
               <p>Here are the phone numbers I needed to be able to accept:</p>
               <div class="itemizedlist">
                  <ul>
                     <li><tt class="literal">800-555-1212</tt></li>
                     <li><tt class="literal">800 555 1212</tt></li>
                     <li><tt class="literal">800.555.1212</tt></li>
                     <li><tt class="literal">(800) 555-1212</tt></li>
                     <li><tt class="literal">1-800-555-1212</tt></li>
                     <li><tt class="literal">800-555-1212-1234</tt></li>
                     <li><tt class="literal">800-555-1212x1234</tt></li>
                     <li><tt class="literal">800-555-1212 ext. 1234</tt></li>
                     <li><tt class="literal">work 1-(800) 555.1212 #1234</tt></li>
                  </ul>
               </div>
               <p>Quite a variety!  In each of these cases, I need to know that the area code was <tt class="literal">800</tt>, the trunk was <tt class="literal">555</tt>, and the rest of the phone number was <tt class="literal">1212</tt>.  For those with an extension, I need to know that the extension was <tt class="literal">1234</tt>.
               </p>
               <p>Let's work through developing a solution for phone number parsing.  This example shows the first step.</p>
               <div class="example"><a name="re.phone.example"></a><h3 class="title">Example&nbsp;7.10.&nbsp;Finding Numbers</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern = re.compile(r'^(\d{3})-(\d{3})-(\d{4})$')</span> <a name="re.phone.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212').groups()</span>            <a name="re.phone.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212-1234')</span>                <a name="re.phone.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Always read regular expressions from left to right.  This one matches the beginning of the string, and then <tt class="literal">(\d{3})</tt>.  What's <tt class="literal">\d{3}</tt>?  Well, the <tt class="literal">{3}</tt> means &#8220;<span class="quote">match exactly three numeric digits</span>&#8221;; it's a variation on the <a href="#re.nm" title="7.4.&nbsp;Using the {n,m} Syntax"><tt class="literal">{n,m} syntax</tt></a> you saw earlier.  <tt class="literal">\d</tt> means &#8220;<span class="quote">any numeric digit</span>&#8221; (<tt class="literal">0</tt> through <tt class="literal">9</tt>).  Putting it in parentheses means &#8220;<span class="quote">match exactly three numeric digits, <span class="emphasis"><em>and then remember them as a group that I can ask for later</em></span></span>&#8221;.  Then match a literal hyphen.  Then match another group of exactly three digits.  Then another literal hyphen.  Then another
                              group of exactly four digits.  Then match the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To get access to the groups that the regular expression parser remembered along the way, use the <tt class="function">groups()</tt> method on the object that the <tt class="function">search</tt> function returns.  It will return a tuple of however many groups were defined in the regular expression.  In this case, you
                              defined three groups, one with three digits, one with three digits, and one with four digits.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This regular expression is not the final answer, because it doesn't handle a phone number with an extension on the end.  For
                              that, you'll need to expand the regular expression.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e19043"></a><h3 class="title">Example&nbsp;7.11.&nbsp;Finding the Extension</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern = re.compile(r'^(\d{3})-(\d{3})-(\d{4})-(\d+)$')</span> <a name="re.phone.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212-1234').groups()</span>             <a name="re.phone.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800 555 1212 1234')</span>                      <a name="re.phone.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212')</span>                           <a name="re.phone.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This regular expression is almost identical to the previous one.  Just as before, you match the beginning of the string, then
                              a remembered group of three digits, then a hyphen, then a remembered group of three digits, then a hyphen, then a remembered
                              group of four digits.  What's new is that you then match another hyphen, and a remembered group of one or more digits, then
                              the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">groups()</tt> method now returns a tuple of four elements, since the regular expression now defines four groups to remember.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Unfortunately, this regular expression is not the final answer either, because it assumes that the different parts of the
                              phone number are separated by hyphens.  What if they're separated by spaces, or commas, or dots?  You need a more general
                              solution to match several different types of separators.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Oops!  Not only does this regular expression not do everything you want, it's actually a step backwards, because now you can't
                              parse phone numbers <span class="emphasis"><em>without</em></span> an extension.  That's not what you wanted at all; if the extension is there, you want to know what it is, but if it's not
                              there, you still want to know what the different parts of the main number are.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The next example shows the regular expression to handle separators between the different parts of the phone number.</p>
               <div class="example"><a name="d0e19106"></a><h3 class="title">Example&nbsp;7.12.&nbsp;Handling Different Separators</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern = re.compile(r'^(\d{3})\D+(\d{3})\D+(\d{4})\D+(\d+)$')</span> <a name="re.phone.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800 555 1212 1234').groups()</span>                   <a name="re.phone.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212-1234').groups()</span>                   <a name="re.phone.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('80055512121234')</span>                               <a name="re.phone.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212')</span>                                 <a name="re.phone.3.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Hang on to your hat.  You're matching the beginning of the string, then a group of three digits, then <tt class="literal">\D+</tt>.  What the heck is that?  Well, <tt class="literal">\D</tt> matches any character <span class="emphasis"><em>except</em></span> a numeric digit, and <tt class="literal">+</tt> means &#8220;<span class="quote">1 or more</span>&#8221;.  So <tt class="literal">\D+</tt> matches one or more characters that are not digits.  This is what you're using instead of a literal hyphen, to try to match
                              different separators.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using <tt class="literal">\D+</tt> instead of <tt class="literal">-</tt> means you can now match phone numbers where the parts are separated by spaces instead of hyphens.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Of course, phone numbers separated by hyphens still work too.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Unfortunately, this is still not the final answer, because it assumes that there is a separator at all.  What if the phone
                              number is entered without any spaces or hyphens at all?
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Oops!  This still hasn't fixed the problem of requiring extensions.  Now you have two problems, but you can solve both of
                              them with the same technique.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The next example shows the regular expression for handling phone numbers <span class="emphasis"><em>without</em></span> separators.
               </p>
               <div class="example"><a name="d0e19203"></a><h3 class="title">Example&nbsp;7.13.&nbsp;Handling Numbers Without Separators</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern = re.compile(r'^(\d{3})\D*(\d{3})\D*(\d{4})\D*(\d*)$')</span> <a name="re.phone.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('80055512121234').groups()</span>                      <a name="re.phone.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800.555.1212 x1234').groups()</span>                  <a name="re.phone.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212').groups()</span>                        <a name="re.phone.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('(800)5551212 x1234')</span>                           <a name="re.phone.4.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The only change you've made since that last step is changing all the <tt class="literal">+</tt> to <tt class="literal">*</tt>.  Instead of <tt class="literal">\D+</tt> between the parts of the phone number, you now match on <tt class="literal">\D*</tt>.  Remember that <tt class="literal">+</tt> means &#8220;<span class="quote">1 or more</span>&#8221;?  Well, <tt class="literal">*</tt> means &#8220;<span class="quote">zero or more</span>&#8221;.  So now you should be able to parse phone numbers even when there is no separator character at all.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Lo and behold, it actually works.  Why?  You matched the beginning of the string, then a remembered group of three digits
                              (<tt class="literal">800</tt>), then zero non-numeric characters, then a remembered group of three digits (<tt class="literal">555</tt>), then zero non-numeric characters, then a remembered group of four digits (<tt class="literal">1212</tt>), then zero non-numeric characters, then a remembered group of an arbitrary number of digits (<tt class="literal">1234</tt>), then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Other variations work now too: dots instead of hyphens, and both a space and an <tt class="literal">x</tt> before the extension.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Finally, you've solved the other long-standing problem: extensions are optional again.  If no extension is found, the <tt class="function">groups()</tt> method still returns a tuple of four elements, but the fourth element is just an empty string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.4.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">I hate to be the bearer of bad news, but you're not finished yet.  What's the problem here?  There's an extra character before
                              the area code, but the regular expression assumes that the area code is the first thing at the beginning of the string.  No
                              problem, you can use the same technique of &#8220;<span class="quote">zero or more non-numeric characters</span>&#8221; to skip over the leading characters before the area code.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The next example shows how to handle leading characters in phone numbers.</p>
               <div class="example"><a name="d0e19318"></a><h3 class="title">Example&nbsp;7.14.&nbsp;Handling Leading Characters</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern = re.compile(r'^\D*(\d{3})\D*(\d{3})\D*(\d{4})\D*(\d*)$')</span> <a name="re.phone.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('(800)5551212 ext. 1234').groups()</span>                 <a name="re.phone.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212').groups()</span>                           <a name="re.phone.5.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('work 1-(800) 555.1212 #1234')</span>                     <a name="re.phone.5.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the same as in the previous example, except now you're matching <tt class="literal">\D*</tt>, zero or more non-numeric characters, before the first remembered group (the area code).  Notice that you're not remembering
                              these non-numeric characters (they're not in parentheses).  If you find them, you'll just skip over them and then start remembering
                              the area code whenever you get to it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can successfully parse the phone number, even with the leading left parenthesis before the area code.  (The right parenthesis
                              after the area code is already handled; it's treated as a non-numeric separator and matched by the <tt class="literal">\D*</tt> after the first remembered group.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.5.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Just a sanity check to make sure you haven't broken anything that used to work.  Since the leading characters are entirely
                              optional, this matches the beginning of the string, then zero non-numeric characters, then a remembered group of three digits
                              (<tt class="literal">800</tt>), then one non-numeric character (the hyphen), then a remembered group of three digits (<tt class="literal">555</tt>), then one non-numeric character (the hyphen), then a remembered group of four digits (<tt class="literal">1212</tt>), then zero non-numeric characters, then a remembered group of zero digits, then the end of the string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.5.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is where regular expressions make me want to gouge my eyes out with a blunt object.  Why doesn't this phone number match?
                               Because there's a <tt class="literal">1</tt> before the area code, but you assumed that all the leading characters before the area code were non-numeric characters (<tt class="literal">\D*</tt>).  Aargh.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Let's back up for a second.  So far the regular expressions have all matched from the beginning of the string.  But now you
                  see that there may be an indeterminate amount of stuff at the beginning of the string that you want to ignore.  Rather than
                  trying to match it all just so you can skip over it, let's take a different approach: don't explicitly match the beginning
                  of the string at all.  This approach is shown in the next example.
               </p>
               <div class="example"><a name="d0e19396"></a><h3 class="title">Example&nbsp;7.15.&nbsp;Phone Number, Wherever I May Find Ye</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern = re.compile(r'(\d{3})\D*(\d{3})\D*(\d{4})\D*(\d*)$')</span> <a name="re.phone.6.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('work 1-(800) 555.1212 #1234').groups()</span>        <a name="re.phone.6.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212')</span>                                <a name="re.phone.6.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('80055512121234')</span>                              <a name="re.phone.6.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.6.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note the lack of <tt class="literal">^</tt> in this regular expression.  You are not matching the beginning of the string anymore.  There's nothing that says you need
                              to match the entire input with your regular expression.  The regular expression engine will do the hard work of figuring out
                              where the input string starts to match, and go from there.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.6.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you can successfully parse a phone number that includes leading characters and a leading digit, plus any number of any
                              kind of separators around each part of the phone number.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.6.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Sanity check.  this still works.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.6.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">That still works too.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>See how quickly a regular expression can get out of control?  Take a quick glance at any of the previous iterations.  Can
                  you tell the difference between one and the next?
               </p>
               <p>While you still understand the final answer (and it is the final answer; if you've discovered a case it doesn't handle, I
                  don't want to know about it), let's write it out as a verbose regular expression, before you forget why you made the choices
                  you made.
               </p>
               <div class="example"><a name="d0e19458"></a><h3 class="title">Example&nbsp;7.16.&nbsp;Parsing Phone Numbers (Final Version)</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern = re.compile(r'''
                # don't match beginning of string, number can start anywhere
    (\d{3})     # area code is 3 digits (e.g. '800')
    \D*         # optional separator is any number of non-digits
    (\d{3})     # trunk is 3 digits (e.g. '555')
    \D*         # optional separator
    (\d{4})     # rest of number is 4 digits (e.g. '1212')
    \D*         # optional separator
    (\d*)       # extension is optional and can be any number of digits
    $           # end of string
    ''', re.VERBOSE)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('work 1-(800) 555.1212 #1234').groups()</span>        <a name="re.phone.7.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '1234')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">phonePattern.search('800-555-1212')</span>                                <a name="re.phone.7.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">('800', '555', '1212', '')</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.7.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Other than being spread out over multiple lines, this is exactly the same regular expression as the last step, so it's no
                              surprise that it parses the same inputs.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#re.phone.7.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Final sanity check.  Yes, this still works.  You're done.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Regular Expressions</h3>
                  <ul>
                     <li><a href="http://py-howto.sourceforge.net/regex/regex.html">Regular Expression HOWTO</a> teaches about regular expressions and how to use them in <span class="application">Python</span>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes the <a href="http://www.python.org/doc/current/lib/module-re.html"><tt class="filename">re</tt> module</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="re.summary"></a>7.7.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>This is just the tiniest tip of the iceberg of what regular expressions can do.  In other words, even though you're completely
                     overwhelmed by them now, believe me, you ain't seen nothing yet.
                  </p>
               </div>
               <p>You should now be familiar with the following techniques:</p>
               <div class="itemizedlist">
                  <ul>
                     <li><tt class="literal">^</tt> matches the beginning of a string.
                     </li>
                     <li><tt class="literal">$</tt> matches the end of a string.
                     </li>
                     <li><tt class="literal">\b</tt> matches a word boundary.
                     </li>
                     <li><tt class="literal">\d</tt> matches any numeric digit.
                     </li>
                     <li><tt class="literal">\D</tt> matches any non-numeric character.
                     </li>
                     <li><tt class="literal">x?</tt> matches an optional <tt class="literal">x</tt> character (in other words, it matches an <tt class="literal">x</tt> zero or one times).
                     </li>
                     <li><tt class="literal">x*</tt> matches <tt class="literal">x</tt> zero or more times.
                     </li>
                     <li><tt class="literal">x+</tt> matches <tt class="literal">x</tt> one or more times.
                     </li>
                     <li><tt class="literal">x{n,m}</tt> matches an <tt class="literal">x</tt> character at least <tt class="literal">n</tt> times, but not more than <tt class="literal">m</tt> times.
                     </li>
                     <li><tt class="literal">(a|b|c)</tt> matches either <tt class="literal">a</tt> or <tt class="literal">b</tt> or <tt class="literal">c</tt>.
                     </li>
                     <li><tt class="literal">(x)</tt> in general is a <span class="emphasis"><em>remembered group</em></span>.  You can get the value of what matched by using the <tt class="function">groups()</tt> method of the object returned by <tt class="function">re.search</tt>.
                     </li>
                  </ul>
               </div>
               <p>Regular expressions are extremely powerful, but they are not the correct solution for every problem.  You should learn enough
                  about them to know when they are appropriate, when they will solve your problems, and when they will cause more problems than
                  they solve.
               </p>
               <div class="blockquote">
                  <table border="0" width="100%" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote">
                     <tr>
                        <td width="10%" valign="top">&nbsp;</td>
                        <td width="80%" valign="top">
                           <p>Some people, when confronted with a problem, think &#8220;<span class="quote">I know, I'll use regular expressions.</span>&#8221;  Now they have two problems.
                           </p>
                        </td>
                        <td width="10%" valign="top">&nbsp;</td>
                     </tr>
                     <tr>
                        <td colspan="2" align="right" valign="top">--<span class="attribution">Jamie Zawinski, <a href="http://groups.google.com/groups?selm=33F0C496.370D7C45%40netscape.com">in comp.emacs.xemacs</a></span></td>
                        <td width="10%" valign="top">&nbsp;</td>
                     </tr>
                  </table>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="dialect"></a>Chapter&nbsp;8.&nbsp;<span class="acronym">HTML</span> Processing
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.divein"></a>8.1.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>I often see questions on <a href="http://groups.google.com/groups?group=comp.lang.python">comp.lang.python</a> like &#8220;<span class="quote">How can I list all the [headers|images|links] in my <span class="acronym">HTML</span> document?</span>&#8221;  &#8220;<span class="quote">How do I parse/translate/munge the text of my <span class="acronym">HTML</span> document but leave the tags alone?</span>&#8221;  &#8220;<span class="quote">How can I add/remove/quote attributes of all my <span class="acronym">HTML</span> tags at once?</span>&#8221;  This chapter will answer all of these questions.
                  </p>
               </div>
               <p>Here is a complete, working <span class="application">Python</span> program in two parts.  The first part, <tt class="filename">BaseHTMLProcessor.py</tt>, is a generic tool to help you process <span class="acronym">HTML</span> files by walking through the tags and text blocks.  The second part, <tt class="filename">dialect.py</tt>, is an example of how to use <tt class="filename">BaseHTMLProcessor.py</tt> to translate the text of an <span class="acronym">HTML</span> document but leave the tags alone.  Read the <tt class="literal">doc string</tt>s and comments to get an overview of what's going on.  Most of it will seem like black magic, because it's not obvious how
                  any of these class methods ever get called.  Don't worry, all will be revealed in due time.
               </p>
               <div class="example"><a name="dialect.basehtml.listing"></a><h3 class="title">Example&nbsp;8.1.&nbsp;<tt class="filename">BaseHTMLProcessor.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
from sgmllib import SGMLParser
import htmlentitydefs

class BaseHTMLProcessor(SGMLParser):
    def reset(self):                       
        # extend (called by SGMLParser.__init__)
        self.pieces = []
        SGMLParser.reset(self)

    def unknown_starttag(self, tag, attrs):
        # called for each start tag
        # attrs is a list of (attr, value) tuples
        # e.g. for &lt;pre class="screen"&gt;, tag="pre", attrs=[("class", "screen")]
        # Ideally we would like to reconstruct original tag and attributes, but
        # we may end up quoting attribute values that weren't quoted in the source
        # document, or we may change the type of quotes around the attribute value
        # (single to double quotes).
        # Note that improperly embedded non-HTML code (like client-side Javascript)
        # may be parsed incorrectly by the ancestor, causing runtime script errors.
        # All non-HTML code must be enclosed in HTML comment tags (&lt;!-- code --&gt;)
        # to ensure that it will pass through this parser unaltered (in handle_comment).
        strattrs = "".join([' %s="%s"' % (key, value) for key, value in attrs])
        self.pieces.append("&lt;%(tag)s%(strattrs)s&gt;" % locals())

    def unknown_endtag(self, tag):         
        # called for each end tag, e.g. for &lt;/pre&gt;, tag will be "pre"
        # Reconstruct the original end tag.
        self.pieces.append("&lt;/%(tag)s&gt;" % locals())

    def handle_charref(self, ref):         
        # called for each character reference, e.g. for "&amp;#160;", ref will be "160"
        # Reconstruct the original character reference.
        self.pieces.append("&amp;#%(ref)s;" % locals())

    def handle_entityref(self, ref):       
        # called for each entity reference, e.g. for "&amp;copy;", ref will be "copy"
        # Reconstruct the original entity reference.
        self.pieces.append("&amp;%(ref)s" % locals())
        # standard HTML entities are closed with a semicolon; other entities are not
        if htmlentitydefs.entitydefs.has_key(ref):
            self.pieces.append(";")

    def handle_data(self, text):           
        # called for each block of plain text, i.e. outside of any tag and
        # not containing any character or entity references
        # Store the original text verbatim.
        self.pieces.append(text)

    def handle_comment(self, text):        
        # called for each HTML comment, e.g. &lt;!-- insert Javascript code here --&gt;
        # Reconstruct the original comment.
        # It is especially important that the source document enclose client-side
        # code (like Javascript) within comments so it can pass through this
        # processor undisturbed; see comments in unknown_starttag for details.
        self.pieces.append("&lt;!--%(text)s--&gt;" % locals())

    def handle_pi(self, text):             
        # called for each processing instruction, e.g. &lt;?instruction&gt;
        # Reconstruct original processing instruction.
        self.pieces.append("&lt;?%(text)s&gt;" % locals())

    def handle_decl(self, text):
        # called for the DOCTYPE, if present, e.g.
        # &lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        #     "http://www.w3.org/TR/html4/loose.dtd"&gt;
        # Reconstruct original DOCTYPE
        self.pieces.append("&lt;!%(text)s&gt;" % locals())

    def output(self):              
        """Return processed HTML as a single string"""
        return "".join(self.pieces)</pre></div>
               <div class="example"><a name="d0e19707"></a><h3 class="title">Example&nbsp;8.2.&nbsp;<tt class="filename">dialect.py</tt></h3><pre class="programlisting">
import re
from BaseHTMLProcessor import BaseHTMLProcessor

class Dialectizer(BaseHTMLProcessor):
    subs = ()

    def reset(self):
        # extend (called from __init__ in ancestor)
        # Reset all data attributes
        self.verbatim = 0
        BaseHTMLProcessor.reset(self)

    def start_pre(self, attrs):            
        # called for every &lt;pre&gt; tag in HTML source
        # Increment verbatim mode count, then handle tag like normal
        self.verbatim += 1                 
        self.unknown_starttag("pre", attrs)

    def end_pre(self):                     
        # called for every &lt;/pre&gt; tag in HTML source
        # Decrement verbatim mode count
        self.unknown_endtag("pre")         
        self.verbatim -= 1                 

    def handle_data(self, text):                                        
        # override
        # called for every block of text in HTML source
        # If in verbatim mode, save text unaltered;
        # otherwise process the text with a series of substitutions
        self.pieces.append(self.verbatim and text or self.process(text))

    def process(self, text):
        # called from handle_data
        # Process text block by performing series of regular expression
        # substitutions (actual substitions are defined in descendant)
        for fromPattern, toPattern in self.subs:
            text = re.sub(fromPattern, toPattern, text)
        return text

class ChefDialectizer(Dialectizer):
    """convert HTML to Swedish Chef-speak
    
    based on the classic chef.x, copyright (c) 1992, 1993 John Hagerman
    """
    subs = ((r'a([nu])', r'u\1'),
            (r'A([nu])', r'U\1'),
            (r'a\B', r'e'),
            (r'A\B', r'E'),
            (r'en\b', r'ee'),
            (r'\Bew', r'oo'),
            (r'\Be\b', r'e-a'),
            (r'\be', r'i'),
            (r'\bE', r'I'),
            (r'\Bf', r'ff'),
            (r'\Bir', r'ur'),
            (r'(\w*?)i(\w*?)$', r'\1ee\2'),
            (r'\bow', r'oo'),
            (r'\bo', r'oo'),
            (r'\bO', r'Oo'),
            (r'the', r'zee'),
            (r'The', r'Zee'),
            (r'th\b', r't'),
            (r'\Btion', r'shun'),
            (r'\Bu', r'oo'),
            (r'\BU', r'Oo'),
            (r'v', r'f'),
            (r'V', r'F'),
            (r'w', r'w'),
            (r'W', r'W'),
            (r'([a-z])[.]', r'\1.  Bork Bork Bork!'))

class FuddDialectizer(Dialectizer):
    """convert HTML to Elmer Fudd-speak"""
    subs = ((r'[rl]', r'w'),
            (r'qu', r'qw'),
            (r'th\b', r'f'),
            (r'th', r'd'),
            (r'n[.]', r'n, uh-hah-hah-hah.'))

class OldeDialectizer(Dialectizer):
    """convert HTML to mock Middle English"""
    subs = ((r'i([bcdfghjklmnpqrstvwxyz])e\b', r'y\1'),
            (r'i([bcdfghjklmnpqrstvwxyz])e', r'y\1\1e'),
            (r'ick\b', r'yk'),
            (r'ia([bcdfghjklmnpqrstvwxyz])', r'e\1e'),
            (r'e[ea]([bcdfghjklmnpqrstvwxyz])', r'e\1e'),
            (r'([bcdfghjklmnpqrstvwxyz])y', r'\1ee'),
            (r'([bcdfghjklmnpqrstvwxyz])er', r'\1re'),
            (r'([aeiou])re\b', r'\1r'),
            (r'ia([bcdfghjklmnpqrstvwxyz])', r'i\1e'),
            (r'tion\b', r'cioun'),
            (r'ion\b', r'ioun'),
            (r'aid', r'ayde'),
            (r'ai', r'ey'),
            (r'ay\b', r'y'),
            (r'ay', r'ey'),
            (r'ant', r'aunt'),
            (r'ea', r'ee'),
            (r'oa', r'oo'),
            (r'ue', r'e'),
            (r'oe', r'o'),
            (r'ou', r'ow'),
            (r'ow', r'ou'),
            (r'\bhe', r'hi'),
            (r've\b', r'veth'),
            (r'se\b', r'e'),
            (r"'s\b", r'es'),
            (r'ic\b', r'ick'),
            (r'ics\b', r'icc'),
            (r'ical\b', r'ick'),
            (r'tle\b', r'til'),
            (r'll\b', r'l'),
            (r'ould\b', r'olde'),
            (r'own\b', r'oune'),
            (r'un\b', r'onne'),
            (r'rry\b', r'rye'),
            (r'est\b', r'este'),
            (r'pt\b', r'pte'),
            (r'th\b', r'the'),
            (r'ch\b', r'che'),
            (r'ss\b', r'sse'),
            (r'([wybdp])\b', r'\1e'),
            (r'([rnt])\b', r'\1\1e'),
            (r'from', r'fro'),
            (r'when', r'whan'))

def translate(url, dialectName="chef"):
    """fetch URL and translate using dialect
    
    dialect in ("chef", "fudd", "olde")"""
    import urllib                      
    sock = urllib.urlopen(url)         
    htmlSource = sock.read()           
    sock.close()                       
    parserName = "%sDialectizer" % dialectName.capitalize()
    parserClass = globals()[parserName]                    
    parser = parserClass()                                 
    parser.feed(htmlSource)
    parser.close()         
    return parser.output() 

def test(url):
    """test all dialects against URL"""
    for dialect in ("chef", "fudd", "olde"):
        outfile = "%s.html" % dialect
        fsock = open(outfile, "wb")
        fsock.write(translate(url, dialect))
        fsock.close()
        import webbrowser
        webbrowser.open_new(outfile)

if __name__ == "__main__":
    test("http://diveintopython.org/odbchelper_list.html")</pre></div>
               <div class="example"><a name="d0e19713"></a><h3 class="title">Example&nbsp;8.3.&nbsp;Output of <tt class="filename">dialect.py</tt></h3>
                  <p>Running this script will translate <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">Section&nbsp;3.2, &#8220;Introducing Lists&#8221;</a> into <a href="../native_data_types/chef.html">mock Swedish Chef-speak</a> (from The Muppets), <a href="../native_data_types/fudd.html">mock Elmer Fudd-speak</a> (from Bugs Bunny cartoons), and <a href="../native_data_types/olde.html">mock Middle English</a> (loosely based on Chaucer's <i class="citetitle">The Canterbury Tales</i>).  If you look at the <span class="acronym">HTML</span> source of the output pages, you'll see that all the <span class="acronym">HTML</span> tags and attributes are untouched, but the text between the tags has been &#8220;<span class="quote">translated</span>&#8221; into the mock language.  If you look closer, you'll see that, in fact, only the titles and paragraphs were translated; the
                     code listings and screen examples were left untouched.
                  </p><pre class="programlisting">
&lt;div class="abstract"&gt;
&lt;p&gt;Lists awe &lt;span class="application"&gt;Pydon&lt;/span&gt;'s wowkhowse datatype.
If youw onwy expewience wif wists is awways in
&lt;span class="application"&gt;Visuaw Basic&lt;/span&gt; ow (God fowbid) de datastowe
in &lt;span class="application"&gt;Powewbuiwdew&lt;/span&gt;, bwace youwsewf fow
&lt;span class="application"&gt;Pydon&lt;/span&gt; wists.&lt;/p&gt;
&lt;/div&gt;
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.sgmllib"></a>8.2.&nbsp;Introducing <tt class="filename">sgmllib.py</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="acronym">HTML</span> processing is broken into three steps: breaking down the <span class="acronym">HTML</span> into its constituent pieces, fiddling with the pieces, and reconstructing the pieces into <span class="acronym">HTML</span> again.  The first step is done by <tt class="filename">sgmllib.py</tt>, a part of the standard <span class="application">Python</span> library.
                  </p>
               </div>
               <p>The key to understanding this chapter is to realize that <span class="acronym">HTML</span> is not just text, it is structured text.  The structure is derived from the more-or-less-hierarchical sequence of start tags
                  and end tags.  Usually you don't work with <span class="acronym">HTML</span> this way; you work with it <span class="emphasis"><em>textually</em></span> in a text editor, or <span class="emphasis"><em>visually</em></span> in a web browser or web authoring tool.  <tt class="filename">sgmllib.py</tt> presents <span class="acronym">HTML</span> <span class="emphasis"><em>structurally</em></span>.
               </p>
               <p><tt class="filename">sgmllib.py</tt> contains one important class: <tt class="classname">SGMLParser</tt>.  <tt class="classname">SGMLParser</tt> parses <span class="acronym">HTML</span> into useful pieces, like start tags and end tags.  As soon as it succeeds in breaking down some data into a useful piece,
                  it calls a method on itself based on what it found.  In order to use the parser, you subclass the <tt class="classname">SGMLParser</tt> class and override these methods.  This is what I meant when I said that it presents <span class="acronym">HTML</span> <span class="emphasis"><em>structurally</em></span>: the structure of the <span class="acronym">HTML</span> determines the sequence of method calls and the arguments passed to each method.
               </p>
               <p><tt class="classname">SGMLParser</tt> parses <span class="acronym">HTML</span> into 8 kinds of data, and calls a separate method for each of them:
               </p>
               <div class="variablelist">
                  <dl>
                     <dt><span class="term">Start tag</span></dt>
                     <dd>An <span class="acronym">HTML</span> tag that starts a block, like <tt class="sgmltag-element">&lt;html&gt;</tt>, <tt class="sgmltag-element">&lt;head&gt;</tt>, <tt class="sgmltag-element">&lt;body&gt;</tt>, or <tt class="sgmltag-element">&lt;pre&gt;</tt>, or a standalone tag like <tt class="sgmltag-element">&lt;br&gt;</tt> or <tt class="sgmltag-element">&lt;img&gt;</tt>.  When it finds a start tag <i class="replaceable"><tt>tagname</tt></i>, <tt class="classname">SGMLParser</tt> will look for a method called <tt class="function">start_<i class="replaceable"><tt>tagname</tt></i></tt> or <tt class="function">do_<i class="replaceable"><tt>tagname</tt></i></tt>.  For instance, when it finds a <tt class="sgmltag-element">&lt;pre&gt;</tt> tag, it will look for a <tt class="function">start_pre</tt> or <tt class="function">do_pre</tt> method.  If found, <tt class="classname">SGMLParser</tt> calls this method with a list of the tag's attributes; otherwise, it calls <tt class="function">unknown_starttag</tt> with the tag name and list of attributes.
                     </dd>
                     <dt><span class="term">End tag</span></dt>
                     <dd>An <span class="acronym">HTML</span> tag that ends a block, like <tt class="sgmltag-element">&lt;/html&gt;</tt>, <tt class="sgmltag-element">&lt;/head&gt;</tt>, <tt class="sgmltag-element">&lt;/body&gt;</tt>, or <tt class="sgmltag-element">&lt;/pre&gt;</tt>.  When it finds an end tag, <tt class="classname">SGMLParser</tt> will look for a method called <tt class="function">end_<i class="replaceable"><tt>tagname</tt></i></tt>.  If found, <tt class="classname">SGMLParser</tt> calls this method, otherwise it calls <tt class="function">unknown_endtag</tt> with the tag name.
                     </dd>
                     <dt><span class="term">Character reference</span></dt>
                     <dd>An escaped character referenced by its decimal or hexadecimal equivalent, like <tt class="literal">&amp;#160;</tt>.  When found, <tt class="classname">SGMLParser</tt> calls <tt class="function">handle_charref</tt> with the text of the decimal or hexadecimal character equivalent.
                     </dd>
                     <dt><span class="term">Entity reference</span></dt>
                     <dd>An <span class="acronym">HTML</span> entity, like <tt class="literal">&amp;copy;</tt>.  When found, <tt class="classname">SGMLParser</tt> calls <tt class="function">handle_entityref</tt> with the name of the <span class="acronym">HTML</span> entity.
                     </dd>
                     <dt><span class="term">Comment</span></dt>
                     <dd>An <span class="acronym">HTML</span> comment, enclosed in <tt class="literal">&lt;!-- ... --&gt;</tt>.  When found, <tt class="classname">SGMLParser</tt> calls <tt class="function">handle_comment</tt> with the body of the comment.
                     </dd>
                     <dt><span class="term">Processing instruction</span></dt>
                     <dd>An <span class="acronym">HTML</span> processing instruction, enclosed in <tt class="literal">&lt;? ... &gt;</tt>.  When found, <tt class="classname">SGMLParser</tt> calls <tt class="function">handle_pi</tt> with the body of the processing instruction.
                     </dd>
                     <dt><span class="term">Declaration</span></dt>
                     <dd>An <span class="acronym">HTML</span> declaration, such as a <tt class="sgmltag-element">DOCTYPE</tt>, enclosed in <tt class="literal">&lt;! ... &gt;</tt>.  When found, <tt class="classname">SGMLParser</tt> calls <tt class="function">handle_decl</tt> with the body of the declaration.
                     </dd>
                     <dt><span class="term">Text data</span></dt>
                     <dd>A block of text.  Anything that doesn't fit into the other 7 categories.  When found, <tt class="classname">SGMLParser</tt> calls <tt class="function">handle_data</tt> with the text.
                     </dd>
                  </dl>
               </div><a name="d0e20023"></a><table class="important" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> 2.0 had a bug where <tt class="classname">SGMLParser</tt> would not recognize declarations at all (<tt class="function">handle_decl</tt> would never be called), which meant that <tt class="sgmltag-element">DOCTYPE</tt>s were silently ignored.  This is fixed in <span class="application">Python</span> 2.1.
                     </td>
                  </tr>
               </table>
               <p><tt class="filename">sgmllib.py</tt> comes with a test suite to illustrate this.  You can run <tt class="filename">sgmllib.py</tt>, passing the name of an <span class="acronym">HTML</span> file on the command line, and it will print out the tags and other elements as it parses them.  It does this by subclassing
                  the <tt class="classname">SGMLParser</tt> class and defining <tt class="function">unknown_starttag</tt>, <tt class="function">unknown_endtag</tt>, <tt class="function">handle_data</tt> and other methods which simply print their arguments.
               </p><a name="tip.commandline.windows"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">ActivePython</span> <span class="acronym">IDE</span> on Windows, you can specify command line arguments in the &#8220;<span class="quote">Run script</span>&#8221; dialog.  Separate multiple arguments with spaces.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="d0e20080"></a><h3 class="title">Example&nbsp;8.4.&nbsp;Sample test of <tt class="filename">sgmllib.py</tt></h3>
                  <p>Here is a snippet from the table of contents of the <span class="acronym">HTML</span> version of this book.  Of course your paths may vary.  (If you haven't downloaded the <span class="acronym">HTML</span> version of the book, you can do so at <a href="http://diveintopython.org/">http://diveintopython.org/</a>.
                  </p><pre class="screen">
<tt class="prompt">c:\python23\lib&gt;</tt> <span class="userinput">type "c:\downloads\diveintopython\html\toc\index.html"</span>
<tt class="literal">
&lt;!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;
&lt;html lang="en"&gt;
   &lt;head&gt;
      &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;
   
      &lt;title&gt;Dive Into Python&lt;/title&gt;
      &lt;link rel="stylesheet" href="diveintopython.css" type="text/css"&gt;

... rest of file omitted for brevity ...
</tt></pre><p>Running this through the test suite of <tt class="filename">sgmllib.py</tt> yields this output:
                  </p><pre class="screen">
<tt class="prompt">c:\python23\lib&gt;</tt> <span class="userinput">python sgmllib.py "c:\downloads\diveintopython\html\toc\index.html"</span>
<span class="computeroutput">data: '\n\n'
start tag: &lt;html lang="en" &gt;
data: '\n   '
start tag: &lt;head&gt;
data: '\n      '
start tag: &lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" &gt;
data: '\n   \n      '
start tag: &lt;title&gt;
data: 'Dive Into Python'
end tag: &lt;/title&gt;
data: '\n      '
start tag: &lt;link rel="stylesheet" href="diveintopython.css" type="text/css" &gt;
data: '\n      '

... rest of output omitted for brevity ...
</span></pre></div>
               <p>Here's the roadmap for the rest of the chapter:</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Subclass <tt class="classname">SGMLParser</tt> to create classes that extract interesting data out of <span class="acronym">HTML</span> documents.
                     </li>
                     <li>Subclass <tt class="classname">SGMLParser</tt> to create <tt class="classname">BaseHTMLProcessor</tt>, which overrides all 8 handler methods and uses them to reconstruct the original <span class="acronym">HTML</span> from the pieces.
                     </li>
                     <li>Subclass <tt class="classname">BaseHTMLProcessor</tt> to create <tt class="classname">Dialectizer</tt>, which adds some methods to process specific <span class="acronym">HTML</span> tags specially, and overrides the <tt class="function">handle_data</tt> method to provide a framework for processing the text blocks between the <span class="acronym">HTML</span> tags.
                     </li>
                     <li>Subclass <tt class="classname">Dialectizer</tt> to create classes that define text processing rules used by <tt class="function">Dialectizer.handle_data</tt>.
                     </li>
                     <li>Write a test suite that grabs a real web page from <tt class="systemitem">http://diveintopython.org/</tt> and processes it.
                     </li>
                  </ul>
               </div>
               <p>Along the way, you'll also learn about <tt class="function">locals</tt>, <tt class="function">globals</tt>, and dictionary-based string formatting.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.extract"></a>8.3.&nbsp;Extracting data from <span class="acronym">HTML</span> documents
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>To extract data from <span class="acronym">HTML</span> documents, subclass the <tt class="classname">SGMLParser</tt> class and define methods for each tag or entity you want to capture.
                  </p>
               </div>
               <p>The first step to extracting data from an <span class="acronym">HTML</span> document is getting some <span class="acronym">HTML</span>.  If you have some <span class="acronym">HTML</span> lying around on your hard drive, you can use <a href="#fileinfo.files" title="6.2.&nbsp;Working with File Objects">file functions</a> to read it, but the real fun begins when you get <span class="acronym">HTML</span> from live web pages.
               </p>
               <div class="example"><a name="dialect.extract.urllib"></a><h3 class="title">Example&nbsp;8.5.&nbsp;Introducing <tt class="filename">urllib</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib</span>                                       <a name="dialect.extract.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sock = urllib.urlopen("http://diveintopython.org/")</span> <a name="dialect.extract.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">htmlSource = sock.read()</span>                            <a name="dialect.extract.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sock.close()</span>                                        <a name="dialect.extract.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print htmlSource</span>                                    <a name="dialect.extract.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;&lt;html&gt;&lt;head&gt;
      &lt;meta http-equiv='Content-Type' content='text/html; charset=ISO-8859-1'&gt;
   &lt;title&gt;Dive Into Python&lt;/title&gt;
&lt;link rel='stylesheet' href='diveintopython.css' type='text/css'&gt;
&lt;link rev='made' href='mailto:mark@diveintopython.org'&gt;
&lt;meta name='keywords' content='Python, Dive Into Python, tutorial, object-oriented, programming, documentation, book, free'&gt;
&lt;meta name='description' content='a free Python tutorial for experienced programmers'&gt;
&lt;/head&gt;
&lt;body bgcolor='white' text='black' link='#0000FF' vlink='#840084' alink='#0000FF'&gt;
&lt;table cellpadding='0' cellspacing='0' border='0' width='100%'&gt;
&lt;tr&gt;&lt;td class='header' width='1%' valign='top'&gt;diveintopython.org&lt;/td&gt;
&lt;td width='99%' align='right'&gt;&lt;hr size='1' noshade&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td class='tagline' colspan='2'&gt;Python&amp;nbsp;for&amp;nbsp;experienced&amp;nbsp;programmers&lt;/td&gt;&lt;/tr&gt;</span>

[...snip...]</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="filename">urllib</tt> module is part of the standard <span class="application">Python</span> library.  It contains functions for getting information about and actually retrieving data from Internet-based <span class="acronym">URL</span>s (mainly web pages).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The simplest use of <tt class="filename">urllib</tt> is to retrieve the entire text of a web page using the <tt class="function">urlopen</tt> function.  Opening a <span class="acronym">URL</span> is similar to <a href="#fileinfo.files" title="6.2.&nbsp;Working with File Objects">opening a file</a>.  The return value of <tt class="function">urlopen</tt> is a file-like object, which has some of the same methods as a file object.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The simplest thing to do with the file-like object returned by <tt class="function">urlopen</tt> is <tt class="function">read</tt>, which reads the entire <span class="acronym">HTML</span> of the web page into a single string.  The object also supports <tt class="function">readlines</tt>, which reads the text line by line into a list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When you're done with the object, make sure to <tt class="function">close</tt> it, just like a normal file object.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You now have the complete <span class="acronym">HTML</span> of the home page of <tt class="systemitem">http://diveintopython.org/</tt> in a string, and you're ready to parse it.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="dialect.extract.links"></a><h3 class="title">Example&nbsp;8.6.&nbsp;Introducing <tt class="filename">urllister.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
from sgmllib import SGMLParser

class URLLister(SGMLParser):
    def reset(self):                              <a name="dialect.extract.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        SGMLParser.reset(self)
        self.urls = []

    def start_a(self, attrs):                     <a name="dialect.extract.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        href = [v for k, v in attrs if k=='href'] <a name="dialect.extract.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"> <a name="dialect.extract.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        if href:
            self.urls.extend(href)</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">reset</tt> is called by the <tt class="function">__init__</tt> method of <tt class="classname">SGMLParser</tt>, and it can also be called manually once an instance of the parser has been created.  So if you need to do any initialization,
                              do it in <tt class="function">reset</tt>, not in <tt class="function">__init__</tt>, so that it will be re-initialized properly when someone re-uses a parser instance.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">start_a</tt> is called by <tt class="classname">SGMLParser</tt> whenever it finds an <tt class="sgmltag-element">&lt;a&gt;</tt> tag.  The tag may contain an <tt class="literal">href</tt> attribute, and/or other attributes, like <tt class="literal">name</tt> or <tt class="literal">title</tt>.  The <tt class="varname">attrs</tt> parameter is a list of tuples, <tt class="literal">[(<i class="replaceable">attribute</i>, <i class="replaceable">value</i>), (<i class="replaceable">attribute</i>, <i class="replaceable">value</i>), ...]</tt>.  Or it may be just an <tt class="sgmltag-element">&lt;a&gt;</tt>, a valid (if useless) <span class="acronym">HTML</span> tag, in which case <tt class="varname">attrs</tt> would be an empty list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can find out whether this <tt class="sgmltag-element">&lt;a&gt;</tt> tag has an <tt class="literal">href</tt> attribute with a simple <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">multi-variable</a> <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehension</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">String comparisons like <tt class="literal">k=='href'</tt> are always case-sensitive, but that's safe in this case, because <tt class="classname">SGMLParser</tt> converts attribute names to lowercase while building <tt class="varname">attrs</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="dialect.feed.example"></a><h3 class="title">Example&nbsp;8.7.&nbsp;Using <tt class="filename">urllister.py</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib, urllister</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">usock = urllib.urlopen("http://diveintopython.org/")</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">parser = urllister.URLLister()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">parser.feed(usock.read())</span>         <a name="dialect.extract.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">usock.close()</span>                     <a name="dialect.extract.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">parser.close()</span>                    <a name="dialect.extract.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for url in parser.urls: print url</span> <a name="dialect.extract.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">toc/index.html
#download
#languages
toc/index.html
appendix/history.html
download/diveintopython-html-5.0.zip
download/diveintopython-pdf-5.0.zip
download/diveintopython-word-5.0.zip
download/diveintopython-text-5.0.zip
download/diveintopython-html-flat-5.0.zip
download/diveintopython-xml-5.0.zip
download/diveintopython-common-5.0.zip
</span>

... rest of output omitted for brevity ...</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Call the <tt class="function">feed</tt> method, defined in <tt class="classname">SGMLParser</tt>, to get <span class="acronym">HTML</span> into the parser.<sup>[<a name="d0e20503" href="#ftn.d0e20503">1</a>]</sup>  It takes a string, which is what <tt class="function">usock.read()</tt> returns.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Like files, you should <tt class="function">close</tt> your <span class="acronym">URL</span> objects as soon as you're done with them.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You should <tt class="function">close</tt> your parser object, too, but for a different reason.  You've read all the data and fed it to the parser, but the <tt class="function">feed</tt> method isn't guaranteed to have actually processed all the <span class="acronym">HTML</span> you give it; it may buffer it, waiting for more.  Be sure to call <tt class="function">close</tt> to flush the buffer and force everything to be fully parsed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.extract.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Once the parser is <tt class="function">close</tt>d, the parsing is complete, and <tt class="varname">parser.urls</tt> contains a list of all the linked <span class="acronym">URL</span>s in the <span class="acronym">HTML</span> document.  (Your output may look different, if the download links have been updated by the time you read this.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.basehtml"></a>8.4.&nbsp;Introducing <tt class="filename">BaseHTMLProcessor.py</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><tt class="classname">SGMLParser</tt> doesn't produce anything by itself.  It parses and parses and parses, and it calls a method for each interesting thing it
                     finds, but the methods don't do anything.  <tt class="classname">SGMLParser</tt> is an <span class="acronym">HTML</span> <span class="emphasis"><em>consumer</em></span>: it takes <span class="acronym">HTML</span> and breaks it down into small, structured pieces.  As you saw in the <a href="#dialect.extract" title="8.3.&nbsp;Extracting data from HTML documents">previous section</a>, you can subclass <tt class="classname">SGMLParser</tt> to define classes that catch specific tags and produce useful things, like a list of all the links on a web page.  Now you'll
                     take this one step further by defining a class that catches everything <tt class="classname">SGMLParser</tt> throws at it and reconstructs the complete <span class="acronym">HTML</span> document.  In technical terms, this class will be an <span class="acronym">HTML</span> <span class="emphasis"><em>producer</em></span>.
                  </p>
               </div>
               <p><tt class="classname">BaseHTMLProcessor</tt> subclasses <tt class="classname">SGMLParser</tt> and provides all 8 essential handler methods: <tt class="function">unknown_starttag</tt>, <tt class="function">unknown_endtag</tt>, <tt class="function">handle_charref</tt>, <tt class="function">handle_entityref</tt>, <tt class="function">handle_comment</tt>, <tt class="function">handle_pi</tt>, <tt class="function">handle_decl</tt>, and <tt class="function">handle_data</tt>.
               </p>
               <div class="example"><a name="dialect.basehtml.intro"></a><h3 class="title">Example&nbsp;8.8.&nbsp;Introducing <tt class="classname">BaseHTMLProcessor</tt></h3><pre class="programlisting">
class BaseHTMLProcessor(SGMLParser):
    def reset(self):                        <a name="dialect.basehtml.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        self.pieces = []
        SGMLParser.reset(self)

    def unknown_starttag(self, tag, attrs): <a name="dialect.basehtml.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        strattrs = "".join([' %s="%s"' % (key, value) for key, value in attrs])
        self.pieces.append("&lt;%(tag)s%(strattrs)s&gt;" % locals())

    def unknown_endtag(self, tag):          <a name="dialect.basehtml.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        self.pieces.append("&lt;/%(tag)s&gt;" % locals())

    def handle_charref(self, ref):          <a name="dialect.basehtml.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        self.pieces.append("&amp;#%(ref)s;" % locals())

    def handle_entityref(self, ref):        <a name="dialect.basehtml.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
        self.pieces.append("&amp;%(ref)s" % locals())
        if htmlentitydefs.entitydefs.has_key(ref):
            self.pieces.append(";")

    def handle_data(self, text):            <a name="dialect.basehtml.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
        self.pieces.append(text)

    def handle_comment(self, text):         <a name="dialect.basehtml.1.7"></a><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12">
        self.pieces.append("&lt;!--%(text)s--&gt;" % locals())

    def handle_pi(self, text):              <a name="dialect.basehtml.1.8"></a><img src="images/callouts/8.png" alt="8" border="0" width="12" height="12">
        self.pieces.append("&lt;?%(text)s&gt;" % locals())

    def handle_decl(self, text):
        self.pieces.append("&lt;!%(text)s&gt;" % locals())</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">reset</tt>, called by <tt class="function">SGMLParser.__init__</tt>, initializes <tt class="varname">self.pieces</tt> as an empty list before <a href="#fileinfo.init.code.example" title="Example&nbsp;5.6.&nbsp;Coding the FileInfo Class">calling the ancestor method</a>.  <tt class="varname">self.pieces</tt> is a <a href="#fileinfo.userdict.init.example" title="Example&nbsp;5.9.&nbsp;Defining the UserDict Class">data attribute</a> which will hold the pieces of the <span class="acronym">HTML</span> document you're constructing.  Each handler method will reconstruct the <span class="acronym">HTML</span> that <tt class="classname">SGMLParser</tt> parsed, and each method will append that string to <tt class="varname">self.pieces</tt>.  Note that <tt class="varname">self.pieces</tt> is a list.  You might be tempted to define it as a string and just keep appending each piece to it.  That would work, but
                              <span class="application">Python</span> is much more efficient at dealing with lists.<sup>[<a name="d0e20702" href="#ftn.d0e20702">2</a>]</sup></td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since <tt class="classname">BaseHTMLProcessor</tt> does not define any methods for specific tags (like the <tt class="function">start_a</tt> method in <a href="#dialect.extract.links" title="Example&nbsp;8.6.&nbsp;Introducing urllister.py"><tt class="classname">URLLister</tt></a>), <tt class="classname">SGMLParser</tt> will call <tt class="function">unknown_starttag</tt> for every start tag.  This method takes the tag (<tt class="varname">tag</tt>) and the list of attribute name/value pairs (<tt class="varname">attrs</tt>), reconstructs the original <span class="acronym">HTML</span>, and appends it to <tt class="varname">self.pieces</tt>.  The <a href="#odbchelper.stringformatting" title="3.5.&nbsp;Formatting Strings">string formatting</a> here is a little strange; you'll untangle that (and also the odd-looking <tt class="function">locals</tt> function) later in this chapter.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Reconstructing end tags is much simpler; just take the tag name and wrap it in the <tt class="literal">&lt;/...&gt;</tt> brackets.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When <tt class="classname">SGMLParser</tt> finds a character reference, it calls <tt class="function">handle_charref</tt> with the bare reference.  If the <span class="acronym">HTML</span> document contains the reference <tt class="literal">&amp;#160;</tt>, <tt class="varname">ref</tt> will be <tt class="literal">160</tt>.  Reconstructing the original complete character reference just involves wrapping <tt class="varname">ref</tt> in <tt class="literal">&amp;#...;</tt> characters.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Entity references are similar to character references, but without the hash mark.  Reconstructing the original entity reference
                              requires wrapping <tt class="varname">ref</tt> in <tt class="literal">&amp;...;</tt> characters.  (Actually, as an erudite reader pointed out to me, it's slightly more complicated than this.  Only certain standard
                              <span class="acronym">HTML</span> entites end in a semicolon; other similar-looking entities do not.  Luckily for us, the set of standard <span class="acronym">HTML</span> entities is defined in a dictionary in a <span class="application">Python</span> module called <tt class="filename">htmlentitydefs</tt>.  Hence the extra <tt class="literal">if</tt> statement.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Blocks of text are simply appended to <tt class="varname">self.pieces</tt> unaltered.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.7"><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><span class="acronym">HTML</span> comments are wrapped in <tt class="literal">&lt;!--...--&gt;</tt> characters.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.1.8"><img src="images/callouts/8.png" alt="8" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Processing instructions are wrapped in <tt class="literal">&lt;?...&gt;</tt> characters.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e20845"></a><table class="important" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">The <span class="acronym">HTML</span> specification requires that all non-<span class="acronym">HTML</span> (like client-side <span class="application">JavaScript</span>) must be enclosed in <span class="acronym">HTML</span> comments, but not all web pages do this properly (and all modern web browsers are forgiving if they don't).  <tt class="classname">BaseHTMLProcessor</tt> is not forgiving; if script is improperly embedded, it will be parsed as if it were <span class="acronym">HTML</span>.  For instance, if the script contains less-than and equals signs, <tt class="classname">SGMLParser</tt> may incorrectly think that it has found tags and attributes.  <tt class="classname">SGMLParser</tt> always converts tags and attribute names to lowercase, which may break the script, and <tt class="classname">BaseHTMLProcessor</tt> always encloses attribute values in double quotes (even if the original <span class="acronym">HTML</span> document used single quotes or no quotes), which will certainly break the script.  Always protect your client-side script
                        within <span class="acronym">HTML</span> comments.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="dialect.output.example"></a><h3 class="title">Example&nbsp;8.9.&nbsp;<tt class="classname">BaseHTMLProcessor</tt> output
                  </h3><pre class="programlisting">
    def output(self):               <a name="dialect.basehtml.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        """Return processed HTML as a single string"""
        return "".join(self.pieces) <a name="dialect.basehtml.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the one method in <tt class="classname">BaseHTMLProcessor</tt> that is never called by the ancestor <tt class="classname">SGMLParser</tt>.  Since the other handler methods store their reconstructed <span class="acronym">HTML</span> in <tt class="varname">self.pieces</tt>, this function is needed to join all those pieces into one string.  As noted before, <span class="application">Python</span> is great at lists and mediocre at strings, so you only create the complete string when somebody explicitly asks for it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If you prefer, you could use the <tt class="function">join</tt> method of the <tt class="filename">string</tt> module instead: <tt class="literal">string.join(self.pieces, "")</tt></td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li><a href="http://www.w3.org/">W3C</a> discusses <a href="http://www.w3.org/TR/REC-html40/charset.html#entities">character and entity references</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> confirms your suspicions that <a href="http://www.python.org/doc/current/lib/module-htmlentitydefs.html">the <tt class="filename">htmlentitydefs</tt> module</a> is exactly what it sounds like.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.locals"></a>8.5.&nbsp;<tt class="function">locals</tt> and <tt class="function">globals</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Let's digress from <span class="acronym">HTML</span> processing for a minute and talk about how <span class="application">Python</span> handles variables.  <span class="application">Python</span> has two built-in functions, <tt class="function">locals</tt> and <tt class="function">globals</tt>, which provide dictionary-based access to local and global variables.
                  </p>
               </div>
               <p>Remember <tt class="function">locals</tt>?  You first saw it here:
               </p>
               <div class="informalexample"><pre class="programlisting">
    def unknown_starttag(self, tag, attrs):
        strattrs = "".join([' %s="%s"' % (key, value) for key, value in attrs])
        self.pieces.append("&lt;%(tag)s%(strattrs)s&gt;" % locals())
</pre></div>
               <p>No, wait, you can't learn about <tt class="function">locals</tt> yet.  First, you need to learn about namespaces.  This is dry stuff, but it's important, so pay attention.
               </p>
               <p><span class="application">Python</span> uses what are called namespaces to keep track of variables.  A namespace is just like a dictionary where the keys are names
                  of variables and the dictionary values are the values of those variables.  In fact, you can access a namespace as a <span class="application">Python</span> dictionary, as you'll see in a minute.
               </p>
               <p>At any particular point in a <span class="application">Python</span> program, there are several namespaces available.  Each function has its own namespace, called the local namespace, which
                  keeps track of the function's variables, including function arguments and locally defined variables.  Each module has its
                  own namespace, called the global namespace, which keeps track of the module's variables, including functions, classes, any
                  other imported modules, and module-level variables and constants.  And there is the built-in namespace, accessible from any
                  module, which holds built-in functions and exceptions.
               </p>
               <p>When a line of code asks for the value of a variable <tt class="varname">x</tt>, <span class="application">Python</span> will search for that variable in all the available namespaces, in order:
               </p>
               <div class="orderedlist">
                  <ol type="1">
                     <li>local namespace - specific to the current function or class method.  If the function defines a local variable <tt class="varname">x</tt>, or has an argument <tt class="varname">x</tt>, <span class="application">Python</span> will use this and stop searching.
                     </li>
                     <li>global namespace - specific to the current module.  If the module has defined a variable, function, or class called <tt class="varname">x</tt>, <span class="application">Python</span> will use that and stop searching.
                     </li>
                     <li>built-in namespace - global to all modules.  As a last resort, <span class="application">Python</span> will assume that <tt class="varname">x</tt> is the name of built-in function or variable.
                     </li>
                  </ol>
               </div>
               <p>If <span class="application">Python</span> doesn't find <tt class="varname">x</tt> in any of these namespaces, it gives up and raises a <tt class="errorcode">NameError</tt> with the message <tt class="errorname">There is no variable named 'x'</tt>, which you saw back in <a href="#odbchelper.unboundvariable" title="Example&nbsp;3.18.&nbsp;Referencing an Unbound Variable">Example&nbsp;3.18, &#8220;Referencing an Unbound Variable&#8221;</a>, but you didn't appreciate how much work <span class="application">Python</span> was doing before giving you that error.
               </p><a name="d0e21061"></a><table class="important" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> 2.2 introduced a subtle but important change that affects the namespace search order: nested scopes.  In versions of <span class="application">Python</span> prior to 2.2, when you reference a variable within a <a href="#fileinfo.nested" title="Example&nbsp;6.21.&nbsp;listDirectory">nested function</a> or <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions"><tt class="literal">lambda</tt> function</a>, <span class="application">Python</span> will search for that variable in the current (nested or <tt class="literal">lambda</tt>) function's namespace, then in the module's namespace.  <span class="application">Python</span> 2.2 will search for the variable in the current (nested or <tt class="literal">lambda</tt>) function's namespace, <span class="emphasis"><em>then in the parent function's namespace</em></span>, then in the module's namespace.  <span class="application">Python</span> 2.1 can work either way; by default, it works like <span class="application">Python</span> 2.0, but you can add the following line of code at the top of your module to make your module work like <span class="application">Python</span> 2.2:<pre class="programlisting">
from __future__ import nested_scopes</pre></td>
                  </tr>
               </table>
               <p>Are you confused yet?  Don't despair!  This is really cool, I promise.  Like many things in <span class="application">Python</span>, namespaces are <span class="emphasis"><em>directly accessible at run-time</em></span>.  How?  Well, the local namespace is accessible via the built-in <tt class="function">locals</tt> function, and the global (module level) namespace is accessible via the built-in <tt class="function">globals</tt> function.
               </p>
               <div class="example"><a name="d0e21119"></a><h3 class="title">Example&nbsp;8.10.&nbsp;Introducing <tt class="function">locals</tt></h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def foo(arg):</span> <a name="dialect.locals.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">x = 1</span>
<tt class="prompt">...     </tt><span class="userinput">print locals()</span>
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">foo(7)</span>        <a name="dialect.locals.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">{'arg': 7, 'x': 1}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">foo('bar')</span>    <a name="dialect.locals.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">{'arg': 'bar', 'x': 1}</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The function <tt class="function">foo</tt> has two variables in its local namespace: <tt class="varname">arg</tt>, whose value is passed in to the function, and <tt class="varname">x</tt>, which is defined within the function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">locals</tt> returns a dictionary of name/value pairs.  The keys of this dictionary are the names of the variables as strings; the values
                              of the dictionary are the actual values of the variables.  So calling <tt class="function">foo</tt> with <tt class="literal">7</tt> prints the dictionary containing the function's two local variables: <tt class="varname">arg</tt> (<tt class="literal">7</tt>) and <tt class="varname">x</tt> (<tt class="constant">1</tt>).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember, <span class="application">Python</span> has dynamic typing, so you could just as easily pass a string in for <tt class="varname">arg</tt>; the function (and the call to <tt class="function">locals</tt>) would still work just as well.  <tt class="function">locals</tt> works with all variables of all datatypes.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>What <tt class="function">locals</tt> does for the local (function) namespace, <tt class="function">globals</tt> does for the global (module) namespace.  <tt class="function">globals</tt> is more exciting, though, because a module's namespace is more exciting.<sup>[<a name="d0e21226" href="#ftn.d0e21226">3</a>]</sup>  Not only does the module's namespace include module-level variables and constants, it includes all the functions and classes
                  defined in the module.  Plus, it includes anything that was imported into the module.
               </p>
               <p>Remember the difference between <a href="#fileinfo.fromimport" title="5.2.&nbsp;Importing Modules Using from module import"><tt class="literal">from <i class="replaceable">module</i> import</tt></a> and <a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string"><tt class="literal">import <i class="replaceable">module</i></tt></a>?  With <tt class="literal">import <i class="replaceable">module</i></tt>, the module itself is imported, but it retains its own namespace, which is why you need to use the module name to access
                  any of its functions or attributes: <tt class="literal"><i class="replaceable">module</i>.<i class="replaceable">function</i></tt>.  But with <tt class="literal">from <i class="replaceable">module</i> import</tt>, you're actually importing specific functions and attributes from another module into your own namespace, which is why you
                  access them directly without referencing the original module they came from.  With the <tt class="function">globals</tt> function, you can actually see this happen.
               </p>
               <div class="example"><a name="dialect.globals.example"></a><h3 class="title">Example&nbsp;8.11.&nbsp;Introducing <tt class="function">globals</tt></h3>
                  <p>Look at the following block of code at the bottom of <tt class="filename">BaseHTMLProcessor.py</tt>:
                  </p><pre class="programlisting">
if __name__ == "__main__":
    for k, v in globals().items():             <a name="dialect.locals.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        print k, "=", v</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Just so you don't get intimidated, remember that you've seen all this before.  The <tt class="function">globals</tt> function returns a dictionary, and you're <a href="#dictionaryiter.example" title="Example&nbsp;6.10.&nbsp;Iterating Through a Dictionary">iterating through the dictionary</a> using the <tt class="function">items</tt> method and <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">multi-variable assignment</a>.  The only thing new here is the <tt class="function">globals</tt> function.
                           </td>
                        </tr>
                     </table>
                  </div>
                  <p>Now running the script from the command line gives this output (note that your output may be slightly different, depending
                     on your platform and where you installed <span class="application">Python</span>):
                  </p><pre class="screen"><tt class="prompt">c:\docbook\dip\py&gt;</tt> <span class="userinput">python BaseHTMLProcessor.py</span></pre><pre class="programlisting">
SGMLParser = sgmllib.SGMLParser                <a name="dialect.locals.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
htmlentitydefs = &lt;module 'htmlentitydefs' from 'C:\Python23\lib\htmlentitydefs.py'&gt; <a name="dialect.locals.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
BaseHTMLProcessor = __main__.BaseHTMLProcessor <a name="dialect.locals.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
__name__ = __main__                            <a name="dialect.locals.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
... rest of output omitted for brevity...</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="classname">SGMLParser</tt> was imported from <tt class="filename">sgmllib</tt>, using <tt class="literal">from <i class="replaceable">module</i> import</tt>.  That means that it was imported directly into the module's namespace, and here it is.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Contrast this with <tt class="filename">htmlentitydefs</tt>, which was imported using <tt class="literal">import</tt>.  That means that the <tt class="filename">htmlentitydefs</tt> module itself is in the namespace, but the <tt class="varname">entitydefs</tt> variable defined within <tt class="filename">htmlentitydefs</tt> is not.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This module only defines one class, <tt class="classname">BaseHTMLProcessor</tt>, and here it is.  Note that the value here is <a href="#fileinfo.classattributes.intro" title="Example&nbsp;5.17.&nbsp;Introducing Class Attributes">the class itself</a>, not a specific instance of the class.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember the <a href="#odbchelper.ifnametrick"><tt class="literal">if <span class="literal">__name__</span></tt> trick</a>?  When running a module (as opposed to importing it from another module), the built-in <tt class="literal">__name__</tt> attribute is a special value, <tt class="literal">__main__</tt>.  Since you ran this module as a script from the command line, <tt class="literal">__name__</tt> is <tt class="literal">__main__</tt>, which is why the little test code to print the <tt class="function">globals</tt> got executed.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="tip.localsbyname"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Using the <tt class="function">locals</tt> and <tt class="function">globals</tt> functions, you can get the value of arbitrary variables dynamically, providing the variable name as a string.  This mirrors
                        the functionality of the <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr"><tt class="function">getattr</tt></a> function, which allows you to access arbitrary functions dynamically by providing the function name as a string.
                     </td>
                  </tr>
               </table>
               <p>There is one other important difference between the <tt class="function">locals</tt> and <tt class="function">globals</tt> functions, which you should learn now before it bites you.  It will bite you anyway, but at least then you'll remember learning
                  it.
               </p>
               <div class="example"><a name="dialect.locals.readonly.example"></a><h3 class="title">Example&nbsp;8.12.&nbsp;<tt class="function">locals</tt> is read-only, <tt class="function">globals</tt> is not
                  </h3><pre class="programlisting">
def foo(arg):
    x = 1
    print locals()    <a name="dialect.locals.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    locals()["x"] = 2 <a name="dialect.locals.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    print "x=",x      <a name="dialect.locals.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">

z = 7
print "z=",z
foo(3)
globals()["z"] = 8    <a name="dialect.locals.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
print "z=",z          <a name="dialect.locals.4.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since <tt class="function">foo</tt> is called with <tt class="literal">3</tt>, this will print <tt class="literal">{'arg': 3, 'x': 1}</tt>.  This should not be a surprise.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">locals</tt> is a function that returns a dictionary, and here you are setting a value in that dictionary.  You might think that this
                              would change the value of the local variable <tt class="varname">x</tt> to <tt class="literal">2</tt>, but it doesn't.  <tt class="function">locals</tt> does not actually return the local namespace, it returns a copy.  So changing it does nothing to the value of the variables
                              in the local namespace.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This prints <tt class="literal">x= 1</tt>, not <tt class="literal">x= 2</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">After being burned by <tt class="function">locals</tt>, you might think that this <span class="emphasis"><em>wouldn't</em></span> change the value of <tt class="varname">z</tt>, but it does.  Due to internal differences in how <span class="application">Python</span> is implemented (which I'd rather not go into, since I don't fully understand them myself), <tt class="function">globals</tt> returns the actual global namespace, not a copy: the exact opposite behavior of <tt class="function">locals</tt>.  So any changes to the dictionary returned by <tt class="function">globals</tt> directly affect your global variables.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.locals.4.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This prints <tt class="literal">z= 8</tt>, not <tt class="literal">z= 7</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.dictsub"></a>8.6.&nbsp;Dictionary-based string formatting
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>Why did you learn about <tt class="function">locals</tt> and <tt class="function">globals</tt>?  So you can learn about dictionary-based string formatting.  As you recall, <a href="#odbchelper.stringformatting" title="3.5.&nbsp;Formatting Strings">regular string formatting</a> provides an easy way to insert values into strings.  Values are listed in a tuple and inserted in order into the string in
                  place of each formatting marker.  While this is efficient, it is not always the easiest code to read, especially when multiple
                  values are being inserted.  You can't simply scan through the string in one pass and understand what the result will be; you're
                  constantly switching between reading the string and reading the tuple of values.
               </p>
               <div class="abstract">
                  <p>There is an alternative form of string formatting that uses dictionaries instead of tuples of values.</p>
               </div>
               <div class="example"><a name="d0e21518"></a><h3 class="title">Example&nbsp;8.13.&nbsp;Introducing dictionary-based string formatting</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params = {"server":"mpilgrim", "database":"master", "uid":"sa", "pwd":"secret"}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">"%(pwd)s" % params</span>                                    <a name="dialect.dictsub.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'secret'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">"%(pwd)s is not a good password for %(uid)s" % params</span> <a name="dialect.dictsub.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'secret is not a good password for sa'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">"%(database)s of mind, %(database)s of body" % params</span> <a name="dialect.dictsub.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'master of mind, master of body'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dictsub.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Instead of a tuple of explicit values, this form of string formatting uses a dictionary, <tt class="varname">params</tt>.  And instead of a simple <tt class="literal">%s</tt> marker in the string, the marker contains a name in parentheses.  This name is used as a key in the <tt class="varname">params</tt> dictionary and subsitutes the corresponding value, <tt class="literal">secret</tt>, in place of the <tt class="literal">%(pwd)s</tt> marker.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dictsub.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Dictionary-based string formatting works with any number of named keys.  Each key must exist in the given dictionary, or the
                              formatting will fail with a <tt class="errorcode">KeyError</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dictsub.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can even specify the same key twice; each occurrence will be replaced with the same value.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So why would you use dictionary-based string formatting?  Well, it does seem like overkill to set up a dictionary of keys
                  and values simply to do string formatting in the next line; it's really most useful when you happen to have a dictionary of
                  meaningful keys and values already.  Like <a href="#dialect.locals" title="8.5.&nbsp;locals and globals"><tt class="function">locals</tt></a>.
               </p>
               <div class="example"><a name="dialect.unknownstarttag"></a><h3 class="title">Example&nbsp;8.14.&nbsp;Dictionary-based string formatting in <tt class="filename">BaseHTMLProcessor.py</tt></h3><pre class="programlisting">
    def handle_comment(self, text):        
        self.pieces.append("&lt;!--%(text)s--&gt;" % locals()) <a name="dialect.dictsub.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dictsub.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using the built-in <tt class="function">locals</tt> function is the most common use of dictionary-based string formatting.  It means that you can use the names of local variables
                              within your string (in this case, <tt class="varname">text</tt>, which was passed to the class method as an argument) and each named variable will be replaced by its value.  If <tt class="varname">text</tt> is <tt class="literal">'Begin page footer'</tt>, the string formatting <tt class="literal">"&lt;!--%(text)s--&gt;" % locals()</tt> will resolve to the string <tt class="literal">'&lt;!--Begin page footer--&gt;'</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e21622"></a><h3 class="title">Example&nbsp;8.15.&nbsp;More dictionary-based string formatting</h3><pre class="programlisting">
    def unknown_starttag(self, tag, attrs):
        strattrs = "".join([' %s="%s"' % (key, value) for key, value in attrs]) <a name="dialect.dictsub.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        self.pieces.append("&lt;%(tag)s%(strattrs)s&gt;" % locals())                      <a name="dialect.dictsub.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dictsub.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When this method is called, <tt class="varname">attrs</tt> is a list of key/value tuples, just like the <a href="#odbchelper.items" title="Example&nbsp;3.25.&nbsp;The keys, values, and items Functions"><tt class="function">items</tt> of a dictionary</a>, which means you can use <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">multi-variable assignment</a> to iterate through it.  This should be a familiar pattern by now, but there's a lot going on here, so let's break it down:
                              <div class="orderedlist">
                                 <ol type="a">
                                    <li>Suppose <tt class="varname">attrs</tt> is <tt class="literal">[('href', 'index.html'), ('title', 'Go to home page')]</tt>.
                                    </li>
                                    <li>In the first round of the list comprehension, <tt class="varname">key</tt> will get <tt class="literal">'href'</tt>, and <tt class="varname">value</tt> will get <tt class="literal">'index.html'</tt>.
                                    </li>
                                    <li>The string formatting <tt class="literal">'&nbsp;%s="%s"' % (key, value)</tt> will resolve to <tt class="literal">'&nbsp;href="index.html"'</tt>.  This string becomes the first element of the list comprehension's return value.
                                    </li>
                                    <li>In the second round, <tt class="varname">key</tt> will get <tt class="literal">'title'</tt>, and <tt class="varname">value</tt> will get <tt class="literal">'Go to home page'</tt>.
                                    </li>
                                    <li>The string formatting will resolve to <tt class="literal">' title="Go to home page"'</tt>.
                                    </li>
                                    <li>The list comprehension returns a list of these two resolved strings, and <tt class="varname">strattrs</tt> will join both elements of this list together to form <tt class="literal">'&nbsp;href="index.html" title="Go to home page"'</tt>.
                                    </li>
                                 </ol>
                              </div>
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dictsub.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now, using dictionary-based string formatting, you insert the value of <tt class="varname">tag</tt> and <tt class="varname">strattrs</tt> into a string.  So if <tt class="varname">tag</tt> is <tt class="literal">'a'</tt>, the final result would be <tt class="literal">'&lt;a href="index.html" title="Go to home page"&gt;'</tt>, and that is what gets appended to <tt class="varname">self.pieces</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e21731"></a><table class="important" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Using dictionary-based string formatting with <tt class="function">locals</tt> is a convenient way of making complex string formatting expressions more readable, but it comes with a price.  There is a
                        slight performance hit in making the call to <tt class="function">locals</tt>, since <a href="#dialect.locals.readonly.example" title="Example&nbsp;8.12.&nbsp;locals is read-only, globals is not"><tt class="function">locals</tt> builds a copy</a> of the local namespace.
                     </td>
                  </tr>
               </table>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.quoting"></a>8.7.&nbsp;Quoting attribute values
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>A common question on <a href="http://groups.google.com/groups?group=comp.lang.python">comp.lang.python</a> is &#8220;<span class="quote">I have a bunch of <span class="acronym">HTML</span> documents with unquoted attribute values, and I want to properly quote them all.  How can I do this?</span>&#8221;<sup>[<a name="d0e21764" href="#ftn.d0e21764">4</a>]</sup>  (This is generally precipitated by a project manager who has found the <span class="acronym">HTML</span>-is-a-standard religion joining a large project and proclaiming that all pages must validate against an <span class="acronym">HTML</span> validator.  Unquoted attribute values are a common violation of the <span class="acronym">HTML</span> standard.)  Whatever the reason, unquoted attribute values are easy to fix by feeding <span class="acronym">HTML</span> through <tt class="classname">BaseHTMLProcessor</tt>.
                  </p>
               </div>
               <p><tt class="classname">BaseHTMLProcessor</tt> consumes <span class="acronym">HTML</span> (since it's descended from <tt class="classname">SGMLParser</tt>) and produces equivalent <span class="acronym">HTML</span>, but the <span class="acronym">HTML</span> output is not identical to the input.  Tags and attribute names will end up in lowercase, even if they started in uppercase
                  or mixed case, and attribute values will be enclosed in double quotes, even if they started in single quotes or with no quotes
                  at all.  It is this last side effect that you can take advantage of.
               </p>
               <div class="example"><a name="dialect.quoting.example"></a><h3 class="title">Example&nbsp;8.16.&nbsp;Quoting attribute values</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">htmlSource = """</span>        <a name="dialect.basehtml.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt>&lt;html&gt;
<tt class="prompt">...     </tt>&lt;head&gt;
<tt class="prompt">...     </tt>&lt;title&gt;Test page&lt;/title&gt;
<tt class="prompt">...     </tt>&lt;/head&gt;
<tt class="prompt">...     </tt>&lt;body&gt;
<tt class="prompt">...     </tt>&lt;ul&gt;
<tt class="prompt">...     </tt>&lt;li&gt;&lt;a href=index.html&gt;Home&lt;/a&gt;&lt;/li&gt;
<tt class="prompt">...     </tt>&lt;li&gt;&lt;a href=toc.html&gt;Table of contents&lt;/a&gt;&lt;/li&gt;
<tt class="prompt">...     </tt>&lt;li&gt;&lt;a href=history.html&gt;Revision history&lt;/a&gt;&lt;/li&gt;
<tt class="prompt">...     </tt>&lt;/body&gt;
<tt class="prompt">...     </tt>&lt;/html&gt;
<tt class="prompt">...     </tt><span class="userinput">"""</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from BaseHTMLProcessor import BaseHTMLProcessor</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">parser = BaseHTMLProcessor()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">parser.feed(htmlSource)</span> <a name="dialect.basehtml.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print parser.output()</span>   <a name="dialect.basehtml.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Test page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="index.html"&gt;Home&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="toc.html"&gt;Table of contents&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="history.html"&gt;Revision history&lt;/a&gt;&lt;/li&gt;
&lt;/body&gt;
&lt;/html&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that the attribute values of the <tt class="literal">href</tt> attributes in the <tt class="sgmltag-element">&lt;a&gt;</tt> tags are not properly quoted.  (Also note that you're using <a href="#odbchelper.triplequotes" title="Example&nbsp;2.2.&nbsp;Defining the buildConnectionString Function's doc string">triple quotes</a> for something other than a <tt class="literal">doc string</tt>.  And directly in the <span class="acronym">IDE</span>, no less.  They're very useful.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Feed the parser.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.basehtml.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using the <tt class="function">output</tt> function defined in <tt class="classname">BaseHTMLProcessor</tt>, you get the output as a single string, complete with quoted attribute values.  While this may seem anti-climactic, think
                              about how much has actually happened here: <tt class="classname">SGMLParser</tt> parsed the entire <span class="acronym">HTML</span> document, breaking it down into tags, refs, data, and so forth; <tt class="classname">BaseHTMLProcessor</tt> used those elements to reconstruct pieces of <span class="acronym">HTML</span> (which are still stored in <tt class="varname">parser.pieces</tt>, if you want to see them); finally, you called <tt class="function">parser.output</tt>, which joined all the pieces of <span class="acronym">HTML</span> into one string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.dialectizer"></a>8.8.&nbsp;Introducing <tt class="filename">dialect.py</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><tt class="classname">Dialectizer</tt> is a simple (and silly) descendant of <tt class="classname">BaseHTMLProcessor</tt>.  It runs blocks of text through a series of substitutions, but it makes sure that anything within a <tt class="literal"><tt class="sgmltag-element">&lt;pre&gt;</tt>...<tt class="sgmltag-element">&lt;/pre&gt;</tt></tt> block passes through unaltered.
                  </p>
               </div>
               <p>To handle the <tt class="sgmltag-element">&lt;pre&gt;</tt> blocks, you define two methods in <tt class="classname">Dialectizer</tt>: <tt class="function">start_pre</tt> and <tt class="function">end_pre</tt>.
               </p>
               <div class="example"><a name="dialect.specifictags.example"></a><h3 class="title">Example&nbsp;8.17.&nbsp;Handling specific tags</h3><pre class="programlisting">
    def start_pre(self, attrs):             <a name="dialect.dialectizer.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        self.verbatim += 1                  <a name="dialect.dialectizer.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        self.unknown_starttag("pre", attrs) <a name="dialect.dialectizer.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">

    def end_pre(self):                      <a name="dialect.dialectizer.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        self.unknown_endtag("pre")          <a name="dialect.dialectizer.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
        self.verbatim -= 1                  <a name="dialect.dialectizer.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">start_pre</tt> is called every time <tt class="classname">SGMLParser</tt> finds a <tt class="sgmltag-element">&lt;pre&gt;</tt> tag in the <span class="acronym">HTML</span> source.  (In a minute, you'll see exactly how this happens.)  The method takes a single parameter, <tt class="varname">attrs</tt>, which contains the attributes of the tag (if any).  <tt class="varname">attrs</tt> is a list of key/value tuples, just like <a href="#dialect.unknownstarttag" title="Example&nbsp;8.14.&nbsp;Dictionary-based string formatting in BaseHTMLProcessor.py"><tt class="function">unknown_starttag</tt></a> takes.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In the <tt class="function">reset</tt> method, you initialize a data attribute that serves as a counter for <tt class="sgmltag-element">&lt;pre&gt;</tt> tags.  Every time you hit a <tt class="sgmltag-element">&lt;pre&gt;</tt> tag, you increment the counter; every time you hit a <tt class="sgmltag-element">&lt;/pre&gt;</tt> tag, you'll decrement the counter.  (You could just use this as a flag and set it to <tt class="constant">1</tt> and reset it to <tt class="constant">0</tt>, but it's just as easy to do it this way, and this handles the odd (but possible) case of nested <tt class="sgmltag-element">&lt;pre&gt;</tt> tags.)  In a minute, you'll see how this counter is put to good use.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">That's it, that's the only special processing you do for <tt class="sgmltag-element">&lt;pre&gt;</tt> tags.  Now you pass the list of attributes along to <tt class="function">unknown_starttag</tt> so it can do the default processing.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">end_pre</tt> is called every time <tt class="classname">SGMLParser</tt> finds a <tt class="sgmltag-element">&lt;/pre&gt;</tt> tag.  Since end tags can not contain attributes, the method takes no parameters.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First, you want to do the default processing, just like any other end tag.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Second, you decrement your counter to signal that this <tt class="sgmltag-element">&lt;pre&gt;</tt> block has been closed.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>At this point, it's worth digging a little further into <tt class="classname">SGMLParser</tt>.  I've claimed repeatedly (and you've taken it on faith so far) that <tt class="classname">SGMLParser</tt> looks for and calls specific methods for each tag, if they exist.  For instance, you just saw the definition of <tt class="function">start_pre</tt> and <tt class="function">end_pre</tt> to handle <tt class="sgmltag-element">&lt;pre&gt;</tt> and <tt class="sgmltag-element">&lt;/pre&gt;</tt>.  But how does this happen?  Well, it's not magic, it's just good <span class="application">Python</span> coding.
               </p>
               <div class="example"><a name="dialect.dialectizer.example"></a><h3 class="title">Example&nbsp;8.18.&nbsp;<tt class="classname">SGMLParser</tt></h3><pre class="programlisting">
    def finish_starttag(self, tag, attrs):               <a name="dialect.dialectizer.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        try:                                            
            method = getattr(self, 'start_' + tag)       <a name="dialect.dialectizer.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        except AttributeError:                           <a name="dialect.dialectizer.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
            try:                                        
                method = getattr(self, 'do_' + tag)      <a name="dialect.dialectizer.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
            except AttributeError:                      
                self.unknown_starttag(tag, attrs)        <a name="dialect.dialectizer.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
                return -1                               
            else:                                       
                self.handle_starttag(tag, method, attrs) <a name="dialect.dialectizer.2.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
                return 0                                
        else:                                           
            self.stack.append(tag)                      
            self.handle_starttag(tag, method, attrs)    
            return 1                                     <a name="dialect.dialectizer.2.7"></a><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12">

    def handle_starttag(self, tag, method, attrs):      
        method(attrs)                                    <a name="dialect.dialectizer.2.8"></a><img src="images/callouts/8.png" alt="8" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">At this point, <tt class="classname">SGMLParser</tt> has already found a start tag and parsed the attribute list.  The only thing left to do is figure out whether there is a
                              specific handler method for this tag, or whether you should fall back on the default method (<tt class="function">unknown_starttag</tt>).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The &#8220;<span class="quote">magic</span>&#8221; of <tt class="classname">SGMLParser</tt> is nothing more than your old friend, <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr"><tt class="function">getattr</tt></a>.  What you may not have realized before is that <tt class="function">getattr</tt> will find methods defined in descendants of an object as well as the object itself.  Here the object is <tt class="literal">self</tt>, the current instance.  So if <tt class="varname">tag</tt> is <tt class="literal">'pre'</tt>, this call to <tt class="function">getattr</tt> will look for a <tt class="function">start_pre</tt> method on the current instance, which is an instance of the <tt class="classname">Dialectizer</tt> class.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">getattr</tt> raises an <tt class="errorcode">AttributeError</tt> if the method it's looking for doesn't exist in the object (or any of its descendants), but that's okay, because you wrapped
                              the call to <tt class="function">getattr</tt> inside a <a href="#fileinfo.exception" title="6.1.&nbsp;Handling Exceptions"><tt class="literal">try...except</tt></a> block and explicitly caught the <tt class="errorcode">AttributeError</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since you didn't find a <tt class="function">start_xxx</tt> method, you'll also look for a <tt class="function">do_xxx</tt> method before giving up.  This alternate naming scheme is generally used for standalone tags, like <tt class="sgmltag-element">&lt;br&gt;</tt>, which have no corresponding end tag.  But you can use either naming scheme; as you can see, <tt class="classname">SGMLParser</tt> tries both for every tag.  (You shouldn't define both a <tt class="function">start_xxx</tt> and <tt class="function">do_xxx</tt> handler method for the same tag, though; only the <tt class="function">start_xxx</tt> method will get called.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Another <tt class="errorcode">AttributeError</tt>, which means that the call to <tt class="function">getattr</tt> failed with <tt class="function">do_xxx</tt>.  Since you found neither a <tt class="function">start_xxx</tt> nor a <tt class="function">do_xxx</tt> method for this tag, you catch the exception and fall back on the default method, <tt class="function">unknown_starttag</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember, <tt class="literal">try...except</tt> blocks can have an <tt class="literal">else</tt> clause, which is called if <a href="#crossplatform.example" title="Example&nbsp;6.2.&nbsp;Supporting Platform-Specific Functionality">no exception is raised</a> during the <tt class="literal">try...except</tt> block.  Logically, that means that you <span class="emphasis"><em>did</em></span> find a <tt class="function">do_xxx</tt> method for this tag, so you're going to call it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.7"><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">By the way, don't worry about these different return values; in theory they mean something, but they're never actually used.
                               Don't worry about the <tt class="literal">self.stack.append(tag)</tt> either; <tt class="classname">SGMLParser</tt> keeps track internally of whether your start tags are balanced by appropriate end tags, but it doesn't do anything with this
                              information either.  In theory, you could use this module to validate that your tags were fully balanced, but it's probably
                              not worth it, and it's beyond the scope of this chapter.  You have better things to worry about right now.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.2.8"><img src="images/callouts/8.png" alt="8" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">start_xxx</tt> and <tt class="function">do_xxx</tt> methods are not called directly; the tag, method, and attributes are passed to this function, <tt class="function">handle_starttag</tt>, so that descendants can override it and change the way <span class="emphasis"><em>all</em></span> start tags are dispatched.  You don't need that level of control, so you just let this method do its thing, which is to call
                              the method (<tt class="function">start_xxx</tt> or <tt class="function">do_xxx</tt>) with the list of attributes.  Remember, <tt class="varname">method</tt> is a function, returned from <tt class="function">getattr</tt>, and functions are objects.  (I know you're getting tired of hearing it, and I promise I'll stop saying it as soon as I run
                              out of ways to use it to my advantage.)  Here, the function object is passed into this dispatch method as an argument, and
                              this method turns around and calls the function.  At this point, you don't need to know what the function is, what it's named,
                              or where it's defined; the only thing you need to know about the function is that it is called with one argument, <tt class="varname">attrs</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now back to our regularly scheduled program: <tt class="classname">Dialectizer</tt>.  When you left, you were in the process of defining specific handler methods for <tt class="sgmltag-element">&lt;pre&gt;</tt> and <tt class="sgmltag-element">&lt;/pre&gt;</tt> tags.  There's only one thing left to do, and that is to process text blocks with the pre-defined substitutions.  For that,
                  you need to override the <tt class="function">handle_data</tt> method.
               </p>
               <div class="example"><a name="d0e22310"></a><h3 class="title">Example&nbsp;8.19.&nbsp;Overriding the <tt class="function">handle_data</tt> method
                  </h3><pre class="programlisting">
    def handle_data(self, text):                                         <a name="dialect.dialectizer.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        self.pieces.append(self.verbatim and text or self.process(text)) <a name="dialect.dialectizer.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">handle_data</tt> is called with only one argument, the text to process.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.dialectizer.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In the ancestor <a href="#dialect.basehtml.intro" title="Example&nbsp;8.8.&nbsp;Introducing BaseHTMLProcessor"><tt class="classname">BaseHTMLProcessor</tt></a>, the <tt class="function">handle_data</tt> method simply appended the text to the output buffer, <tt class="varname">self.pieces</tt>.  Here the logic is only slightly more complicated.  If you're in the middle of a <tt class="literal"><tt class="sgmltag-element">&lt;pre&gt;</tt>...<tt class="sgmltag-element">&lt;/pre&gt;</tt></tt> block, <tt class="varname">self.verbatim</tt> will be some value greater than <tt class="constant">0</tt>, and you want to put the text in the output buffer unaltered.  Otherwise, you will call a separate method to process the
                              substitutions, then put the result of that into the output buffer.  In <span class="application">Python</span>, this is a one-liner, using <a href="#apihelper.andortrick.intro" title="Example&nbsp;4.17.&nbsp;Introducing the and-or Trick">the <tt class="literal">and-or</tt> trick</a>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>You're close to completely understanding <tt class="classname">Dialectizer</tt>.  The only missing link is the nature of the text substitutions themselves.  If you know any <span class="application">Perl</span>, you know that when complex text substitutions are required, the only real solution is regular expressions.  The classes
                  later in <tt class="filename">dialect.py</tt> define a series of regular expressions that operate on the text between the <span class="acronym">HTML</span> tags.  But you just had <a href="#re" title="Chapter&nbsp;7.&nbsp;Regular Expressions">a whole chapter on regular expressions</a>.  You don't really want to slog through regular expressions again, do you?  God knows I don't.  I think you've learned enough
                  for one chapter.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.alltogether"></a>8.9.&nbsp;Putting it all together
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>It's time to put everything you've learned so far to good use.  I hope you were paying attention.</p>
               </div>
               <div class="example"><a name="d0e22387"></a><h3 class="title">Example&nbsp;8.20.&nbsp;The <tt class="function">translate</tt> function, part 1
                  </h3><pre class="programlisting">
def translate(url, dialectName="chef"): <a name="dialect.alltogether.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    import urllib                       <a name="dialect.alltogether.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    sock = urllib.urlopen(url)          <a name="dialect.alltogether.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
    htmlSource = sock.read()           
    sock.close()                       
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">translate</tt> function has an <a href="#apihelper.optional" title="4.2.&nbsp;Using Optional and Named Arguments">optional argument</a> <tt class="varname">dialectName</tt>, which is a string that specifies the dialect you'll be using.  You'll see how this is used in a minute.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Hey, wait a minute, there's an <a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string"><tt class="literal">import</tt></a> statement in this function!  That's perfectly legal in <span class="application">Python</span>.  You're used to seeing <tt class="literal">import</tt> statements at the top of a program, which means that the imported module is available anywhere in the program.  But you can
                              also import modules within a function, which means that the imported module is only available within the function.  If you
                              have a module that is only ever used in one function, this is an easy way to make your code more modular.  (When you find
                              that your weekend hack has turned into an 800-line work of art and decide to split it up into a dozen reusable modules, you'll
                              appreciate this.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you <a href="#dialect.extract.urllib" title="Example&nbsp;8.5.&nbsp;Introducing urllib">get the source of the given URL</a>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e22433"></a><h3 class="title">Example&nbsp;8.21.&nbsp;The <tt class="function">translate</tt> function, part 2: curiouser and curiouser
                  </h3><pre class="programlisting">
    parserName = "%sDialectizer" % dialectName.capitalize() <a name="dialect.alltogether.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    parserClass = globals()[parserName]                     <a name="dialect.alltogether.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    parser = parserClass()                                  <a name="dialect.alltogether.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">capitalize</tt> is a string method you haven't seen before; it simply capitalizes the first letter of a string and forces everything else
                              to lowercase.  Combined with some <a href="#odbchelper.stringformatting" title="3.5.&nbsp;Formatting Strings">string formatting</a>, you've taken the name of a dialect and transformed it into the name of the corresponding Dialectizer class.  If <tt class="varname">dialectName</tt> is the string <tt class="literal">'chef'</tt>, <tt class="varname">parserName</tt> will be the string <tt class="literal">'ChefDialectizer'</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You have the name of a class as a string (<tt class="varname">parserName</tt>), and you have the global namespace as a dictionary (<tt class="function">globals</tt>()).  Combined, you can get a reference to the class which the string names.  (Remember, <a href="#fileinfo.classattributes" title="5.8.&nbsp;Introducing Class Attributes">classes are objects</a>, and they can be assigned to variables just like any other object.)  If <tt class="varname">parserName</tt> is the string <tt class="literal">'ChefDialectizer'</tt>, <tt class="varname">parserClass</tt> will be the class <tt class="literal">ChefDialectizer</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Finally, you have a class object (<tt class="varname">parserClass</tt>), and you want an instance of the class.  Well, you already know how to do that: <a href="#fileinfo.create" title="5.4.&nbsp;Instantiating Classes">call the class like a function</a>.  The fact that the class is being stored in a local variable makes absolutely no difference; you just call the local variable
                              like a function, and out pops an instance of the class.  If <tt class="varname">parserClass</tt> is the class <tt class="literal">ChefDialectizer</tt>, <tt class="varname">parser</tt> will be an instance of the class <tt class="literal">ChefDialectizer</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Why bother?  After all, there are only 3 <tt class="classname">Dialectizer</tt> classes; why not just use a <tt class="function">case</tt> statement?  (Well, there's no <tt class="function">case</tt> statement in <span class="application">Python</span>, but why not just use a series of <tt class="literal">if</tt> statements?)  One reason: extensibility.  The <tt class="function">translate</tt> function has absolutely no idea how many Dialectizer classes you've defined.  Imagine if you defined a new <tt class="classname">FooDialectizer</tt> tomorrow; <tt class="function">translate</tt> would work by passing <tt class="literal">'foo'</tt> as the <tt class="varname">dialectName</tt>.
               </p>
               <p>Even better, imagine putting <tt class="classname">FooDialectizer</tt> in a separate module, and importing it with <tt class="literal">from <i class="replaceable">module</i> import</tt>.  You've already seen that this <a href="#dialect.globals.example" title="Example&nbsp;8.11.&nbsp;Introducing globals">includes it in <tt class="function">globals</tt>()</a>, so <tt class="function">translate</tt> would still work without modification, even though <tt class="classname">FooDialectizer</tt> was in a separate file.
               </p>
               <p>Now imagine that the name of the dialect is coming from somewhere outside the program, maybe from a database or from a user-inputted
                  value on a form.  You can use any number of server-side <span class="application">Python</span> scripting architectures to dynamically generate web pages; this function could take a <span class="acronym">URL</span> and a dialect name (both strings) in the query string of a web page request, and output the &#8220;<span class="quote">translated</span>&#8221; web page.
               </p>
               <p>Finally, imagine a <tt class="classname">Dialectizer</tt> framework with a plug-in architecture.  You could put each <tt class="classname">Dialectizer</tt> class in a separate file, leaving only the <tt class="function">translate</tt> function in <tt class="filename">dialect.py</tt>.  Assuming a consistent naming scheme, the <tt class="function">translate</tt> function could dynamic import the appropiate class from the appropriate file, given nothing but the dialect name.  (You haven't
                  seen dynamic importing yet, but I promise to cover it in a later chapter.)  To add a new dialect, you would simply add an
                  appropriately-named file in the plug-ins directory (like <tt class="filename">foodialect.py</tt> which contains the <tt class="classname">FooDialectizer</tt> class).  Calling the <tt class="function">translate</tt> function with the dialect name <tt class="literal">'foo'</tt> would find the module <tt class="filename">foodialect.py</tt>, import the class <tt class="classname">FooDialectizer</tt>, and away you go.
               </p>
               <div class="example"><a name="d0e22614"></a><h3 class="title">Example&nbsp;8.22.&nbsp;The <tt class="function">translate</tt> function, part 3
                  </h3><pre class="programlisting">
    parser.feed(htmlSource) <a name="dialect.alltogether.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    parser.close()          <a name="dialect.alltogether.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    return parser.output()  <a name="dialect.alltogether.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">After all that imagining, this is going to seem pretty boring, but the <tt class="function">feed</tt> function is what <a href="#dialect.feed.example" title="Example&nbsp;8.7.&nbsp;Using urllister.py">does the entire transformation</a>.  You had the entire <span class="acronym">HTML</span> source in a single string, so you only had to call <tt class="function">feed</tt> once.  However, you can call <tt class="function">feed</tt> as often as you want, and the parser will just keep parsing.  So if you were worried about memory usage (or you knew you
                              were going to be dealing with very large <span class="acronym">HTML</span> pages), you could set this up in a loop, where you read a few bytes of <span class="acronym">HTML</span> and fed it to the parser.  The result would be the same.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Because <tt class="function">feed</tt> maintains an internal buffer, you should always call the parser's <tt class="function">close</tt> method when you're done (even if you fed it all at once, like you did).  Otherwise you may find that your output is missing
                              the last few bytes.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#dialect.alltogether.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember, <tt class="function">output</tt> is the function you defined on <tt class="classname">BaseHTMLProcessor</tt> that <a href="#dialect.output.example" title="Example&nbsp;8.9.&nbsp;BaseHTMLProcessor output">joins all the pieces of output you've buffered</a> and returns them in a single string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>And just like that, you've &#8220;<span class="quote">translated</span>&#8221; a web page, given nothing but a <span class="acronym">URL</span> and the name of a dialect.
               </p>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li>You thought I was kidding about the server-side scripting idea.  So did I, until I found <a href="http://rinkworks.com/dialect/">this web-based dialectizer</a>.  Unfortunately, source code does not appear to be available.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="dialect.summary"></a>8.10.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> provides you with a powerful tool, <tt class="filename">sgmllib.py</tt>, to manipulate <span class="acronym">HTML</span> by turning its structure into an object model.  You can use this tool in many different ways.
                  </p>
               </div>
               <div class="itemizedlist">
                  <ul>
                     <li>parsing the <span class="acronym">HTML</span> looking for something specific
                     </li>
                     <li>aggregating the results, like the <a href="#dialect.extract.links" title="Example&nbsp;8.6.&nbsp;Introducing urllister.py"><span class="acronym">URL</span> lister</a></li>
                     <li>altering the structure along the way, like the <a href="#dialect.quoting.example" title="Example&nbsp;8.16.&nbsp;Quoting attribute values">attribute quoter</a></li>
                     <li>transforming the <span class="acronym">HTML</span> into something else by manipulating the text while leaving the tags alone, like the <a href="#dialect.dialectizer" title="8.8.&nbsp;Introducing dialect.py"><tt class="classname">Dialectizer</tt></a></li>
                  </ul>
               </div>
               <p>Along with these examples, you should be comfortable doing all of the following things:</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Using <a href="#dialect.locals" title="8.5.&nbsp;locals and globals"><tt class="function">locals</tt>() and <tt class="function">globals</tt>()</a> to access namespaces
                     </li>
                     <li><a href="#dialect.dictsub" title="8.6.&nbsp;Dictionary-based string formatting">Formatting strings</a> using dictionary-based substitutions
                     </li>
                  </ul>
               </div>
            </div>
            <div class="footnotes"><br><hr width="100" align="left">
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e20503" href="#d0e20503">1</a>] </sup>The technical term for a parser like <tt class="classname">SGMLParser</tt> is a <span class="emphasis"><em>consumer</em></span>: it consumes <span class="acronym">HTML</span> and breaks it down.  Presumably, the name <tt class="function">feed</tt> was chosen to fit into the whole &#8220;<span class="quote">consumer</span>&#8221; motif.  Personally, it makes me think of an exhibit in the zoo where there's just a dark cage with no trees or plants or
                     evidence of life of any kind, but if you stand perfectly still and look really closely you can make out two beady eyes staring
                     back at you from the far left corner, but you convince yourself that that's just your mind playing tricks on you, and the
                     only way you can tell that the whole thing isn't just an empty cage is a small innocuous sign on the railing that reads, &#8220;<span class="quote">Do not feed the parser.</span>&#8221;  But maybe that's just me.  In any event, it's an interesting mental image.
                  </p>
               </div>
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e20702" href="#d0e20702">2</a>] </sup>The reason <span class="application">Python</span> is better at lists than strings is that lists are mutable but strings are immutable.  This means that appending to a list
                     just adds the element and updates the index.  Since strings can not be changed after they are created, code like <tt class="literal">s = s + newpiece</tt> will create an entirely new string out of the concatenation of the original and the new piece, then throw away the original
                     string.  This involves a lot of expensive memory management, and the amount of effort involved increases as the string gets
                     longer, so doing <tt class="literal">s = s + newpiece</tt> in a loop is deadly.  In technical terms, appending <tt class="varname">n</tt> items to a list is <tt class="literal">O(n)</tt>, while appending <tt class="varname">n</tt> items to a string is <tt class="literal">O(n<sup>2</sup>)</tt>.
                  </p>
               </div>
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e21226" href="#d0e21226">3</a>] </sup>I don't get out much.
                  </p>
               </div>
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e21764" href="#d0e21764">4</a>] </sup>All right, it's not that common a question.  It's not up there with &#8220;<span class="quote">What editor should I use to write <span class="application">Python</span> code?</span>&#8221; (answer: <span class="application">Emacs</span>) or &#8220;<span class="quote">Is <span class="application">Python</span> better or worse than <span class="application">Perl</span>?</span>&#8221; (answer: &#8220;<span class="quote"><span class="application">Perl</span> is worse than <span class="application">Python</span> because people wanted it worse.</span>&#8221; -Larry Wall, 10/14/1998)  But questions about <span class="acronym">HTML</span> processing pop up in one form or another about once a month, and among those questions, this is a popular one.
                  </p>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="kgp"></a>Chapter&nbsp;9.&nbsp;<span class="acronym">XML</span> Processing
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.divein"></a>9.1.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>These next two chapters are about <span class="acronym">XML</span> processing in <span class="application">Python</span>.  It would be helpful if you already knew what an <span class="acronym">XML</span> document looks like, that it's made up of structured tags to form a hierarchy of elements, and so on.  If this doesn't make
                  sense to you, there are <a href="http://directory.google.com/Top/Computers/Data_Formats/Markup_Languages/XML/Resources/FAQs,_Help,_and_Tutorials/">many <span class="acronym">XML</span> tutorials</a> that can explain the basics.
               </p>
               <p>If you're not particularly interested in XML, you should still read these chapters, which cover important topics like <span class="application">Python</span> packages, Unicode, command line arguments, and how to use <tt class="function">getattr</tt> for method dispatching.
               </p>
               <p>Being a philosophy major is not required, although if you have ever had the misfortune of being subjected to the writings
                  of Immanuel Kant, you will appreciate the example program a lot more than if you majored in something useful, like computer
                  science.
               </p>
               <div class="abstract">
                  <p>There are two basic ways to work with <span class="acronym">XML</span>.  One is called <span class="acronym">SAX</span> (&#8220;<span class="quote">Simple <span class="acronym">API</span> for <span class="acronym">XML</span></span>&#8221;), and it works by reading the <span class="acronym">XML</span> a little bit at a time and calling a method for each element it finds.  (If you read <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">Chapter&nbsp;8, <i>HTML Processing</i></a>, this should sound familiar, because that's how the <tt class="filename">sgmllib</tt> module works.)  The other is called <span class="acronym">DOM</span> (&#8220;<span class="quote">Document Object Model</span>&#8221;), and it works by reading in the entire <span class="acronym">XML</span> document at once and creating an internal representation of it using native <span class="application">Python</span> classes linked in a tree structure.  <span class="application">Python</span> has standard modules for both kinds of parsing, but this chapter will only deal with using the <span class="acronym">DOM</span>.
                  </p>
               </div>
               <p>The following is a complete <span class="application">Python</span> program which generates pseudo-random output based on a context-free grammar defined in an <span class="acronym">XML</span> format.  Don't worry yet if you don't understand what that means; you'll examine both the program's input and its output
                  in more depth throughout these next two chapters.
               </p>
               <div class="example"><a name="d0e22845"></a><h3 class="title">Example&nbsp;9.1.&nbsp;<tt class="filename">kgp.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Kant Generator for Python

Generates mock philosophy based on a context-free grammar

Usage: python kgp.py [options] [source]

Options:
  -g ..., --grammar=...   use specified grammar file or URL
  -h, --help              show this help
  -d                      show debugging information while parsing

Examples:
  kgp.py                  generates several paragraphs of Kantian philosophy
  kgp.py -g husserl.xml   generates several paragraphs of Husserl
  kpg.py "&lt;xref id='paragraph'/&gt;"  generates a paragraph of Kant
  kgp.py template.xml     reads from template.xml to decide what to generate
"""
from xml.dom import minidom
import random
import toolbox
import sys
import getopt

_debug = 0

class NoSourceError(Exception): pass

class KantGenerator:
    """generates mock philosophy based on a context-free grammar"""

    def __init__(self, grammar, source=None):
        self.loadGrammar(grammar)
        self.loadSource(source and source or self.getDefaultSource())
        self.refresh()

    def _load(self, source):
        """load XML input source, return parsed XML document

        - a URL of a remote XML file ("http://diveintopython.org/kant.xml")
        - a filename of a local XML file ("~/diveintopython/common/py/kant.xml")
        - standard input ("-")
        - the actual XML document, as a string
        """
        sock = toolbox.openAnything(source)
        xmldoc = minidom.parse(sock).documentElement
        sock.close()
        return xmldoc

    def loadGrammar(self, grammar):                         
        """load context-free grammar"""                     
        self.grammar = self._load(grammar)                  
        self.refs = {}                                      
        for ref in self.grammar.getElementsByTagName("ref"):
            self.refs[ref.attributes["id"].value] = ref     

    def loadSource(self, source):
        """load source"""
        self.source = self._load(source)

    def getDefaultSource(self):
        """guess default source of the current grammar
        
        The default source will be one of the &lt;ref&gt;s that is not
        cross-referenced.  This sounds complicated but it's not.
        Example: The default source for kant.xml is
        "&lt;xref id='section'/&gt;", because 'section' is the one &lt;ref&gt;
        that is not &lt;xref&gt;'d anywhere in the grammar.
        In most grammars, the default source will produce the
        longest (and most interesting) output.
        """
        xrefs = {}
        for xref in self.grammar.getElementsByTagName("xref"):
            xrefs[xref.attributes["id"].value] = 1
        xrefs = xrefs.keys()
        standaloneXrefs = [e for e in self.refs.keys() if e not in xrefs]
        if not standaloneXrefs:
            raise NoSourceError, "can't guess source, and no source specified"
        return '&lt;xref id="%s"/&gt;' % random.choice(standaloneXrefs)
        
    def reset(self):
        """reset parser"""
        self.pieces = []
        self.capitalizeNextWord = 0

    def refresh(self):
        """reset output buffer, re-parse entire source file, and return output
        
        Since parsing involves a good deal of randomness, this is an
        easy way to get new output without having to reload a grammar file
        each time.
        """
        self.reset()
        self.parse(self.source)
        return self.output()

    def output(self):
        """output generated text"""
        return "".join(self.pieces)

    def randomChildElement(self, node):
        """choose a random child element of a node
        
        This is a utility method used by do_xref and do_choice.
        """
        choices = [e for e in node.childNodes
                   if e.nodeType == e.ELEMENT_NODE]
        chosen = random.choice(choices)            
        if _debug:                                 
            sys.stderr.write('%s available choices: %s\n' % \
                (len(choices), [e.toxml() for e in choices]))
            sys.stderr.write('Chosen: %s\n' % chosen.toxml())
        return chosen                              

    def parse(self, node):         
        """parse a single XML node
        
        A parsed XML document (from minidom.parse) is a tree of nodes
        of various types.  Each node is represented by an instance of the
        corresponding Python class (Element for a tag, Text for
        text data, Document for the top-level document).  The following
        statement constructs the name of a class method based on the type
        of node we're parsing ("parse_Element" for an Element node,
        "parse_Text" for a Text node, etc.) and then calls the method.
        """
        parseMethod = getattr(self, "parse_%s" % node.__class__.__name__)
        parseMethod(node)

    def parse_Document(self, node):
        """parse the document node
        
        The document node by itself isn't interesting (to us), but
        its only child, node.documentElement, is: it's the root node
        of the grammar.
        """
        self.parse(node.documentElement)

    def parse_Text(self, node):    
        """parse a text node
        
        The text of a text node is usually added to the output buffer
        verbatim.  The one exception is that &lt;p class='sentence'&gt; sets
        a flag to capitalize the first letter of the next word.  If
        that flag is set, we capitalize the text and reset the flag.
        """
        text = node.data
        if self.capitalizeNextWord:
            self.pieces.append(text[0].upper())
            self.pieces.append(text[1:])
            self.capitalizeNextWord = 0
        else:
            self.pieces.append(text)

    def parse_Element(self, node): 
        """parse an element
        
        An XML element corresponds to an actual tag in the source:
        &lt;xref id='...'&gt;, &lt;p chance='...'&gt;, &lt;choice&gt;, etc.
        Each element type is handled in its own method.  Like we did in
        parse(), we construct a method name based on the name of the
        element ("do_xref" for an &lt;xref&gt; tag, etc.) and
        call the method.
        """
        handlerMethod = getattr(self, "do_%s" % node.tagName)
        handlerMethod(node)

    def parse_Comment(self, node):
        """parse a comment
        
        The grammar can contain XML comments, but we ignore them
        """
        pass
    
    def do_xref(self, node):
        """handle &lt;xref id='...'&gt; tag
        
        An &lt;xref id='...'&gt; tag is a cross-reference to a &lt;ref id='...'&gt;
        tag.  &lt;xref id='sentence'/&gt; evaluates to a randomly chosen child of
        &lt;ref id='sentence'&gt;.
        """
        id = node.attributes["id"].value
        self.parse(self.randomChildElement(self.refs[id]))

    def do_p(self, node):
        """handle &lt;p&gt; tag
        
        The &lt;p&gt; tag is the core of the grammar.  It can contain almost
        anything: freeform text, &lt;choice&gt; tags, &lt;xref&gt; tags, even other
        &lt;p&gt; tags.  If a "class='sentence'" attribute is found, a flag
        is set and the next word will be capitalized.  If a "chance='X'"
        attribute is found, there is an X% chance that the tag will be
        evaluated (and therefore a (100-X)% chance that it will be
        completely ignored)
        """
        keys = node.attributes.keys()
        if "class" in keys:
            if node.attributes["class"].value == "sentence":
                self.capitalizeNextWord = 1
        if "chance" in keys:
            chance = int(node.attributes["chance"].value)
            doit = (chance &gt; random.randrange(100))
        else:
            doit = 1
        if doit:
            for child in node.childNodes: self.parse(child)

    def do_choice(self, node):
        """handle &lt;choice&gt; tag
        
        A &lt;choice&gt; tag contains one or more &lt;p&gt; tags.  One &lt;p&gt; tag
        is chosen at random and evaluated; the rest are ignored.
        """
        self.parse(self.randomChildElement(node))

def usage():
    print __doc__

def main(argv):                         
    grammar = "kant.xml"                
    try:                                
        opts, args = getopt.getopt(argv, "hg:d", ["help", "grammar="])
    except getopt.GetoptError:          
        usage()                         
        sys.exit(2)                     
    for opt, arg in opts:               
        if opt in ("-h", "--help"):     
            usage()                     
            sys.exit()                  
        elif opt == '-d':               
            global _debug               
            _debug = 1                  
        elif opt in ("-g", "--grammar"):
            grammar = arg               
    
    source = "".join(args)              

    k = KantGenerator(grammar, source)
    print k.output()

if __name__ == "__main__":
    main(sys.argv[1:])
</pre></div>
               <div class="example"><a name="d0e22856"></a><h3 class="title">Example&nbsp;9.2.&nbsp;<tt class="filename">toolbox.py</tt></h3><pre class="programlisting">
"""Miscellaneous utility functions"""

def openAnything(source):            
    """URI, filename, or string --&gt; stream

    This function lets you define parsers that take any input source
    (URL, pathname to local or network file, or actual data as a string)
    and deal with it in a uniform manner.  Returned object is guaranteed
    to have all the basic stdio read methods (read, readline, readlines).
    Just .close() the object when you're done with it.
    
    Examples:
    &gt;&gt;&gt; from xml.dom import minidom
    &gt;&gt;&gt; sock = openAnything("http://localhost/kant.xml")
    &gt;&gt;&gt; doc = minidom.parse(sock)
    &gt;&gt;&gt; sock.close()
    &gt;&gt;&gt; sock = openAnything("c:\\inetpub\\wwwroot\\kant.xml")
    &gt;&gt;&gt; doc = minidom.parse(sock)
    &gt;&gt;&gt; sock.close()
    &gt;&gt;&gt; sock = openAnything("&lt;ref id='conjunction'&gt;&lt;text&gt;and&lt;/text&gt;&lt;text&gt;or&lt;/text&gt;&lt;/ref&gt;")
    &gt;&gt;&gt; doc = minidom.parse(sock)
    &gt;&gt;&gt; sock.close()
    """
    if hasattr(source, "read"):
        return source

    if source == '-':
        import sys
        return sys.stdin

    # try to open with urllib (if source is http, ftp, or file URL)
    import urllib                         
    try:                                  
        return urllib.urlopen(source)     
    except (IOError, OSError):            
        pass                              
    
    # try to open with native open function (if source is pathname)
    try:                                  
        return open(source)               
    except (IOError, OSError):            
        pass                              
    
    # treat source as string
    import StringIO                       
    return StringIO.StringIO(str(source)) 
</pre></div>
               <p>Run the program <tt class="filename">kgp.py</tt> by itself, and it will parse the default <span class="acronym">XML</span>-based grammar, in <tt class="filename">kant.xml</tt>, and print several paragraphs worth of philosophy in the style of Immanuel Kant.
               </p>
               <div class="example"><a name="d0e22873"></a><h3 class="title">Example&nbsp;9.3.&nbsp;Sample output of <tt class="filename">kgp.py</tt></h3><pre class="screen"><tt class="prompt">[you@localhost kgp]$ python kgp.py</tt>
<span class="computeroutput">     As is shown in the writings of Hume, our a priori concepts, in
reference to ends, abstract from all content of knowledge; in the study
of space, the discipline of human reason, in accordance with the
principles of philosophy, is the clue to the discovery of the
Transcendental Deduction.  The transcendental aesthetic, in all
theoretical sciences, occupies part of the sphere of human reason
concerning the existence of our ideas in general; still, the
never-ending regress in the series of empirical conditions constitutes
the whole content for the transcendental unity of apperception.  What
we have alone been able to show is that, even as this relates to the
architectonic of human reason, the Ideal may not contradict itself, but
it is still possible that it may be in contradictions with the
employment of the pure employment of our hypothetical judgements, but
natural causes (and I assert that this is the case) prove the validity
of the discipline of pure reason.  As we have already seen, time (and
it is obvious that this is true) proves the validity of time, and the
architectonic of human reason, in the full sense of these terms,
abstracts from all content of knowledge.  I assert, in the case of the
discipline of practical reason, that the Antinomies are just as
necessary as natural causes, since knowledge of the phenomena is a
posteriori.
    The discipline of human reason, as I have elsewhere shown, is by
its very nature contradictory, but our ideas exclude the possibility of
the Antinomies.  We can deduce that, on the contrary, the pure
employment of philosophy, on the contrary, is by its very nature
contradictory, but our sense perceptions are a representation of, in
the case of space, metaphysics.  The thing in itself is a
representation of philosophy.  Applied logic is the clue to the
discovery of natural causes.  However, what we have alone been able to
show is that our ideas, in other words, should only be used as a canon
for the Ideal, because of our necessary ignorance of the conditions.

[...snip...]</span></pre></div>
               <p>This is, of course, complete gibberish.  Well, not complete gibberish.  It is syntactically and grammatically correct (although
                  very verbose -- Kant wasn't what you would call a get-to-the-point kind of guy).  Some of it may actually be true (or at least
                  the sort of thing that Kant would have agreed with), some of it is blatantly false, and most of it is simply incoherent. 
                  But all of it is in the style of Immanuel Kant.
               </p>
               <p>Let me repeat that this is much, much funnier if you are now or have ever been a philosophy major.</p>
               <p>The interesting thing about this program is that there is nothing Kant-specific about it.  All the content in the previous
                  example was derived from the grammar file, <tt class="filename">kant.xml</tt>.  If you tell the program to use a different grammar file (which you can specify on the command line), the output will be
                  completely different.
               </p>
               <div class="example"><a name="d0e22893"></a><h3 class="title">Example&nbsp;9.4.&nbsp;Simpler output from <tt class="filename">kgp.py</tt></h3><pre class="screen"><tt class="prompt">[you@localhost kgp]$ python kgp.py -g binary.xml</tt>
<span class="computeroutput">00101001</span>
<tt class="prompt">[you@localhost kgp]$ python kgp.py -g binary.xml</tt>
<span class="computeroutput">10110100</span></pre></div>
               <p>You will take a closer look at the structure of the grammar file later in this chapter.  For now, all you need to know is
                  that the grammar file defines the structure of the output, and the <tt class="filename">kgp.py</tt> program reads through the grammar and makes random decisions about which words to plug in where.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.packages"></a>9.2.&nbsp;Packages
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Actually parsing an <span class="acronym">XML</span> document is very simple: one line of code.  However, before you get to that line of code, you need to take a short detour
                     to talk about packages.
                  </p>
               </div>
               <div class="example"><a name="d0e22925"></a><h3 class="title">Example&nbsp;9.5.&nbsp;Loading an <span class="acronym">XML</span> document (a sneak peek)
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom import minidom</span> <a name="kgp.packages.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse('~/diveintopython/common/py/kgp/binary.xml')</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.packages.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a syntax you haven't seen before.  It looks almost like the <tt class="literal">from <i class="replaceable">module</i> import</tt> you know and love, but the <tt class="literal">"."</tt> gives it away as something above and beyond a simple import.  In fact, <tt class="filename">xml</tt> is what is known as a package, <tt class="filename">dom</tt> is a nested package within <tt class="filename">xml</tt>, and <tt class="filename">minidom</tt> is a module within <tt class="filename">xml.dom</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>That sounds complicated, but it's really not.  Looking at the actual implementation may help.  Packages are little more than
                  directories of modules; nested packages are subdirectories.  The modules within a package (or a nested package) are still
                  just <tt class="filename">.py</tt> files, like always, except that they're in a subdirectory instead of the main <tt class="filename">lib/</tt> directory of your <span class="application">Python</span> installation.
               </p>
               <div class="example"><a name="d0e22983"></a><h3 class="title">Example&nbsp;9.6.&nbsp;File layout of a package</h3><pre class="screen"><span class="computeroutput"><span class="application">Python</span>21/           root <span class="application">Python</span> installation (home of the executable)
|
+--lib/             library directory (home of the standard library modules)
   |
   +-- xml/         xml package (really just a directory with other stuff in it)
       |
       +--sax/      xml.sax package (again, just a directory)
       |
       +--dom/      xml.dom package (contains minidom.py)
       |
       +--parsers/  xml.parsers package (used internally)</span></pre></div>
               <p>So when you say <tt class="literal">from xml.dom import minidom</tt>, <span class="application">Python</span> figures out that that means &#8220;<span class="quote">look in the <tt class="filename">xml</tt> directory for a <tt class="filename">dom</tt> directory, and look in <span class="emphasis"><em>that</em></span> for the <tt class="filename">minidom</tt> module, and import it as <tt class="filename">minidom</tt></span>&#8221;.  But <span class="application">Python</span> is even smarter than that; not only can you import entire modules contained within a package, you can selectively import
                  specific classes or functions from a module contained within a package.  You can also import the package itself as a module.
                  The syntax is all the same; <span class="application">Python</span> figures out what you mean based on the file layout of the package, and automatically does the right thing.
               </p>
               <div class="example"><a name="d0e23025"></a><h3 class="title">Example&nbsp;9.7.&nbsp;Packages are modules, too</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom import minidom</span>         <a name="kgp.packages.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">minidom</span>
<span class="computeroutput">&lt;module 'xml.dom.minidom' from 'C:\Python21\lib\xml\dom\minidom.pyc'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">minidom.Element</span>
<span class="computeroutput">&lt;class xml.dom.minidom.Element at 01095744&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom.minidom import Element</span> <a name="kgp.packages.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">Element</span>
<span class="computeroutput">&lt;class xml.dom.minidom.Element at 01095744&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">minidom.Element</span>
<span class="computeroutput">&lt;class xml.dom.minidom.Element at 01095744&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml import dom</span>                 <a name="kgp.packages.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">dom</span>
<span class="computeroutput">&lt;module 'xml.dom' from 'C:\Python21\lib\xml\dom\__init__.pyc'&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import xml</span>                          <a name="kgp.packages.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xml</span>
<span class="computeroutput">&lt;module 'xml' from 'C:\Python21\lib\xml\__init__.pyc'&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.packages.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here you're importing a module (<tt class="filename">minidom</tt>) from a nested package (<tt class="filename">xml.dom</tt>).  The result is that <tt class="filename">minidom</tt> is imported into your <a href="#dialect.locals" title="8.5.&nbsp;locals and globals">namespace</a>, and in order to reference classes within the <tt class="filename">minidom</tt> module (like <tt class="classname">Element</tt>), you need to preface them with the module name.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.packages.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here you are importing a class (<tt class="classname">Element</tt>) from a module (<tt class="filename">minidom</tt>) from a nested package (<tt class="filename">xml.dom</tt>).  The result is that <tt class="classname">Element</tt> is imported directly into your namespace.  Note that this does not interfere with the previous import; the <tt class="classname">Element</tt> class can now be referenced in two ways (but it's all still the same class).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.packages.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here you are importing the <tt class="filename">dom</tt> package (a nested package of <tt class="filename">xml</tt>) as a module in and of itself.  Any level of a package can be treated as a module, as you'll see in a moment.  It can even
                              have its own attributes and methods, just the modules you've seen before.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.packages.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here you are importing the root level <tt class="filename">xml</tt> package as a module.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So how can a package (which is just a directory on disk) be imported and treated as a module (which is always a file on disk)?
                  The answer is the magical <tt class="filename">__init__.py</tt> file.  You see, packages are not simply directories; they are directories with a specific file, <tt class="filename">__init__.py</tt>, inside.  This file defines the attributes and methods of the package.  For instance, <tt class="filename">xml.dom</tt> contains a <tt class="classname">Node</tt> class, which is defined in <tt class="filename">xml/dom/__init__.py</tt>.  When you import a package as a module (like <tt class="filename">dom</tt> from <tt class="filename">xml</tt>), you're really importing its <tt class="filename">__init__.py</tt> file.
               </p><a name="d0e23185"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">A package is a directory with the special <tt class="filename">__init__.py</tt> file in it.  The <tt class="filename">__init__.py</tt> file defines the attributes and methods of the package.  It doesn't need to define anything; it can just be an empty file,
                        but it has to exist.  But if <tt class="filename">__init__.py</tt> doesn't exist, the directory is just a directory, not a package, and it can't be imported or contain modules or nested packages.
                     </td>
                  </tr>
               </table>
               <p>So why bother with packages?  Well, they provide a way to logically group related modules.  Instead of having an <tt class="filename">xml</tt> package with <tt class="filename">sax</tt> and <tt class="filename">dom</tt> packages inside, the authors could have chosen to put all the <tt class="filename">sax</tt> functionality in <tt class="filename">xmlsax.py</tt> and all the <tt class="filename">dom</tt> functionality in <tt class="filename">xmldom.py</tt>, or even put all of it in a single module.  But that would have been unwieldy (as of this writing, the <span class="acronym">XML</span> package has over 3000 lines of code) and difficult to manage (separate source files mean multiple people can work on different
                  areas simultaneously).
               </p>
               <p>If you ever find yourself writing a large subsystem in <span class="application">Python</span> (or, more likely, when you realize that your small subsystem has grown into a large one), invest some time designing a good
                  package architecture.  It's one of the many things <span class="application">Python</span> is good at, so take advantage of it.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.parse"></a>9.3.&nbsp;Parsing <span class="acronym">XML</span></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>As I was saying, actually parsing an <span class="acronym">XML</span> document is very simple: one line of code.  Where you go from there is up to you.
                  </p>
               </div>
               <div class="example"><a name="d0e23245"></a><h3 class="title">Example&nbsp;9.8.&nbsp;Loading an <span class="acronym">XML</span> document (for real this time)
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom import minidom</span>                                          <a name="kgp.parse.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse('~/diveintopython/common/py/kgp/binary.xml')</span>  <a name="kgp.parse.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc</span>                                                               <a name="kgp.parse.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;xml.dom.minidom.Document instance at 010BE87C&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print xmldoc.toxml()</span>                                                 <a name="kgp.parse.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;?xml version="1.0" ?&gt;
&lt;grammar&gt;
&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;
&lt;ref id="byte"&gt;
  &lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;
&lt;/ref&gt;
&lt;/grammar&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in the <a href="#kgp.packages" title="9.2.&nbsp;Packages">previous section</a>, this imports the <tt class="filename">minidom</tt> module from the <tt class="filename">xml.dom</tt> package.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here is the one line of code that does all the work: <tt class="function">minidom.parse</tt> takes one argument and returns a parsed representation of the <span class="acronym">XML</span> document.  The argument can be many things; in this case, it's simply a filename of an <span class="acronym">XML</span> document on my local disk.  (To follow along, you'll need to change the path to point to your downloaded examples directory.)
                               But you can also pass a <a href="#fileinfo.files" title="6.2.&nbsp;Working with File Objects">file object</a>, or even a <a href="#dialect.extract.urllib" title="Example&nbsp;8.5.&nbsp;Introducing urllib">file-like object</a>.  You'll take advantage of this flexibility later in this chapter.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The object returned from <tt class="function">minidom.parse</tt> is a <tt class="classname">Document</tt> object, a descendant of the <tt class="classname">Node</tt> class.  This <tt class="classname">Document</tt> object is the root level of a complex tree-like structure of interlocking <span class="application">Python</span> objects that completely represent the <span class="acronym">XML</span> document you passed to <tt class="function">minidom.parse</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">toxml</tt> is a method of the <tt class="classname">Node</tt> class (and is therefore available on the <tt class="classname">Document</tt> object you got from <tt class="function">minidom.parse</tt>).  <tt class="function">toxml</tt> prints out the <span class="acronym">XML</span> that this <tt class="classname">Node</tt> represents.  For the <tt class="classname">Document</tt> node, this prints out the entire <span class="acronym">XML</span> document.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now that you have an <span class="acronym">XML</span> document in memory, you can start traversing through it.
               </p>
               <div class="example"><a name="kgp.parse.gettingchildnodes.example"></a><h3 class="title">Example&nbsp;9.9.&nbsp;Getting child nodes</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc.childNodes</span>    <a name="kgp.parse.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[&lt;DOM Element: grammar at 17538908&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc.childNodes[0]</span> <a name="kgp.parse.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;DOM Element: grammar at 17538908&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc.firstChild</span>    <a name="kgp.parse.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;DOM Element: grammar at 17538908&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Every <tt class="classname">Node</tt> has a <tt class="function">childNodes</tt> attribute, which is a list of the <tt class="classname">Node</tt> objects.  A <tt class="classname">Document</tt> always has only one child node, the root element of the <span class="acronym">XML</span> document (in this case, the <tt class="sgmltag-element">grammar</tt> element).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To get the first (and in this case, the only) child node, just use regular list syntax.  Remember, there is nothing special
                              going on here; this is just a regular <span class="application">Python</span> list of regular <span class="application">Python</span> objects.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since getting the first child node of a node is a useful and common activity, the <tt class="classname">Node</tt> class has a <tt class="function">firstChild</tt> attribute, which is synonymous with <tt class="literal">childNodes[0]</tt>.  (There is also a <tt class="function">lastChild</tt> attribute, which is synonymous with <tt class="literal">childNodes[-1]</tt>.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e23458"></a><h3 class="title">Example&nbsp;9.10.&nbsp;<tt class="function">toxml</tt> works on any node
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">grammarNode = xmldoc.firstChild</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print grammarNode.toxml()</span> <a name="kgp.parse.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;grammar&gt;
&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;
&lt;ref id="byte"&gt;
  &lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;
&lt;/ref&gt;
&lt;/grammar&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since the <tt class="function">toxml</tt> method is defined in the <tt class="classname">Node</tt> class, it is available on any <span class="acronym">XML</span> node, not just the <tt class="classname">Document</tt> element.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="kgp.parse.childnodescanbetext.example"></a><h3 class="title">Example&nbsp;9.11.&nbsp;Child nodes can be text</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">grammarNode.childNodes</span>                  <a name="kgp.parse.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[&lt;DOM Text node "\n"&gt;, &lt;DOM Element: ref at 17533332&gt;, \
&lt;DOM Text node "\n"&gt;, &lt;DOM Element: ref at 17549660&gt;, &lt;DOM Text node "\n"&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print grammarNode.firstChild.toxml()</span>    <a name="kgp.parse.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">

</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print grammarNode.childNodes[1].toxml()</span> <a name="kgp.parse.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print grammarNode.childNodes[3].toxml()</span> <a name="kgp.parse.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;ref id="byte"&gt;
  &lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;
&lt;/ref&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print grammarNode.lastChild.toxml()</span>     <a name="kgp.parse.4.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">

</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Looking at the <span class="acronym">XML</span> in <tt class="filename">binary.xml</tt>, you might think that the <tt class="sgmltag-element">grammar</tt> has only two child nodes, the two <tt class="sgmltag-element">ref</tt> elements.  But you're missing something: the carriage returns!  After the <tt class="literal">'&lt;grammar&gt;'</tt> and before the first <tt class="literal">'&lt;ref&gt;'</tt> is a carriage return, and this text counts as a child node of the <tt class="sgmltag-element">grammar</tt> element.  Similarly, there is a carriage return after each <tt class="literal">'&lt;/ref&gt;'</tt>; these also count as child nodes.  So <tt class="literal">grammar.childNodes</tt> is actually a list of 5 objects: 3 <tt class="classname">Text</tt> objects and 2 <tt class="classname">Element</tt> objects.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first child is a <tt class="classname">Text</tt> object representing the carriage return after the <tt class="literal">'&lt;grammar&gt;'</tt> tag and before the first <tt class="literal">'&lt;ref&gt;'</tt> tag.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The second child is an <tt class="classname">Element</tt> object representing the first <tt class="sgmltag-element">ref</tt> element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The fourth child is an <tt class="classname">Element</tt> object representing the second <tt class="sgmltag-element">ref</tt> element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.4.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The last child is a <tt class="classname">Text</tt> object representing the carriage return after the <tt class="literal">'&lt;/ref&gt;'</tt> end tag and before the <tt class="literal">'&lt;/grammar&gt;'</tt> end tag.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e23628"></a><h3 class="title">Example&nbsp;9.12.&nbsp;Drilling down all the way to text</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">grammarNode</span>
<span class="computeroutput">&lt;DOM Element: grammar at 19167148&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">refNode = grammarNode.childNodes[1]</span> <a name="kgp.parse.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">refNode</span>
<span class="computeroutput">&lt;DOM Element: ref at 17987740&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">refNode.childNodes</span>                  <a name="kgp.parse.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">[&lt;DOM Text node "\n"&gt;, &lt;DOM Text node "  "&gt;, &lt;DOM Element: p at 19315844&gt;, \
&lt;DOM Text node "\n"&gt;, &lt;DOM Text node "  "&gt;, \
&lt;DOM Element: p at 19462036&gt;, &lt;DOM Text node "\n"&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pNode = refNode.childNodes[2]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pNode</span>
<span class="computeroutput">&lt;DOM Element: p at 19315844&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print pNode.toxml()</span>                 <a name="kgp.parse.5.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;p&gt;0&lt;/p&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pNode.firstChild</span>                    <a name="kgp.parse.5.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;DOM Text node "0"&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pNode.firstChild.data</span>               <a name="kgp.parse.5.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">u'0'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in the previous example, the first <tt class="sgmltag-element">ref</tt> element is <tt class="literal">grammarNode.childNodes[1]</tt>, since childNodes[0] is a <tt class="classname">Text</tt> node for the carriage return.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="sgmltag-element">ref</tt> element has its own set of child nodes, one for the carriage return, a separate one for the spaces, one for the <tt class="sgmltag-element">p</tt> element, and so forth.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.5.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can even use the <tt class="function">toxml</tt> method here, deeply nested within the document.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.5.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="sgmltag-element">p</tt> element has only one child node (you can't tell that from this example, but look at <tt class="literal">pNode.childNodes</tt> if you don't believe me), and it is a <tt class="classname">Text</tt> node for the single character <tt class="literal">'0'</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.parse.5.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="literal">.data</tt> attribute of a <tt class="classname">Text</tt> node gives you the actual string that the text node represents.  But what is that <tt class="literal">'u'</tt> in front of the string?  The answer to that deserves its own section.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.unicode"></a>9.4.&nbsp;Unicode
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Unicode is a system to represent characters from all the world's different languages.  When <span class="application">Python</span> parses an <span class="acronym">XML</span> document, all data is stored in memory as unicode.
                  </p>
               </div>
               <p>You'll get to all that in a minute, but first, some background.</p>
               <p><b>Historical note.&nbsp;</b>Before unicode, there were separate character encoding systems for each language, each using the same numbers (0-255) to represent
                  that language's characters.  Some languages (like Russian) have multiple conflicting standards about how to represent the
                  same characters; other languages (like Japanese) have so many characters that they require multiple-byte character sets. 
                  Exchanging documents between systems was difficult because there was no way for a computer to tell for certain which character
                  encoding scheme the document author had used; the computer only saw numbers, and the numbers could mean different things.
                  Then think about trying to store these documents in the same place (like in the same database table); you would need to store
                  the character encoding alongside each piece of text, and make sure to pass it around whenever you passed the text around.
                  Then think about multilingual documents, with characters from multiple languages in the same document.  (They typically used
                  escape codes to switch modes; poof, you're in Russian koi8-r mode, so character 241 means this; poof, now you're in Mac Greek
                  mode, so character 241 means something else.  And so on.)  These are the problems which unicode was designed to solve.
               </p>
               <p>To solve these problems, unicode represents each character as a 2-byte number, from 0 to 65535.<sup>[<a name="d0e23786" href="#ftn.d0e23786">5</a>]</sup>  Each 2-byte number represents a unique character used in at least one of the world's languages.  (Characters that are used
                  in multiple languages have the same numeric code.)  There is exactly 1 number per character, and exactly 1 character per number.
                  Unicode data is never ambiguous.
               </p>
               <p>Of course, there is still the matter of all these legacy encoding systems.  7-bit <span class="acronym">ASCII</span>, for instance, which stores English characters as numbers ranging from 0 to 127.  (65 is capital &#8220;<span class="quote"><tt class="literal">A</tt></span>&#8221;, 97 is lowercase &#8220;<span class="quote"><tt class="literal">a</tt></span>&#8221;, and so forth.)  English has a very simple alphabet, so it can be completely expressed in 7-bit <span class="acronym">ASCII</span>.  Western European languages like French, Spanish, and German all use an encoding system called ISO-8859-1 (also called &#8220;<span class="quote">latin-1</span>&#8221;), which uses the 7-bit <span class="acronym">ASCII</span> characters for the numbers 0 through 127, but then extends into the 128-255 range for characters like n-with-a-tilde-over-it
                  (241), and u-with-two-dots-over-it (252).  And unicode uses the same characters as 7-bit <span class="acronym">ASCII</span> for 0 through 127, and the same characters as ISO-8859-1 for 128 through 255, and then extends from there into characters
                  for other languages with the remaining numbers, 256 through 65535.
               </p>
               <p>When dealing with unicode data, you may at some point need to convert the data back into one of these other legacy encoding
                  systems.  For instance, to integrate with some other computer system which expects its data in a specific 1-byte encoding
                  scheme, or to print it to a non-unicode-aware terminal or printer.  Or to store it in an <span class="acronym">XML</span> document which explicitly specifies the encoding scheme.
               </p>
               <p>And on that note, let's get back to <span class="application">Python</span>.
               </p>
               <p><span class="application">Python</span> has had unicode support throughout the language since version 2.0.  The <span class="acronym">XML</span> package uses unicode to store all parsed <span class="acronym">XML</span> data, but you can use unicode anywhere.
               </p>
               <div class="example"><a name="d0e23841"></a><h3 class="title">Example&nbsp;9.13.&nbsp;Introducing unicode</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = u'Dive in'</span>            <a name="kgp.unicode.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s</span>
<span class="computeroutput">u'Dive in'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print s</span>                   <a name="kgp.unicode.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">Dive in</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To create a unicode string instead of a regular <span class="acronym">ASCII</span> string, add the letter &#8220;<span class="quote"><tt class="literal">u</tt></span>&#8221; before the string.  Note that this particular string doesn't have any non-<span class="acronym">ASCII</span> characters.  That's fine; unicode is a superset of <span class="acronym">ASCII</span> (a very large superset at that), so any regular <span class="acronym">ASCII</span> string can also be stored as unicode.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When printing a string, <span class="application">Python</span> will attempt to convert it to your default encoding, which is usually <span class="acronym">ASCII</span>.  (More on this in a minute.)  Since this unicode string is made up of characters that are also <span class="acronym">ASCII</span> characters, printing it has the same result as printing a normal <span class="acronym">ASCII</span> string; the conversion is seamless, and if you didn't know that <tt class="varname">s</tt> was a unicode string, you'd never notice the difference.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e23908"></a><h3 class="title">Example&nbsp;9.14.&nbsp;Storing non-<span class="acronym">ASCII</span> characters
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = u'La Pe\xf1a'</span>         <a name="kgp.unicode.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print s</span>                   <a name="kgp.unicode.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
UnicodeError: ASCII encoding error: ordinal not in range(128)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print s.encode('latin-1')</span> <a name="kgp.unicode.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">La Pe&ntilde;a</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The real advantage of unicode, of course, is its ability to store non-<span class="acronym">ASCII</span> characters, like the Spanish &#8220;<span class="quote"><tt class="literal">&ntilde;</tt></span>&#8221; (<tt class="literal">n</tt> with a tilde over it).  The unicode character code for the tilde-n is <tt class="literal">0xf1</tt> in hexadecimal (241 in decimal), which you can type like this: <tt class="literal">\xf1</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember I said that the <tt class="function">print</tt> function attempts to convert a unicode string to <span class="acronym">ASCII</span> so it can print it?  Well, that's not going to work here, because your unicode string contains non-<span class="acronym">ASCII</span> characters, so <span class="application">Python</span> raises a <tt class="errorname">UnicodeError</tt> error.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here's where the conversion-from-unicode-to-other-encoding-schemes comes in.  <tt class="varname">s</tt> is a unicode string, but <tt class="function">print</tt> can only print a regular string.  To solve this problem, you call the <tt class="function">encode</tt> method, available on every unicode string, to convert the unicode string to a regular string in the given encoding scheme,
                              which you pass as a parameter.  In this case, you're using <tt class="literal">latin-1</tt> (also known as <tt class="literal">iso-8859-1</tt>), which includes the tilde-n (whereas the default <span class="acronym">ASCII</span> encoding scheme did not, since it only includes characters numbered 0 through 127).
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Remember I said <span class="application">Python</span> usually converted unicode to <span class="acronym">ASCII</span> whenever it needed to make a regular string out of a unicode string?  Well, this default encoding scheme is an option which
                  you can customize.
               </p>
               <div class="example"><a name="d0e24009"></a><h3 class="title">Example&nbsp;9.15.&nbsp;<tt class="filename">sitecustomize.py</tt></h3><pre class="programlisting">
# sitecustomize.py                   <a name="kgp.unicode.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
# this file can be anywhere in your Python path,
# but it usually goes in ${pythondir}/lib/site-packages/
import sys
sys.setdefaultencoding('iso-8859-1') <a name="kgp.unicode.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">sitecustomize.py</tt> is a special script; <span class="application">Python</span> will try to import it on startup, so any code in it will be run automatically.  As the comment mentions, it can go anywhere
                              (as long as <tt class="literal">import</tt> can find it), but it usually goes in the <tt class="filename">site-packages</tt> directory within your <span class="application">Python</span> <tt class="filename">lib</tt> directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">setdefaultencoding</tt> function sets, well, the default encoding.  This is the encoding scheme that <span class="application">Python</span> will try to use whenever it needs to auto-coerce a unicode string into a regular string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e24048"></a><h3 class="title">Example&nbsp;9.16.&nbsp;Effects of setting the default encoding</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import sys</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys.getdefaultencoding()</span> <a name="kgp.unicode.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'iso-8859-1'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">s = u'La Pe\xf1a'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print s</span>                  <a name="kgp.unicode.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">La Pe&ntilde;a</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This example assumes that you have made the changes listed in the previous example to your <tt class="filename">sitecustomize.py</tt> file, and restarted <span class="application">Python</span>.  If your default encoding still says <tt class="literal">'ascii'</tt>, you didn't set up your <tt class="filename">sitecustomize.py</tt> properly, or you didn't restart <span class="application">Python</span>.  The default encoding can only be changed during <span class="application">Python</span> startup; you can't change it later.  (Due to some wacky programming tricks that I won't get into right now, you can't even
                              call <tt class="function">sys.setdefaultencoding</tt> after <span class="application">Python</span> has started up.  Dig into <tt class="filename">site.py</tt> and search for &#8220;<span class="quote"><tt class="literal">setdefaultencoding</tt></span>&#8221; to find out how.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now that the default encoding scheme includes all the characters you use in your string, <span class="application">Python</span> has no problem auto-coercing the string and printing it.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e24123"></a><h3 class="title">Example&nbsp;9.17.&nbsp;Specifying encoding in <tt class="filename">.py</tt> files
                  </h3>
                  <p>If you are going to be storing non-ASCII strings within your <span class="application">Python</span> code, you'll need to specify the encoding of each individual <tt class="filename">.py</tt> file by putting an encoding declaration at the top of each file.  This declaration defines the <tt class="filename">.py</tt> file to be UTF-8:
                  </p><pre class="programlisting">
#!/usr/bin/env python
# -*- coding: UTF-8 -*-
</pre></div>
               <p>Now, what about <span class="acronym">XML</span>?  Well, every <span class="acronym">XML</span> document is in a specific encoding.  Again, ISO-8859-1 is a popular encoding for data in Western European languages.  KOI8-R
                  is popular for Russian texts.  The encoding, if specified, is in the header of the <span class="acronym">XML</span> document.
               </p>
               <div class="example"><a name="d0e24153"></a><h3 class="title">Example&nbsp;9.18.&nbsp;<tt class="filename">russiansample.xml</tt></h3><pre class="screen"><span class="computeroutput">
&lt;?xml version="1.0" encoding="koi8-r"?&gt;       </span><a name="kgp.unicode.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
&lt;preface&gt;
&lt;title&gt;&#1055;&#1088;&#1077;&#1076;&#1080;&#1089;&#1083;&#1086;&#1074;&#1080;&#1077;&lt;/title&gt;                    </span><a name="kgp.unicode.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
&lt;/preface&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a sample extract from a real Russian <span class="acronym">XML</span> document; it's part of a Russian translation of this very book.  Note the encoding, <tt class="literal">koi8-r</tt>, specified in the header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">These are Cyrillic characters which, as far as I know, spell the Russian word for &#8220;<span class="quote">Preface</span>&#8221;.  If you open this file in a regular text editor, the characters will most likely like gibberish, because they're encoded
                              using the <tt class="literal">koi8-r</tt> encoding scheme, but they're being displayed in <tt class="literal">iso-8859-1</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e24188"></a><h3 class="title">Example&nbsp;9.19.&nbsp;Parsing <tt class="filename">russiansample.xml</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom import minidom</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse('russiansample.xml')</span> <a name="kgp.unicode.6.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">title = xmldoc.getElementsByTagName('title')[0].firstChild.data</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">title</span>                                       <a name="kgp.unicode.6.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">u'\u041f\u0440\u0435\u0434\u0438\u0441\u043b\u043e\u0432\u0438\u0435'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print title</span>                                 <a name="kgp.unicode.6.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
UnicodeError: ASCII encoding error: ordinal not in range(128)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">convertedtitle = title.encode('koi8-r')</span>     <a name="kgp.unicode.6.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">convertedtitle</span>
<span class="computeroutput">'\xf0\xd2\xc5\xc4\xc9\xd3\xcc\xcf\xd7\xc9\xc5'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print convertedtitle</span>                        <a name="kgp.unicode.6.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">&#1055;&#1088;&#1077;&#1076;&#1080;&#1089;&#1083;&#1086;&#1074;&#1080;&#1077;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.6.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">I'm assuming here that you saved the previous example as <tt class="filename">russiansample.xml</tt> in the current directory.  I am also, for the sake of completeness, assuming that you've changed your default encoding back
                              to <tt class="literal">'ascii'</tt> by removing your <tt class="filename">sitecustomize.py</tt> file, or at least commenting out the <tt class="function">setdefaultencoding</tt> line.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.6.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that the text data of the <tt class="sgmltag-element">title</tt> tag (now in the <tt class="varname">title</tt> variable, thanks to that long concatenation of <span class="application">Python</span> functions which I hastily skipped over and, annoyingly, won't explain until the next section) -- the text data inside the
                              <span class="acronym">XML</span> document's <tt class="sgmltag-element">title</tt> element is stored in unicode.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.6.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Printing the title is not possible, because this unicode string contains non-<span class="acronym">ASCII</span> characters, so <span class="application">Python</span> can't convert it to <span class="acronym">ASCII</span> because that doesn't make sense.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.6.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can, however, explicitly convert it to <tt class="literal">koi8-r</tt>, in which case you get a (regular, not unicode) string of single-byte characters (<tt class="literal">f0</tt>, <tt class="literal">d2</tt>, <tt class="literal">c5</tt>, and so forth) that are the <tt class="literal">koi8-r</tt>-encoded versions of the characters in the original unicode string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.unicode.6.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Printing the <tt class="literal">koi8-r</tt>-encoded string will probably show gibberish on your screen, because your <span class="application">Python</span> <span class="acronym">IDE</span> is interpreting those characters as <tt class="literal">iso-8859-1</tt>, not <tt class="literal">koi8-r</tt>.  But at least they do print.  (And, if you look carefully, it's the same gibberish that you saw when you opened the original
                              <span class="acronym">XML</span> document in a non-unicode-aware text editor.  <span class="application">Python</span> converted it from <tt class="literal">koi8-r</tt> into unicode when it parsed the <span class="acronym">XML</span> document, and you've just converted it back.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>To sum up, unicode itself is a bit intimidating if you've never seen it before, but unicode data is really very easy to handle
                  in <span class="application">Python</span>.  If your <span class="acronym">XML</span> documents are all 7-bit <span class="acronym">ASCII</span> (like the examples in this chapter), you will literally never think about unicode.  <span class="application">Python</span> will convert the <span class="acronym">ASCII</span> data in the <span class="acronym">XML</span> documents into unicode while parsing, and auto-coerce it back to <span class="acronym">ASCII</span> whenever necessary, and you'll never even notice.  But if you need to deal with that in other languages, <span class="application">Python</span> is ready.
               </p>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li><a href="http://www.unicode.org/">Unicode.org</a> is the home page of the unicode standard, including a brief <a href="http://www.unicode.org/standard/principles.html">technical introduction</a>.
                     </li>
                     <li><a href="http://www.reportlab.com/i18n/python_unicode_tutorial.html">Unicode Tutorial</a> has some more examples of how to use <span class="application">Python</span>'s unicode functions, including how to force <span class="application">Python</span> to coerce unicode into <span class="acronym">ASCII</span> even when it doesn't really want to.
                     </li>
                     <li><a href="http://www.python.org/peps/pep-0263.html">PEP 263</a> goes into more detail about how and when to define a character encoding in your <tt class="filename">.py</tt> files.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.search"></a>9.5.&nbsp;Searching for elements
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Traversing <span class="acronym">XML</span> documents by stepping through each node can be tedious.  If you're looking for something in particular, buried deep within
                     your <span class="acronym">XML</span> document, there is a shortcut you can use to find it quickly: <tt class="function">getElementsByTagName</tt>.
                  </p>
               </div>
               <p>For this section, you'll be using the <tt class="filename">binary.xml</tt> grammar file, which looks like this:
               </p>
               <div class="example"><a name="d0e24431"></a><h3 class="title">Example&nbsp;9.20.&nbsp;<tt class="filename">binary.xml</tt></h3><pre class="screen"><span class="computeroutput">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE grammar PUBLIC "-//diveintopython.org//DTD Kant Generator Pro v1.0//EN" "kgp.dtd"&gt;
&lt;grammar&gt;
&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;
&lt;ref id="byte"&gt;
  &lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;
&lt;/ref&gt;
&lt;/grammar&gt;</span></pre></div>
               <p>It has two <tt class="sgmltag-element">ref</tt>s, <tt class="literal">'bit'</tt> and <tt class="literal">'byte'</tt>.  A <tt class="literal">bit</tt> is either a <tt class="literal">'0'</tt> or <tt class="literal">'1'</tt>, and a <tt class="literal">byte</tt> is 8 <tt class="literal">bit</tt>s.
               </p>
               <div class="example"><a name="d0e24464"></a><h3 class="title">Example&nbsp;9.21.&nbsp;Introducing <tt class="function">getElementsByTagName</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom import minidom</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse('binary.xml')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">reflist = xmldoc.getElementsByTagName('ref')</span> <a name="kgp.search.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">reflist</span>
<span class="computeroutput">[&lt;DOM Element: ref at 136138108&gt;, &lt;DOM Element: ref at 136144292&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print reflist[0].toxml()</span>
<span class="computeroutput">&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print reflist[1].toxml()</span>
<span class="computeroutput">&lt;ref id="byte"&gt;
  &lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;
&lt;/ref&gt;
</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.search.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">getElementsByTagName</tt> takes one argument, the name of the element you wish to find.  It returns a list of <tt class="classname">Element</tt> objects, corresponding to the <span class="acronym">XML</span> elements that have that name.  In this case, you find two <tt class="literal">ref</tt> elements.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e24526"></a><h3 class="title">Example&nbsp;9.22.&nbsp;Every element is searchable</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">firstref = reflist[0]</span>                      <a name="kgp.search.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print firstref.toxml()</span>
<span class="computeroutput">&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">plist = firstref.getElementsByTagName("p")</span> <a name="kgp.search.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">plist</span>
<span class="computeroutput">[&lt;DOM Element: p at 136140116&gt;, &lt;DOM Element: p at 136142172&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print plist[0].toxml()</span>                     <a name="kgp.search.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;p&gt;0&lt;/p&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print plist[1].toxml()</span>
<span class="computeroutput">&lt;p&gt;1&lt;/p&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.search.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Continuing from the previous example, the first object in your <tt class="varname">reflist</tt> is the <tt class="literal">'bit'</tt> <tt class="sgmltag-element">ref</tt> element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.search.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can use the same <tt class="function">getElementsByTagName</tt> method on this <tt class="classname">Element</tt> to find all the <tt class="sgmltag-element">&lt;p&gt;</tt> elements within the <tt class="literal">'bit'</tt> <tt class="sgmltag-element">ref</tt> element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.search.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Just as before, the <tt class="function">getElementsByTagName</tt> method returns a list of all the elements it found.  In this case, you have two, one for each bit.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e24615"></a><h3 class="title">Example&nbsp;9.23.&nbsp;Searching is actually recursive</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">plist = xmldoc.getElementsByTagName("p")</span> <a name="kgp.search.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">plist</span>
<span class="computeroutput">[&lt;DOM Element: p at 136140116&gt;, &lt;DOM Element: p at 136142172&gt;, &lt;DOM Element: p at 136146124&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">plist[0].toxml()</span>                         <a name="kgp.search.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'&lt;p&gt;0&lt;/p&gt;'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">plist[1].toxml()</span>
<span class="computeroutput">'&lt;p&gt;1&lt;/p&gt;'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">plist[2].toxml()</span>                         <a name="kgp.search.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'&lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.search.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note carefully the difference between this and the previous example.  Previously, you were searching for <tt class="sgmltag-element">p</tt> elements within <tt class="varname">firstref</tt>, but here you are searching for <tt class="sgmltag-element">p</tt> elements within <tt class="varname">xmldoc</tt>, the root-level object that represents the entire <span class="acronym">XML</span> document.  This <span class="emphasis"><em>does</em></span> find the <tt class="sgmltag-element">p</tt> elements nested within the <tt class="sgmltag-element">ref</tt> elements within the root <tt class="sgmltag-element">grammar</tt> element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.search.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first two <tt class="sgmltag-element">p</tt> elements are within the first <tt class="sgmltag-element">ref</tt> (the <tt class="literal">'bit'</tt> <tt class="sgmltag-element">ref</tt>).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.search.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The last <tt class="sgmltag-element">p</tt> element is the one within the second <tt class="sgmltag-element">ref</tt> (the <tt class="literal">'byte'</tt> <tt class="sgmltag-element">ref</tt>).
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.attributes"></a>9.6.&nbsp;Accessing element attributes
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="acronym">XML</span> elements can have one or more attributes, and it is incredibly simple to access them once you have parsed an <span class="acronym">XML</span> document.
                  </p>
               </div>
               <p>For this section, you'll be using the <tt class="filename">binary.xml</tt> grammar file that you saw in the <a href="#kgp.search" title="9.5.&nbsp;Searching for elements">previous section</a>.
               </p><a name="d0e24744"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">This section may be a little confusing, because of some overlapping terminology.  Elements in an <span class="acronym">XML</span> document have attributes, and <span class="application">Python</span> objects also have attributes.  When you parse an <span class="acronym">XML</span> document, you get a bunch of <span class="application">Python</span> objects that represent all the pieces of the <span class="acronym">XML</span> document, and some of these <span class="application">Python</span> objects represent attributes of the <span class="acronym">XML</span> elements.  But the (<span class="application">Python</span>) objects that represent the (<span class="acronym">XML</span>) attributes also have (<span class="application">Python</span>) attributes, which are used to access various parts of the (<span class="acronym">XML</span>) attribute that the object represents.  I told you it was confusing.  I am open to suggestions on how to distinguish these
                        more clearly.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="d0e24787"></a><h3 class="title">Example&nbsp;9.24.&nbsp;Accessing element attributes</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse('binary.xml')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">reflist = xmldoc.getElementsByTagName('ref')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">bitref = reflist[0]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print bitref.toxml()</span>
<span class="computeroutput">&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">bitref.attributes</span>          <a name="kgp.attributes.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;xml.dom.minidom.NamedNodeMap instance at 0x81e0c9c&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">bitref.attributes.keys()</span>   <a name="kgp.attributes.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"> <a name="kgp.attributes.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">[u'id']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">bitref.attributes.values()</span> <a name="kgp.attributes.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">[&lt;xml.dom.minidom.Attr instance at 0x81d5044&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">bitref.attributes["id"]</span>    <a name="kgp.attributes.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">&lt;xml.dom.minidom.Attr instance at 0x81d5044&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.attributes.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each <tt class="classname">Element</tt> object has an attribute called <tt class="literal">attributes</tt>, which is a <tt class="classname">NamedNodeMap</tt> object.  This sounds scary, but it's not, because a <tt class="classname">NamedNodeMap</tt> is an object that <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">acts like a dictionary</a>, so you already know how to use it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.attributes.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Treating the <tt class="classname">NamedNodeMap</tt> as a dictionary, you can get a list of the names of the attributes of this element by using <tt class="function">attributes.keys()</tt>.  This element has only one attribute, <tt class="literal">'id'</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.attributes.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Attribute names, like all other text in an <span class="acronym">XML</span> document, are stored in <a href="#kgp.unicode" title="9.4.&nbsp;Unicode">unicode</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.attributes.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Again treating the <tt class="classname">NamedNodeMap</tt> as a dictionary, you can get a list of the values of the attributes by using <tt class="function">attributes.values()</tt>.  The values are themselves objects, of type <tt class="classname">Attr</tt>.  You'll see how to get useful information out of this object in the next example.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.attributes.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Still treating the <tt class="classname">NamedNodeMap</tt> as a dictionary, you can access an individual attribute by name, using normal dictionary syntax.  (Readers who have been
                              paying extra-close attention will already know how the <tt class="classname">NamedNodeMap</tt> class accomplishes this neat trick: by defining a <a href="#fileinfo.specialmethods" title="5.6.&nbsp;Special Class Methods"><tt class="function">__getitem__</tt> special method</a>.  Other readers can take comfort in the fact that they don't need to understand how it works in order to use it effectively.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e24922"></a><h3 class="title">Example&nbsp;9.25.&nbsp;Accessing individual attributes</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">a = bitref.attributes["id"]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">a</span>
<span class="computeroutput">&lt;xml.dom.minidom.Attr instance at 0x81d5044&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">a.name</span>  <a name="kgp.attributes.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">u'id'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">a.value</span> <a name="kgp.attributes.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">u'bit'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.attributes.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="classname">Attr</tt> object completely represents a single <span class="acronym">XML</span> attribute of a single <span class="acronym">XML</span> element.  The name of the attribute (the same name as you used to find this object in the <tt class="literal">bitref.attributes</tt> <tt class="classname">NamedNodeMap</tt> pseudo-dictionary) is stored in <tt class="literal">a.name</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.attributes.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The actual text value of this <span class="acronym">XML</span> attribute is stored in <tt class="literal">a.value</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e24990"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Like a dictionary, attributes of an <span class="acronym">XML</span> element have no ordering.  Attributes may <span class="emphasis"><em>happen to be</em></span> listed in a certain order in the original <span class="acronym">XML</span> document, and the <tt class="classname">Attr</tt> objects may <span class="emphasis"><em>happen to be</em></span> listed in a certain order when the <span class="acronym">XML</span> document is parsed into <span class="application">Python</span> objects, but these orders are arbitrary and should carry no special meaning.  You should always access individual attributes
                        by name, like the keys of a dictionary.
                     </td>
                  </tr>
               </table>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.segue"></a>9.7.&nbsp;Segue
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>OK, that's it for the hard-core XML stuff.  The next chapter will continue to use these same example programs, but focus on
                     other aspects that make the program more flexible: using streams for input processing, using <tt class="function">getattr</tt> for method dispatching, and using command-line flags to allow users to reconfigure the program without changing the code.
                  </p>
               </div>
               <p>Before moving on to the next chapter, you should be comfortable doing all of these things:</p>
               <div class="itemizedlist">
                  <ul>
                     <li><a href="#kgp.parse" title="9.3.&nbsp;Parsing XML">Parsing <span class="acronym">XML</span> documents</a> using <tt class="filename">minidom</tt>, <a href="#kgp.search" title="9.5.&nbsp;Searching for elements">searching through the parsed document</a>, and accessing arbitrary <a href="#kgp.attributes" title="9.6.&nbsp;Accessing element attributes">element attributes</a> and <a href="#kgp.child" title="10.4.&nbsp;Finding direct children of a node">element children</a></li>
                     <li>Organizing complex libraries into <a href="#kgp.packages" title="9.2.&nbsp;Packages">packages</a></li>
                     <li><a href="#kgp.unicode" title="9.4.&nbsp;Unicode">Converting unicode strings</a> to different character encodings
                     </li>
                  </ul>
               </div>
            </div>
            <div class="footnotes"><br><hr width="100" align="left">
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e23786" href="#d0e23786">5</a>] </sup>This, sadly, is <span class="emphasis"><em>still</em></span> an oversimplification.  Unicode now has been extended to handle ancient Chinese, Korean, and Japanese texts, which had so
                     many different characters that the 2-byte unicode system could not represent them all.  But <span class="application">Python</span> doesn't currently support that out of the box, and I don't know if there is a project afoot to add it.  You've reached the
                     limits of my expertise, sorry.
                  </p>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="streams"></a>Chapter&nbsp;10.&nbsp;Scripts and Streams
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.openanything"></a>10.1.&nbsp;Abstracting input sources
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>One of <span class="application">Python</span>'s greatest strengths is its dynamic binding, and one powerful use of dynamic binding is the <span class="emphasis"><em>file-like object</em></span>.
                  </p>
               </div>
               <p>Many functions which require an input source could simply take a filename, go open the file for reading, read it, and close
                  it when they're done.  But they don't.  Instead, they take a <span class="emphasis"><em>file-like object</em></span>.
               </p>
               <p>In the simplest case, a <span class="emphasis"><em>file-like object</em></span> is any object with a <tt class="function">read</tt> method with an optional <tt class="varname">size</tt> parameter, which returns a string.  When called with no <tt class="varname">size</tt> parameter, it reads everything there is to read from the input source and returns all the data as a single string.  When
                  called with a <tt class="varname">size</tt> parameter, it reads that much from the input source and returns that much data; when called again, it picks up where it left
                  off and returns the next chunk of data.
               </p>
               <p>This is how <a href="#fileinfo.files" title="6.2.&nbsp;Working with File Objects">reading from real files</a> works; the difference is that you're not limiting yourself to real files.  The input source could be anything: a file on
                  disk, a web page, even a hard-coded string.  As long as you pass a file-like object to the function, and the function simply
                  calls the object's <tt class="function">read</tt> method, the function can handle any kind of input source without specific code to handle each kind.
               </p>
               <p>In case you were wondering how this relates to <span class="acronym">XML</span> processing, <tt class="function">minidom.parse</tt> is one such function which can take a file-like object.
               </p>
               <div class="example"><a name="d0e25118"></a><h3 class="title">Example&nbsp;10.1.&nbsp;Parsing <span class="acronym">XML</span> from a file
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom import minidom</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">fsock = open('binary.xml')</span>    <a name="kgp.openanything.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse(fsock)</span> <a name="kgp.openanything.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">fsock.close()</span>                 <a name="kgp.openanything.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print xmldoc.toxml()</span>          <a name="kgp.openanything.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;?xml version="1.0" ?&gt;
&lt;grammar&gt;
&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;
&lt;ref id="byte"&gt;
  &lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;
&lt;/ref&gt;
&lt;/grammar&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First, you open the file on disk.  This gives you a <a href="#fileinfo.files" title="6.2.&nbsp;Working with File Objects">file object</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You pass the file object to <tt class="function">minidom.parse</tt>, which calls the <tt class="function">read</tt> method of <tt class="varname">fsock</tt> and reads the <span class="acronym">XML</span> document from the file on disk.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Be sure to call the <tt class="function">close</tt> method of the file object after you're done with it.  <tt class="function">minidom.parse</tt> will not do this for you.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Calling the <tt class="methodname">toxml()</tt> method on the returned <span class="acronym">XML</span> document prints out the entire thing.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Well, that all seems like a colossal waste of time.  After all, you've already seen that <tt class="function">minidom.parse</tt> can simply take the filename and do all the opening and closing nonsense automatically.  And it's true that if you know you're
                  just going to be parsing a local file, you can pass the filename and <tt class="function">minidom.parse</tt> is smart enough to <span class="trademark">Do The Right Thing</span>&#8482;.  But notice how similar -- and easy -- it is to parse an <span class="acronym">XML</span> document straight from the Internet.
               </p>
               <div class="example"><a name="kgp.openanything.urllib"></a><h3 class="title">Example&nbsp;10.2.&nbsp;Parsing <span class="acronym">XML</span> from a <span class="acronym">URL</span></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">usock = urllib.urlopen('http://slashdot.org/slashdot.rdf')</span> <a name="kgp.openanything.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse(usock)</span>                              <a name="kgp.openanything.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">usock.close()</span>                                              <a name="kgp.openanything.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print xmldoc.toxml()</span>                                       <a name="kgp.openanything.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;?xml version="1.0" ?&gt;
&lt;rdf:RDF xmlns="http://my.netscape.com/rdf/simple/0.9/"
 xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;

&lt;channel&gt;
&lt;title&gt;Slashdot&lt;/title&gt;
&lt;link&gt;http://slashdot.org/&lt;/link&gt;
&lt;description&gt;News for nerds, stuff that matters&lt;/description&gt;
&lt;/channel&gt;

&lt;image&gt;
&lt;title&gt;Slashdot&lt;/title&gt;
&lt;url&gt;http://images.slashdot.org/topics/topicslashdot.gif&lt;/url&gt;
&lt;link&gt;http://slashdot.org/&lt;/link&gt;
&lt;/image&gt;

&lt;item&gt;
&lt;title&gt;To HDTV or Not to HDTV?&lt;/title&gt;
&lt;link&gt;http://slashdot.org/article.pl?sid=01/12/28/0421241&lt;/link&gt;
&lt;/item&gt;

[...snip...]</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw <a href="#dialect.extract.urllib" title="Example&nbsp;8.5.&nbsp;Introducing urllib">in a previous chapter</a>, <tt class="function">urlopen</tt> takes a web page <span class="acronym">URL</span> and returns a file-like object.  Most importantly, this object has a <tt class="function">read</tt> method which returns the <span class="acronym">HTML</span> source of the web page.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you pass the file-like object to <tt class="function">minidom.parse</tt>, which obediently calls the <tt class="function">read</tt> method of the object and parses the <span class="acronym">XML</span> data that the <tt class="function">read</tt> method returns.  The fact that this <span class="acronym">XML</span> data is now coming straight from a web page is completely irrelevant.  <tt class="function">minidom.parse</tt> doesn't know about web pages, and it doesn't care about web pages; it just knows about file-like objects.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As soon as you're done with it, be sure to close the file-like object that <tt class="function">urlopen</tt> gives you.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">By the way, this <span class="acronym">URL</span> is real, and it really is <span class="acronym">XML</span>.  It's an <span class="acronym">XML</span> representation of the current headlines on <a href="http://slashdot.org/">Slashdot</a>, a technical news and gossip site.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e25321"></a><h3 class="title">Example&nbsp;10.3.&nbsp;Parsing <span class="acronym">XML</span> from a string (the easy but inflexible way)
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">contents = "&lt;grammar&gt;&lt;ref id='bit'&gt;&lt;p&gt;0&lt;/p&gt;&lt;p&gt;1&lt;/p&gt;&lt;/ref&gt;&lt;/grammar&gt;"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parseString(contents)</span> <a name="kgp.openanything.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print xmldoc.toxml()</span>
<span class="computeroutput">&lt;?xml version="1.0" ?&gt;
&lt;grammar&gt;&lt;ref id="bit"&gt;&lt;p&gt;0&lt;/p&gt;&lt;p&gt;1&lt;/p&gt;&lt;/ref&gt;&lt;/grammar&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">minidom</tt> has a method, <tt class="function">parseString</tt>, which takes an entire <span class="acronym">XML</span> document as a string and parses it.  You can use this instead of <tt class="function">minidom.parse</tt> if you know you already have your entire <span class="acronym">XML</span> document in a string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>OK, so you can use the <tt class="function">minidom.parse</tt> function for parsing both local files and remote <span class="acronym">URL</span>s, but for parsing strings, you use... a different function.  That means that if you want to be able to take input from a
                  file, a <span class="acronym">URL</span>, or a string, you'll need special logic to check whether it's a string, and call the <tt class="function">parseString</tt> function instead.  How unsatisfying.
               </p>
               <p>If there were a way to turn a string into a file-like object, then you could simply pass this object to <tt class="function">minidom.parse</tt>.  And in fact, there is a module specifically designed for doing just that: <tt class="filename">StringIO</tt>.
               </p>
               <div class="example"><a name="kgp.openanything.stringio.example"></a><h3 class="title">Example&nbsp;10.4.&nbsp;Introducing <tt class="filename">StringIO</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">contents = "&lt;grammar&gt;&lt;ref id='bit'&gt;&lt;p&gt;0&lt;/p&gt;&lt;p&gt;1&lt;/p&gt;&lt;/ref&gt;&lt;/grammar&gt;"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import StringIO</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock = StringIO.StringIO(contents)</span>   <a name="kgp.openanything.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.read()</span>                          <a name="kgp.openanything.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">"&lt;grammar&gt;&lt;ref id='bit'&gt;&lt;p&gt;0&lt;/p&gt;&lt;p&gt;1&lt;/p&gt;&lt;/ref&gt;&lt;/grammar&gt;"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.read()</span>                          <a name="kgp.openanything.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">''</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.seek(0)</span>                         <a name="kgp.openanything.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.read(15)</span>                        <a name="kgp.openanything.4.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">'&lt;grammar&gt;&lt;ref i'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.read(15)</span>
<span class="computeroutput">"d='bit'&gt;&lt;p&gt;0&lt;/p"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.read()</span>
<span class="computeroutput">'&gt;&lt;p&gt;1&lt;/p&gt;&lt;/ref&gt;&lt;/grammar&gt;'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.close()</span>                         <a name="kgp.openanything.4.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="filename">StringIO</tt> module contains a single class, also called <tt class="classname">StringIO</tt>, which allows you to turn a string into a file-like object.  The <tt class="classname">StringIO</tt> class takes the string as a parameter when creating an instance.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you have a file-like object, and you can do all sorts of file-like things with it.  Like <tt class="function">read</tt>, which returns the original string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Calling <tt class="function">read</tt> again returns an empty string.  This is how real file objects work too; once you read the entire file, you can't read any
                              more without explicitly seeking to the beginning of the file.  The <tt class="classname">StringIO</tt> object works the same way.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can explicitly seek to the beginning of the string, just like seeking through a file, by using the <tt class="function">seek</tt> method of the <tt class="classname">StringIO</tt> object.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.4.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can also read the string in chunks, by passing a <tt class="varname">size</tt> parameter to the <tt class="function">read</tt> method.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.4.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">At any time, <tt class="function">read</tt> will return the rest of the string that you haven't read yet.  All of this is exactly how file objects work; hence the term
                              <span class="emphasis"><em>file-like object</em></span>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e25526"></a><h3 class="title">Example&nbsp;10.5.&nbsp;Parsing <span class="acronym">XML</span> from a string (the file-like object way)
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">contents = "&lt;grammar&gt;&lt;ref id='bit'&gt;&lt;p&gt;0&lt;/p&gt;&lt;p&gt;1&lt;/p&gt;&lt;/ref&gt;&lt;/grammar&gt;"</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock = StringIO.StringIO(contents)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse(ssock)</span> <a name="kgp.openanything.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">ssock.close()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print xmldoc.toxml()</span>
<span class="computeroutput">&lt;?xml version="1.0" ?&gt;
&lt;grammar&gt;&lt;ref id="bit"&gt;&lt;p&gt;0&lt;/p&gt;&lt;p&gt;1&lt;/p&gt;&lt;/ref&gt;&lt;/grammar&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you can pass the file-like object (really a <tt class="classname">StringIO</tt>) to <tt class="function">minidom.parse</tt>, which will call the object's <tt class="function">read</tt> method and happily parse away, never knowing that its input came from a hard-coded string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So now you know how to use a single function, <tt class="function">minidom.parse</tt>, to parse an <span class="acronym">XML</span> document stored on a web page, in a local file, or in a hard-coded string.  For a web page, you use <tt class="function">urlopen</tt> to get a file-like object; for a local file, you use <tt class="function">open</tt>; and for a string, you use <tt class="classname">StringIO</tt>.  Now let's take it one step further and generalize <span class="emphasis"><em>these</em></span> differences as well.
               </p>
               <div class="example"><a name="kgp.openanything.example"></a><h3 class="title">Example&nbsp;10.6.&nbsp;<tt class="function">openAnything</tt></h3><pre class="programlisting">
def openAnything(source):                  <a name="kgp.openanything.6.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    # try to open with urllib (if source is http, ftp, or file URL)
    import urllib                         
    try:                                  
        return urllib.urlopen(source)      <a name="kgp.openanything.6.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    except (IOError, OSError):            
        pass                              

    # try to open with native open function (if source is pathname)
    try:                                  
        return open(source)                <a name="kgp.openanything.6.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
    except (IOError, OSError):            
        pass                              

    # treat source as string
    import StringIO                       
    return StringIO.StringIO(str(source))  <a name="kgp.openanything.6.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.6.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">openAnything</tt> function takes a single parameter, <tt class="varname">source</tt>, and returns a file-like object.  <tt class="varname">source</tt> is a string of some sort; it can either be a <span class="acronym">URL</span> (like <tt class="literal">'http://slashdot.org/slashdot.rdf'</tt>), a full or partial pathname to a local file (like <tt class="literal">'binary.xml'</tt>), or a string that contains actual <span class="acronym">XML</span> data to be parsed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.6.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First, you see if <tt class="varname">source</tt> is a <span class="acronym">URL</span>.  You do this through brute force: you try to open it as a <span class="acronym">URL</span> and silently ignore errors caused by trying to open something which is not a <span class="acronym">URL</span>.  This is actually elegant in the sense that, if <tt class="filename">urllib</tt> ever supports new types of <span class="acronym">URL</span>s in the future, you will also support them without recoding.  If <tt class="filename">urllib</tt> is able to open <tt class="varname">source</tt>, then the <tt class="literal">return</tt> kicks you out of the function immediately and the following <tt class="literal">try</tt> statements never execute.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.6.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">On the other hand, if <tt class="filename">urllib</tt> yelled at you and told you that <tt class="varname">source</tt> wasn't a valid <span class="acronym">URL</span>, you assume it's a path to a file on disk and try to open it.  Again, you don't do anything fancy to check whether <tt class="varname">source</tt> is a valid filename or not (the rules for valid filenames vary wildly between different platforms anyway, so you'd probably
                              get them wrong anyway).  Instead, you just blindly open the file, and silently trap any errors.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.openanything.6.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">By this point, you need to assume that <tt class="varname">source</tt> is a string that has hard-coded data in it (since nothing else worked), so you use <tt class="classname">StringIO</tt> to create a file-like object out of it and return that.  (In fact, since you're using the <tt class="function">str</tt> function, <tt class="varname">source</tt> doesn't even need to be a string; it could be any object, and you'll use its string representation, as defined by its <tt class="function">__str__</tt> <a href="#fileinfo.morespecial" title="5.7.&nbsp;Advanced Special Class Methods">special method</a>.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now you can use this <tt class="function">openAnything</tt> function in conjunction with <tt class="function">minidom.parse</tt> to make a function that takes a <tt class="varname">source</tt> that refers to an <span class="acronym">XML</span> document somehow (either as a <span class="acronym">URL</span>, or a local filename, or a hard-coded <span class="acronym">XML</span> document in a string) and parses it.
               </p>
               <div class="example"><a name="d0e25723"></a><h3 class="title">Example&nbsp;10.7.&nbsp;Using <tt class="function">openAnything</tt> in <tt class="filename">kgp.py</tt></h3><pre class="programlisting">
class KantGenerator:
    def _load(self, source):
        sock = toolbox.openAnything(source)
        xmldoc = minidom.parse(sock).documentElement
        sock.close()
        return xmldoc</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.stdio"></a>10.2.&nbsp;Standard input, output, and error
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="acronym">UNIX</span> users are already familiar with the concept of standard input, standard output, and standard error.  This section is for
                     the rest of you.
                  </p>
               </div>
               <p>Standard output and standard error (commonly abbreviated <tt class="literal">stdout</tt> and <tt class="literal">stderr</tt>) are pipes that are built into every <span class="acronym">UNIX</span> system.  When you <tt class="function">print</tt> something, it goes to the <tt class="literal">stdout</tt> pipe; when your program crashes and prints out debugging information (like a traceback in <span class="application">Python</span>), it goes to the <tt class="literal">stderr</tt> pipe.  Both of these pipes are ordinarily just connected to the terminal window where you are working, so when a program
                  prints, you see the output, and when a program crashes, you see the debugging information.  (If you're working on a system
                  with a window-based <span class="application">Python</span> <span class="acronym">IDE</span>, <tt class="literal">stdout</tt> and <tt class="literal">stderr</tt> default to your &#8220;<span class="quote">Interactive Window</span>&#8221;.)
               </p>
               <div class="example"><a name="d0e25781"></a><h3 class="title">Example&nbsp;10.8.&nbsp;Introducing <tt class="literal">stdout</tt> and <tt class="literal">stderr</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for i in range(3):</span>
<tt class="prompt">...     </tt><span class="userinput">print 'Dive in'</span>             <a name="kgp.stdio.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">Dive in
Dive in
Dive in</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import sys</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for i in range(3):</span>
<tt class="prompt">...     </tt><span class="userinput">sys.stdout.write('Dive in')</span> <a name="kgp.stdio.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">Dive inDive inDive in</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for i in range(3):</span>
<tt class="prompt">...     </tt><span class="userinput">sys.stderr.write('Dive in')</span> <a name="kgp.stdio.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">Dive inDive inDive in</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#fileinfo.for.counter" title="Example&nbsp;6.9.&nbsp;Simple Counters">Example&nbsp;6.9, &#8220;Simple Counters&#8221;</a>, you can use <span class="application">Python</span>'s built-in <tt class="function">range</tt> function to build simple counter loops that repeat something a set number of times.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">stdout</tt> is a file-like object; calling its <tt class="function">write</tt> function will print out whatever string you give it.  In fact, this is what the <tt class="function">print</tt> function really does; it adds a carriage return to the end of the string you're printing, and calls <tt class="function">sys.stdout.write</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In the simplest case, <tt class="literal">stdout</tt> and <tt class="literal">stderr</tt> send their output to the same place: the <span class="application">Python</span> <span class="acronym">IDE</span> (if you're in one), or the terminal (if you're running <span class="application">Python</span> from the command line).  Like <tt class="literal">stdout</tt>, <tt class="literal">stderr</tt> does not add carriage returns for you; if you want them, add them yourself.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p><tt class="literal">stdout</tt> and <tt class="literal">stderr</tt> are both file-like objects, like the ones you discussed in <a href="#kgp.openanything" title="10.1.&nbsp;Abstracting input sources">Section&nbsp;10.1, &#8220;Abstracting input sources&#8221;</a>, but they are both write-only.  They have no <tt class="function">read</tt> method, only <tt class="function">write</tt>.  Still, they are file-like objects, and you can assign any other file- or file-like object to them to redirect their output.
               </p>
               <div class="example"><a name="d0e25905"></a><h3 class="title">Example&nbsp;10.9.&nbsp;Redirecting output</h3><pre class="screen">
<tt class="prompt">[you@localhost kgp]$ </tt><span class="userinput">python stdout.py</span>
<span class="computeroutput">Dive in</span>
<tt class="prompt">[you@localhost kgp]$ </tt><span class="userinput">cat out.log</span>
<span class="computeroutput">This message will be logged instead of displayed</span></pre><p>(On Windows, you can use <tt class="literal">type</tt> instead of <tt class="literal">cat</tt> to display the contents of a file.)
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
#stdout.py
import sys

print 'Dive in'                                          <a name="kgp.stdio.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
saveout = sys.stdout                                     <a name="kgp.stdio.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
fsock = open('out.log', 'w')                             <a name="kgp.stdio.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
sys.stdout = fsock                                       <a name="kgp.stdio.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
print 'This message will be logged instead of displayed' <a name="kgp.stdio.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
sys.stdout = saveout                                     <a name="kgp.stdio.2.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
fsock.close()                                            <a name="kgp.stdio.2.7"></a><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This will print to the <span class="acronym">IDE</span> &#8220;<span class="quote">Interactive Window</span>&#8221; (or the terminal, if running the script from the command line).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Always save <tt class="literal">stdout</tt> before redirecting it, so you can set it back to normal later.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Open a file for writing.  If the file doesn't exist, it will be created.  If the file does exist, it will be overwritten.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Redirect all further output to the new file you just opened.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This will be &#8220;<span class="quote">printed</span>&#8221; to the log file only; it will not be visible in the <span class="acronym">IDE</span> window or on the screen.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.2.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Set <tt class="literal">stdout</tt> back to the way it was before you mucked with it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.2.7"><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Close the log file.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Redirecting <tt class="literal">stderr</tt> works exactly the same way, using <tt class="function">sys.stderr</tt> instead of <tt class="function">sys.stdout</tt>.
               </p>
               <div class="example"><a name="d0e26005"></a><h3 class="title">Example&nbsp;10.10.&nbsp;Redirecting error information</h3><pre class="screen">
<tt class="prompt">[you@localhost kgp]$ </tt><span class="userinput">python stderr.py</span>
<tt class="prompt">[you@localhost kgp]$ </tt><span class="userinput">cat error.log</span>
<span class="computeroutput">Traceback (most recent line last):
  File "stderr.py", line 5, in ?
    raise Exception, 'this error will be logged'
Exception: this error will be logged</span></pre><p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
#stderr.py
import sys

fsock = open('error.log', 'w')               <a name="kgp.stdio.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
sys.stderr = fsock                           <a name="kgp.stdio.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
raise Exception, 'this error will be logged' <a name="kgp.stdio.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"> <a name="kgp.stdio.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Open the log file where you want to store debugging information.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Redirect standard error by assigning the file object of the newly-opened log file to <tt class="literal">stderr</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Raise an exception.  Note from the screen output that this does <span class="emphasis"><em>not</em></span> print anything on screen.  All the normal traceback information has been written to <tt class="filename">error.log</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Also note that you're not explicitly closing your log file, nor are you setting <tt class="literal">stderr</tt> back to its original value.  This is fine, since once the program crashes (because of the exception), <span class="application">Python</span> will clean up and close the file for us, and it doesn't make any difference that <tt class="literal">stderr</tt> is never restored, since, as I mentioned, the program crashes and <span class="application">Python</span> ends.  Restoring the original is more important for <tt class="literal">stdout</tt>, if you expect to go do other stuff within the same script afterwards.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Since it is so common to write error messages to standard error, there is a shorthand syntax that can be used instead of going
                  through the hassle of redirecting it outright.
               </p>
               <div class="example"><a name="kgp.stdio.print.example"></a><h3 class="title">Example&nbsp;10.11.&nbsp;Printing to <tt class="literal">stderr</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print 'entering function'</span>
<span class="computeroutput">entering function</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import sys</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print &gt;&gt; sys.stderr, 'entering function'</span> <a name="kgp.stdio.6.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">entering function</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.6.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This shorthand syntax of the <tt class="function">print</tt> statement can be used to write to any open file, or file-like object.  In this case, you can redirect a single <tt class="function">print</tt> statement to <tt class="literal">stderr</tt> without affecting subsequent <tt class="function">print</tt> statements.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Standard input, on the other hand, is a read-only file object, and it represents the data flowing into the program from some
                  previous program.  This will likely not make much sense to classic <span class="abbrev">Mac</span> <span class="acronym">OS</span> users, or even Windows users unless you were ever fluent on the <span class="acronym">MS-DOS</span> command line.  The way it works is that you can construct a chain of commands in a single line, so that one program's output
                  becomes the input for the next program in the chain.  The first program simply outputs to standard output (without doing any
                  special redirecting itself, just doing normal <tt class="function">print</tt> statements or whatever), and the next program reads from standard input, and the operating system takes care of connecting
                  one program's output to the next program's input.
               </p>
               <div class="example"><a name="d0e26136"></a><h3 class="title">Example&nbsp;10.12.&nbsp;Chaining commands</h3><pre class="screen">
<tt class="prompt">[you@localhost kgp]$ </tt><span class="userinput">python kgp.py -g binary.xml</span>         <a name="kgp.stdio.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">01100111</span>
<tt class="prompt">[you@localhost kgp]$ </tt><span class="userinput">cat binary.xml</span>                      <a name="kgp.stdio.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE grammar PUBLIC "-//diveintopython.org//DTD Kant Generator Pro v1.0//EN" "kgp.dtd"&gt;
&lt;grammar&gt;
&lt;ref id="bit"&gt;
  &lt;p&gt;0&lt;/p&gt;
  &lt;p&gt;1&lt;/p&gt;
&lt;/ref&gt;
&lt;ref id="byte"&gt;
  &lt;p&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;\
&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;xref id="bit"/&gt;&lt;/p&gt;
&lt;/ref&gt;
&lt;/grammar&gt;</span>
<tt class="prompt">[you@localhost kgp]$ </tt><span class="userinput">cat binary.xml | python kgp.py -g -</span> <a name="kgp.stdio.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"> <a name="kgp.stdio.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">10110001</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#kgp.divein" title="9.1.&nbsp;Diving in">Section&nbsp;9.1, &#8220;Diving in&#8221;</a>, this will print a string of eight random bits, <tt class="constant">0</tt> or <tt class="constant">1</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This simply prints out the entire contents of <tt class="filename">binary.xml</tt>.  (Windows users should use <tt class="literal">type</tt> instead of <tt class="literal">cat</tt>.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This prints the contents of <tt class="filename">binary.xml</tt>, but the &#8220;<span class="quote"><tt class="literal">|</tt></span>&#8221; character, called the &#8220;<span class="quote">pipe</span>&#8221; character, means that the contents will not be printed to the screen.  Instead, they will become the standard input of the
                              next command, which in this case calls your <span class="application">Python</span> script.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Instead of specifying a module (like <tt class="filename">binary.xml</tt>), you specify &#8220;<span class="quote"><tt class="literal">-</tt></span>&#8221;, which causes your script to load the grammar from standard input instead of from a specific file on disk.  (More on how
                              this happens in the next example.)  So the effect is the same as the first syntax, where you specified the grammar filename
                              directly, but think of the expansion possibilities here.  Instead of simply doing <tt class="literal">cat binary.xml</tt>, you could run a script that dynamically generates the grammar, then you can pipe it into your script.  It could come from
                              anywhere: a database, or some grammar-generating meta-script, or whatever.  The point is that you don't need to change your
                              <tt class="filename">kgp.py</tt> script at all to incorporate any of this functionality.  All you need to do is be able to take grammar files from standard
                              input, and you can separate all the other logic into another program.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So how does the script &#8220;<span class="quote">know</span>&#8221; to read from standard input when the grammar file is &#8220;<span class="quote"><tt class="literal">-</tt></span>&#8221;?  It's not magic; it's just code.
               </p>
               <div class="example"><a name="d0e26237"></a><h3 class="title">Example&nbsp;10.13.&nbsp;Reading from standard input in <tt class="filename">kgp.py</tt></h3><pre class="programlisting">
def openAnything(source):
    if source == "-":    <a name="kgp.stdio.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        import sys
        return sys.stdin

    # try to open with urllib (if source is http, ftp, or file URL)
    import urllib
    try:

[... snip ...]</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.stdio.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the <tt class="function">openAnything</tt> function from <tt class="filename">toolbox.py</tt>, which you previously examined in <a href="#kgp.openanything" title="10.1.&nbsp;Abstracting input sources">Section&nbsp;10.1, &#8220;Abstracting input sources&#8221;</a>.  All you've done is add three lines of code at the beginning of the function to check if the source is &#8220;<span class="quote"><tt class="literal">-</tt></span>&#8221;; if so, you return <tt class="literal">sys.stdin</tt>.  Really, that's it!  Remember, <tt class="literal">stdin</tt> is a file-like object with a <tt class="function">read</tt> method, so the rest of the code (in <tt class="filename">kgp.py</tt>, where you call <tt class="function">openAnything</tt>) doesn't change a bit.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.cache"></a>10.3.&nbsp;Caching node lookups
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><tt class="filename">kgp.py</tt> employs several tricks which may or may not be useful to you in your <span class="acronym">XML</span> processing.  The first one takes advantage of the consistent structure of the input documents to build a cache of nodes.
                  </p>
               </div>
               <p>A grammar file defines a series of <tt class="sgmltag-element">ref</tt> elements.  Each <tt class="sgmltag-element">ref</tt> contains one or more <tt class="sgmltag-element">p</tt> elements, which can contain a lot of different things, including <tt class="sgmltag-element">xref</tt>s.  Whenever you encounter an <tt class="sgmltag-element">xref</tt>, you look for a corresponding <tt class="sgmltag-element">ref</tt> element with the same <tt class="sgmltag-element">id</tt> attribute, and choose one of the <tt class="sgmltag-element">ref</tt> element's children and parse it.  (You'll see how this random choice is made in the next section.)
               </p>
               <p>This is how you build up the grammar: define <tt class="sgmltag-element">ref</tt> elements for the smallest pieces, then define <tt class="sgmltag-element">ref</tt> elements which "include" the first <tt class="sgmltag-element">ref</tt> elements by using <tt class="sgmltag-element">xref</tt>, and so forth.  Then you parse the "largest" reference and follow each <tt class="sgmltag-element">xref</tt>, and eventually output real text.  The text you output depends on the (random) decisions you make each time you fill in an
                  <tt class="sgmltag-element">xref</tt>, so the output is different each time.
               </p>
               <p>This is all very flexible, but there is one downside: performance.  When you find an <tt class="sgmltag-element">xref</tt> and need to find the corresponding <tt class="sgmltag-element">ref</tt> element, you have a problem.  The <tt class="sgmltag-element">xref</tt> has an <tt class="sgmltag-element">id</tt> attribute, and you want to find the <tt class="sgmltag-element">ref</tt> element that has that same <tt class="sgmltag-element">id</tt> attribute, but there is no easy way to do that.  The slow way to do it would be to get the entire list of <tt class="sgmltag-element">ref</tt> elements each time, then manually loop through and look at each <tt class="sgmltag-element">id</tt> attribute.  The fast way is to do that once and build a cache, in the form of a dictionary.
               </p>
               <div class="example"><a name="d0e26362"></a><h3 class="title">Example&nbsp;10.14.&nbsp;<tt class="function">loadGrammar</tt></h3><pre class="programlisting">
    def loadGrammar(self, grammar):                         
        self.grammar = self._load(grammar)                  
        self.refs = {}                                       <a name="kgp.cache.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        for ref in self.grammar.getElementsByTagName("ref"): <a name="kgp.cache.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
            self.refs[ref.attributes["id"].value] = ref      <a name="kgp.cache.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"> <a name="kgp.cache.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.cache.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Start by creating an empty dictionary, <tt class="varname">self.refs</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.cache.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#kgp.search" title="9.5.&nbsp;Searching for elements">Section&nbsp;9.5, &#8220;Searching for elements&#8221;</a>, <tt class="function">getElementsByTagName</tt> returns a list of all the elements of a particular name.  You easily can get a list of all the <tt class="sgmltag-element">ref</tt> elements, then simply loop through that list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.cache.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#kgp.attributes" title="9.6.&nbsp;Accessing element attributes">Section&nbsp;9.6, &#8220;Accessing element attributes&#8221;</a>, you can access individual attributes of an element by name, using standard dictionary syntax.  So the keys of the <tt class="varname">self.refs</tt> dictionary will be the values of the <tt class="sgmltag-element">id</tt> attribute of each <tt class="sgmltag-element">ref</tt> element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.cache.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The values of the <tt class="varname">self.refs</tt> dictionary will be the <tt class="sgmltag-element">ref</tt> elements themselves.  As you saw in <a href="#kgp.parse" title="9.3.&nbsp;Parsing XML">Section&nbsp;9.3, &#8220;Parsing XML&#8221;</a>, each element, each node, each comment, each piece of text in a parsed <span class="acronym">XML</span> document is an object.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Once you build this cache, whenever you come across an <tt class="sgmltag-element">xref</tt> and need to find the <tt class="sgmltag-element">ref</tt> element with the same <tt class="sgmltag-element">id</tt> attribute, you can simply look it up in <tt class="varname">self.refs</tt>.
               </p>
               <div class="example"><a name="d0e26435"></a><h3 class="title">Example&nbsp;10.15.&nbsp;Using the <tt class="sgmltag-element">ref</tt> element cache
                  </h3><pre class="programlisting">
    def do_xref(self, node):
        id = node.attributes["id"].value
        self.parse(self.randomChildElement(self.refs[id]))</pre></div>
               <p>You'll explore the <tt class="function">randomChildElement</tt> function in the next section.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.child"></a>10.4.&nbsp;Finding direct children of a node
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Another useful techique when parsing <span class="acronym">XML</span> documents is finding all the direct child elements of a particular element.  For instance, in the grammar files, a <tt class="sgmltag-element">ref</tt> element can have several <tt class="sgmltag-element">p</tt> elements, each of which can contain many things, including other <tt class="sgmltag-element">p</tt> elements.  You want to find just the <tt class="sgmltag-element">p</tt> elements that are children of the <tt class="sgmltag-element">ref</tt>, not <tt class="sgmltag-element">p</tt> elements that are children of other <tt class="sgmltag-element">p</tt> elements.
                  </p>
               </div>
               <p>You might think you could simply use <tt class="function">getElementsByTagName</tt> for this, but you can't.  <tt class="function">getElementsByTagName</tt> searches recursively and returns a single list for all the elements it finds.  Since <tt class="sgmltag-element">p</tt> elements can contain other <tt class="sgmltag-element">p</tt> elements, you can't use <tt class="function">getElementsByTagName</tt>, because it would return nested <tt class="sgmltag-element">p</tt> elements that you don't want.  To find only direct child elements, you'll need to do it yourself.
               </p>
               <div class="example"><a name="d0e26500"></a><h3 class="title">Example&nbsp;10.16.&nbsp;Finding direct child elements</h3><pre class="programlisting">
    def randomChildElement(self, node):
        choices = [e for e in node.childNodes
                   if e.nodeType == e.ELEMENT_NODE] <a name="kgp.child.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"> <a name="kgp.child.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"> <a name="kgp.child.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        chosen = random.choice(choices)             <a name="kgp.child.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        return chosen                              </pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.child.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#kgp.parse.gettingchildnodes.example" title="Example&nbsp;9.9.&nbsp;Getting child nodes">Example&nbsp;9.9, &#8220;Getting child nodes&#8221;</a>, the <tt class="function">childNodes</tt> attribute returns a list of all the child nodes of an element.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.child.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">However, as you saw in <a href="#kgp.parse.childnodescanbetext.example" title="Example&nbsp;9.11.&nbsp;Child nodes can be text">Example&nbsp;9.11, &#8220;Child nodes can be text&#8221;</a>, the list returned by <tt class="function">childNodes</tt> contains all different types of nodes, including text nodes.  That's not what you're looking for here.  You only want the
                              children that are elements.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.child.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each node has a <tt class="varname">nodeType</tt> attribute, which can be <tt class="literal">ELEMENT_NODE</tt>, <tt class="literal">TEXT_NODE</tt>, <tt class="literal">COMMENT_NODE</tt>, or any number of other values.  The complete list of possible values is in the <tt class="filename">__init__.py</tt> file in the <tt class="classname">xml.dom</tt> package.  (See <a href="#kgp.packages" title="9.2.&nbsp;Packages">Section&nbsp;9.2, &#8220;Packages&#8221;</a> for more on packages.)  But you're just interested in nodes that are elements, so you can filter the list to only include
                              those nodes whose <tt class="varname">nodeType</tt> is <tt class="literal">ELEMENT_NODE</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.child.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Once you have a list of actual elements, choosing a random one is easy.  <span class="application">Python</span> comes with a module called <tt class="filename">random</tt> which includes several useful functions.  The <tt class="function">random.choice</tt> function takes a list of any number of items and returns a random item.  For example, if the <tt class="sgmltag-element">ref</tt> elements contains several <tt class="sgmltag-element">p</tt> elements, then <tt class="varname">choices</tt> would be a list of <tt class="sgmltag-element">p</tt> elements, and <tt class="varname">chosen</tt> would end up being assigned exactly one of them, selected at random.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.handler"></a>10.5.&nbsp;Creating separate handlers by node type
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The third useful <span class="acronym">XML</span> processing tip involves separating your code into logical functions, based on node types and element names.  Parsed <span class="acronym">XML</span> documents are made up of various types of nodes, each represented by a <span class="application">Python</span> object.  The root level of the document itself is represented by a <tt class="classname">Document</tt> object.  The <tt class="classname">Document</tt> then contains one or more <tt class="classname">Element</tt> objects (for actual <span class="acronym">XML</span> tags), each of which may contain other <tt class="classname">Element</tt> objects, <tt class="classname">Text</tt> objects (for bits of text), or <tt class="classname">Comment</tt> objects (for embedded comments).  <span class="application">Python</span> makes it easy to write a dispatcher to separate the logic for each node type.
                  </p>
               </div>
               <div class="example"><a name="d0e26627"></a><h3 class="title">Example&nbsp;10.17.&nbsp;Class names of parsed <span class="acronym">XML</span> objects
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from xml.dom import minidom</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc = minidom.parse('kant.xml')</span> <a name="kgp.handler.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc</span>
<span class="computeroutput">&lt;xml.dom.minidom.Document instance at 0x01359DE8&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc.__class__</span>                   <a name="kgp.handler.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;class xml.dom.minidom.Document at 0x01105D40&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xmldoc.__class__.__name__</span>          <a name="kgp.handler.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'Document'</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Assume for a moment that <tt class="filename">kant.xml</tt> is in the current directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#kgp.packages" title="9.2.&nbsp;Packages">Section&nbsp;9.2, &#8220;Packages&#8221;</a>, the object returned by parsing an <span class="acronym">XML</span> document is a <tt class="classname">Document</tt> object, as defined in the <tt class="filename">minidom.py</tt> in the <tt class="filename">xml.dom</tt> package.  As you saw in <a href="#fileinfo.create" title="5.4.&nbsp;Instantiating Classes">Section&nbsp;5.4, &#8220;Instantiating Classes&#8221;</a>, <tt class="literal">__class__</tt> is built-in attribute of every <span class="application">Python</span> object.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Furthermore, <tt class="literal">__name__</tt> is a built-in attribute of every <span class="application">Python</span> class, and it is a string.  This string is not mysterious; it's the same as the class name you type when you define a class
                              yourself.  (See <a href="#fileinfo.class" title="5.3.&nbsp;Defining Classes">Section&nbsp;5.3, &#8220;Defining Classes&#8221;</a>.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Fine, so now you can get the class name of any particular <span class="acronym">XML</span> node (since each <span class="acronym">XML</span> node is represented as a <span class="application">Python</span> object).  How can you use this to your advantage to separate the logic of parsing each node type?  The answer is <tt class="function">getattr</tt>, which you first saw in <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr">Section&nbsp;4.4, &#8220;Getting Object References With getattr&#8221;</a>.
               </p>
               <div class="example"><a name="d0e26733"></a><h3 class="title">Example&nbsp;10.18.&nbsp;<tt class="function">parse</tt>, a generic <span class="acronym">XML</span> node dispatcher
                  </h3><pre class="programlisting">
    def parse(self, node):          
        parseMethod = getattr(self, "parse_%s" % node.__class__.__name__) <a name="kgp.handler.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"> <a name="kgp.handler.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        parseMethod(node) <a name="kgp.handler.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First off, notice that you're constructing a larger string based on the class name of the node you were passed (in the <tt class="varname">node</tt> argument).  So if you're passed a <tt class="classname">Document</tt> node, you're constructing the string <tt class="literal">'parse_Document'</tt>, and so forth.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you can treat that string as a function name, and get a reference to the function itself using <tt class="function">getattr</tt></td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Finally, you can call that function and pass the node itself as an argument.  The next example shows the definitions of each
                              of these functions.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e26769"></a><h3 class="title">Example&nbsp;10.19.&nbsp;Functions called by the <tt class="function">parse</tt> dispatcher
                  </h3><pre class="programlisting">
    def parse_Document(self, node): <a name="kgp.handler.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        self.parse(node.documentElement)

    def parse_Text(self, node):    <a name="kgp.handler.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        text = node.data
        if self.capitalizeNextWord:
            self.pieces.append(text[0].upper())
            self.pieces.append(text[1:])
            self.capitalizeNextWord = 0
        else:
            self.pieces.append(text)

    def parse_Comment(self, node): <a name="kgp.handler.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        pass

    def parse_Element(self, node): <a name="kgp.handler.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        handlerMethod = getattr(self, "do_%s" % node.tagName)
        handlerMethod(node)</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">parse_Document</tt> is only ever called once, since there is only one <tt class="classname">Document</tt> node in an <span class="acronym">XML</span> document, and only one <tt class="classname">Document</tt> object in the parsed <span class="acronym">XML</span> representation.  It simply turns around and parses the root element of the grammar file.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">parse_Text</tt> is called on nodes that represent bits of text.  The function itself does some special processing to handle automatic capitalization
                              of the first word of a sentence, but otherwise simply appends the represented text to a list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">parse_Comment</tt> is just a <tt class="literal">pass</tt>, since you don't care about embedded comments in the grammar files.  Note, however, that you still need to define the function
                              and explicitly make it do nothing.  If the function did not exist, the generic <tt class="function">parse</tt> function would fail as soon as it stumbled on a comment, because it would try to find the non-existent <tt class="function">parse_Comment</tt> function.  Defining a separate function for every node type, even ones you don't use, allows the generic <tt class="function">parse</tt> function to stay simple and dumb.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.handler.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">parse_Element</tt> method is actually itself a dispatcher, based on the name of the element's tag.  The basic idea is the same: take what distinguishes
                              elements from each other (their tag names) and dispatch to a separate function for each of them.  You construct a string like
                              <tt class="literal">'do_xref'</tt> (for an <tt class="sgmltag-element">&lt;xref&gt;</tt> tag), find a function of that name, and call it.  And so forth for each of the other tag names that might be found in the
                              course of parsing a grammar file (<tt class="sgmltag-element">&lt;p&gt;</tt> tags, <tt class="sgmltag-element">&lt;choice&gt;</tt> tags).
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>In this example, the dispatch functions <tt class="function">parse</tt> and <tt class="function">parse_Element</tt> simply find other methods in the same class.  If your processing is very complex (or you have many different tag names),
                  you could break up your code into separate modules, and use dynamic importing to import each module and call whatever functions
                  you needed.  Dynamic importing will be discussed in <a href="#regression" title="Chapter&nbsp;16.&nbsp;Functional Programming">Chapter&nbsp;16, <i>Functional Programming</i></a>.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.commandline"></a>10.6.&nbsp;Handling command-line arguments
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> fully supports creating programs that can be run on the command line, complete with command-line arguments and either short-
                     or long-style flags to specify various options.  None of this is <span class="acronym">XML</span>-specific, but this script makes good use of command-line processing, so it seemed like a good time to mention it.
                  </p>
               </div>
               <p>It's difficult to talk about command-line processing without understanding how command-line arguments are exposed to your
                  <span class="application">Python</span> program, so let's write a simple program to see them.
               </p>
               <div class="example"><a name="d0e26871"></a><h3 class="title">Example&nbsp;10.20.&nbsp;Introducing <tt class="varname">sys.argv</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
#argecho.py
import sys

for arg in sys.argv: <a name="kgp.commandline.0.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    print arg</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.0.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each command-line argument passed to the program will be in <tt class="varname">sys.argv</tt>, which is just a list.  Here you are printing each argument on a separate line.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e26892"></a><h3 class="title">Example&nbsp;10.21.&nbsp;The contents of <tt class="varname">sys.argv</tt></h3><pre class="screen">
<tt class="prompt">[you@localhost py]$ </tt><span class="userinput">python argecho.py</span>             <a name="kgp.commandline.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">argecho.py</span>
<tt class="prompt">[you@localhost py]$ </tt><span class="userinput">python argecho.py abc def</span>     <a name="kgp.commandline.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">argecho.py
abc
def</span>
<tt class="prompt">[you@localhost py]$ </tt><span class="userinput">python argecho.py --help</span>      <a name="kgp.commandline.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">argecho.py
--help</span>
<tt class="prompt">[you@localhost py]$ </tt><span class="userinput">python argecho.py -m kant.xml</span> <a name="kgp.commandline.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">argecho.py
-m
kant.xml</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first thing to know about <tt class="varname">sys.argv</tt> is that it contains the name of the script you're calling.  You will actually use this knowledge to your advantage later,
                              in <a href="#regression" title="Chapter&nbsp;16.&nbsp;Functional Programming">Chapter&nbsp;16, <i>Functional Programming</i></a>.  Don't worry about it for now.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Command-line arguments are separated by spaces, and each shows up as a separate element in the <tt class="varname">sys.argv</tt> list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Command-line flags, like <tt class="literal">--help</tt>, also show up as their own element in the <tt class="varname">sys.argv</tt> list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To make things even more interesting, some command-line flags themselves take arguments.  For instance, here you have a flag
                              (<tt class="literal">-m</tt>) which takes an argument (<tt class="literal">kant.xml</tt>).  Both the flag itself and the flag's argument are simply sequential elements in the <tt class="varname">sys.argv</tt> list.  No attempt is made to associate one with the other; all you get is a list.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So as you can see, you certainly have all the information passed on the command line, but then again, it doesn't look like
                  it's going to be all that easy to actually use it.  For simple programs that only take a single argument and have no flags,
                  you can simply use <tt class="literal">sys.argv[1]</tt> to access the argument.  There's no shame in this; I do it all the time.  For more complex programs, you need the <tt class="filename">getopt</tt> module.
               </p>
               <div class="example"><a name="d0e26982"></a><h3 class="title">Example&nbsp;10.22.&nbsp;Introducing <tt class="filename">getopt</tt></h3><pre class="programlisting">
def main(argv):                         
    grammar = "kant.xml"                 <a name="kgp.commandline.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    try:                                
        opts, args = getopt.getopt(argv, "hg:d", ["help", "grammar="]) <a name="kgp.commandline.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    except getopt.GetoptError:           <a name="kgp.commandline.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        usage()                          <a name="kgp.commandline.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        sys.exit(2)                     

...

if __name__ == "__main__":
    main(sys.argv[1:])</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First off, look at the bottom of the example and notice that you're calling the <tt class="function">main</tt> function with <tt class="literal">sys.argv[1:]</tt>.  Remember, <tt class="literal">sys.argv[0]</tt> is the name of the script that you're running; you don't care about that for command-line processing, so you chop it off
                              and pass the rest of the list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is where all the interesting processing happens.  The <tt class="function">getopt</tt> function of the <tt class="filename">getopt</tt> module takes three parameters: the argument list (which you got from <tt class="literal">sys.argv[1:]</tt>), a string containing all the possible single-character command-line flags that this program accepts, and a list of longer
                              command-line flags that are equivalent to the single-character versions.  This is quite confusing at first glance, and is
                              explained in more detail below.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If anything goes wrong trying to parse these command-line flags, <tt class="filename">getopt</tt> will raise an exception, which you catch.  You told <tt class="filename">getopt</tt> all the flags you understand, so this probably means that the end user passed some command-line flag that you don't understand.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As is standard practice in the <span class="acronym">UNIX</span> world, when the script is passed flags it doesn't understand, you print out a summary of proper usage and exit gracefully.
                               Note that I haven't shown the <tt class="function">usage</tt> function here.  You would still need to code that somewhere and have it print out the appropriate summary; it's not automatic.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So what are all those parameters you pass to the <tt class="function">getopt</tt> function?  Well, the first one is simply the raw list of command-line flags and arguments (not including the first element,
                  the script name, which you already chopped off before calling the <tt class="function">main</tt> function).  The second is the list of short command-line flags that the script accepts.
               </p>
               <div class="variablelist">
                  <h3 class="title"><tt class="literal">"hg:d"</tt></h3>
                  <dl>
                     <dt><span class="term"><tt class="literal">-h</tt></span></dt>
                     <dd>print usage summary</dd>
                     <dt><span class="term"><tt class="literal">-g ...</tt></span></dt>
                     <dd>use specified grammar file or URL</dd>
                     <dt><span class="term"><tt class="literal">-d</tt></span></dt>
                     <dd>show debugging information while parsing</dd>
                  </dl>
               </div>
               <p>The first and third flags are simply standalone flags; you specify them or you don't, and they do things (print help) or change
                  state (turn on debugging).  However, the second flag (<tt class="literal">-g</tt>) <span class="emphasis"><em>must</em></span> be followed by an argument, which is the name of the grammar file to read from.  In fact it can be a filename or a web address,
                  and you don't know which yet (you'll figure it out later), but you know it has to be <span class="emphasis"><em>something</em></span>.  So you tell <tt class="filename">getopt</tt> this by putting a colon after the <tt class="literal">g</tt> in that second parameter to the <tt class="function">getopt</tt> function.
               </p>
               <p>To further complicate things, the script accepts either short flags (like <tt class="literal">-h</tt>) or long flags (like <tt class="literal">--help</tt>), and you want them to do the same thing.  This is what the third parameter to <tt class="function">getopt</tt> is for, to specify a list of the long flags that correspond to the short flags you specified in the second parameter.
               </p>
               <div class="variablelist">
                  <h3 class="title"><tt class="literal">["help", "grammar="]</tt></h3>
                  <dl>
                     <dt><span class="term"><tt class="literal">--help</tt></span></dt>
                     <dd>print usage summary</dd>
                     <dt><span class="term"><tt class="literal">--grammar ...</tt></span></dt>
                     <dd>use specified grammar file or URL</dd>
                  </dl>
               </div>
               <p>Three things of note here:</p>
               <div class="orderedlist">
                  <ol type="1">
                     <li>All long flags are preceded by two dashes on the command line, but you don't include those dashes when calling <tt class="function">getopt</tt>.  They are understood.
                     </li>
                     <li>The <tt class="literal">--grammar</tt> flag must always be followed by an additional argument, just like the <tt class="literal">-g</tt> flag.  This is notated by an equals sign, <tt class="literal">"grammar="</tt>.
                     </li>
                     <li>The list of long flags is shorter than the list of short flags, because the <tt class="literal">-d</tt> flag does not have a corresponding long version.  This is fine; only <tt class="literal">-d</tt> will turn on debugging.  But the order of short and long flags needs to be the same, so you'll need to specify all the short
                        flags that <span class="emphasis"><em>do</em></span> have corresponding long flags first, then all the rest of the short flags.
                     </li>
                  </ol>
               </div>
               <p>Confused yet?  Let's look at the actual code and see if it makes sense in context.</p>
               <div class="example"><a name="d0e27157"></a><h3 class="title">Example&nbsp;10.23.&nbsp;Handling command-line arguments in <tt class="filename">kgp.py</tt></h3><pre class="programlisting">
def main(argv):                          <a name="kgp.commandline.3.0"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    grammar = "kant.xml"                
    try:                                
        opts, args = getopt.getopt(argv, "hg:d", ["help", "grammar="])
    except getopt.GetoptError:          
        usage()                         
        sys.exit(2)                     
    for opt, arg in opts:                <a name="kgp.commandline.3.1"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        if opt in ("-h", "--help"):      <a name="kgp.commandline.3.2"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
            usage()                     
            sys.exit()                  
        elif opt == '-d':                <a name="kgp.commandline.3.3"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
            global _debug               
            _debug = 1                  
        elif opt in ("-g", "--grammar"): <a name="kgp.commandline.3.4"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
            grammar = arg               

    source = "".join(args)               <a name="kgp.commandline.3.5"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">

    k = KantGenerator(grammar, source)
    print k.output()</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.3.0"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="varname">grammar</tt> variable will keep track of the grammar file you're using.  You initialize it here in case it's not specified on the command
                              line (using either the <tt class="literal">-g</tt> or the <tt class="literal">--grammar</tt> flag).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.3.1"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="varname">opts</tt> variable that you get back from <tt class="function">getopt</tt> contains a list of tuples: <tt class="varname">flag</tt> and <tt class="varname">argument</tt>.  If the flag doesn't take an argument, then <tt class="varname">arg</tt> will simply be <tt class="literal">None</tt>.  This makes it easier to loop through the flags.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.3.2"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">getopt</tt> validates that the command-line flags are acceptable, but it doesn't do any sort of conversion between short and long flags.
                               If you specify the <tt class="literal">-h</tt> flag, <tt class="varname">opt</tt> will contain <tt class="literal">"-h"</tt>; if you specify the <tt class="literal">--help</tt> flag, <tt class="varname">opt</tt> will contain <tt class="literal">"--help"</tt>.  So you need to check for both.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.3.3"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember, the <tt class="literal">-d</tt> flag didn't have a corresponding long flag, so you only need to check for the short form.  If you find it, you set a global
                              variable that you'll refer to later to print out debugging information.  (I used this during the development of the script.
                               What, you thought all these examples worked on the first try?)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.3.4"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If you find a grammar file, either with a <tt class="literal">-g</tt> flag or a <tt class="literal">--grammar</tt> flag, you save the argument that followed it (stored in <tt class="varname">arg</tt>) into the <tt class="varname">grammar</tt> variable, overwriting the default that you initialized at the top of the <tt class="function">main</tt> function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#kgp.commandline.3.5"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">That's it.  You've looped through and dealt with all the command-line flags.  That means that anything left must be command-line
                              arguments.  These come back from the <tt class="function">getopt</tt> function in the <tt class="varname">args</tt> variable.  In this case, you're treating them as source material for the parser.  If there are no command-line arguments
                              specified, <tt class="varname">args</tt> will be an empty list, and <tt class="varname">source</tt> will end up as the empty string.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.alltogether"></a>10.7.&nbsp;Putting it all together
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You've covered a lot of ground.  Let's step back and see how all the pieces fit together.</p>
               </div>
               <p>To start with, this is a script that <a href="#kgp.commandline" title="10.6.&nbsp;Handling command-line arguments">takes its arguments on the command line</a>, using the <tt class="filename">getopt</tt> module.
               </p>
               <div class="informalexample"><pre class="programlisting">
def main(argv):                         
...
    try:                                
        opts, args = getopt.getopt(argv, "hg:d", ["help", "grammar="])
    except getopt.GetoptError:          
...
    for opt, arg in opts:               
...</pre></div>
               <p>You create a new instance of the <tt class="classname">KantGenerator</tt> class, and pass it the grammar file and source that may or may not have been specified on the command line.
               </p>
               <div class="informalexample"><pre class="programlisting">
    k = KantGenerator(grammar, source)</pre></div>
               <p>The <tt class="classname">KantGenerator</tt> instance automatically loads the grammar, which is an <span class="acronym">XML</span> file.  You use your custom <tt class="function">openAnything</tt> function to open the file (which <a href="#kgp.openanything" title="10.1.&nbsp;Abstracting input sources">could be stored in a local file or a remote web server</a>), then use the built-in <tt class="filename">minidom</tt> parsing functions to <a href="#kgp.parse" title="9.3.&nbsp;Parsing XML">parse the <span class="acronym">XML</span> into a tree of <span class="application">Python</span> objects</a>.
               </p>
               <div class="informalexample"><pre class="programlisting">
    def _load(self, source):
        sock = toolbox.openAnything(source)
        xmldoc = minidom.parse(sock).documentElement
        sock.close()</pre></div>
               <p>Oh, and along the way, you take advantage of your knowledge of the structure of the <span class="acronym">XML</span> document to <a href="#kgp.cache" title="10.3.&nbsp;Caching node lookups">set up a little cache of references</a>, which are just elements in the <span class="acronym">XML</span> document.
               </p>
               <div class="informalexample"><pre class="programlisting">
    def loadGrammar(self, grammar):                         
        for ref in self.grammar.getElementsByTagName("ref"):
            self.refs[ref.attributes["id"].value] = ref     </pre></div>
               <p>If you specified some source material on the command line, you use that; otherwise you rip through the grammar looking for
                  the "top-level" reference (that isn't referenced by anything else) and use that as a starting point.
               </p>
               <div class="informalexample"><pre class="programlisting">
    def getDefaultSource(self):
        xrefs = {}
        for xref in self.grammar.getElementsByTagName("xref"):
            xrefs[xref.attributes["id"].value] = 1
        xrefs = xrefs.keys()
        standaloneXrefs = [e for e in self.refs.keys() if e not in xrefs]
        return '&lt;xref id="%s"/&gt;' % random.choice(standaloneXrefs)</pre></div>
               <p>Now you rip through the source material.  The source material is also <span class="acronym">XML</span>, and you parse it one node at a time.  To keep the code separated and more maintainable, you use <a href="#kgp.handler" title="10.5.&nbsp;Creating separate handlers by node type">separate handlers for each node type</a>.
               </p>
               <div class="informalexample"><pre class="programlisting">
    def parse_Element(self, node): 
        handlerMethod = getattr(self, "do_%s" % node.tagName)
        handlerMethod(node)</pre></div>
               <p>You bounce through the grammar, <a href="#kgp.child" title="10.4.&nbsp;Finding direct children of a node">parsing all the children</a> of each <tt class="sgmltag-element">p</tt> element,
               </p>
               <div class="informalexample"><pre class="programlisting">
    def do_p(self, node):
...
        if doit:
            for child in node.childNodes: self.parse(child)</pre></div>
               <p>replacing <tt class="sgmltag-element">choice</tt> elements with a random child,
               </p>
               <div class="informalexample"><pre class="programlisting">
    def do_choice(self, node):
        self.parse(self.randomChildElement(node))</pre></div>
               <p>and replacing <tt class="sgmltag-element">xref</tt> elements with a random child of the corresponding <tt class="sgmltag-element">ref</tt> element, which you previously cached.
               </p>
               <div class="informalexample"><pre class="programlisting">
    def do_xref(self, node):
        id = node.attributes["id"].value
        self.parse(self.randomChildElement(self.refs[id]))</pre></div>
               <p>Eventually, you parse your way down to plain text,</p>
               <div class="informalexample"><pre class="programlisting">
    def parse_Text(self, node):    
        text = node.data
...
            self.pieces.append(text)</pre></div>
               <p>which you print out.</p>
               <div class="informalexample"><pre class="programlisting">
def main(argv):                         
...
    k = KantGenerator(grammar, source)
    print k.output()</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="kgp.summary"></a>10.8.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="application">Python</span> comes with powerful libraries for parsing and manipulating <span class="acronym">XML</span> documents.  The <tt class="filename">minidom</tt> takes an <span class="acronym">XML</span> file and parses it into <span class="application">Python</span> objects, providing for random access to arbitrary elements.  Furthermore, this chapter shows how <span class="application">Python</span> can be used to create a "real" standalone command-line script, complete with command-line flags, command-line arguments,
                     error handling, even the ability to take input from the piped result of a previous program.
                  </p>
               </div>
               <p>Before moving on to the next chapter, you should be comfortable doing all of these things:</p>
               <div class="itemizedlist">
                  <ul>
                     <li><a href="#kgp.stdio" title="10.2.&nbsp;Standard input, output, and error">Chaining programs</a> with standard input and output
                     </li>
                     <li><a href="#kgp.handler" title="10.5.&nbsp;Creating separate handlers by node type">Defining dynamic dispatchers</a> with <tt class="function">getattr</tt>.
                     </li>
                     <li><a href="#kgp.commandline" title="10.6.&nbsp;Handling command-line arguments">Using command-line flags</a> and validating them with <tt class="filename">getopt</tt></li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="oa"></a>Chapter&nbsp;11.&nbsp;HTTP Web Services
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.divein"></a>11.1.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You've learned about <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">HTML processing</a> and <a href="#kgp" title="Chapter&nbsp;9.&nbsp;XML Processing">XML processing</a>, and along the way you saw <a href="#dialect.extract.urllib" title="Example&nbsp;8.5.&nbsp;Introducing urllib">how to download a web page</a> and <a href="#kgp.openanything.urllib" title="Example&nbsp;10.2.&nbsp;Parsing XML from a URL">how to parse XML from a URL</a>, but let's dive into the more general topic of HTTP web services.
                  </p>
               </div>
               <p>Simply stated, HTTP web services are programmatic ways of sending and receiving data from remote servers using the operations
                  of HTTP directly.  If you want to get data from the server, use a straight HTTP GET; if you want to send new data to the server,
                  use HTTP POST.  (Some more advanced HTTP web service APIs also define ways of modifying existing data and deleting data, using
                  HTTP PUT and HTTP DELETE.)  In other words, the &#8220;<span class="quote">verbs</span>&#8221; built into the HTTP protocol (GET, POST, PUT, and DELETE) map directly to application-level operations for receiving, sending,
                  modifying, and deleting data.
               </p>
               <p>The main advantage of this approach is simplicity, and its simplicity has proven popular with a lot of different sites.  Data
                  -- usually XML data -- can be built and stored statically, or generated dynamically by a server-side script, and all major
                  languages include an HTTP library for downloading it.  Debugging is also easier, because you can load up the web service in
                  any web browser and see the raw data.  Modern browsers will even nicely format and pretty-print XML data for you, to allow
                  you to quickly navigate through it.
               </p>
               <p>Examples of pure XML-over-HTTP web services:</p>
               <div class="itemizedlist">
                  <ul>
                     <li><a href="http://www.amazon.com/webservices">Amazon API</a> allows you to retrieve product information from the Amazon.com online store.
                     </li>
                     <li><a href="http://www.nws.noaa.gov/alerts/">National Weather Service</a> (United States) and <a href="http://demo.xml.weather.gov.hk/">Hong Kong Observatory</a> (Hong Kong) offer weather alerts as a web service.
                     </li>
                     <li><a href="http://atomenabled.org/">Atom API</a> for managing web-based content.
                     </li>
                     <li><a href="http://syndic8.com/">Syndicated feeds</a> from weblogs and news sites bring you up-to-the-minute news from a variety of sites.
                     </li>
                  </ul>
               </div>
               <p>In later chapters, you'll explore APIs which use HTTP as a transport for sending and receiving data, but don't map application
                  semantics to the underlying HTTP semantics.  (They tunnel everything over HTTP POST.)  But this chapter will concentrate on
                  using HTTP GET to get data from a remote server, and you'll explore several HTTP features you can use to get the maximum benefit
                  out of pure HTTP web services.
               </p>
               <p>Here is a more advanced version of the <tt class="filename">openanything</tt> module that you saw in <a href="#streams" title="Chapter&nbsp;10.&nbsp;Scripts and Streams">the previous chapter</a>:
               </p>
               <div class="example"><a name="d0e27515"></a><h3 class="title">Example&nbsp;11.1.&nbsp;<tt class="filename">openanything.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
import urllib2, urlparse, gzip
from StringIO import StringIO

USER_AGENT = 'OpenAnything/1.0 +http://diveintopython.org/http_web_services/'

class SmartRedirectHandler(urllib2.HTTPRedirectHandler):    
    def http_error_301(self, req, fp, code, msg, headers):  
        result = urllib2.HTTPRedirectHandler.http_error_301(
            self, req, fp, code, msg, headers)              
        result.status = code                                
        return result                                       

    def http_error_302(self, req, fp, code, msg, headers):  
        result = urllib2.HTTPRedirectHandler.http_error_302(
            self, req, fp, code, msg, headers)              
        result.status = code                                
        return result                                       

class DefaultErrorHandler(urllib2.HTTPDefaultErrorHandler):   
    def http_error_default(self, req, fp, code, msg, headers):
        result = urllib2.HTTPError(                           
            req.get_full_url(), code, msg, headers, fp)       
        result.status = code                                  
        return result                                         

def openAnything(source, etag=None, lastmodified=None, agent=USER_AGENT):
    '''URL, filename, or string --&gt; stream

    This function lets you define parsers that take any input source
    (URL, pathname to local or network file, or actual data as a string)
    and deal with it in a uniform manner.  Returned object is guaranteed
    to have all the basic stdio read methods (read, readline, readlines).
    Just .close() the object when you're done with it.

    If the etag argument is supplied, it will be used as the value of an
    If-None-Match request header.

    If the lastmodified argument is supplied, it must be a formatted
    date/time string in GMT (as returned in the Last-Modified header of
    a previous request).  The formatted date/time will be used
    as the value of an If-Modified-Since request header.

    If the agent argument is supplied, it will be used as the value of a
    User-Agent request header.
    '''

    if hasattr(source, 'read'):
        return source

    if source == '-':
        return sys.stdin

    if urlparse.urlparse(source)[0] == 'http':                                      
        # open URL with urllib2                                                     
        request = urllib2.Request(source)                                           
        request.add_header('User-Agent', agent)                                     
        if etag:                                                                    
            request.add_header('If-None-Match', etag)                               
        if lastmodified:                                                            
            request.add_header('If-Modified-Since', lastmodified)                   
        request.add_header('Accept-encoding', 'gzip')                               
        opener = urllib2.build_opener(SmartRedirectHandler(), DefaultErrorHandler())
        return opener.open(request)                                                 
    
    # try to open with native open function (if source is a filename)
    try:
        return open(source)
    except (IOError, OSError):
        pass

    # treat source as string
    return StringIO(str(source))

def fetch(source, etag=None, last_modified=None, agent=USER_AGENT):  
    '''Fetch data and metadata from a URL, file, stream, or string'''
    result = {}                                                      
    f = openAnything(source, etag, last_modified, agent)             
    result['data'] = f.read()                                        
    if hasattr(f, 'headers'):                                        
        # save ETag, if the server sent one                          
        result['etag'] = f.headers.get('ETag')                       
        # save Last-Modified header, if the server sent one          
        result['lastmodified'] = f.headers.get('Last-Modified')      
        if f.headers.get('content-encoding', '') == 'gzip':          
            # data came back gzip-compressed, decompress it          
            result['data'] = gzip.GzipFile(fileobj=StringIO(result['data']])).read()
    if hasattr(f, 'url'):                                            
        result['url'] = f.url                                        
        result['status'] = 200                                       
    if hasattr(f, 'status'):                                         
        result['status'] = f.status                                  
    f.close()                                                        
    return result                                                    
</pre></div>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li>Paul Prescod believes that <a href="http://webservices.xml.com/pub/a/ws/2002/02/06/rest.html">pure HTTP web services are the future of the Internet</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.review"></a>11.2.&nbsp;How not to fetch data over HTTP
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Let's say you want to download a resource over HTTP, such as a syndicated Atom feed.  But you don't just want to download
                     it once; you want to download it over and over again, every hour, to get the latest news from the site that's offering the
                     news feed.  Let's do it the quick-and-dirty way first, and then see how you can do better.
                  </p>
               </div>
               <div class="example"><a name="d0e27543"></a><h3 class="title">Example&nbsp;11.2.&nbsp;Downloading a feed the quick-and-dirty way</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">data = urllib.urlopen('http://diveintomark.org/xml/atom.xml').read()</span>    <a name="oa.review.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print data</span>
<span class="computeroutput">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;feed version="0.3"
  xmlns="http://purl.org/atom/ns#"
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xml:lang="en"&gt;
  &lt;title mode="escaped"&gt;dive into mark&lt;/title&gt;
  &lt;link rel="alternate" type="text/html" href="http://diveintomark.org/"/&gt;
  &lt;-- rest of feed omitted for brevity --&gt;</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.review.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Downloading anything over HTTP is incredibly easy in <span class="application">Python</span>; in fact, it's a one-liner.  The <tt class="filename">urllib</tt> module has a handy <tt class="function">urlopen</tt> function that takes the address of the page you want, and returns a file-like object that you can just <tt class="function">read()</tt> from to get the full contents of the page.  It just can't get much easier.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So what's wrong with this?  Well, for a quick one-off during testing or development, there's nothing wrong with it.  I do
                  it all the time.  I wanted the contents of the feed, and I got the contents of the feed.  The same technique works for any
                  web page.  But once you start thinking in terms of a web service that you want to access on a regular basis -- and remember,
                  you said you were planning on retrieving this syndicated feed once an hour -- then you're being inefficient, and you're being
                  rude.
               </p>
               <p>Let's talk about some of the basic features of HTTP.</p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.features"></a>11.3.&nbsp;Features of HTTP
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>There are five important features of HTTP which you should support.</p>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e27596"></a>11.3.1.&nbsp;<tt class="literal">User-Agent</tt></h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The <tt class="literal">User-Agent</tt> is simply a way for a client to tell a server who it is when it requests a web page, a syndicated feed, or any sort of web
                     service over HTTP.  When the client requests a resource, it should always announce who it is, as specifically as possible.
                     This allows the server-side administrator to get in touch with the client-side developer if anything is going fantastically
                     wrong.
                  </p>
                  <p>By default, <span class="application">Python</span> sends a generic <tt class="literal">User-Agent</tt>: <tt class="literal">Python-urllib/1.15</tt>.  In the next section, you'll see how to change this to something more specific.
                  </p>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e27616"></a>11.3.2.&nbsp;Redirects
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>Sometimes resources move around.  Web sites get reorganized, pages move to new addresses.  Even web services can reorganize.
                     A syndicated feed at <tt class="literal">http://example.com/index.xml</tt> might be moved to <tt class="literal">http://example.com/xml/atom.xml</tt>.  Or an entire domain might move, as an organization expands and reorganizes; for instance, <tt class="literal">http://www.example.com/index.xml</tt> might be redirected to <tt class="literal">http://server-farm-1.example.com/index.xml</tt>.
                  </p>
                  <p>Every time you request any kind of resource from an HTTP server, the server includes a status code in its response.  Status
                     code <tt class="literal">200</tt> means &#8220;<span class="quote">everything's normal, here's the page you asked for</span>&#8221;.  Status code <tt class="literal">404</tt> means &#8220;<span class="quote">page not found</span>&#8221;.  (You've probably seen 404 errors while browsing the web.)
                  </p>
                  <p>HTTP has two different ways of signifying that a resource has moved.  Status code <tt class="literal">302</tt> is a <span class="emphasis"><em>temporary redirect</em></span>; it means &#8220;<span class="quote">oops, that got moved over here temporarily</span>&#8221; (and then gives the temporary address in a <tt class="literal">Location:</tt> header).  Status code <tt class="literal">301</tt> is a <span class="emphasis"><em>permanent redirect</em></span>; it means &#8220;<span class="quote">oops, that got moved permanently</span>&#8221; (and then gives the new address in a <tt class="literal">Location:</tt> header).  If you get a <tt class="literal">302</tt> status code and a new address, the HTTP specification says you should use the new address to get what you asked for, but
                     the next time you want to access the same resource, you should retry the old address.  But if you get a <tt class="literal">301</tt> status code and a new address, you're supposed to use the new address from then on.
                  </p>
                  <p><tt class="function">urllib.urlopen</tt> will automatically &#8220;<span class="quote">follow</span>&#8221; redirects when it receives the appropriate status code from the HTTP server, but unfortunately, it doesn't tell you when
                     it does so.  You'll end up getting data you asked for, but you'll never know that the underlying library &#8220;<span class="quote">helpfully</span>&#8221; followed a redirect for you.  So you'll continue pounding away at the old address, and each time you'll get redirected to
                     the new address.  That's two round trips instead of one: not very efficient!  Later in this chapter, you'll see how to work
                     around this so you can deal with permanent redirects properly and efficiently.
                  </p>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e27689"></a>11.3.3.&nbsp;<tt class="literal">Last-Modified</tt>/<tt class="literal">If-Modified-Since</tt></h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>Some data changes all the time.  The home page of CNN.com is constantly updating every few minutes.  On the other hand, the
                     home page of Google.com only changes once every few weeks (when they put up a special holiday logo, or advertise a new service).
                     Web services are no different; usually the server knows when the data you requested last changed, and HTTP provides a way
                     for the server to include this last-modified date along with the data you requested.
                  </p>
                  <p>If you ask for the same data a second time (or third, or fourth), you can tell the server the last-modified date that you
                     got last time: you send an <tt class="literal">If-Modified-Since</tt> header with your request, with the date you got back from the server last time.  If the data hasn't changed since then, the
                     server sends back a special HTTP status code <tt class="literal">304</tt>, which means &#8220;<span class="quote">this data hasn't changed since the last time you asked for it</span>&#8221;.  Why is this an improvement?  Because when the server sends a <tt class="literal">304</tt>, <span class="emphasis"><em>it doesn't re-send the data</em></span>.  All you get is the status code.  So you don't need to download the same data over and over again if it hasn't changed;
                     the server assumes you have the data cached locally.
                  </p>
                  <p>All modern web browsers support last-modified date checking.  If you've ever visited a page, re-visited the same page a day
                     later and found that it hadn't changed, and wondered why it loaded so quickly the second time -- this could be why.  Your
                     web browser cached the contents of the page locally the first time, and when you visited the second time, your browser automatically
                     sent the last-modified date it got from the server the first time.  The server simply says <tt class="literal">304: Not Modified</tt>, so your browser knows to load the page from its cache.  Web services can be this smart too.
                  </p>
                  <p><span class="application">Python</span>'s URL library has no built-in support for last-modified date checking, but since you can add arbitrary headers to each request
                     and read arbitrary headers in each response, you can add support for it yourself.
                  </p>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e27724"></a>11.3.4.&nbsp;<tt class="literal">ETag</tt>/<tt class="literal">If-None-Match</tt></h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>ETags are an alternate way to accomplish the same thing as the last-modified date checking: don't re-download data that hasn't
                     changed.  The way it works is, the server sends some sort of hash of the data (in an <tt class="literal">ETag</tt> header) along with the data you requested.  Exactly how this hash is determined is entirely up to the server.  The second
                     time you request the same data, you include the ETag hash in an <tt class="literal">If-None-Match:</tt> header, and if the data hasn't changed, the server will send you back a <tt class="literal">304</tt> status code.  As with the last-modified date checking, the server <span class="emphasis"><em>just</em></span> sends the <tt class="literal">304</tt>; it doesn't send you the same data a second time.  By including the ETag hash in your second request, you're telling the
                     server that there's no need to re-send the same data if it still matches this hash, since you still have the data from the
                     last time.
                  </p>
                  <p><span class="application">Python</span>'s URL library has no built-in support for ETags, but you'll see how to add it later in this chapter.
                  </p>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e27752"></a>11.3.5.&nbsp;Compression
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The last important HTTP feature is gzip compression.  When you talk about HTTP web services, you're almost always talking
                     about moving XML back and forth over the wire.  XML is text, and quite verbose text at that, and text generally compresses
                     well.  When you request a resource over HTTP, you can ask the server that, if it has any new data to send you, to please send
                     it in compressed format.  You include the <tt class="literal">Accept-encoding: gzip</tt> header in your request, and if the server supports compression, it will send you back gzip-compressed data and mark it with
                     a <tt class="literal">Content-encoding: gzip</tt> header.
                  </p>
                  <p><span class="application">Python</span>'s URL library has no built-in support for gzip compression per se, but you can add arbitrary headers to the request.  And
                     <span class="application">Python</span> comes with a separate <tt class="filename">gzip</tt> module, which has functions you can use to decompress the data yourself.
                  </p>
                  <p>Note that <a href="#oa.review" title="11.2.&nbsp;How not to fetch data over HTTP">our little one-line script</a> to download a syndicated feed did not support any of these HTTP features.  Let's see how you can improve it.
                  </p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.debug"></a>11.4.&nbsp;Debugging HTTP web services
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>First, let's turn on the debugging features of <span class="application">Python</span>'s HTTP library and see what's being sent over the wire.  This will be useful throughout the chapter, as you add more and
                     more features.
                  </p>
               </div>
               <div class="example"><a name="d0e27789"></a><h3 class="title">Example&nbsp;11.3.&nbsp;Debugging HTTP</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import httplib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">httplib.HTTPConnection.debuglevel = 1</span>             <a name="oa.debug.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">feeddata = urllib.urlopen('http://diveintomark.org/xml/atom.xml').read()</span>
<span class="computeroutput">connect: (diveintomark.org, 80)</span>                       <a name="oa.debug.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">send: '</span>
<span class="computeroutput">GET /xml/atom.xml HTTP/1.0</span>                            <a name="oa.debug.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">Host: diveintomark.org</span>                                <a name="oa.debug.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">User-agent: Python-urllib/1.15</span>                        <a name="oa.debug.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">'</span>
<span class="computeroutput">reply: 'HTTP/1.1 200 OK\r\n'</span>                          <a name="oa.debug.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
<span class="computeroutput">header: Date: Wed, 14 Apr 2004 22:27:30 GMT</span>
<span class="computeroutput">header: Server: Apache/2.0.49 (Debian GNU/Linux)</span>
<span class="computeroutput">header: Content-Type: application/atom+xml</span>
<span class="computeroutput">header: Last-Modified: Wed, 14 Apr 2004 22:14:38 GMT</span>  <a name="oa.debug.1.7"></a><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12">
<span class="computeroutput">header: ETag: "e8284-68e0-4de30f80"</span>                   <a name="oa.debug.1.8"></a><img src="images/callouts/8.png" alt="8" border="0" width="12" height="12">
<span class="computeroutput">header: Accept-Ranges: bytes</span>
<span class="computeroutput">header: Content-Length: 26848</span>
<span class="computeroutput">header: Connection: close</span>
</pre></div>
               <div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left"><tt class="filename">urllib</tt> relies on another standard <span class="application">Python</span> library, <tt class="filename">httplib</tt>.  Normally you don't need to <tt class="literal">import httplib</tt> directly (<tt class="filename">urllib</tt> does that automatically), but you will here so you can set the debugging flag on the <tt class="classname">HTTPConnection</tt> class that <tt class="filename">urllib</tt> uses internally to connect to the HTTP server.  This is an incredibly useful technique.  Some other <span class="application">Python</span> libraries have similar debug flags, but there's no particular standard for naming them or turning them on; you need to read
                           the documentation of each library to see if such a feature is available.
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">Now that the debugging flag is set, information on the the HTTP request and response is printed out in real time.  The first
                           thing it tells you is that you're connecting to the server <tt class="literal">diveintomark.org</tt> on port 80, which is the standard port for HTTP.
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">When you request the Atom feed, <tt class="filename">urllib</tt> sends three lines to the server.  The first line specifies the HTTP verb you're using, and the path of the resource (minus
                           the domain name).  All the requests in this chapter will use <tt class="literal">GET</tt>, but in the next chapter on <span class="acronym">SOAP</span>, you'll see that it uses <tt class="literal">POST</tt> for everything.  The basic syntax is the same, regardless of the verb.
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">The second line is the <tt class="literal">Host</tt> header, which specifies the domain name of the service you're accessing.  This is important, because a single HTTP server
                           can host multiple separate domains.  My server currently hosts 12 domains; other servers can host hundreds or even thousands.
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">The third line is the <tt class="literal">User-Agent</tt> header.  What you see here is the generic <tt class="literal">User-Agent</tt> that the <tt class="filename">urllib</tt> library adds by default.  In the next section, you'll see how to customize this to be more specific.
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">The server replies with a status code and a bunch of headers (and possibly some data, which got stored in the <tt class="varname">feeddata</tt> variable).  The status code here is <tt class="literal">200</tt>, meaning &#8220;<span class="quote">everything's normal, here's the data you requested</span>&#8221;.  The server also tells you the date it responded to your request, some information about the server itself, and the content
                           type of the data it's giving you.  Depending on your application, this might be useful, or not.  It's certainly reassuring
                           that you thought you were asking for an Atom feed, and lo and behold, you're getting an Atom feed (<tt class="literal">application/atom+xml</tt>, which is the registered content type for Atom feeds).
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.7"><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">The server tells you when this Atom feed was last modified (in this case, about 13 minutes ago).  You can send this date back
                           to the server the next time you request the same feed, and the server can do last-modified checking.
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#oa.debug.1.8"><img src="images/callouts/8.png" alt="8" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">The server also tells you that this Atom feed has an ETag hash of <tt class="literal">"e8284-68e0-4de30f80"</tt>.  The hash doesn't mean anything by itself; there's nothing you can do with it, except send it back to the server the next
                           time you request this same feed.  Then the server can use it to tell you if the data has changed or not.
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.useragent"></a>11.5.&nbsp;Setting the <tt class="literal">User-Agent</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The first step to improving your HTTP web services client is to identify yourself properly with a <tt class="literal">User-Agent</tt>.  To do that, you need to move beyond the basic <tt class="filename">urllib</tt> and dive into <tt class="filename">urllib2</tt>.
                  </p>
               </div>
               <div class="example"><a name="d0e27984"></a><h3 class="title">Example&nbsp;11.4.&nbsp;Introducing <tt class="filename">urllib2</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import httplib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">httplib.HTTPConnection.debuglevel = 1</span>                             <a name="oa.useragent.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request = urllib2.Request('http://diveintomark.org/xml/atom.xml')</span> <a name="oa.useragent.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">opener = urllib2.build_opener()</span>                                   <a name="oa.useragent.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">feeddata = opener.open(request).read()</span>                            <a name="oa.useragent.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">connect: (diveintomark.org, 80)</span>
<span class="computeroutput">send: '</span>
<span class="computeroutput">GET /xml/atom.xml HTTP/1.0</span>
<span class="computeroutput">Host: diveintomark.org</span>
<span class="computeroutput">User-agent: Python-urllib/2.1</span>
<span class="computeroutput">'</span>
<span class="computeroutput">reply: 'HTTP/1.1 200 OK\r\n'</span>
<span class="computeroutput">header: Date: Wed, 14 Apr 2004 23:23:12 GMT</span>
<span class="computeroutput">header: Server: Apache/2.0.49 (Debian GNU/Linux)</span>
<span class="computeroutput">header: Content-Type: application/atom+xml</span>
<span class="computeroutput">header: Last-Modified: Wed, 14 Apr 2004 22:14:38 GMT</span>
<span class="computeroutput">header: ETag: "e8284-68e0-4de30f80"</span>
<span class="computeroutput">header: Accept-Ranges: bytes</span>
<span class="computeroutput">header: Content-Length: 26848</span>
<span class="computeroutput">header: Connection: close</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If you still have your <span class="application">Python</span> <span class="acronym">IDE</span> open from the previous section's example, you can skip this, but this turns on <a href="#oa.debug" title="11.4.&nbsp;Debugging HTTP web services">HTTP debugging</a> so you can see what you're actually sending over the wire, and what gets sent back.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Fetching an HTTP resource with <tt class="filename">urllib2</tt> is a three-step process, for good reasons that will become clear shortly.  The first step is to create a <tt class="classname">Request</tt> object, which takes the URL of the resource you'll eventually get around to retrieving.  Note that this step doesn't actually
                              retrieve anything yet.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The second step is to build a URL opener.  This can take any number of handlers, which control how responses are handled.
                               But you can also build an opener without any custom handlers, which is what you're doing here.  You'll see how to define
                              and use custom handlers later in this chapter when you explore redirects.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The final step is to tell the opener to open the URL, using the <tt class="classname">Request</tt> object you created.  As you can see from all the debugging information that gets printed, this step actually retrieves the
                              resource and stores the returned data in <tt class="varname">feeddata</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e28108"></a><h3 class="title">Example&nbsp;11.5.&nbsp;Adding headers with the <tt class="classname">Request</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request</span>                                                <a name="oa.useragent.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;urllib2.Request instance at 0x00250AA8&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request.get_full_url()</span>
<span class="computeroutput">http://diveintomark.org/xml/atom.xml</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request.add_header('User-Agent',
<tt class="prompt">...     </tt>'OpenAnything/1.0 +http://diveintopython.org/')</span>    <a name="oa.useragent.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">feeddata = opener.open(request).read()</span>                 <a name="oa.useragent.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">connect: (diveintomark.org, 80)</span>
<span class="computeroutput">send: '</span>
<span class="computeroutput">GET /xml/atom.xml HTTP/1.0</span>
<span class="computeroutput">Host: diveintomark.org</span>
<span class="computeroutput">User-agent: OpenAnything/1.0 +http://diveintopython.org/</span>   <a name="oa.useragent.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'</span>
<span class="computeroutput">reply: 'HTTP/1.1 200 OK\r\n'</span>
<span class="computeroutput">header: Date: Wed, 14 Apr 2004 23:45:17 GMT</span>
<span class="computeroutput">header: Server: Apache/2.0.49 (Debian GNU/Linux)</span>
<span class="computeroutput">header: Content-Type: application/atom+xml</span>
<span class="computeroutput">header: Last-Modified: Wed, 14 Apr 2004 22:14:38 GMT</span>
<span class="computeroutput">header: ETag: "e8284-68e0-4de30f80"</span>
<span class="computeroutput">header: Accept-Ranges: bytes</span>
<span class="computeroutput">header: Content-Length: 26848</span>
<span class="computeroutput">header: Connection: close</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You're continuing from the previous example; you've already created a <tt class="classname">Request</tt> object with the URL you want to access.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using the <tt class="function">add_header</tt> method on the <tt class="classname">Request</tt> object, you can add arbitrary HTTP headers to the request.  The first argument is the header, the second is the value you're
                              providing for that header.  Convention dictates that a <tt class="literal">User-Agent</tt> should be in this specific format: an application name, followed by a slash, followed by a version number.  The rest is free-form,
                              and you'll see a lot of variations in the wild, but somewhere it should include a URL of your application.  The <tt class="literal">User-Agent</tt> is usually logged by the server along with other details of your request, and including a URL of your application allows
                              server administrators looking through their access logs to contact you if something is wrong.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="varname">opener</tt> object you created before can be reused too, and it will retrieve the same feed again, but with your custom <tt class="literal">User-Agent</tt> header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.useragent.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">And here's you sending your custom <tt class="literal">User-Agent</tt>, in place of the generic one that <span class="application">Python</span> sends by default.  If you look closely, you'll notice that you defined a <tt class="literal">User-Agent</tt> header, but you actually sent a <tt class="literal">User-agent</tt> header.  See the difference?  <tt class="filename">urllib2</tt> changed the case so that only the first letter was capitalized.  It doesn't really matter; HTTP specifies that header field
                              names are completely case-insensitive.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.etags"></a>11.6.&nbsp;Handling <tt class="literal">Last-Modified</tt> and <tt class="literal">ETag</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that you know how to add custom HTTP headers to your web service requests, let's look at adding support for <tt class="literal">Last-Modified</tt> and <tt class="literal">ETag</tt> headers.
                  </p>
               </div>
               <p>These examples show the output with debugging turned off.  If you still have it turned on from the previous section, you can
                  turn it off by setting <tt class="literal">httplib.HTTPConnection.debuglevel = 0</tt>.  Or you can just leave debugging on, if that helps you.
               </p>
               <div class="example"><a name="oa.etags.example.1"></a><h3 class="title">Example&nbsp;11.6.&nbsp;Testing <tt class="literal">Last-Modified</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request = urllib2.Request('http://diveintomark.org/xml/atom.xml')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">opener = urllib2.build_opener()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">firstdatastream = opener.open(request)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">firstdatastream.headers.dict</span>                       <a name="oa.etags.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">{'date': 'Thu, 15 Apr 2004 20:42:41 GMT', 
 'server': 'Apache/2.0.49 (Debian GNU/Linux)', 
 'content-type': 'application/atom+xml',
 'last-modified': 'Thu, 15 Apr 2004 19:45:21 GMT', 
 'etag': '"e842a-3e53-55d97640"',
 'content-length': '15955', 
 'accept-ranges': 'bytes', 
 'connection': 'close'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request.add_header('If-Modified-Since',</span>
<tt class="prompt">...     </tt><span class="userinput">firstdatastream.headers.get('Last-Modified'))</span>  <a name="oa.etags.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">seconddatastream = opener.open(request)</span>            <a name="oa.etags.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="traceback">Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
  File "c:\python23\lib\urllib2.py", line 326, in open
    '_open', req)
  File "c:\python23\lib\urllib2.py", line 306, in _call_chain
    result = func(*args)
  File "c:\python23\lib\urllib2.py", line 901, in http_open
    return self.do_open(httplib.HTTP, req)
  File "c:\python23\lib\urllib2.py", line 895, in do_open
    return self.parent.error('http', req, fp, code, msg, hdrs)
  File "c:\python23\lib\urllib2.py", line 352, in error
    return self._call_chain(*args)
  File "c:\python23\lib\urllib2.py", line 306, in _call_chain
    result = func(*args)
  File "c:\python23\lib\urllib2.py", line 412, in http_error_default
    raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
urllib2.HTTPError: HTTP Error 304: Not Modified</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember all those HTTP headers you saw printed out when you turned on debugging?  This is how you can get access to them
                              programmatically: <tt class="varname">firstdatastream.headers</tt> is <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">an object that acts like a dictionary</a> and allows you to get any of the individual headers returned from the HTTP server.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">On the second request, you add the <tt class="literal">If-Modified-Since</tt> header with the last-modified date from the first request.  If the data hasn't changed, the server should return a <tt class="literal">304</tt> status code.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Sure enough, the data hasn't changed.  You can see from the traceback that <tt class="filename">urllib2</tt> throws a special exception, <tt class="classname">HTTPError</tt>, in response to the <tt class="literal">304</tt> status code.  This is a little unusual, and not entirely helpful.  After all, it's not an error; you specifically asked the
                              server not to send you any data if it hadn't changed, and the data didn't change, so the server told you it wasn't sending
                              you any data.  That's not an error; that's exactly what you were hoping for.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p><tt class="filename">urllib2</tt> also raises an <tt class="classname">HTTPError</tt> exception for conditions that you would think of as errors, such as <tt class="literal">404</tt> (page not found).  In fact, it will raise <tt class="classname">HTTPError</tt> for <span class="emphasis"><em>any</em></span> status code other than <tt class="literal">200</tt> (OK), <tt class="literal">301</tt> (permanent redirect), or <tt class="literal">302</tt> (temporary redirect).  It would be more helpful for your purposes to capture the status code and simply return it, without
                  throwing an exception.  To do that, you'll need to define a custom URL handler.
               </p>
               <div class="example"><a name="d0e28385"></a><h3 class="title">Example&nbsp;11.7.&nbsp;Defining URL handlers</h3>
                  <p>This custom URL handler is part of <tt class="filename">openanything.py</tt>.
                  </p><pre class="programlisting">
class DefaultErrorHandler(urllib2.HTTPDefaultErrorHandler):    <a name="oa.etags.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    def http_error_default(self, req, fp, code, msg, headers): <a name="oa.etags.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        result = urllib2.HTTPError(                           
            req.get_full_url(), code, msg, headers, fp)       
        result.status = code                                   <a name="oa.etags.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        return result                                         
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">urllib2</tt> is designed around URL handlers.  Each handler is just a class that can define any number of methods.  When something happens
                              -- like an HTTP error, or even a <tt class="literal">304</tt> code -- <tt class="filename">urllib2</tt> introspects into the list of defined handlers for a method that can handle it.  You used a similar introspection in <a href="#kgp" title="Chapter&nbsp;9.&nbsp;XML Processing">Chapter&nbsp;9, <i>XML Processing</i></a> to define handlers for different node types, but <tt class="filename">urllib2</tt> is more flexible, and introspects over as many handlers as are defined for the current request.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">urllib2</tt> searches through the defined handlers and calls the <tt class="methodname">http_error_default</tt> method when it encounters a <tt class="literal">304</tt> status code from the server. By defining a custom error handler, you can prevent <tt class="filename">urllib2</tt> from raising an exception.  Instead, you create the <tt class="classname">HTTPError</tt> object, but return it instead of raising it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the key part: before returning, you save the status code returned by the HTTP server.  This will allow you easy access
                              to it from the calling program.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e28438"></a><h3 class="title">Example&nbsp;11.8.&nbsp;Using custom URL handlers</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request.headers</span>                           <a name="oa.etags.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">{'If-modified-since': 'Thu, 15 Apr 2004 19:45:21 GMT'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import openanything</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">opener = urllib2.build_opener(</span>
<tt class="prompt">...     </tt><span class="userinput">openanything.DefaultErrorHandler())</span>   <a name="oa.etags.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">seconddatastream = opener.open(request)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">seconddatastream.status</span>                   <a name="oa.etags.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">304</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">seconddatastream.read()</span>                   <a name="oa.etags.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">''</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You're continuing the previous example, so the <tt class="classname">Request</tt> object is already set up, and you've already added the <tt class="literal">If-Modified-Since</tt> header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the key: now that you've defined your custom URL handler, you need to tell <tt class="filename">urllib2</tt> to use it.  Remember how I said that <tt class="filename">urllib2</tt> broke up the process of accessing an HTTP resource into three steps, and for good reason?  This is why building the URL opener
                              is its own step, because you can build it with your own custom URL handlers that override <tt class="filename">urllib2</tt>'s default behavior.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you can quietly open the resource, and what you get back is an object that, along with the usual headers (use <tt class="varname">seconddatastream.headers.dict</tt> to acess them), also contains the HTTP status code.  In this case, as you expected, the status is <tt class="literal">304</tt>, meaning this data hasn't changed since the last time you asked for it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that when the server sends back a <tt class="literal">304</tt> status code, it doesn't re-send the data.  That's the whole point: to save bandwidth by not re-downloading data that hasn't
                              changed.  So if you actually want that data, you'll need to cache it locally the first time you get it.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Handling <tt class="literal">ETag</tt> works much the same way, but instead of checking for <tt class="literal">Last-Modified</tt> and sending <tt class="literal">If-Modified-Since</tt>, you check for <tt class="literal">ETag</tt> and send <tt class="literal">If-None-Match</tt>.  Let's start with a fresh <span class="acronym">IDE</span> session.
               </p>
               <div class="example"><a name="oa.etags.example"></a><h3 class="title">Example&nbsp;11.9.&nbsp;Supporting <tt class="literal">ETag</tt>/<tt class="literal">If-None-Match</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib2, openanything</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request = urllib2.Request('http://diveintomark.org/xml/atom.xml')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">opener = urllib2.build_opener(</span>
<tt class="prompt">...     </tt><span class="userinput">openanything.DefaultErrorHandler())</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">firstdatastream = opener.open(request)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">firstdatastream.headers.get('ETag')</span>        <a name="oa.etags.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'"e842a-3e53-55d97640"'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">firstdata = firstdatastream.read()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print firstdata</span>                            <a name="oa.etags.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;feed version="0.3"
  xmlns="http://purl.org/atom/ns#"
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xml:lang="en"&gt;
  &lt;title mode="escaped"&gt;dive into mark&lt;/title&gt;
  &lt;link rel="alternate" type="text/html" href="http://diveintomark.org/"/&gt;
  &lt;-- rest of feed omitted for brevity --&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request.add_header('If-None-Match',</span>
<tt class="prompt">...     </tt><span class="userinput">firstdatastream.headers.get('ETag'))</span>   <a name="oa.etags.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">seconddatastream = opener.open(request)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">seconddatastream.status</span>                    <a name="oa.etags.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">304</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">seconddatastream.read()</span>                    <a name="oa.etags.4.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">''</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using the <tt class="varname">firstdatastream.headers</tt> pseudo-dictionary, you can get the <tt class="literal">ETag</tt> returned from the server.  (What happens if the server didn't send back an <tt class="literal">ETag</tt>?  Then this line would return <tt class="literal">None</tt>.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">OK, you got the data.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now set up the second call by setting the <tt class="literal">If-None-Match</tt> header to the <tt class="literal">ETag</tt> you got from the first call.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The second call succeeds quietly (without throwing an exception), and once again you see that the server has sent back a <tt class="literal">304</tt> status code.  Based on the <tt class="literal">ETag</tt> you sent the second time, it knows that the data hasn't changed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.etags.4.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Regardless of whether the <tt class="literal">304</tt> is triggered by <tt class="literal">Last-Modified</tt> date checking or <tt class="literal">ETag</tt> hash matching, you'll never get the data along with the <tt class="literal">304</tt>.  That's the whole point.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="tip.etag.vs.lastmodified"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">In these examples, the HTTP server has supported both <tt class="literal">Last-Modified</tt> and <tt class="literal">ETag</tt> headers, but not all servers do.  As a web services client, you should be prepared to support both, but you must code defensively
                        in case a server only supports one or the other, or neither.
                     </td>
                  </tr>
               </table>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.redirect"></a>11.7.&nbsp;Handling redirects
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You can support permanent and temporary redirects using a different kind of custom URL handler.</p>
               </div>
               <p>First, let's see why a redirect handler is necessary in the first place.</p>
               <div class="example"><a name="d0e28730"></a><h3 class="title">Example&nbsp;11.10.&nbsp;Accessing web services without a redirect handler</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib2, httplib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">httplib.HTTPConnection.debuglevel = 1</span>           <a name="oa.redirect.1.0"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request = urllib2.Request(</span>
<tt class="prompt">...     </tt><span class="userinput">'http://diveintomark.org/redir/example301.xml')</span> <a name="oa.redirect.1.1"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">opener = urllib2.build_opener()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = opener.open(request)</span>
<span class="computeroutput">connect: (diveintomark.org, 80)
send: '
GET /redir/example301.xml HTTP/1.0
Host: diveintomark.org
User-agent: Python-urllib/2.1
'
reply: 'HTTP/1.1 301 Moved Permanently\r\n'</span>             <a name="oa.redirect.1.2"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">header: Date: Thu, 15 Apr 2004 22:06:25 GMT
header: Server: Apache/2.0.49 (Debian GNU/Linux)
header: Location: http://diveintomark.org/xml/atom.xml</span>  <a name="oa.redirect.1.3"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">header: Content-Length: 338
header: Connection: close
header: Content-Type: text/html; charset=iso-8859-1
connect: (diveintomark.org, 80)
send: '
GET /xml/atom.xml HTTP/1.0</span>                              <a name="oa.redirect.1.4"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">Host: diveintomark.org
User-agent: Python-urllib/2.1
'
reply: 'HTTP/1.1 200 OK\r\n'
header: Date: Thu, 15 Apr 2004 22:06:25 GMT
header: Server: Apache/2.0.49 (Debian GNU/Linux)
header: Last-Modified: Thu, 15 Apr 2004 19:45:21 GMT
header: ETag: "e842a-3e53-55d97640"
header: Accept-Ranges: bytes
header: Content-Length: 15955
header: Connection: close
header: Content-Type: application/atom+xml</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.url</span>                                               <a name="oa.redirect.1.5"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
<span class="computeroutput">'http://diveintomark.org/xml/atom.xml'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.headers.dict</span>
<span class="computeroutput">{'content-length': '15955', 
'accept-ranges': 'bytes', 
'server': 'Apache/2.0.49 (Debian GNU/Linux)', 
'last-modified': 'Thu, 15 Apr 2004 19:45:21 GMT', 
'connection': 'close', 
'etag': '"e842a-3e53-55d97640"', 
'date': 'Thu, 15 Apr 2004 22:06:25 GMT', 
'content-type': 'application/atom+xml'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.status</span>
<span class="traceback">Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
AttributeError: addinfourl instance has no attribute 'status'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.1.0"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You'll be better able to see what's happening if you turn on debugging.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.1.1"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a URL which I have set up to permanently redirect to my Atom feed at <tt class="literal">http://diveintomark.org/xml/atom.xml</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.1.2"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Sure enough, when you try to download the data at that address, the server sends back a <tt class="literal">301</tt> status code, telling you that the resource has moved permanently.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.1.3"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The server also sends back a <tt class="literal">Location:</tt> header that gives the new address of this data.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.1.4"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">urllib2</tt> notices the redirect status code and automatically tries to retrieve the data at the new location specified in the <tt class="literal">Location:</tt> header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.1.5"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The object you get back from the <tt class="varname">opener</tt> contains the new permanent address and all the headers returned from the second request (retrieved from the new permanent
                              address).  But the status code is missing, so you have no way of knowing programmatically whether this redirect was temporary
                              or permanent.  And that matters very much: if it was a temporary redirect, then you should continue to ask for the data at
                              the old location.  But if it was a permanent redirect (as this was), you should ask for the data at the new location from
                              now on.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>This is suboptimal, but easy to fix.  <tt class="filename">urllib2</tt> doesn't behave exactly as you want it to when it encounters a <tt class="literal">301</tt> or <tt class="literal">302</tt>, so let's override its behavior.  How?  With a custom URL handler, <a href="#oa.etags" title="11.6.&nbsp;Handling Last-Modified and ETag">just like you did to handle <tt class="literal">304</tt> codes</a>.
               </p>
               <div class="example"><a name="d0e28866"></a><h3 class="title">Example&nbsp;11.11.&nbsp;Defining the redirect handler</h3>
                  <p>This class is defined in <tt class="filename">openanything.py</tt>.
                  </p><pre class="programlisting">
class SmartRedirectHandler(urllib2.HTTPRedirectHandler):     <a name="oa.redirect.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    def http_error_301(self, req, fp, code, msg, headers):  
        result = urllib2.HTTPRedirectHandler.http_error_301( <a name="oa.redirect.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
            self, req, fp, code, msg, headers)              
        result.status = code                                 <a name="oa.redirect.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        return result                                       

    def http_error_302(self, req, fp, code, msg, headers):   <a name="oa.redirect.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        result = urllib2.HTTPRedirectHandler.http_error_302(
            self, req, fp, code, msg, headers)              
        result.status = code                                
        return result                                       
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Redirect behavior is defined in <tt class="filename">urllib2</tt> in a class called <tt class="classname">HTTPRedirectHandler</tt>.  You don't want to completely override the behavior, you just want to extend it a little, so you'll subclass <tt class="classname">HTTPRedirectHandler</tt> so you can call the ancestor class to do all the hard work.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">When it encounters a <tt class="literal">301</tt> status code from the server, <tt class="filename">urllib2</tt> will search through its handlers and call the <tt class="methodname">http_error_301</tt> method.   The first thing ours does is just call the <tt class="methodname">http_error_301</tt> method in the ancestor, which handles the grunt work of looking for the <tt class="literal">Location:</tt> header and following the redirect to the new address.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here's the key: before you return, you store the status code (<tt class="literal">301</tt>), so that the calling program can access it later.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Temporary redirects (status code <tt class="literal">302</tt>) work the same way: override the <tt class="literal">http_error_302</tt> method, call the ancestor, and save the status code before returning.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So what has this bought us?  You can now build a URL opener with the custom redirect handler, and it will still automatically
                  follow redirects, but now it will also expose the redirect status code.
               </p>
               <div class="example"><a name="d0e28932"></a><h3 class="title">Example&nbsp;11.12.&nbsp;Using the redirect handler to detect permanent redirects</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request = urllib2.Request('http://diveintomark.org/redir/example301.xml')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import openanything, httplib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">httplib.HTTPConnection.debuglevel = 1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">opener = urllib2.build_opener(</span>
<tt class="prompt">...     </tt><span class="userinput">openanything.SmartRedirectHandler())</span>           <a name="oa.redirect.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = opener.open(request)</span>
<span class="computeroutput">connect: (diveintomark.org, 80)
send: 'GET /redir/example301.xml HTTP/1.0
Host: diveintomark.org
User-agent: Python-urllib/2.1
'
reply: 'HTTP/1.1 301 Moved Permanently\r\n'</span>            <a name="oa.redirect.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">header: Date: Thu, 15 Apr 2004 22:13:21 GMT
header: Server: Apache/2.0.49 (Debian GNU/Linux)
header: Location: http://diveintomark.org/xml/atom.xml
header: Content-Length: 338
header: Connection: close
header: Content-Type: text/html; charset=iso-8859-1
connect: (diveintomark.org, 80)
send: '
GET /xml/atom.xml HTTP/1.0
Host: diveintomark.org
User-agent: Python-urllib/2.1
'
reply: 'HTTP/1.1 200 OK\r\n'
header: Date: Thu, 15 Apr 2004 22:13:21 GMT
header: Server: Apache/2.0.49 (Debian GNU/Linux)
header: Last-Modified: Thu, 15 Apr 2004 19:45:21 GMT
header: ETag: "e842a-3e53-55d97640"
header: Accept-Ranges: bytes
header: Content-Length: 15955
header: Connection: close
header: Content-Type: application/atom+xml
</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.status</span>                                           <a name="oa.redirect.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">301</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.url</span>
<span class="computeroutput">'http://diveintomark.org/xml/atom.xml'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First, build a URL opener with the redirect handler you just defined.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You sent off a request, and you got a <tt class="literal">301</tt> status code in response.  At this point, the <tt class="methodname">http_error_301</tt> method gets called.  You call the ancestor method, which follows the redirect and sends a request at the new location (<tt class="literal">http://diveintomark.org/xml/atom.xml</tt>).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the payoff: now, not only do you have access to the new URL, but you have access to the redirect status code, so you
                              can tell that this was a permanent redirect.  The next time you request this data, you should request it from the new location
                              (<tt class="literal">http://diveintomark.org/xml/atom.xml</tt>, as specified in <tt class="varname">f.url</tt>).  If you had stored the location in a configuration file or a database, you need to update that so you don't keep pounding
                              the server with requests at the old address.  It's time to update your address book.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The same redirect handler can also tell you that you <span class="emphasis"><em>shouldn't</em></span> update your address book.
               </p>
               <div class="example"><a name="d0e29025"></a><h3 class="title">Example&nbsp;11.13.&nbsp;Using the redirect handler to detect temporary redirects</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request = urllib2.Request(</span>
<tt class="prompt">...     </tt><span class="userinput">'http://diveintomark.org/redir/example302.xml')</span>   <a name="oa.redirect.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = opener.open(request)</span>
<span class="computeroutput">connect: (diveintomark.org, 80)
send: '
GET /redir/example302.xml HTTP/1.0
Host: diveintomark.org
User-agent: Python-urllib/2.1
'
reply: 'HTTP/1.1 302 Found\r\n'</span>                           <a name="oa.redirect.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">header: Date: Thu, 15 Apr 2004 22:18:21 GMT
header: Server: Apache/2.0.49 (Debian GNU/Linux)
header: Location: http://diveintomark.org/xml/atom.xml
header: Content-Length: 314
header: Connection: close
header: Content-Type: text/html; charset=iso-8859-1
connect: (diveintomark.org, 80)
send: '
GET /xml/atom.xml HTTP/1.0</span>                                <a name="oa.redirect.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">Host: diveintomark.org
User-agent: Python-urllib/2.1
'
reply: 'HTTP/1.1 200 OK\r\n'
header: Date: Thu, 15 Apr 2004 22:18:21 GMT
header: Server: Apache/2.0.49 (Debian GNU/Linux)
header: Last-Modified: Thu, 15 Apr 2004 19:45:21 GMT
header: ETag: "e842a-3e53-55d97640"
header: Accept-Ranges: bytes
header: Content-Length: 15955
header: Connection: close
header: Content-Type: application/atom+xml</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.status</span>                                              <a name="oa.redirect.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">302</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.url</span>
<span class="computeroutput">http://diveintomark.org/xml/atom.xml</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a sample URL I've set up that is configured to tell clients to <span class="emphasis"><em>temporarily</em></span> redirect to <tt class="literal">http://diveintomark.org/xml/atom.xml</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The server sends back a <tt class="literal">302</tt> status code, indicating a temporary redirect.  The temporary new location of the data is given in the <tt class="literal">Location:</tt> header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">urllib2</tt> calls your <tt class="methodname">http_error_302</tt> method, which calls the ancestor method of the same name in <tt class="classname">urllib2.HTTPRedirectHandler</tt>, which follows the redirect to the new location.  Then your <tt class="methodname">http_error_302</tt> method stores the status code (<tt class="literal">302</tt>) so the calling application can get it later.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.redirect.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">And here you are, having successfully followed the redirect to <tt class="literal">http://diveintomark.org/xml/atom.xml</tt>.  <tt class="varname">f.status</tt> tells you that this was a temporary redirect, which means that you should continue to request data from the original address
                              (<tt class="literal">http://diveintomark.org/redir/example302.xml</tt>).  Maybe it will redirect next time too, but maybe not.  Maybe it will redirect to a different address.  It's not for you
                              to say.  The server said this redirect was only temporary, so you should respect that.  And now you're exposing enough information
                              that the calling application can respect that.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.gzip"></a>11.8.&nbsp;Handling compressed data
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The last important HTTP feature you want to support is compression.  Many web services have the ability to send data compressed,
                     which can cut down the amount of data sent over the wire by 60% or more.  This is especially true of XML web services, since
                     XML data compresses very well.
                  </p>
               </div>
               <p>Servers won't give you compressed data unless you tell them you can handle it.</p>
               <div class="example"><a name="d0e29136"></a><h3 class="title">Example&nbsp;11.14.&nbsp;Telling the server you would like compressed data</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import urllib2, httplib</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">httplib.HTTPConnection.debuglevel = 1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request = urllib2.Request('http://diveintomark.org/xml/atom.xml')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">request.add_header('Accept-encoding', 'gzip')</span>        <a name="oa.gzip.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">opener = urllib2.build_opener()</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = opener.open(request)</span>
<span class="computeroutput">connect: (diveintomark.org, 80)
send: '
GET /xml/atom.xml HTTP/1.0
Host: diveintomark.org
User-agent: Python-urllib/2.1
Accept-encoding: gzip</span>                                    <a name="oa.gzip.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'
reply: 'HTTP/1.1 200 OK\r\n'
header: Date: Thu, 15 Apr 2004 22:24:39 GMT
header: Server: Apache/2.0.49 (Debian GNU/Linux)
header: Last-Modified: Thu, 15 Apr 2004 19:45:21 GMT
header: ETag: "e842a-3e53-55d97640"
header: Accept-Ranges: bytes
header: Vary: Accept-Encoding
header: Content-Encoding: gzip</span>                           <a name="oa.gzip.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">header: Content-Length: 6289</span>                             <a name="oa.gzip.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">header: Connection: close
header: Content-Type: application/atom+xml</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the key: once you've created your <tt class="classname">Request</tt> object, add an <tt class="literal">Accept-encoding</tt> header to tell the server you can accept gzip-encoded data.  <tt class="literal">gzip</tt> is the name of the compression algorithm you're using.  In theory there could be other compression algorithms, but <tt class="literal">gzip</tt> is the compression algorithm used by 99% of web servers.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">There's your header going across the wire.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">And here's what the server sends back: the <tt class="literal">Content-Encoding: gzip</tt> header means that the data you're about to receive has been gzip-compressed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="literal">Content-Length</tt> header is the length of the compressed data, not the uncompressed data.  As you'll see in a minute, the actual length of
                              the uncompressed data was 15955, so gzip compression cut your bandwidth by over 60%!
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e29222"></a><h3 class="title">Example&nbsp;11.15.&nbsp;Decompressing the data</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">compresseddata = f.read()</span>                              <a name="oa.gzip.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">len(compresseddata)</span>
<span class="computeroutput">6289</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import StringIO</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">compressedstream = StringIO.StringIO(compresseddata)</span>   <a name="oa.gzip.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import gzip</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">gzipper = gzip.GzipFile(fileobj=compressedstream)</span>      <a name="oa.gzip.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">data = gzipper.read()</span>                                  <a name="oa.gzip.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">print data</span>                                             <a name="oa.gzip.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;feed version="0.3"
  xmlns="http://purl.org/atom/ns#"
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xml:lang="en"&gt;
  &lt;title mode="escaped"&gt;dive into mark&lt;/title&gt;
  &lt;link rel="alternate" type="text/html" href="http://diveintomark.org/"/&gt;
  &lt;-- rest of feed omitted for brevity --&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">len(data)</span>
<span class="computeroutput">15955</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Continuing from the previous example, <tt class="varname">f</tt> is the file-like object returned from the URL opener.  Using its <tt class="methodname">read()</tt> method would ordinarily get you the uncompressed data, but since this data has been gzip-compressed, this is just the first
                              step towards getting the data you really want.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">OK, this step is a little bit of messy workaround.  <span class="application">Python</span> has a <tt class="filename">gzip</tt> module, which reads (and actually writes) gzip-compressed files on disk.  But you don't have a file on disk, you have a gzip-compressed
                              buffer in memory, and you don't want to write out a temporary file just so you can uncompress it.  So what you're going to
                              do is create a file-like object out of the in-memory data (<tt class="varname">compresseddata</tt>), using the <tt class="filename">StringIO</tt> module.  You first saw the <tt class="filename">StringIO</tt> module in <a href="#kgp.openanything.stringio.example" title="Example&nbsp;10.4.&nbsp;Introducing StringIO">the previous chapter</a>, but now you've found another use for it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you can create an instance of <tt class="classname">GzipFile</tt>, and tell it that its &#8220;<span class="quote">file</span>&#8221; is the file-like object <tt class="varname">compressedstream</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the line that does all the actual work: &#8220;<span class="quote">reading</span>&#8221; from <tt class="classname">GzipFile</tt> will decompress the data.  Strange?  Yes, but it makes sense in a twisted kind of way.  <tt class="varname">gzipper</tt> is a file-like object which represents a gzip-compressed file.  That &#8220;<span class="quote">file</span>&#8221; is not a real file on disk, though; <tt class="varname">gzipper</tt> is really just &#8220;<span class="quote">reading</span>&#8221; from the file-like object you created with <tt class="filename">StringIO</tt> to wrap the compressed data, which is only in memory in the variable <tt class="varname">compresseddata</tt>.  And where did that compressed data come from?  You originally downloaded it from a remote HTTP server by &#8220;<span class="quote">reading</span>&#8221; from the file-like object you built with <tt class="function">urllib2.build_opener</tt>.  And amazingly, this all just works.  Every step in the chain has no idea that the previous step is faking it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Look ma, real data. (15955 bytes of it, in fact.)</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>&#8220;<span class="quote">But wait!</span>&#8221; I hear you cry.  &#8220;<span class="quote">This could be even easier!</span>&#8221;  I know what you're thinking.  You're thinking that <tt class="varname">opener.open</tt> returns a file-like object, so why not cut out the <tt class="filename">StringIO</tt> middleman and just pass <tt class="varname">f</tt> directly to <tt class="methodname">GzipFile</tt>?  OK, maybe you weren't thinking that, but don't worry about it, because it doesn't work.
               </p>
               <div class="example"><a name="d0e29389"></a><h3 class="title">Example&nbsp;11.16.&nbsp;Decompressing the data directly from the server</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f = opener.open(request)</span>                  <a name="oa.gzip.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">f.headers.get('Content-Encoding')</span>         <a name="oa.gzip.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'gzip'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">data = gzip.GzipFile(fileobj=f).read()</span>    <a name="oa.gzip.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="traceback">Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
  File "c:\python23\lib\gzip.py", line 217, in read
    self._read(readsize)
  File "c:\python23\lib\gzip.py", line 252, in _read
    pos = self.fileobj.tell()   # Save current position
AttributeError: addinfourl instance has no attribute 'tell'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Continuing from the previous example, you already have a <tt class="classname">Request</tt> object set up with an <tt class="literal">Accept-encoding: gzip</tt> header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Simply opening the request will get you the headers (though not download any data yet).  As you can see from the returned
                              <tt class="literal">Content-Encoding</tt> header, this data has been sent gzip-compressed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.gzip.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since <tt class="methodname">opener.open</tt> returns a file-like object, and you know from the headers that when you read it, you're going to get gzip-compressed data,
                              why not simply pass that file-like object directly to <tt class="classname">GzipFile</tt>?  As you &#8220;<span class="quote">read</span>&#8221; from the <tt class="classname">GzipFile</tt> instance, it will &#8220;<span class="quote">read</span>&#8221; compressed data from the remote HTTP server and decompress it on the fly.  It's a good idea, but unfortunately it doesn't
                              work.  Because of the way gzip compression works, <tt class="classname">GzipFile</tt> needs to save its position and move forwards and backwards through the compressed file.  This doesn't work when the &#8220;<span class="quote">file</span>&#8221; is a stream of bytes coming from a remote server; all you can do with it is retrieve bytes one at a time, not move back and
                              forth through the data stream.  So the inelegant hack of using <tt class="filename">StringIO</tt> is the best solution: download the compressed data, create a file-like object out of it with <tt class="filename">StringIO</tt>, and then decompress the data from that.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.alltogether"></a>11.9.&nbsp;Putting it all together
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You've seen all the pieces for building an intelligent HTTP web services client.  Now let's see how they all fit together.</p>
               </div>
               <div class="example"><a name="d0e29475"></a><h3 class="title">Example&nbsp;11.17.&nbsp;The <tt class="function">openanything</tt> function
                  </h3>
                  <p>This function is defined in <tt class="filename">openanything.py</tt>.
                  </p><pre class="programlisting">
def openAnything(source, etag=None, lastmodified=None, agent=USER_AGENT):
    # non-HTTP code omitted for brevity
    if urlparse.urlparse(source)[0] == 'http':                                       <a name="oa.alltogether.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        # open URL with urllib2                                                     
        request = urllib2.Request(source)                                           
        request.add_header('User-Agent', agent)                                      <a name="oa.alltogether.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        if etag:                                                                    
            request.add_header('If-None-Match', etag)                                <a name="oa.alltogether.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        if lastmodified:                                                            
            request.add_header('If-Modified-Since', lastmodified)                    <a name="oa.alltogether.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        request.add_header('Accept-encoding', 'gzip')                                <a name="oa.alltogether.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
        opener = urllib2.build_opener(SmartRedirectHandler(), DefaultErrorHandler()) <a name="oa.alltogether.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
        return opener.open(request)                                                  <a name="oa.alltogether.1.7"></a><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="filename">urlparse</tt> is a handy utility module for, you guessed it, parsing URLs.  It's primary function, also called <tt class="function">urlparse</tt>, takes a URL and splits it into a tuple of (scheme, domain, path, params, query string parameters, and fragment identifier).
                               Of these, the only thing you care about is the scheme, to make sure that you're dealing with an HTTP URL (which <tt class="filename">urllib2</tt> can handle).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You identify yourself to the HTTP server with the <tt class="literal">User-Agent</tt> passed in by the calling function.  If no <tt class="literal">User-Agent</tt> was specified, you use a default one defined earlier in the <tt class="filename">openanything.py</tt> module.  You never use the default one defined by <tt class="filename">urllib2</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If an <tt class="literal">ETag</tt> hash was given, send it in the <tt class="literal">If-None-Match</tt> header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If a last-modified date was given, send it in the <tt class="literal">If-Modified-Since</tt> header.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Tell the server you would like compressed data if possible.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Build a URL opener that uses <span class="emphasis"><em>both</em></span> of the custom URL handlers: <tt class="classname">SmartRedirectHandler</tt> for handling <tt class="literal">301</tt> and <tt class="literal">302</tt> redirects, and <tt class="classname">DefaultErrorHandler</tt> for handling <tt class="literal">304</tt>, <tt class="literal">404</tt>, and other error conditions gracefully.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.1.7"><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">That's it!  Open the URL and return a file-like object to the caller.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e29574"></a><h3 class="title">Example&nbsp;11.18.&nbsp;The <tt class="function">fetch</tt> function
                  </h3>
                  <p>This function is defined in <tt class="filename">openanything.py</tt>.
                  </p><pre class="programlisting">
def fetch(source, etag=None, last_modified=None, agent=USER_AGENT):  
    '''Fetch data and metadata from a URL, file, stream, or string'''
    result = {}                                                      
    f = openAnything(source, etag, last_modified, agent)              <a name="oa.alltogether.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    result['data'] = f.read()                                         <a name="oa.alltogether.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    if hasattr(f, 'headers'):                                        
        # save ETag, if the server sent one                          
        result['etag'] = f.headers.get('ETag')                        <a name="oa.alltogether.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        # save Last-Modified header, if the server sent one          
        result['lastmodified'] = f.headers.get('Last-Modified')       <a name="oa.alltogether.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        if f.headers.get('content-encoding', '') == 'gzip':           <a name="oa.alltogether.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
            # data came back gzip-compressed, decompress it          
            result['data'] = gzip.GzipFile(fileobj=StringIO(result['data']])).read()
    if hasattr(f, 'url'):                                             <a name="oa.alltogether.2.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
        result['url'] = f.url                                        
        result['status'] = 200                                       
    if hasattr(f, 'status'):                                          <a name="oa.alltogether.2.7"></a><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12">
        result['status'] = f.status                                  
    f.close()                                                        
    return result                                                    
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First, you call the <tt class="function">openAnything</tt> function with a URL, <tt class="literal">ETag</tt> hash, <tt class="literal">Last-Modified</tt> date, and <tt class="literal">User-Agent</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Read the actual data returned from the server.  This may be compressed; if so, you'll decompress it later.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Save the <tt class="literal">ETag</tt> hash returned from the server, so the calling application can pass it back to you next time, and you can pass it on to <tt class="function">openAnything</tt>, which can stick it in the <tt class="literal">If-None-Match</tt> header and send it to the remote server.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Save the <tt class="literal">Last-Modified</tt> date too.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If the server says that it sent compressed data, decompress it.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.2.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If you got a URL back from the server, save it, and assume that the status code is <tt class="literal">200</tt> until you find out otherwise.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.2.7"><img src="images/callouts/7.png" alt="7" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If one of the custom URL handlers captured a status code, then save that too.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e29650"></a><h3 class="title">Example&nbsp;11.19.&nbsp;Using <tt class="filename">openanything.py</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import openanything</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">useragent = 'MyHTTPWebServicesApp/1.0'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">url = 'http://diveintopython.org/redir/example301.xml'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params = openanything.fetch(url, agent=useragent)</span>              <a name="oa.alltogether.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">params</span>                                                         <a name="oa.alltogether.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">{'url': 'http://diveintomark.org/xml/atom.xml', 
'lastmodified': 'Thu, 15 Apr 2004 19:45:21 GMT', 
'etag': '"e842a-3e53-55d97640"', 
'status': 301,
'data': '&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;feed version="0.3"
&lt;-- rest of data omitted for brevity --&gt;'}</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">if params['status'] == 301:</span>                                    <a name="oa.alltogether.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">url = params['url']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">newparams = openanything.fetch(</span>
<tt class="prompt">...     </tt><span class="userinput">url, params['etag'], params['lastmodified'], useragent)</span>    <a name="oa.alltogether.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">newparams</span>
<span class="computeroutput">{'url': 'http://diveintomark.org/xml/atom.xml', 
'lastmodified': None, 
'etag': '"e842a-3e53-55d97640"', 
'status': 304,
'data': ''}</span>                                                        <a name="oa.alltogether.3.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The very first time you fetch a resource, you don't have an <tt class="literal">ETag</tt> hash or <tt class="literal">Last-Modified</tt> date, so you'll leave those out.  (They're <a href="#apihelper.optional" title="4.2.&nbsp;Using Optional and Named Arguments">optional parameters</a>.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">What you get back is a dictionary of several useful headers, the HTTP status code, and the actual data returned from the server.
                               <tt class="filename">openanything</tt> handles the gzip compression internally; you don't care about that at this level.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If you ever get a <tt class="literal">301</tt> status code, that's a permanent redirect, and you need to update your URL to the new address.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The second time you fetch the same resource, you have all sorts of information to pass back: a (possibly updated) URL, the
                              <tt class="literal">ETag</tt> from the last time, the <tt class="literal">Last-Modified</tt> date from the last time, and of course your <tt class="literal">User-Agent</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#oa.alltogether.3.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">What you get back is again a dictionary, but the data hasn't changed, so all you got was a <tt class="literal">304</tt> status code and no data.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="oa.summary"></a>11.10.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <tt class="filename">openanything.py</tt> and its functions should now make perfect sense.
                  </p>
               </div>
               <p>There are 5 important features of HTTP web services that every client should support:</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Identifying your application <a href="#oa.useragent" title="11.5.&nbsp;Setting the User-Agent">by setting a proper <tt class="literal">User-Agent</tt></a>.
                     </li>
                     <li>Handling <a href="#oa.redirect" title="11.7.&nbsp;Handling redirects">permanent redirects properly</a>.
                     </li>
                     <li>Supporting <a href="#oa.etags" title="11.6.&nbsp;Handling Last-Modified and ETag"><tt class="literal">Last-Modified</tt> date checking</a> to avoid re-downloading data that hasn't changed.
                     </li>
                     <li>Supporting <a href="#oa.etags.example" title="Example&nbsp;11.9.&nbsp;Supporting ETag/If-None-Match"><tt class="literal">ETag</tt> hashes</a> to avoid re-downloading data that hasn't changed.
                     </li>
                     <li>Supporting <a href="#oa.gzip" title="11.8.&nbsp;Handling compressed data">gzip compression</a> to reduce bandwidth even when data <span class="emphasis"><em>has</em></span> changed.
                     </li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="soap"></a>Chapter&nbsp;12.&nbsp;<span class="acronym">SOAP</span> Web Services
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p><a href="#oa">Chapter 11</a> focused on document-oriented web services over HTTP.  The &#8220;<span class="quote">input parameter</span>&#8221; was the <span class="acronym">URL</span>, and the &#8220;<span class="quote">return value</span>&#8221; was an actual XML document which it was your responsibility to parse.
               </p>
               <p>This chapter will focus on <span class="acronym">SOAP</span> web services, which take a more structured approach.  Rather than dealing with HTTP requests and XML documents directly,
                  <span class="acronym">SOAP</span> allows you to simulate calling functions that return native data types.  As you will see, the illusion is almost perfect;
                  you can &#8220;<span class="quote">call</span>&#8221; a function through a <span class="acronym">SOAP</span> library, with the standard <span class="application">Python</span> calling syntax, and the function appears to return <span class="application">Python</span> objects and values.  But under the covers, the <span class="acronym">SOAP</span> library has actually performed a complex transaction involving multiple XML documents and a remote server.
               </p>
               <p><span class="acronym">SOAP</span> is a complex specification, and it is somewhat misleading to say that <span class="acronym">SOAP</span> is all about calling remote functions.  Some people would pipe up to add that <span class="acronym">SOAP</span> allows for one-way asynchronous message passing, and document-oriented web services.  And those people would be correct;
                  <span class="acronym">SOAP</span> can be used that way, and in many different ways.  But this chapter will focus on so-called &#8220;<span class="quote">RPC-style</span>&#8221; <span class="acronym">SOAP</span> -- calling a remote function and getting results back.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.divein"></a>12.1.&nbsp;Diving In
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You use Google, right?  It's a popular search engine.  Have you ever wished you could programmatically access Google search
                     results?  Now you can.  Here is a program to search Google from <span class="application">Python</span>.
                  </p>
               </div>
               <div class="example"><a name="d0e29893"></a><h3 class="title">Example&nbsp;12.1.&nbsp;<tt class="filename">search.py</tt></h3><pre class="programlisting">from SOAPpy import WSDL

# you'll need to configure these two values;
# see http://www.google.com/apis/
WSDLFILE = '/path/to/copy/of/GoogleSearch.wsdl'
APIKEY = 'YOUR_GOOGLE_API_KEY'

_server = WSDL.Proxy(WSDLFILE)
def search(q):
    """Search Google and return list of {title, link, description}"""
    results = _server.doGoogleSearch(
        APIKEY, q, 0, 10, False, "", False, "", "utf-8", "utf-8")
    return [{"title": r.title.encode("utf-8"),
             "link": r.URL.encode("utf-8"),
             "description": r.snippet.encode("utf-8")}
            for r in results.resultElements]

if __name__ == '__main__':
    import sys
    for r in search(sys.argv[1])[:5]:
        print r['title']
        print r['link']
        print r['description']
        print</pre></div>
               <p>You can import this as a module and use it from a larger program, or you can run the script from the command line.  On the
                  command line, you give the search query as a command-line argument, and it prints out the URL, title, and description of the
                  top five Google search results.
               </p>
               <p>Here is the sample output for a search for the word &#8220;<span class="quote">python</span>&#8221;.
               </p>
               <div class="example"><a name="d0e29906"></a><h3 class="title">Example&nbsp;12.2.&nbsp;Sample Usage of <tt class="filename">search.py</tt></h3><pre class="screen">
<tt class="prompt">C:\diveintopython\common\py&gt;</tt> <span class="userinput">python search.py "python"</span>
<span class="computeroutput">&lt;b&gt;Python&lt;/b&gt; Programming Language
http://www.python.org/
Home page for &lt;b&gt;Python&lt;/b&gt;, an interpreted, interactive, object-oriented,
extensible&lt;br&gt; programming language. &lt;b&gt;...&lt;/b&gt; &lt;b&gt;Python&lt;/b&gt;
is OSI Certified Open Source: OSI Certified.

&lt;b&gt;Python&lt;/b&gt; Documentation Index
http://www.python.org/doc/
 &lt;b&gt;...&lt;/b&gt; New-style classes (aka descrintro). Regular expressions. Database
API. Email Us.&lt;br&gt; docs@&lt;b&gt;python&lt;/b&gt;.org. (c) 2004. &lt;b&gt;Python&lt;/b&gt;
Software Foundation. &lt;b&gt;Python&lt;/b&gt; Documentation. &lt;b&gt;...&lt;/b&gt;

Download &lt;b&gt;Python&lt;/b&gt; Software
http://www.python.org/download/
Download Standard &lt;b&gt;Python&lt;/b&gt; Software. &lt;b&gt;Python&lt;/b&gt; 2.3.3 is the
current production&lt;br&gt; version of &lt;b&gt;Python&lt;/b&gt;. &lt;b&gt;...&lt;/b&gt;
&lt;b&gt;Python&lt;/b&gt; is OSI Certified Open Source:

Pythonline
http://www.pythonline.com/


Dive Into &lt;b&gt;Python&lt;/b&gt;
http://diveintopython.org/
Dive Into &lt;b&gt;Python&lt;/b&gt;. &lt;b&gt;Python&lt;/b&gt; from novice to pro. Find:
&lt;b&gt;...&lt;/b&gt; It is also available in multiple&lt;br&gt; languages. Read
Dive Into &lt;b&gt;Python&lt;/b&gt;. This book is still being written. &lt;b&gt;...&lt;/b&gt;</span>
</pre></div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on <span class="acronym">SOAP</span></h3>
                  <ul>
                     <li><a href="http://www.xmethods.net/">http://www.xmethods.net/</a> is a repository of public access <span class="acronym">SOAP</span> web services.
                     </li>
                     <li>The <a href="http://www.w3.org/TR/soap/"><span class="acronym">SOAP</span> specification</a> is surprisingly readable, if you like that sort of thing.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.install"></a>12.2.&nbsp;Installing the SOAP Libraries
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Unlike the other code in this book, this chapter relies on libraries that do not come pre-installed with <span class="application">Python</span>.
                  </p>
               </div>
               <p>Before you can dive into <span class="acronym">SOAP</span> web services, you'll need to install three libraries: <span class="application">PyXML</span>, <span class="application">fpconst</span>, and <span class="application">SOAPpy</span>.
               </p>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e29967"></a>12.2.1.&nbsp;Installing <span class="application">PyXML</span></h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The first library you need is <span class="application">PyXML</span>, an advanced set of <span class="acronym">XML</span> libraries that provide more functionality than the built-in <span class="acronym">XML</span> libraries we studied in <a href="#kgp">Chapter 9</a>.
                  </p>
                  <div class="procedure">
                     <h3 class="title">Procedure&nbsp;12.1.&nbsp;</h3>
                     <p>Here is the procedure for installing <span class="application">PyXML</span>:
                     </p>
                     <ol type="1">
                        <li>
                           <p>Go to <a href="http://pyxml.sourceforge.net/">http://pyxml.sourceforge.net/</a>, click Downloads, and download the latest version for your operating system.
                           </p>
                        </li>
                        <li>
                           <p>If you are using Windows, there are several choices.  Make sure to download the version of <span class="application">PyXML</span> that matches the version of <span class="application">Python</span> you are using.
                           </p>
                        </li>
                        <li>
                           <p>Double-click the installer.  If you download <span class="application">PyXML</span> 0.8.3 for Windows and <span class="application">Python</span> 2.3, the installer program will be <tt class="filename">PyXML-0.8.3.win32-py2.3.exe</tt>.
                           </p>
                        </li>
                        <li>
                           <p>Step through the installer program.</p>
                        </li>
                        <li>
                           <p>After the installation is complete, close the installer.  There will not be any visible indication of success (no programs
                              installed on the Start Menu or shortcuts installed on the desktop).  <span class="application">PyXML</span> is simply a collection of <span class="acronym">XML</span> libraries used by other programs.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <p>To verify that you installed <span class="application">PyXML</span> correctly, run your <span class="application">Python</span> <span class="acronym">IDE</span> and check the version of the <span class="acronym">XML</span> libraries you have installed, as shown here.
                  </p>
                  <div class="example"><a name="d0e30044"></a><h3 class="title">Example&nbsp;12.3.&nbsp;Verifying <span class="application">PyXML</span> Installation
                     </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import xml</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">xml.__version__</span>
<span class="computeroutput">'0.8.3'</span>
</pre><p>This version number should match the version number of the <span class="application">PyXML</span> installer program you downloaded and ran.
                     </p>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e30070"></a>12.2.2.&nbsp;Installing <span class="application">fpconst</span></h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The second library you need is <span class="application">fpconst</span>, a set of constants and functions for working with IEEE754 double-precision special values.  This provides support for the
                     special values Not-a-Number (NaN), Positive Infinity (Inf), and Negative Infinity (-Inf), which are part of the <span class="acronym">SOAP</span> datatype specification.
                  </p>
                  <div class="procedure">
                     <h3 class="title">Procedure&nbsp;12.2.&nbsp;</h3>
                     <p>Here is the procedure for installing <span class="application">fpconst</span>:
                     </p>
                     <ol type="1">
                        <li>
                           <p>Download the latest version of <span class="application">fpconst</span> from <a href="http://www.analytics.washington.edu/statcomp/projects/rzope/fpconst/">http://www.analytics.washington.edu/statcomp/projects/rzope/fpconst/</a>.
                           </p>
                        </li>
                        <li>
                           <p>There are two downloads available, one in <tt class="filename">.tar.gz</tt> format, the other in <tt class="filename">.zip</tt> format.  If you are using Windows, download the <tt class="filename">.zip</tt> file; otherwise, download the <tt class="filename">.tar.gz</tt> file.
                           </p>
                        </li>
                        <li>
                           <p>Decompress the downloaded file.  On Windows XP, you can right-click on the file and choose Extract All; on earlier versions
                              of Windows, you will need a third-party program such as WinZip.  On <span class="abbrev">Mac</span> <span class="acronym">OS</span> X, you can double-click the compressed file to decompress it with Stuffit Expander.
                           </p>
                        </li>
                        <li>
                           <p>Open a command prompt and navigate to the directory where you decompressed the <span class="application">fpconst</span> files.
                           </p>
                        </li>
                        <li>
                           <p>Type <b class="userinput"><tt>python setup.py install</tt></b> to run the installation program.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <p>To verify that you installed <span class="application">fpconst</span> correctly, run your <span class="application">Python</span> <span class="acronym">IDE</span> and check the version number.
                  </p>
                  <div class="example"><a name="d0e30145"></a><h3 class="title">Example&nbsp;12.4.&nbsp;Verifying <span class="application">fpconst</span> Installation
                     </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import fpconst</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">fpconst.__version__</span>
<span class="computeroutput">'0.6.0'</span>
</pre><p>This version number should match the version number of the <span class="application">fpconst</span> archive you downloaded and installed.
                     </p>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e30171"></a>12.2.3.&nbsp;Installing <span class="application">SOAPpy</span></h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <p>The third and final requirement is the <span class="acronym">SOAP</span> library itself: <span class="application">SOAPpy</span>.
                  </p>
                  <div class="procedure">
                     <h3 class="title">Procedure&nbsp;12.3.&nbsp;</h3>
                     <p>Here is the procedure for installing <span class="application">SOAPpy</span>:
                     </p>
                     <ol type="1">
                        <li>
                           <p>Go to <a href="http://pywebsvcs.sourceforge.net/">http://pywebsvcs.sourceforge.net/</a> and select Latest Official Release under the <span class="application">SOAPpy</span> section.
                           </p>
                        </li>
                        <li>
                           <p>There are two downloads available.  If you are using Windows, download the <tt class="filename">.zip</tt> file; otherwise, download the <tt class="filename">.tar.gz</tt> file.
                           </p>
                        </li>
                        <li>
                           <p>Decompress the downloaded file, just as you did with <span class="application">fpconst</span>.
                           </p>
                        </li>
                        <li>
                           <p>Open a command prompt and navigate to the directory where you decompressed the <span class="application">SOAPpy</span> files.
                           </p>
                        </li>
                        <li>
                           <p>Type <b class="userinput"><tt>python setup.py install</tt></b> to run the installation program.
                           </p>
                        </li>
                     </ol>
                  </div>
                  <p>To verify that you installed <span class="application">SOAPpy</span> correctly, run your <span class="application">Python</span> <span class="acronym">IDE</span> and check the version number.
                  </p>
                  <div class="example"><a name="d0e30237"></a><h3 class="title">Example&nbsp;12.5.&nbsp;Verifying <span class="application">SOAPpy</span> Installation
                     </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import SOAPpy</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">SOAPpy.__version__</span>
<span class="computeroutput">'0.11.4'</span>
</pre><p>This version number should match the version number of the <span class="application">SOAPpy</span> archive you downloaded and installed.
                     </p>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.firststeps"></a>12.3.&nbsp;First Steps with <span class="acronym">SOAP</span></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The heart of <span class="acronym">SOAP</span> is the ability to call remote functions.  There are a number of public access <span class="acronym">SOAP</span> servers that provide simple functions for demonstration purposes.
                  </p>
               </div>
               <p>The most popular public access <span class="acronym">SOAP</span> server is <a href="http://www.xmethods.net/">http://www.xmethods.net/</a>.  This example uses a demonstration function that takes a United States zip code and returns the current temperature in that
                  region.
               </p>
               <div class="example"><a name="d0e30286"></a><h3 class="title">Example&nbsp;12.6.&nbsp;Getting the Current Temperature</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import SOAPProxy</span>            <a name="soap.firststeps.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">url = 'http://services.xmethods.net:80/soap/servlet/rpcrouter'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">namespace = 'urn:xmethods-Temperature'</span>  <a name="soap.firststeps.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = SOAPProxy(url, namespace)</span>      <a name="soap.firststeps.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.getTemp('27502')</span>                 <a name="soap.firststeps.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">80.0</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.firststeps.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You access the remote <span class="acronym">SOAP</span> server through a proxy class, <tt class="classname">SOAPProxy</tt>.  The proxy handles all the internals of <span class="acronym">SOAP</span> for you, including creating the XML request document out of the function name and argument list, sending the request over
                              HTTP to the remote <span class="acronym">SOAP</span> server, parsing the XML response document, and creating native <span class="application">Python</span> values to return.  You'll see what these XML documents look like in the next section.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.firststeps.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Every <span class="acronym">SOAP</span> service has a <span class="acronym">URL</span> which handles all the requests.  The same <span class="acronym">URL</span> is used for all function calls.  This particular service only has a single function, but later in this chapter you'll see
                              examples of the Google <span class="acronym">API</span>, which has several functions.  The service <span class="acronym">URL</span> is shared by all functions.Each <span class="acronym">SOAP</span> service also has a namespace, which is defined by the server and is completely arbitrary.  It's simply part of the configuration
                              required to call <span class="acronym">SOAP</span> methods.  It allows the server to share a single service <span class="acronym">URL</span> and route requests between several unrelated services.  It's like dividing <span class="application">Python</span> modules into <a href="#kgp.packages" title="9.2.&nbsp;Packages">packages</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.firststeps.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You're creating the <tt class="classname">SOAPProxy</tt> with the service <span class="acronym">URL</span> and the service namespace.  This doesn't make any connection to the <span class="acronym">SOAP</span> server; it simply creates a local <span class="application">Python</span> object.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.firststeps.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now with everything configured properly, you can actually call remote <span class="acronym">SOAP</span> methods as if they were local functions.  You pass arguments just like a normal function, and you get a return value just
                              like a normal function.  But under the covers, there's a heck of a lot going on.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Let's peek under those covers.</p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.debug"></a>12.4.&nbsp;Debugging <span class="acronym">SOAP</span> Web Services
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <span class="acronym">SOAP</span> libraries provide an easy way to see what's going on behind the scenes.
                  </p>
               </div>
               <p>Turning on debugging is a simple matter of setting two flags in the <tt class="classname">SOAPProxy</tt>'s configuration.
               </p>
               <div class="example"><a name="d0e30423"></a><h3 class="title">Example&nbsp;12.7.&nbsp;Debugging <span class="acronym">SOAP</span> Web Services
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import SOAPProxy</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">url = 'http://services.xmethods.net:80/soap/servlet/rpcrouter'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">n = 'urn:xmethods-Temperature'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = SOAPProxy(url, namespace=n)</span>     <a name="soap.debug.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.config.dumpSOAPOut = 1</span>            <a name="soap.debug.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.config.dumpSOAPIn = 1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">temperature = server.getTemp('27502')</span>    <a name="soap.debug.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">*** Outgoing SOAP ******************************************************
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"
  xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"
  xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance"
  xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
  xmlns:xsd="http://www.w3.org/1999/XMLSchema"&gt;
&lt;SOAP-ENV:Body&gt;
&lt;ns1:getTemp xmlns:ns1="urn:xmethods-Temperature" SOAP-ENC:root="1"&gt;
&lt;v1 xsi:type="xsd:string"&gt;27502&lt;/v1&gt;
&lt;/ns1:getTemp&gt;
&lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
************************************************************************
*** Incoming SOAP ******************************************************
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
&lt;SOAP-ENV:Body&gt;
&lt;ns1:getTempResponse xmlns:ns1="urn:xmethods-Temperature"
  SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"&gt;
&lt;return xsi:type="xsd:float"&gt;80.0&lt;/return&gt;
&lt;/ns1:getTempResponse&gt;

&lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
************************************************************************
</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">temperature</span>
<span class="computeroutput">80.0</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">First, create the <tt class="classname">SOAPProxy</tt> like normal, with the service <span class="acronym">URL</span> and the namespace.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Second, turn on debugging by setting <tt class="varname">server.config.dumpSOAPIn</tt> and <tt class="varname">server.config.dumpSOAPOut</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Third, call the remote <span class="acronym">SOAP</span> method as usual.  The <span class="acronym">SOAP</span> library will print out both the outgoing XML request document, and the incoming XML response document.  This is all the hard
                              work that <tt class="classname">SOAPProxy</tt> is doing for you.  Intimidating, isn't it?  Let's break it down.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Most of the XML request document that gets sent to the server is just boilerplate.  Ignore all the namespace declarations;
                  they're going to be the same (or similar) for all <span class="acronym">SOAP</span> calls.  The heart of the &#8220;<span class="quote">function call</span>&#8221; is this fragment within the <tt class="sgmltag-element">&lt;Body&gt;</tt> element:
               </p>
               <div class="informalexample"><pre class="programlisting">
&lt;ns1:getTemp                                 <a name="soap.debug.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
  xmlns:ns1="urn:xmethods-Temperature"       <a name="soap.debug.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
  SOAP-ENC:root="1"&gt;
&lt;v1 xsi:type="xsd:string"&gt;27502&lt;/v1&gt;         <a name="soap.debug.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
&lt;/ns1:getTemp&gt;
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The element name is the function name, <tt class="function">getTemp</tt>.  <tt class="classname">SOAPProxy</tt> uses <a href="#kgp.handler" title="10.5.&nbsp;Creating separate handlers by node type"><tt class="function">getattr</tt> as a dispatcher</a>.  Instead of calling separate local methods based on the method name, it actually uses the method name to construct the XML
                              request document.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The function's XML element is contained in a specific namespace, which is the namespace you specified when you created the
                              <tt class="classname">SOAPProxy</tt> object.  Don't worry about the <tt class="literal">SOAP-ENC:root</tt>; that's boilerplate too.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The arguments of the function also got translated into XML.  <tt class="classname">SOAPProxy</tt> introspects each argument to determine its datatype (in this case it's a string).  The argument datatype goes into the <tt class="literal">xsi:type</tt> attribute, followed by the actual string value.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The XML return document is equally easy to understand, once you know what to ignore.  Focus on this fragment within the <tt class="sgmltag-element">&lt;Body&gt;</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
&lt;ns1:getTempResponse                             <a name="soap.debug.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
  xmlns:ns1="urn:xmethods-Temperature"           <a name="soap.debug.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
  SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"&gt;
&lt;return xsi:type="xsd:float"&gt;80.0&lt;/return&gt;       <a name="soap.debug.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
&lt;/ns1:getTempResponse&gt;
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The server wraps the function return value within a <tt class="sgmltag-element">&lt;getTempResponse&gt;</tt> element.  By convention, this wrapper element is the name of the function, plus <tt class="literal">Response</tt>.  But it could really be almost anything; the important thing that <tt class="classname">SOAPProxy</tt> notices is not the element name, but the namespace.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The server returns the response in the same namespace we used in the request, the same namespace we specified when we first
                              create the <tt class="classname">SOAPProxy</tt>.  Later in this chapter we'll see what happens if you forget to specify the namespace when creating the <tt class="classname">SOAPProxy</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.debug.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The return value is specified, along with its datatype (it's a float).  <tt class="classname">SOAPProxy</tt> uses this explicit datatype to create a <span class="application">Python</span> object of the correct native datatype and return it.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.wsdl"></a>12.5.&nbsp;Introducing <span class="acronym">WSDL</span></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <tt class="classname">SOAPProxy</tt> class proxies local method calls and transparently turns then into invocations of remote <span class="acronym">SOAP</span> methods.  As you've seen, this is a lot of work, and <tt class="classname">SOAPProxy</tt> does it quickly and transparently.  What it doesn't do is provide any means of method introspection.
                  </p>
               </div>
               <p>Consider this: the previous two sections showed an example of calling a simple remote <span class="acronym">SOAP</span> method with one argument and one return value, both of simple data types.  This required knowing, and keeping track of, the
                  service <span class="acronym">URL</span>, the service namespace, the function name, the number of arguments, and the datatype of each argument.  If any of these is
                  missing or wrong, the whole thing falls apart.
               </p>
               <p>That shouldn't come as a big surprise.  If I wanted to call a local function, I would need to know what package or module
                  it was in (the equivalent of service <span class="acronym">URL</span> and namespace).  I would need to know the correct function name and the correct number of arguments.  <span class="application">Python</span> deftly handles datatyping without explicit types, but I would still need to know how many argument to pass, and how many
                  return values to expect.
               </p>
               <p>The big difference is introspection.  As you saw in <a href="#apihelper">Chapter 4</a>, <span class="application">Python</span> excels at letting you discover things about modules and functions at runtime.  You can list the available functions within
                  a module, and with a little work, drill down to individual function declarations and arguments.
               </p>
               <p><span class="acronym">WSDL</span> lets you do that with <span class="acronym">SOAP</span> web services.  <span class="acronym">WSDL</span> stands for &#8220;<span class="quote">Web Services Description Language</span>&#8221;.  Although designed to be flexible enough to describe many types of web services, it is most often used to describe <span class="acronym">SOAP</span> web services.
               </p>
               <p>A <span class="acronym">WSDL</span> file is just that: a file.  More specifically, it's an XML file.  It usually lives on the same server you use to access the
                  <span class="acronym">SOAP</span> web services it describes, although there's nothing special about it.  Later in this chapter, we'll download the <span class="acronym">WSDL</span> file for the Google API and use it locally.  That doesn't mean we're calling Google locally; the <span class="acronym">WSDL</span> file still describes the remote functions sitting on Google's server.
               </p>
               <p>A <span class="acronym">WSDL</span> file contains a description of everything involved in calling a <span class="acronym">SOAP</span> web service:
               </p>
               <div class="itemizedlist">
                  <ul>
                     <li>The service <span class="acronym">URL</span> and namespace
                     </li>
                     <li>The type of web service (probably function calls using <span class="acronym">SOAP</span>, although as I mentioned, <span class="acronym">WSDL</span> is flexible enough to describe a wide variety of web services)
                     </li>
                     <li>The list of available functions</li>
                     <li>The arguments for each function</li>
                     <li>The datatype of each argument</li>
                     <li>The return values of each function, and the datatype of each return value</li>
                  </ul>
               </div>
               <p>In other words, a <span class="acronym">WSDL</span> file tells you everything you need to know to be able to call a <span class="acronym">SOAP</span> web service.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.introspection"></a>12.6.&nbsp;Introspecting <span class="acronym">SOAP</span> Web Services with <span class="acronym">WSDL</span></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Like many things in the web services arena, <span class="acronym">WSDL</span> has a long and checkered history, full of political strife and intrigue.  I will skip over this history entirely, since it
                     bores me to tears.  There were other standards that tried to do similar things, but <span class="acronym">WSDL</span> won, so let's learn how to use it.
                  </p>
               </div>
               <p>The most fundamental thing that <span class="acronym">WSDL</span> allows you to do is discover the available methods offered by a <span class="acronym">SOAP</span> server.
               </p>
               <div class="example"><a name="d0e30755"></a><h3 class="title">Example&nbsp;12.8.&nbsp;Discovering The Available Methods</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import WSDL</span>          <a name="soap.introspection.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">wsdlFile = 'http://www.xmethods.net/sd/2001/TemperatureService.wsdl')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = WSDL.Proxy(wsdlFile)</span>    <a name="soap.introspection.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.methods.keys()</span>            <a name="soap.introspection.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">[u'getTemp']</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><span class="application">SOAPpy</span> includes a <span class="acronym">WSDL</span> parser.  At the time of this writing, it was labeled as being in the early stages of development, but I had no problem parsing
                              any of the <span class="acronym">WSDL</span> files I tried.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To use a <span class="acronym">WSDL</span> file, you again use a proxy class, <tt class="classname">WSDL.Proxy</tt>, which takes a single argument: the <span class="acronym">WSDL</span> file.  Note that in this case you are passing in the <span class="acronym">URL</span> of a <span class="acronym">WSDL</span> file stored on the remote server, but the proxy class works just as well with a local copy of the <span class="acronym">WSDL</span> file.  The act of creating the <span class="acronym">WSDL</span> proxy will download the <span class="acronym">WSDL</span> file and parse it, so it there are any errors in the <span class="acronym">WSDL</span> file (or it can't be fetched due to networking problems), you'll know about it immediately.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <span class="acronym">WSDL</span> proxy class exposes the available functions as a <span class="application">Python</span> dictionary, <tt class="varname">server.methods</tt>.  So getting the list of available methods is as simple as calling the dictionary method <tt class="methodname">keys()</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Okay, so you know that this <span class="acronym">SOAP</span> server offers a single method: <tt class="methodname">getTemp</tt>.  But how do you call it?  The <span class="acronym">WSDL</span> proxy object can tell you that too.
               </p>
               <div class="example"><a name="d0e30857"></a><h3 class="title">Example&nbsp;12.9.&nbsp;Discovering A Method's Arguments</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo = server.methods['getTemp']</span>  <a name="soap.introspection.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo.inparams</span>                     <a name="soap.introspection.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">[&lt;SOAPpy.wstools.WSDLTools.ParameterInfo instance at 0x00CF3AD0&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo.inparams[0].name</span>             <a name="soap.introspection.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">u'zipcode'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo.inparams[0].type</span>             <a name="soap.introspection.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">(u'http://www.w3.org/2001/XMLSchema', u'string')</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="varname">server.methods</tt> dictionary is filled with a <span class="application">SOAPpy</span>-specific structure called <tt class="classname">CallInfo</tt>.  A <tt class="classname">CallInfo</tt> object contains information about one specific function, including the function arguments.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The function arguments are stored in <tt class="varname">callInfo.inparams</tt>, which is a <span class="application">Python</span> list of <tt class="classname">ParameterInfo</tt> objects that hold information about each parameter.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each <tt class="classname">ParameterInfo</tt> object contains a <tt class="varname">name</tt> attribute, which is the argument name.  You are not required to know the argument name to call the function through <span class="acronym">SOAP</span>, but <span class="acronym">SOAP</span> does support calling functions with named arguments (just like <span class="application">Python</span>), and <tt class="classname">WSDL.Proxy</tt> will correctly handle mapping named arguments to the remote function if you choose to use them.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each parameter is also explicitly typed, using datatypes defined in XML Schema.  You saw this in the wire trace in the previous
                              section; the XML Schema namespace was part of the &#8220;<span class="quote">boilerplate</span>&#8221; I told you to ignore.  For our purposes here, you may continue to ignore it.  The <tt class="varname">zipcode</tt> parameter is a string, and if you pass in a <span class="application">Python</span> string to the <tt class="classname">WSDL.Proxy</tt> object, it will map it correctly and send it to the server.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p><span class="acronym">WSDL</span> also lets you introspect into a function's return values.
               </p>
               <div class="example"><a name="d0e30967"></a><h3 class="title">Example&nbsp;12.10.&nbsp;Discovering A Method's Return Values</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo.outparams</span>            <a name="soap.introspection.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[&lt;SOAPpy.wstools.WSDLTools.ParameterInfo instance at 0x00CF3AF8&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo.outparams[0].name</span>    <a name="soap.introspection.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">u'return'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo.outparams[0].type</span>
<span class="computeroutput">(u'http://www.w3.org/2001/XMLSchema', u'float')</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The adjunct to <tt class="varname">callInfo.inparams</tt> for function arguments is <tt class="varname">callInfo.outparams</tt> for return value.  It is also a list, because functions called through <span class="acronym">SOAP</span> can return multiple values, just like <span class="application">Python</span> functions.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each <tt class="classname">ParameterInfo</tt> object contains <tt class="varname">name</tt> and <tt class="varname">type</tt>.  This function returns a single value, named <tt class="varname">return</tt>, which is a float.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Let's put it all together, and call a <span class="acronym">SOAP</span> web service through a <span class="acronym">WSDL</span> proxy.
               </p>
               <div class="example"><a name="d0e31039"></a><h3 class="title">Example&nbsp;12.11.&nbsp;Calling A Web Service Through A <span class="acronym">WSDL</span> Proxy
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import WSDL</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">wsdlFile = 'http://www.xmethods.net/sd/2001/TemperatureService.wsdl')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = WSDL.Proxy(wsdlFile)</span>               <a name="soap.introspection.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.getTemp('90210')</span>                     <a name="soap.introspection.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">66.0</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.soapproxy.config.dumpSOAPOut = 1</span>     <a name="soap.introspection.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.soapproxy.config.dumpSOAPIn = 1</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">temperature = server.getTemp('90210')</span>
<span class="computeroutput">*** Outgoing SOAP ******************************************************
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"
  xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"
  xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance"
  xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
  xmlns:xsd="http://www.w3.org/1999/XMLSchema"&gt;
&lt;SOAP-ENV:Body&gt;
&lt;ns1:getTemp xmlns:ns1="urn:xmethods-Temperature" SOAP-ENC:root="1"&gt;
&lt;v1 xsi:type="xsd:string"&gt;90210&lt;/v1&gt;
&lt;/ns1:getTemp&gt;
&lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
************************************************************************
*** Incoming SOAP ******************************************************
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
&lt;SOAP-ENV:Body&gt;
&lt;ns1:getTempResponse xmlns:ns1="urn:xmethods-Temperature"
  SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"&gt;
&lt;return xsi:type="xsd:float"&gt;66.0&lt;/return&gt;
&lt;/ns1:getTempResponse&gt;

&lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
************************************************************************
</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">temperature</span>
<span class="computeroutput">66.0</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The configuration is simpler than calling the <span class="acronym">SOAP</span> service directly, since the <span class="acronym">WSDL</span> file contains the both service <span class="acronym">URL</span> and namespace you need to call the service.  Creating the <tt class="classname">WSDL.Proxy</tt> object downloads the <span class="acronym">WSDL</span> file, parses it, and configures a <tt class="classname">SOAPProxy</tt> object that it uses to call the actual <span class="acronym">SOAP</span> web service.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Once the <tt class="classname">WSDL.Proxy</tt> object is created, you can call a function as easily as you did with the <tt class="classname">SOAPProxy</tt> object.  This is not surprising; the <tt class="classname">WSDL.Proxy</tt> is just a wrapper around the <tt class="classname">SOAPProxy</tt> with some introspection methods added, so the syntax for calling functions is the same.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.introspection.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can access the <tt class="classname">WSDL.Proxy</tt>'s <tt class="classname">SOAPProxy</tt> with <tt class="varname">server.soapproxy</tt>.  This is useful to turning on debugging, so that when you can call functions through the <span class="acronym">WSDL</span> proxy, its <tt class="classname">SOAPProxy</tt> will dump the outgoing and incoming XML documents that are going over the wire.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.google"></a>12.7.&nbsp;Searching Google
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Let's finally turn to the sample code that you saw that the beginning of this chapter, which does something more useful and
                     exciting than get the current temperature.
                  </p>
               </div>
               <p>Google provides a <span class="acronym">SOAP</span> <span class="acronym">API</span> for programmatically accessing Google search results.  To use it, you will need to sign up for Google Web Services.
               </p>
               <div class="procedure">
                  <h3 class="title">Procedure&nbsp;12.4.&nbsp;Signing Up for Google Web Services</h3>
                  <ol type="1">
                     <li>
                        <p>Go to <a href="http://www.google.com/apis/">http://www.google.com/apis/</a> and create a Google account.  This requires only an email address.  After you sign up you will receive your Google API license
                           key by email.  You will need this key to pass as a parameter whenever you call Google's search functions.
                        </p>
                     </li>
                     <li>
                        <p>Also on <a href="http://www.google.com/apis/">http://www.google.com/apis/</a>, download the Google Web APIs developer kit.  This includes some sample code in several programming languages (but not <span class="application">Python</span>), and more importantly, it includes the <span class="acronym">WSDL</span> file.
                        </p>
                     </li>
                     <li>
                        <p>Decompress the developer kit file and find <tt class="filename">GoogleSearch.wsdl</tt>.  Copy this file to some permanent location on your local drive.  You will need it later in this chapter.
                        </p>
                     </li>
                  </ol>
               </div>
               <p>Once you have your developer key and your Google <span class="acronym">WSDL</span> file in a known place, you can start poking around with Google Web Services.
               </p>
               <div class="example"><a name="d0e31206"></a><h3 class="title">Example&nbsp;12.12.&nbsp;Introspecting Google Web Services</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import WSDL</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = WSDL.Proxy('/path/to/your/GoogleSearch.wsdl')</span> <a name="soap.google.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.methods.keys()</span>                                  <a name="soap.google.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">[u'doGoogleSearch', u'doGetCachedPage', u'doSpellingSuggestion']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">callInfo = server.methods['doGoogleSearch']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for arg in callInfo.inparams:</span>                          <a name="soap.google.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">print arg.name.ljust(15), arg.type</span>
<span class="computeroutput">key             (u'http://www.w3.org/2001/XMLSchema', u'string')
q               (u'http://www.w3.org/2001/XMLSchema', u'string')
start           (u'http://www.w3.org/2001/XMLSchema', u'int')
maxResults      (u'http://www.w3.org/2001/XMLSchema', u'int')
filter          (u'http://www.w3.org/2001/XMLSchema', u'boolean')
restrict        (u'http://www.w3.org/2001/XMLSchema', u'string')
safeSearch      (u'http://www.w3.org/2001/XMLSchema', u'boolean')
lr              (u'http://www.w3.org/2001/XMLSchema', u'string')
ie              (u'http://www.w3.org/2001/XMLSchema', u'string')
oe              (u'http://www.w3.org/2001/XMLSchema', u'string')</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Getting started with Google web services is easy: just create a <tt class="classname">WSDL.Proxy</tt> object and point it at your local copy of Google's <span class="acronym">WSDL</span> file.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">According to the <span class="acronym">WSDL</span> file, Google offers three functions: <tt class="function">doGoogleSearch</tt>, <tt class="function">doGetCachedPage</tt>, and <tt class="function">doSpellingSuggestion</tt>.  These do exactly what they sound like: perform a Google search and return the results programmatically, get access to the
                              cached version of a page from the last time Google saw it, and offer spelling suggestions for commonly misspelled search words.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">doGoogleSearch</tt> function takes a number of parameters of various types.  Note that while the <span class="acronym">WSDL</span> file can tell you what the arguments are called and what datatype they are, it can't tell you what they mean or how to use
                              them.  It could theoretically tell you the acceptable range of values for each parameter, if only specific values were allowed,
                              but Google's <span class="acronym">WSDL</span> file is not that detailed.  <tt class="classname">WSDL.Proxy</tt> can't work magic; it can only give you the information provided in the <span class="acronym">WSDL</span> file.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Here is a brief synopsis of all the parameters to the <tt class="function">doGoogleSearch</tt> function:
               </p>
               <div class="itemizedlist">
                  <ul>
                     <li><tt class="varname">key</tt> - Your Google API key, which you received when you signed up for Google web services.
                     </li>
                     <li><tt class="varname">q</tt> - The search word or phrase you're looking for.  The syntax is exactly the same as Google's web form, so if you know any
                        advanced search syntax or tricks, they all work here as well.
                     </li>
                     <li><tt class="varname">start</tt> - The index of the result to start on.  Like the interactive web version of Google, this function returns 10 results at a
                        time.  If you wanted to get the second &#8220;<span class="quote">page</span>&#8221; of results, you would set <tt class="varname">start</tt> to 10.
                     </li>
                     <li><tt class="varname">maxResults</tt> - The number of results to return.  Currently capped at 10, although you can specify fewer if you are only interested in
                        a few results and want to save a little bandwidth.
                     </li>
                     <li><tt class="varname">filter</tt> - If <tt class="constant">True</tt>, Google will filter out duplicate pages from the results.
                     </li>
                     <li><tt class="varname">restrict</tt> - Set this to <tt class="literal">country</tt> plus a country code to get results only from a particular country.  Example: <tt class="literal">countryUK</tt> to search pages in the United Kingdom.  You can also specify <tt class="literal">linux</tt>, <tt class="literal">mac</tt>, or <tt class="literal">bsd</tt> to search a Google-defined set of technical sites, or <tt class="literal">unclesam</tt> to search sites about the United States government.
                     </li>
                     <li><tt class="varname">safeSearch</tt> - If <tt class="constant">True</tt>, Google will filter out porn sites.
                     </li>
                     <li><tt class="varname">lr</tt> (&#8220;<span class="quote">language restrict</span>&#8221;) - Set this to a language code to get results only in a particular language.
                     </li>
                     <li><tt class="varname">ie</tt> and <tt class="varname">oe</tt> (&#8220;<span class="quote">input encoding</span>&#8221; and &#8220;<span class="quote">output encoding</span>&#8221;) - Deprecated, both must be <tt class="literal">utf-8</tt>.
                     </li>
                  </ul>
               </div>
               <div class="example"><a name="d0e31392"></a><h3 class="title">Example&nbsp;12.13.&nbsp;Searching Google</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import WSDL</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = WSDL.Proxy('/path/to/your/GoogleSearch.wsdl')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">key = 'YOUR_GOOGLE_API_KEY'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results = server.doGoogleSearch(key, 'mark', 0, 10, False, "",</span>
<tt class="prompt">...     </tt><span class="userinput">False, "", "utf-8", "utf-8")</span>             <a name="soap.google.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">len(results.resultElements)</span>                  <a name="soap.google.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">10</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results.resultElements[0].URL</span>                <a name="soap.google.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'http://diveintomark.org/'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results.resultElements[0].title</span>
<span class="computeroutput">'dive into &lt;b&gt;mark&lt;/b&gt;'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">After setting up the <tt class="classname">WSDL.Proxy</tt> object, you can call <tt class="function">server.doGoogleSearch</tt> with all ten parameters.  Remember to use your own Google API key that you received when you signed up for Google web services.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">There's a lot of information returned, but let's look at the actual search results first.  They're stored in <tt class="varname">results.resultElements</tt>, and you can access them just like a normal <span class="application">Python</span> list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each element in the <tt class="varname">resultElements</tt> is an object that has a <tt class="varname">URL</tt>, <tt class="varname">title</tt>, <tt class="varname">snippet</tt>, and other useful attributes.  At this point you can use normal <span class="application">Python</span> introspection techniques like <b class="userinput"><tt>dir(results.resultElements[0])</tt></b> to see the available attributes.  Or you can introspect through the <span class="acronym">WSDL</span> proxy object and look through the function's <tt class="varname">outparams</tt>.  Each technique will give you the same information.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The <tt class="varname">results</tt> object contains more than the actual search results.  It also contains information about the search itself, such as how long
                  it took and how many results were found (even though only 10 were returned).  The Google web interface shows this information,
                  and you can access it programmatically too.
               </p>
               <div class="example"><a name="d0e31503"></a><h3 class="title">Example&nbsp;12.14.&nbsp;Accessing Secondary Information From Google</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results.searchTime</span>                     <a name="soap.google.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">0.224919</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results.estimatedTotalResultsCount</span>     <a name="soap.google.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">29800000</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results.directoryCategories</span>            <a name="soap.google.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">[&lt;SOAPpy.Types.structType item at 14367400&gt;:
 {'fullViewableName':
  'Top/Arts/Literature/World_Literature/American/19th_Century/Twain,_Mark',
  'specialEncoding': ''}]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results.directoryCategories[0].fullViewableName</span>
<span class="computeroutput">'Top/Arts/Literature/World_Literature/American/19th_Century/Twain,_Mark'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This search took 0.224919 seconds.  That does not include the time spent sending and receiving the actual <span class="acronym">SOAP</span> XML documents.  It's just the time that Google spent processing your request once it received it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In total, there were approximately 30 million results.  You can access them 10 at a time by changing the <tt class="varname">start</tt> parameter and calling <tt class="function">server.doGoogleSearch</tt> again.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.google.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">For some queries, Google also returns a list of related categories in the <a href="http://directory.google.com/">Google Directory</a>.  You can append these URLs to <a href="http://directory.google.com/">http://directory.google.com/</a> to construct the link to the directory category page.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.troubleshooting"></a>12.8.&nbsp;Troubleshooting <span class="acronym">SOAP</span> Web Services
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Of course, the world of <span class="acronym">SOAP</span> web services is not all happiness and light.  Sometimes things go wrong.
                  </p>
               </div>
               <p>As you've seen throughout this chapter, <span class="acronym">SOAP</span> involves several layers.  There's the HTTP layer, since <span class="acronym">SOAP</span> is sending XML documents to, and receiving XML documents from, an HTTP server.  So all the debugging techniques you learned
                  in <a href="#oa" title="Chapter&nbsp;11.&nbsp;HTTP Web Services">Chapter&nbsp;11, <i>HTTP Web Services</i></a> come into play here.  You can <b class="userinput"><tt>import httplib</tt></b> and then set <b class="userinput"><tt>httplib.HTTPConnection.debuglevel = 1</tt></b> to see the underlying HTTP traffic.
               </p>
               <p>Beyond the underlying HTTP layer, there are a number of things that can go wrong.  <span class="application">SOAPpy</span> does an admirable job hiding the <span class="acronym">SOAP</span> syntax from you, but that also means it can be difficult to determine where the problem is when things don't work.
               </p>
               <p>Here are a few examples of common mistakes that I've made in using <span class="acronym">SOAP</span> web services, and the errors they generated.
               </p>
               <div class="example"><a name="d0e31615"></a><h3 class="title">Example&nbsp;12.15.&nbsp;Calling a Method With an Incorrectly Configured Proxy</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import SOAPProxy</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">url = 'http://services.xmethods.net:80/soap/servlet/rpcrouter'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = SOAPProxy(url)</span>                                        <a name="soap.troubleshooting.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server.getTemp('27502')</span>                                        <a name="soap.troubleshooting.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="traceback">&lt;Fault SOAP-ENV:Server.BadTargetObjectURI:
Unable to determine object id from call: is the method element namespaced?&gt;
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 453, in __call__
    return self.__r_call(*args, **kw)
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 475, in __r_call
    self.__hd, self.__ma)
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 389, in __call
    raise p
SOAPpy.Types.faultType: &lt;Fault SOAP-ENV:Server.BadTargetObjectURI:
Unable to determine object id from call: is the method element namespaced?&gt;</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.troubleshooting.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Did you spot the mistake?  You're creating a <tt class="classname">SOAPProxy</tt> manually, and you've correctly specified the service <span class="acronym">URL</span>, but you haven't specified the namespace.  Since multiple services may be routed through the same service <span class="acronym">URL</span>, the namespace is essential to determine which service you're trying to talk to, and therefore which method you're really
                              calling.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.troubleshooting.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The server responds by sending a <span class="acronym">SOAP</span> Fault, which <span class="application">SOAPpy</span> turns into a <span class="application">Python</span> exception of type <tt class="classname">SOAPpy.Types.faultType</tt>.  All errors returned from any <span class="acronym">SOAP</span> server will always be <span class="acronym">SOAP</span> Faults, so you can easily catch this exception.  In this case, the human-readable part of the <span class="acronym">SOAP</span> Fault gives a clue to the problem: the method element is not namespaced, because the original <tt class="classname">SOAPProxy</tt> object was not configured with a service namespace.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Misconfiguring the basic elements of the <span class="acronym">SOAP</span> service is one of the problems that <span class="acronym">WSDL</span> aims to solve.  The <span class="acronym">WSDL</span> file contains the service <span class="acronym">URL</span> and namespace, so you can't get it wrong.  Of course, there are still other things you can get wrong.
               </p>
               <div class="example"><a name="d0e31701"></a><h3 class="title">Example&nbsp;12.16.&nbsp;Calling a Method With the Wrong Arguments</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">wsdlFile = 'http://www.xmethods.net/sd/2001/TemperatureService.wsdl'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = WSDL.Proxy(wsdlFile)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">temperature = server.getTemp(27502)</span>                                <a name="soap.troubleshooting.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="traceback">&lt;Fault SOAP-ENV:Server: Exception while handling service request:
services.temperature.TempService.getTemp(int) -- no signature match&gt;   <a name="soap.troubleshooting.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 453, in __call__
    return self.__r_call(*args, **kw)
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 475, in __r_call
    self.__hd, self.__ma)
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 389, in __call
    raise p
SOAPpy.Types.faultType: &lt;Fault SOAP-ENV:Server: Exception while handling service request:
services.temperature.TempService.getTemp(int) -- no signature match&gt;</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.troubleshooting.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Did you spot the mistake?  It's a subtle one: you're calling <tt class="function">server.getTemp</tt> with an integer instead of a string.  As you saw from introspecting the <span class="acronym">WSDL</span> file, the <tt class="function">getTemp()</tt> <span class="acronym">SOAP</span> function takes a single argument, <tt class="varname">zipcode</tt>, which must be a string.  <tt class="classname">WSDL.Proxy</tt> will <span class="emphasis"><em>not</em></span> coerce datatypes for you; you need to pass the exact datatypes that the server expects.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.troubleshooting.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Again, the server returns a <span class="acronym">SOAP</span> Fault, and the human-readable part of the error gives a clue as to the problem: you're calling a <tt class="function">getTemp</tt> function with an integer value, but there is no function defined with that name that takes an integer.  In theory, <span class="acronym">SOAP</span> allows you to <span class="emphasis"><em>overload</em></span> functions, so you could have two functions in the same <span class="acronym">SOAP</span> service with the same name and the same number of arguments, but the arguments were of different datatypes.  This is why
                              it's important to match the datatypes exactly, and why <tt class="classname">WSDL.Proxy</tt> doesn't coerce datatypes for you.  If it did, you could end up calling a completely different function!  Good luck debugging
                              that one.  It's much easier to be picky about datatypes and fail as quickly as possible if you get them wrong.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>It's also possible to write <span class="application">Python</span> code that expects a different number of return values than the remote function actually returns.
               </p>
               <div class="example"><a name="d0e31779"></a><h3 class="title">Example&nbsp;12.17.&nbsp;Calling a Method and Expecting the Wrong Number of Return Values</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">wsdlFile = 'http://www.xmethods.net/sd/2001/TemperatureService.wsdl'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = WSDL.Proxy(wsdlFile)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">(city, temperature) = server.getTemp(27502)</span>  <a name="soap.troubleshooting.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="traceback">Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
TypeError: unpack non-sequence</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.troubleshooting.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Did you spot the mistake?  <tt class="function">server.getTemp</tt> only returns one value, a float, but you've written code that assumes you're getting two values and trying to assign them
                              to two different variables.  Note that this does not fail with a <span class="acronym">SOAP</span> fault.  As far as the remote server is concerned, nothing went wrong at all.  The error only occurred <span class="emphasis"><em>after</em></span> the <span class="acronym">SOAP</span> transaction was complete, <tt class="classname">WSDL.Proxy</tt> returned a float, and your local <span class="application">Python</span> interpreter tried to accomodate your request to split it into two different variables.  Since the function only returned
                              one value, you get a <span class="application">Python</span> exception trying to split it, not a <span class="acronym">SOAP</span> Fault.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>What about Google's web service?  The most common problem I've had with it is that I forget to set the application key properly.</p>
               <div class="example"><a name="d0e31834"></a><h3 class="title">Example&nbsp;12.18.&nbsp;Calling a Method With An Application-Specific Error</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">from SOAPpy import WSDL</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">server = WSDL.Proxy(r'/path/to/local/GoogleSearch.wsdl')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">results = server.doGoogleSearch('foo', 'mark', 0, 10, False, "",</span> <a name="soap.troubleshooting.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">False, "", "utf-8", "utf-8")</span>
<span class="traceback">&lt;Fault SOAP-ENV:Server:                                              <a name="soap.troubleshooting.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
 Exception from service object: Invalid authorization key: foo:
 &lt;SOAPpy.Types.structType detail at 14164616&gt;:
 {'stackTrace':
  'com.google.soap.search.GoogleSearchFault: Invalid authorization key: foo
   at com.google.soap.search.QueryLimits.lookUpAndLoadFromINSIfNeedBe(
     QueryLimits.java:220)
   at com.google.soap.search.QueryLimits.validateKey(QueryLimits.java:127)
   at com.google.soap.search.GoogleSearchService.doPublicMethodChecks(
     GoogleSearchService.java:825)
   at com.google.soap.search.GoogleSearchService.doGoogleSearch(
     GoogleSearchService.java:121)
   at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)
   at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
   at java.lang.reflect.Method.invoke(Unknown Source)
   at org.apache.soap.server.RPCRouter.invoke(RPCRouter.java:146)
   at org.apache.soap.providers.RPCJavaProvider.invoke(
     RPCJavaProvider.java:129)
   at org.apache.soap.server.http.RPCRouterServlet.doPost(
     RPCRouterServlet.java:288)
   at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)
   at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
   at com.google.gse.HttpConnection.runServlet(HttpConnection.java:237)
   at com.google.gse.HttpConnection.run(HttpConnection.java:195)
   at com.google.gse.DispatchQueue$WorkerThread.run(DispatchQueue.java:201)
Caused by: com.google.soap.search.UserKeyInvalidException: Key was of wrong size.
   at com.google.soap.search.UserKey.&lt;init&gt;(UserKey.java:59)
   at com.google.soap.search.QueryLimits.lookUpAndLoadFromINSIfNeedBe(
     QueryLimits.java:217)
   ... 14 more
'}&gt;
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in ?
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 453, in __call__
    return self.__r_call(*args, **kw)
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 475, in __r_call
    self.__hd, self.__ma)
  File "c:\python23\Lib\site-packages\SOAPpy\Client.py", line 389, in __call
    raise p
SOAPpy.Types.faultType: &lt;Fault SOAP-ENV:Server: Exception from service object:
Invalid authorization key: foo:
&lt;SOAPpy.Types.structType detail at 14164616&gt;:
{'stackTrace':
  'com.google.soap.search.GoogleSearchFault: Invalid authorization key: foo
   at com.google.soap.search.QueryLimits.lookUpAndLoadFromINSIfNeedBe(
     QueryLimits.java:220)
   at com.google.soap.search.QueryLimits.validateKey(QueryLimits.java:127)
   at com.google.soap.search.GoogleSearchService.doPublicMethodChecks(
     GoogleSearchService.java:825)
   at com.google.soap.search.GoogleSearchService.doGoogleSearch(
     GoogleSearchService.java:121)
   at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)
   at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
   at java.lang.reflect.Method.invoke(Unknown Source)
   at org.apache.soap.server.RPCRouter.invoke(RPCRouter.java:146)
   at org.apache.soap.providers.RPCJavaProvider.invoke(
     RPCJavaProvider.java:129)
   at org.apache.soap.server.http.RPCRouterServlet.doPost(
     RPCRouterServlet.java:288)
   at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)
   at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
   at com.google.gse.HttpConnection.runServlet(HttpConnection.java:237)
   at com.google.gse.HttpConnection.run(HttpConnection.java:195)
   at com.google.gse.DispatchQueue$WorkerThread.run(DispatchQueue.java:201)
Caused by: com.google.soap.search.UserKeyInvalidException: Key was of wrong size.
   at com.google.soap.search.UserKey.&lt;init&gt;(UserKey.java:59)
   at com.google.soap.search.QueryLimits.lookUpAndLoadFromINSIfNeedBe(
     QueryLimits.java:217)
   ... 14 more
'}&gt;</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.troubleshooting.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Can you spot the mistake?  There's nothing wrong with the calling syntax, or the number of arguments, or the datatypes.  The
                              problem is application-specific: the first argument is supposed to be my application key, but <tt class="literal">foo</tt> is not a valid Google key.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soap.troubleshooting.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The Google server responds with a <span class="acronym">SOAP</span> Fault and an incredibly long error message, which includes a complete Java stack trace.  Remember that <span class="emphasis"><em>all</em></span> <span class="acronym">SOAP</span> errors are signified by <span class="acronym">SOAP</span> Faults: errors in configuration, errors in function arguments, and application-specific errors like this.  Buried in there
                              somewhere is the crucial piece of information: <tt class="literal">Invalid authorization key: foo</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Troubleshooting <span class="acronym">SOAP</span></h3>
                  <ul>
                     <li><a href="http://www-106.ibm.com/developerworks/webservices/library/ws-pyth17.html">New developments for <span class="application">SOAPpy</span></a> steps through trying to connect to another <span class="acronym">SOAP</span> service that doesn't quite work as advertised.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soap.summary"></a>12.9.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p><span class="acronym">SOAP</span> web services are very complicated.  The specification is very ambitious and tries to cover many different use cases for web
                     services.  This chapter has touched on some of the simpler use cases.
                  </p>
               </div>
               <div class="highlights">
                  <p>Before diving into the next chapter, make sure you're comfortable doing all of these things:</p>
                  <div class="itemizedlist">
                     <ul>
                        <li>Connecting to a <span class="acronym">SOAP</span> server and calling remote methods
                        </li>
                        <li>Loading a <span class="acronym">WSDL</span> file and introspecting remote methods
                        </li>
                        <li>Debugging <span class="acronym">SOAP</span> calls with wire traces
                        </li>
                        <li>Troubleshooting common <span class="acronym">SOAP</span>-related errors
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="roman"></a>Chapter&nbsp;13.&nbsp;Unit Testing
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.intro"></a>13.1.&nbsp;Introduction to Roman numerals
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>In previous chapters, you &#8220;<span class="quote">dived in</span>&#8221; by immediately looking at code and trying to understand it as quickly as possible.  Now that you have some <span class="application">Python</span> under your belt, you're going to step back and look at the steps that happen <span class="emphasis"><em>before</em></span> the code gets written.
                  </p>
               </div>
               <p>In the next few chapters, you're going to write, debug, and optimize a set of utility functions to convert to and from Roman
                  numerals.  You saw the mechanics of constructing and validating Roman numerals in <a href="#re.roman" title="7.3.&nbsp;Case Study: Roman Numerals">Section&nbsp;7.3, &#8220;Case Study: Roman Numerals&#8221;</a>, but now let's step back and consider what it would take to expand that into a two-way utility.
               </p>
               <p><a href="#re.roman" title="7.3.&nbsp;Case Study: Roman Numerals">The rules for Roman numerals</a> lead to a number of interesting observations:
               </p>
               <div class="orderedlist">
                  <ol type="1">
                     <li>There is only one correct way to represent a particular number as Roman numerals.</li>
                     <li>The converse is also true: if a string of characters is a valid Roman numeral, it represents only one number (<span class="foreignphrase"><i class="foreignphrase"><span class="acronym">i.e.</span></i></span> it can only be read one way).
                     </li>
                     <li>There is a limited range of numbers that can be expressed as Roman numerals, specifically <tt class="literal">1</tt> through <tt class="literal">3999</tt>.  (The Romans did have several ways of expressing larger numbers, for instance by having a bar over a numeral to represent
                        that its normal value should be multiplied by <tt class="literal">1000</tt>, but you're not going to deal with that.  For the purposes of this chapter, let's stipulate that Roman numerals go from <tt class="literal">1</tt> to <tt class="literal">3999</tt>.)
                     </li>
                     <li>There is no way to represent <tt class="constant">0</tt> in Roman numerals.  (Amazingly, the ancient Romans had no concept of <tt class="constant">0</tt> as a number.  Numbers were for counting things you had; how can you count what you don't have?)
                     </li>
                     <li>There is no way to represent negative numbers in Roman numerals.</li>
                     <li>There is no way to represent fractions or non-integer numbers in Roman numerals.</li>
                  </ol>
               </div>
               <p>Given all of this, what would you expect out of a set of functions to convert to and from Roman numerals?</p>
               <div class="orderedlist"><a name="roman.requirements"></a><h3 class="title"><tt class="filename">roman.py</tt> requirements
                  </h3>
                  <ol type="1">
                     <li><tt class="function">toRoman</tt> should return the Roman numeral representation for all integers <tt class="constant">1</tt> to <tt class="literal">3999</tt>.
                     </li>
                     <li><tt class="function">toRoman</tt> should fail when given an integer outside the range <tt class="constant">1</tt> to <tt class="literal">3999</tt>.
                     </li>
                     <li><tt class="function">toRoman</tt> should fail when given a non-integer number.
                     </li>
                     <li><tt class="function">fromRoman</tt> should take a valid Roman numeral and return the number that it represents.
                     </li>
                     <li><tt class="function">fromRoman</tt> should fail when given an invalid Roman numeral.
                     </li>
                     <li>If you take a number, convert it to Roman numerals, then convert that back to a number, you should end up with the number
                        you started with.  So <tt class="literal">fromRoman(toRoman(n)) == n</tt> for all <tt class="varname">n</tt> in <tt class="literal">1..3999</tt>.
                     </li>
                     <li><tt class="function">toRoman</tt> should always return a Roman numeral using uppercase letters.
                     </li>
                     <li><tt class="function">fromRoman</tt> should only accept uppercase Roman numerals (<span class="foreignphrase"><i class="foreignphrase"><span class="acronym">i.e.</span></i></span> it should fail when given lowercase input).
                     </li>
                  </ol>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li><a href="http://www.wilkiecollins.demon.co.uk/roman/front.htm">This site</a> has more on Roman numerals, including a fascinating <a href="http://www.wilkiecollins.demon.co.uk/roman/intro.htm">history</a> of how Romans and other civilizations really used them (short answer: haphazardly and inconsistently).
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.divein"></a>13.2.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that you've completely defined the behavior you expect from your conversion functions, you're going to do something a
                     little unexpected: you're going to write a test suite that puts these functions through their paces and makes sure that they
                     behave the way you want them to.  You read that right: you're going to write code that tests code that you haven't written
                     yet.
                  </p>
               </div>
               <p>This is called unit testing, since the set of two conversion functions can be written and tested as a unit, separate from
                  any larger program they may become part of later.  <span class="application">Python</span> has a framework for unit testing, the appropriately-named <tt class="filename">unittest</tt> module.
               </p><a name="note.unittest"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="filename">unittest</tt> is included with <span class="application">Python</span> 2.1 and later.  <span class="application">Python</span> 2.0 users can download it from <a href="http://pyunit.sourceforge.net/"><tt class="systemitem">pyunit.sourceforge.net</tt></a>.
                     </td>
                  </tr>
               </table>
               <p>Unit testing is an important part of an overall testing-centric development strategy.  If you write unit tests, it is important
                  to write them early (preferably before writing the code that they test), and to keep them updated as code and requirements
                  change.  Unit testing is not a replacement for higher-level functional or system testing, but it is important in all phases
                  of development:
               </p>
               <div class="itemizedlist">
                  <ul>
                     <li>Before writing code, it forces you to detail your requirements in a useful fashion.</li>
                     <li>While writing code, it keeps you from over-coding.  When all the test cases pass, the function is complete.</li>
                     <li>When refactoring code, it assures you that the new version behaves the same way as the old version.</li>
                     <li>When maintaining code, it helps you cover your ass when someone comes screaming that your latest change broke their old code.
                         (&#8220;<span class="quote">But <span class="emphasis"><em>sir</em></span>, all the unit tests passed when I checked it in...</span>&#8221;)
                     </li>
                     <li>When writing code in a team, it increases confidence that the code you're about to commit isn't going to break other peoples'
                        code, because you can run their unittests first. (I've seen this sort of thing in code sprints.  A team breaks up the assignment,
                        everybody takes the specs for their task, writes unit tests for it, then shares their unit tests with the rest of the team.
                         That way, nobody goes off too far into developing code that won't play well with others.)
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.romantest"></a>13.3.&nbsp;Introducing <tt class="filename">romantest.py</tt></h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>This is the complete test suite for your Roman numeral conversion functions, which are yet to be written but will eventually
                     be in <tt class="filename">roman.py</tt>.  It is not immediately obvious how it all fits together; none of these classes or methods reference any of the others. 
                     There are good reasons for this, as you'll see shortly.
                  </p>
               </div>
               <div class="example"><a name="d0e32173"></a><h3 class="title">Example&nbsp;13.1.&nbsp;<tt class="filename">romantest.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Unit test for roman.py"""

import roman
import unittest

class KnownValues(unittest.TestCase):                          
    knownValues = ( (1, 'I'),
                    (2, 'II'),
                    (3, 'III'),
                    (4, 'IV'),
                    (5, 'V'),
                    (6, 'VI'),
                    (7, 'VII'),
                    (8, 'VIII'),
                    (9, 'IX'),
                    (10, 'X'),
                    (50, 'L'),
                    (100, 'C'),
                    (500, 'D'),
                    (1000, 'M'),
                    (31, 'XXXI'),
                    (148, 'CXLVIII'),
                    (294, 'CCXCIV'),
                    (312, 'CCCXII'),
                    (421, 'CDXXI'),
                    (528, 'DXXVIII'),
                    (621, 'DCXXI'),
                    (782, 'DCCLXXXII'),
                    (870, 'DCCCLXX'),
                    (941, 'CMXLI'),
                    (1043, 'MXLIII'),
                    (1110, 'MCX'),
                    (1226, 'MCCXXVI'),
                    (1301, 'MCCCI'),
                    (1485, 'MCDLXXXV'),
                    (1509, 'MDIX'),
                    (1607, 'MDCVII'),
                    (1754, 'MDCCLIV'),
                    (1832, 'MDCCCXXXII'),
                    (1993, 'MCMXCIII'),
                    (2074, 'MMLXXIV'),
                    (2152, 'MMCLII'),
                    (2212, 'MMCCXII'),
                    (2343, 'MMCCCXLIII'),
                    (2499, 'MMCDXCIX'),
                    (2574, 'MMDLXXIV'),
                    (2646, 'MMDCXLVI'),
                    (2723, 'MMDCCXXIII'),
                    (2892, 'MMDCCCXCII'),
                    (2975, 'MMCMLXXV'),
                    (3051, 'MMMLI'),
                    (3185, 'MMMCLXXXV'),
                    (3250, 'MMMCCL'),
                    (3313, 'MMMCCCXIII'),
                    (3408, 'MMMCDVIII'),
                    (3501, 'MMMDI'),
                    (3610, 'MMMDCX'),
                    (3743, 'MMMDCCXLIII'),
                    (3844, 'MMMDCCCXLIV'),
                    (3888, 'MMMDCCCLXXXVIII'),
                    (3940, 'MMMCMXL'),
                    (3999, 'MMMCMXCIX'))                       

    def testToRomanKnownValues(self):                          
        """toRoman should give known result with known input"""
        for integer, numeral in self.knownValues:              
            result = roman.toRoman(integer)                    
            self.assertEqual(numeral, result)                  

    def testFromRomanKnownValues(self):                          
        """fromRoman should give known result with known input"""
        for integer, numeral in self.knownValues:                
            result = roman.fromRoman(numeral)                    
            self.assertEqual(integer, result)                    

class ToRomanBadInput(unittest.TestCase):                            
    def testTooLarge(self):                                          
        """toRoman should fail with large input"""                   
        self.assertRaises(roman.OutOfRangeError, roman.toRoman, 4000)

    def testZero(self):                                              
        """toRoman should fail with 0 input"""                       
        self.assertRaises(roman.OutOfRangeError, roman.toRoman, 0)   

    def testNegative(self):                                          
        """toRoman should fail with negative input"""                
        self.assertRaises(roman.OutOfRangeError, roman.toRoman, -1)  

    def testNonInteger(self):                                        
        """toRoman should fail with non-integer input"""             
        self.assertRaises(roman.NotIntegerError, roman.toRoman, 0.5) 

class FromRomanBadInput(unittest.TestCase):                                      
    def testTooManyRepeatedNumerals(self):                                       
        """fromRoman should fail with too many repeated numerals"""              
        for s in ('MMMM', 'DD', 'CCCC', 'LL', 'XXXX', 'VV', 'IIII'):             
            self.assertRaises(roman.InvalidRomanNumeralError, roman.fromRoman, s)

    def testRepeatedPairs(self):                                                 
        """fromRoman should fail with repeated pairs of numerals"""              
        for s in ('CMCM', 'CDCD', 'XCXC', 'XLXL', 'IXIX', 'IVIV'):               
            self.assertRaises(roman.InvalidRomanNumeralError, roman.fromRoman, s)

    def testMalformedAntecedent(self):                                           
        """fromRoman should fail with malformed antecedents"""                   
        for s in ('IIMXCC', 'VX', 'DCM', 'CMM', 'IXIV',
                  'MCMC', 'XCX', 'IVI', 'LM', 'LD', 'LC'):                       
            self.assertRaises(roman.InvalidRomanNumeralError, roman.fromRoman, s)

class SanityCheck(unittest.TestCase):        
    def testSanity(self):                    
        """fromRoman(toRoman(n))==n for all n"""
        for integer in range(1, 4000):       
            numeral = roman.toRoman(integer) 
            result = roman.fromRoman(numeral)
            self.assertEqual(integer, result)

class CaseCheck(unittest.TestCase):                   
    def testToRomanCase(self):                        
        """toRoman should always return uppercase"""  
        for integer in range(1, 4000):                
            numeral = roman.toRoman(integer)          
            self.assertEqual(numeral, numeral.upper())

    def testFromRomanCase(self):                      
        """fromRoman should only accept uppercase input"""
        for integer in range(1, 4000):                
            numeral = roman.toRoman(integer)          
            roman.fromRoman(numeral.upper())          
            self.assertRaises(roman.InvalidRomanNumeralError,
                              roman.fromRoman, numeral.lower())

if __name__ == "__main__":
    unittest.main()   </pre></div>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li><a href="http://pyunit.sourceforge.net/">The <span class="application">PyUnit</span> home page</a> has an in-depth discussion of <a href="http://pyunit.sourceforge.net/pyunit.html">using the <tt class="filename">unittest</tt> framework</a>, including advanced features not covered in this chapter.
                     </li>
                     <li><a href="http://pyunit.sourceforge.net/pyunit.html">The <span class="application">PyUnit</span> <span class="acronym">FAQ</span></a> explains <a href="http://pyunit.sourceforge.net/pyunit.html#WHERE">why test cases are stored separately</a> from the code they test.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes the <a href="http://www.python.org/doc/current/lib/module-unittest.html"><tt class="filename">unittest</tt></a> module.
                     </li>
                     <li><a href="http://www.extremeprogramming.org/">ExtremeProgramming.org</a> discusses <a href="http://www.extremeprogramming.org/rules/unittests.html">why you should write unit tests</a>.
                     </li>
                     <li><a href="http://www.c2.com/cgi/wiki">The Portland Pattern Repository</a> has an ongoing discussion of <a href="http://www.c2.com/cgi/wiki?UnitTests">unit tests</a>, including a <a href="http://www.c2.com/cgi/wiki?StandardDefinitionOfUnitTest">standard definition</a>, why you should <a href="http://www.c2.com/cgi/wiki?CodeUnitTestFirst">code unit tests first</a>, and several in-depth <a href="http://www.c2.com/cgi/wiki?UnitTestTrial">case studies</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.success"></a>13.4.&nbsp;Testing for success
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The most fundamental part of unit testing is constructing individual test cases.  A test case answers a single question about
                     the code it is testing.
                  </p>
               </div>
               <p>A test case should be able to...</p>
               <div class="itemizedlist">
                  <ul>
                     <li>...run completely by itself, without any human input.  Unit testing is about automation.</li>
                     <li>...determine by itself whether the function it is testing has passed or failed, without a human interpreting the results.</li>
                     <li>...run in isolation, separate from any other test cases (even if they test the same functions).  Each test case is an island.</li>
                  </ul>
               </div>
               <p>Given that, let's build the first test case.  You have the following <a href="#roman.requirements">requirement</a>:
               </p>
               <div class="orderedlist">
                  <ol type="1">
                     <li><tt class="function">toRoman</tt> should return the Roman numeral representation for all integers <tt class="constant">1</tt> to <tt class="literal">3999</tt>.
                     </li>
                  </ol>
               </div>
               <div class="example"><a name="roman.testtoromanknownvalues.example"></a><h3 class="title">Example&nbsp;13.2.&nbsp;<tt class="function">testToRomanKnownValues</tt></h3><pre class="programlisting">
class KnownValues(unittest.TestCase):                           <a name="roman.success.1.0"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    knownValues = ( (1, 'I'),
                    (2, 'II'),
                    (3, 'III'),
                    (4, 'IV'),
                    (5, 'V'),
                    (6, 'VI'),
                    (7, 'VII'),
                    (8, 'VIII'),
                    (9, 'IX'),
                    (10, 'X'),
                    (50, 'L'),
                    (100, 'C'),
                    (500, 'D'),
                    (1000, 'M'),
                    (31, 'XXXI'),
                    (148, 'CXLVIII'),
                    (294, 'CCXCIV'),
                    (312, 'CCCXII'),
                    (421, 'CDXXI'),
                    (528, 'DXXVIII'),
                    (621, 'DCXXI'),
                    (782, 'DCCLXXXII'),
                    (870, 'DCCCLXX'),
                    (941, 'CMXLI'),
                    (1043, 'MXLIII'),
                    (1110, 'MCX'),
                    (1226, 'MCCXXVI'),
                    (1301, 'MCCCI'),
                    (1485, 'MCDLXXXV'),
                    (1509, 'MDIX'),
                    (1607, 'MDCVII'),
                    (1754, 'MDCCLIV'),
                    (1832, 'MDCCCXXXII'),
                    (1993, 'MCMXCIII'),
                    (2074, 'MMLXXIV'),
                    (2152, 'MMCLII'),
                    (2212, 'MMCCXII'),
                    (2343, 'MMCCCXLIII'),
                    (2499, 'MMCDXCIX'),
                    (2574, 'MMDLXXIV'),
                    (2646, 'MMDCXLVI'),
                    (2723, 'MMDCCXXIII'),
                    (2892, 'MMDCCCXCII'),
                    (2975, 'MMCMLXXV'),
                    (3051, 'MMMLI'),
                    (3185, 'MMMCLXXXV'),
                    (3250, 'MMMCCL'),
                    (3313, 'MMMCCCXIII'),
                    (3408, 'MMMCDVIII'),
                    (3501, 'MMMDI'),
                    (3610, 'MMMDCX'),
                    (3743, 'MMMDCCXLIII'),
                    (3844, 'MMMDCCCXLIV'),
                    (3888, 'MMMDCCCLXXXVIII'),
                    (3940, 'MMMCMXL'),
                    (3999, 'MMMCMXCIX'))                        <a name="roman.success.1.1"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">

    def testToRomanKnownValues(self):                           <a name="roman.success.1.2"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        """toRoman should give known result with known input"""
        for integer, numeral in self.knownValues:              
            result = roman.toRoman(integer)                     <a name="roman.success.1.3"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"> <a name="roman.success.1.4"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
            self.assertEqual(numeral, result)                   <a name="roman.success.1.5"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.success.1.0"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To write a test case, first subclass the <tt class="classname">TestCase</tt> class of the <tt class="filename">unittest</tt> module.  This class provides many useful methods which you can use in your test case to test specific conditions.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.success.1.1"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a list of integer/numeral pairs that I verified manually.  It includes the lowest ten numbers, the highest number,
                              every number that translates to a single-character Roman numeral, and a random sampling of other valid numbers.  The point
                              of a unit test is not to test every possible input, but to test a representative sample.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.success.1.2"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Every individual test is its own method, which must take no parameters and return no value.  If the method exits normally
                              without raising an exception, the test is considered passed; if the method raises an exception, the test is considered failed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.success.1.3"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here you call the actual <tt class="function">toRoman</tt> function.  (Well, the function hasn't be written yet, but once it is, this is the line that will call it.)  Notice that you
                              have now defined the <span class="acronym">API</span> for the <tt class="function">toRoman</tt> function: it must take an integer (the number to convert) and return a string (the Roman numeral representation).  If the
                              <span class="acronym">API</span> is different than that, this test is considered failed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.success.1.4"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Also notice that you are not trapping any exceptions when you call <tt class="function">toRoman</tt>.  This is intentional.  <tt class="function">toRoman</tt> shouldn't raise an exception when you call it with valid input, and these input values are all valid.  If <tt class="function">toRoman</tt> raises an exception, this test is considered failed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.success.1.5"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Assuming the <tt class="function">toRoman</tt> function was defined correctly, called correctly, completed successfully, and returned a value, the last step is to check
                              whether it returned the <span class="emphasis"><em>right</em></span> value.  This is a common question, and the <tt class="classname">TestCase</tt> class provides a method, <tt class="function">assertEqual</tt>, to check whether two values are equal.  If the result returned from <tt class="function">toRoman</tt> (<tt class="varname">result</tt>) does not match the known value you were expecting (<tt class="varname">numeral</tt>), <tt class="function">assertEqual</tt> will raise an exception and the test will fail.  If the two values are equal, <tt class="function">assertEqual</tt> will do nothing.  If every value returned from <tt class="function">toRoman</tt> matches the known value you expect, <tt class="function">assertEqual</tt> never raises an exception, so <tt class="function">testToRomanKnownValues</tt> eventually exits normally, which means <tt class="function">toRoman</tt> has passed this test.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.failure"></a>13.5.&nbsp;Testing for failure
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>It is not enough to test that functions succeed when given good input; you must also test that they fail when given bad input.
                     And not just any sort of failure; they must fail in the way you expect.
                  </p>
               </div>
               <p>Remember the <a href="#roman.requirements">other requirements</a> for <tt class="function">toRoman</tt>:
               </p>
               <div class="orderedlist">
                  <ol start="2" type="1">
                     <li><tt class="function">toRoman</tt> should fail when given an integer outside the range <tt class="constant">1</tt> to <tt class="literal">3999</tt>.
                     </li>
                     <li><tt class="function">toRoman</tt> should fail when given a non-integer number.
                     </li>
                  </ol>
               </div>
               <p>In <span class="application">Python</span>, functions indicate failure by raising <a href="#fileinfo.exception" title="6.1.&nbsp;Handling Exceptions">exceptions</a>, and the <tt class="filename">unittest</tt> module provides methods for testing whether a function raises a particular exception when given bad input.
               </p>
               <div class="example"><a name="roman.tobadinput.example"></a><h3 class="title">Example&nbsp;13.3.&nbsp;Testing bad input to <tt class="function">toRoman</tt></h3><pre class="programlisting">
class ToRomanBadInput(unittest.TestCase):                            
    def testTooLarge(self):                                          
        """toRoman should fail with large input"""                   
        self.assertRaises(roman.OutOfRangeError, roman.toRoman, 4000) <a name="roman.failure.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

    def testZero(self):                                              
        """toRoman should fail with 0 input"""                       
        self.assertRaises(roman.OutOfRangeError, roman.toRoman, 0)    <a name="roman.failure.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">

    def testNegative(self):                                          
        """toRoman should fail with negative input"""                
        self.assertRaises(roman.OutOfRangeError, roman.toRoman, -1)  

    def testNonInteger(self):                                        
        """toRoman should fail with non-integer input"""             
        self.assertRaises(roman.NotIntegerError, roman.toRoman, 0.5)  <a name="roman.failure.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.failure.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="classname">TestCase</tt> class of the <tt class="filename">unittest</tt> provides the <tt class="function">assertRaises</tt> method, which takes the following arguments: the exception you're expecting, the function you're testing, and the arguments
                              you're passing that function.  (If the function you're testing takes more than one argument, pass them all to <tt class="function">assertRaises</tt>, in order, and it will pass them right along to the function you're testing.)  Pay close attention to what you're doing here:
                              instead of calling <tt class="function">toRoman</tt> directly and manually checking that it raises a particular exception (by wrapping it in a <a href="#fileinfo.exception" title="6.1.&nbsp;Handling Exceptions"><tt class="literal">try...except</tt> block</a>), <tt class="function">assertRaises</tt> has encapsulated all of that for us.  All you do is give it the exception (<tt class="errorcode">roman.OutOfRangeError</tt>), the function (<tt class="function">toRoman</tt>), and <tt class="function">toRoman</tt>'s arguments (<tt class="literal">4000</tt>), and <tt class="function">assertRaises</tt> takes care of calling <tt class="function">toRoman</tt> and checking to make sure that it raises <tt class="errorcode">roman.OutOfRangeError</tt>.  (Also note that you're passing the <tt class="function">toRoman</tt> function itself as an argument; you're not calling it, and you're not passing the name of it as a string.  Have I mentioned
                              recently how handy it is that <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">everything in <span class="application">Python</span> is an object</a>, including functions and exceptions?)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.failure.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Along with testing numbers that are too large, you need to test numbers that are too small.  Remember, Roman numerals cannot
                              express <tt class="constant">0</tt> or negative numbers, so you have a test case for each of those (<tt class="function">testZero</tt> and <tt class="function">testNegative</tt>).  In <tt class="function">testZero</tt>, you are testing that <tt class="function">toRoman</tt> raises a <tt class="errorcode">roman.OutOfRangeError</tt> exception when called with <tt class="constant">0</tt>; if it does <span class="emphasis"><em>not</em></span> raise a <tt class="errorcode">roman.OutOfRangeError</tt> (either because it returns an actual value, or because it raises some other exception), this test is considered failed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.failure.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><a href="#roman.requirements">Requirement #3</a> specifies that <tt class="function">toRoman</tt> cannot accept a non-integer number, so here you test to make sure that <tt class="function">toRoman</tt> raises a <tt class="errorcode">roman.NotIntegerError</tt> exception when called with <tt class="literal">0.5</tt>.  If <tt class="function">toRoman</tt> does not raise a <tt class="errorcode">roman.NotIntegerError</tt>, this test is considered failed.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The next two <a href="#roman.requirements">requirements</a> are similar to the first three, except they apply to <tt class="function">fromRoman</tt> instead of <tt class="function">toRoman</tt>:
               </p>
               <div class="orderedlist">
                  <ol start="4" type="1">
                     <li><tt class="function">fromRoman</tt> should take a valid Roman numeral and return the number that it represents.
                     </li>
                     <li><tt class="function">fromRoman</tt> should fail when given an invalid Roman numeral.
                     </li>
                  </ol>
               </div>
               <p>Requirement #4 is handled in the same way as <a href="#roman.testtoromanknownvalues.example" title="Example&nbsp;13.2.&nbsp;testToRomanKnownValues">requirement #1</a>, iterating through a sampling of known values and testing each in turn.  Requirement #5 is handled in the same way as requirements
                  #2 and #3, by testing a series of bad inputs and making sure <tt class="function">fromRoman</tt> raises the appropriate exception.
               </p>
               <div class="example"><a name="roman.frombadinput.example"></a><h3 class="title">Example&nbsp;13.4.&nbsp;Testing bad input to <tt class="function">fromRoman</tt></h3><pre class="programlisting">
class FromRomanBadInput(unittest.TestCase):                                      
    def testTooManyRepeatedNumerals(self):                                       
        """fromRoman should fail with too many repeated numerals"""              
        for s in ('MMMM', 'DD', 'CCCC', 'LL', 'XXXX', 'VV', 'IIII'):             
            self.assertRaises(roman.InvalidRomanNumeralError, roman.fromRoman, s) <a name="roman.failure.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

    def testRepeatedPairs(self):                                                 
        """fromRoman should fail with repeated pairs of numerals"""              
        for s in ('CMCM', 'CDCD', 'XCXC', 'XLXL', 'IXIX', 'IVIV'):               
            self.assertRaises(roman.InvalidRomanNumeralError, roman.fromRoman, s)

    def testMalformedAntecedent(self):                                           
        """fromRoman should fail with malformed antecedents"""                   
        for s in ('IIMXCC', 'VX', 'DCM', 'CMM', 'IXIV',
                  'MCMC', 'XCX', 'IVI', 'LM', 'LD', 'LC'):                       
            self.assertRaises(roman.InvalidRomanNumeralError, roman.fromRoman, s)</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.failure.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Not much new to say about these; the pattern is exactly the same as the one you used to test bad input to <tt class="function">toRoman</tt>.  I will briefly note that you have another exception: <tt class="errorcode">roman.InvalidRomanNumeralError</tt>.  That makes a total of three custom exceptions that will need to be defined in <tt class="filename">roman.py</tt> (along with <tt class="errorcode">roman.OutOfRangeError</tt> and <tt class="errorcode">roman.NotIntegerError</tt>).  You'll see how to define these custom exceptions when you actually start writing <tt class="filename">roman.py</tt>, later in this chapter.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.sanity"></a>13.6.&nbsp;Testing for sanity
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Often, you will find that a unit of code contains a set of reciprocal functions, usually in the form of conversion functions
                     where one converts A to B and the other converts B to A.  In these cases, it is useful to create a &#8220;<span class="quote">sanity check</span>&#8221; to make sure that you can convert A to B and back to A without losing precision, incurring rounding errors, or triggering
                     any other sort of bug.
                  </p>
               </div>
               <p>Consider this <a href="#roman.requirements">requirement</a>:
               </p>
               <div class="orderedlist">
                  <ol start="6" type="1">
                     <li>If you take a number, convert it to Roman numerals, then convert that back to a number, you should end up with the number
                        you started with.  So <tt class="literal">fromRoman(toRoman(n)) == n</tt> for all <tt class="varname">n</tt> in <tt class="literal">1..3999</tt>.
                     </li>
                  </ol>
               </div>
               <div class="example"><a name="roman.sanity.example"></a><h3 class="title">Example&nbsp;13.5.&nbsp;Testing <tt class="function">toRoman</tt> against <tt class="function">fromRoman</tt></h3><pre class="programlisting">
class SanityCheck(unittest.TestCase):        
    def testSanity(self):                    
        """fromRoman(toRoman(n))==n for all n"""
        for integer in range(1, 4000):        <a name="roman.sanity.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"> <a name="roman.sanity.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
            numeral = roman.toRoman(integer) 
            result = roman.fromRoman(numeral)
            self.assertEqual(integer, result) <a name="roman.sanity.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.sanity.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You've seen <a href="#odbchelper.multiassign.range" title="Example&nbsp;3.20.&nbsp;Assigning Consecutive Values">the <tt class="function">range</tt> function</a> before, but here it is called with two arguments, which returns a list of integers starting at the first argument (<tt class="constant">1</tt>) and counting consecutively up to <span class="emphasis"><em>but not including</em></span> the second argument (<tt class="literal">4000</tt>).  Thus, <tt class="literal">1..3999</tt>, which is the valid range for converting to Roman numerals.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.sanity.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">I just wanted to mention in passing that <tt class="varname">integer</tt> is not a keyword in <span class="application">Python</span>; here it's just a variable name like any other.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.sanity.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The actual testing logic here is straightforward: take a number (<tt class="varname">integer</tt>), convert it to a Roman numeral (<tt class="varname">numeral</tt>), then convert it back to a number (<tt class="varname">result</tt>) and make sure you end up with the same number you started with.  If not, <tt class="function">assertEqual</tt> will raise an exception and the test will immediately be considered failed.  If all the numbers match, <tt class="function">assertEqual</tt> will always return silently, the entire <tt class="function">testSanity</tt> method will eventually return silently, and the test will be considered passed.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>The <a href="#roman.requirements">last two requirements</a> are different from the others because they seem both arbitrary and trivial:
               </p>
               <div class="orderedlist">
                  <ol start="7" type="1">
                     <li><tt class="function">toRoman</tt> should always return a Roman numeral using uppercase letters.
                     </li>
                     <li><tt class="function">fromRoman</tt> should only accept uppercase Roman numerals (<span class="foreignphrase"><i class="foreignphrase"><span class="acronym">i.e.</span></i></span> it should fail when given lowercase input).
                     </li>
                  </ol>
               </div>
               <p>In fact, they are somewhat arbitrary.  You could, for instance, have stipulated that <tt class="function">fromRoman</tt> accept lowercase and mixed case input.  But they are not completely arbitrary; if <tt class="function">toRoman</tt> is always returning uppercase output, then <tt class="function">fromRoman</tt> must at least accept uppercase input, or the &#8220;<span class="quote">sanity check</span>&#8221; (requirement #6) would fail.  The fact that it <span class="emphasis"><em>only</em></span> accepts uppercase input is arbitrary, but as any systems integrator will tell you, case always matters, so it's worth specifying
                  the behavior up front.  And if it's worth specifying, it's worth testing.
               </p>
               <div class="example"><a name="d0e32750"></a><h3 class="title">Example&nbsp;13.6.&nbsp;Testing for case</h3><pre class="programlisting">
class CaseCheck(unittest.TestCase):                   
    def testToRomanCase(self):                        
        """toRoman should always return uppercase"""  
        for integer in range(1, 4000):                
            numeral = roman.toRoman(integer)          
            self.assertEqual(numeral, numeral.upper())         <a name="roman.sanity.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

    def testFromRomanCase(self):                      
        """fromRoman should only accept uppercase input"""
        for integer in range(1, 4000):                
            numeral = roman.toRoman(integer)          
            roman.fromRoman(numeral.upper())                   <a name="roman.sanity.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"> <a name="roman.sanity.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
            self.assertRaises(roman.InvalidRomanNumeralError,
                              roman.fromRoman, numeral.lower())   <a name="roman.sanity.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.sanity.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The most interesting thing about this test case is all the things it doesn't test.  It doesn't test that the value returned
                              from <tt class="function">toRoman</tt> is <a href="#roman.testtoromanknownvalues.example" title="Example&nbsp;13.2.&nbsp;testToRomanKnownValues">right</a> or even <a href="#roman.sanity.example" title="Example&nbsp;13.5.&nbsp;Testing toRoman against fromRoman">consistent</a>; those questions are answered by separate test cases.  You have a whole test case just to test for uppercase-ness.  You might
                              be tempted to combine this with the <a href="#roman.sanity.example" title="Example&nbsp;13.5.&nbsp;Testing toRoman against fromRoman">sanity check</a>, since both run through the entire range of values and call <tt class="function">toRoman</tt>.<sup>[<a name="d0e32781" href="#ftn.d0e32781">6</a>]</sup>  But that would violate one of the <a href="#roman.success" title="13.4.&nbsp;Testing for success">fundamental rules</a>: each test case should answer only a single question.  Imagine that you combined this case check with the sanity check, and
                              then that test case failed.  You would need to do further analysis to figure out which part of the test case failed to determine
                              what the problem was.  If you need to analyze the results of your unit testing just to figure out what they mean, it's a sure
                              sign that you've mis-designed your test cases.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.sanity.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">There's a similar lesson to be learned here: even though &#8220;<span class="quote">you know</span>&#8221; that <tt class="function">toRoman</tt> always returns uppercase, you are explicitly converting its return value to uppercase here to test that <tt class="function">fromRoman</tt> accepts uppercase input.  Why?  Because the fact that <tt class="function">toRoman</tt> always returns uppercase is an independent requirement.  If you changed that requirement so that, for instance, it always
                              returned lowercase, the <tt class="function">testToRomanCase</tt> test case would need to change, but this test case would still work.  This was another of the <a href="#roman.success" title="13.4.&nbsp;Testing for success">fundamental rules</a>: each test case must be able to work in isolation from any of the others.  Every test case is an island.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.sanity.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that you're not assigning the return value of <tt class="function">fromRoman</tt> to anything.  This is legal syntax in <span class="application">Python</span>; if a function returns a value but nobody's listening, <span class="application">Python</span> just throws away the return value.  In this case, that's what you want.  This test case doesn't test anything about the return
                              value; it just tests that <tt class="function">fromRoman</tt> accepts the uppercase input without raising an exception.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.sanity.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a complicated line, but it's very similar to what you did in the <tt class="classname">ToRomanBadInput</tt> and <tt class="classname">FromRomanBadInput</tt> tests.  You are testing to make sure that calling a particular function (<tt class="function">roman.fromRoman</tt>) with a particular value (<tt class="literal">numeral.lower()</tt>, the lowercase version of the current Roman numeral in the loop) raises a particular exception (<tt class="literal">roman.InvalidRomanNumeralError</tt>).  If it does (each time through the loop), the test passes; if even one time it does something else (like raises a different
                              exception, or returning a value without raising an exception at all), the test fails.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>In the next chapter, you'll see how to write code that passes these tests.</p>
            </div>
            <div class="footnotes"><br><hr width="100" align="left">
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e32781" href="#d0e32781">6</a>] </sup>&#8220;<span class="quote">I can resist everything except temptation.</span>&#8221; --Oscar Wilde
                  </p>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="roman1.5"></a>Chapter&nbsp;14.&nbsp;Test-First Programming
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.stage1"></a>14.1.&nbsp;<tt class="filename">roman.py</tt>, stage 1
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that the unit tests are complete, it's time to start writing the code that the test cases are attempting to test.  You're
                     going to do this in stages, so you can see all the unit tests fail, then watch them pass one by one as you fill in the gaps
                     in <tt class="filename">roman.py</tt>.
                  </p>
               </div>
               <div class="example"><a name="d0e32864"></a><h3 class="title">Example&nbsp;14.1.&nbsp;<tt class="filename">roman1.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage1/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Convert to and from Roman numerals"""

#Define exceptions
class RomanError(Exception): pass                <a name="roman.stage1.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
class OutOfRangeError(RomanError): pass          <a name="roman.stage1.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
class NotIntegerError(RomanError): pass
class InvalidRomanNumeralError(RomanError): pass <a name="roman.stage1.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">

def toRoman(n):
    """convert integer to Roman numeral"""
    pass                                         <a name="roman.stage1.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">

def fromRoman(s):
    """convert Roman numeral to integer"""
    pass
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is how you define your own custom exceptions in <span class="application">Python</span>.  Exceptions are classes, and you create your own by subclassing existing exceptions.  It is strongly recommended (but not
                              required) that you subclass <tt class="errorcode">Exception</tt>, which is the base class that all built-in exceptions inherit from.  Here I am defining <tt class="errorcode">RomanError</tt> (inherited from <tt class="errorcode">Exception</tt>) to act as the base class for all my other custom exceptions to follow.  This is a matter of style; I could just as easily
                              have inherited each individual exception from the <tt class="errorcode">Exception</tt> class directly.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="errorcode">OutOfRangeError</tt> and <tt class="errorcode">NotIntegerError</tt> exceptions will eventually be used by <tt class="function">toRoman</tt> to flag various forms of invalid input, as specified in <a href="#roman.tobadinput.example" title="Example&nbsp;13.3.&nbsp;Testing bad input to toRoman"><tt class="classname">ToRomanBadInput</tt></a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="errorcode">InvalidRomanNumeralError</tt> exception will eventually be used by <tt class="function">fromRoman</tt> to flag invalid input, as specified in <a href="#roman.frombadinput.example" title="Example&nbsp;13.4.&nbsp;Testing bad input to fromRoman"><tt class="classname">FromRomanBadInput</tt></a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">At this stage, you want to define the <span class="acronym">API</span> of each of your functions, but you don't want to code them yet, so you stub them out using the <span class="application">Python</span> reserved word <a href="#fileinfo.class.simplest" title="Example&nbsp;5.3.&nbsp;The Simplest Python Class"><tt class="literal">pass</tt></a>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now for the big moment (drum roll please): you're finally going to run the unit test against this stubby little module.  At
                  this point, every test case should fail.  In fact, if any test case passes in stage 1, you should go back to <tt class="filename">romantest.py</tt> and re-evaluate why you coded a test so useless that it passes with do-nothing functions.
               </p>
               <p>Run <tt class="filename">romantest1.py</tt> with the <tt class="option">-v</tt> command-line option, which will give more verbose output so you can see exactly what's going on as each test case runs. 
                  With any luck, your output should look like this:
               </p>
               <div class="example"><a name="roman.stage1.output"></a><h3 class="title">Example&nbsp;14.2.&nbsp;Output of <tt class="filename">romantest1.py</tt> against <tt class="filename">roman1.py</tt></h3><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... ERROR
toRoman should always return uppercase ... ERROR
fromRoman should fail with malformed antecedents ... FAIL
fromRoman should fail with repeated pairs of numerals ... FAIL
fromRoman should fail with too many repeated numerals ... FAIL
fromRoman should give known result with known input ... FAIL
toRoman should give known result with known input ... FAIL
fromRoman(toRoman(n))==n for all n ... FAIL
toRoman should fail with non-integer input ... FAIL
toRoman should fail with negative input ... FAIL
toRoman should fail with large input ... FAIL
toRoman should fail with 0 input ... FAIL

======================================================================
ERROR: fromRoman should only accept uppercase input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 154, in testFromRomanCase
    roman1.fromRoman(numeral.upper())
AttributeError: 'None' object has no attribute 'upper'</span><span class="computeroutput">
======================================================================
ERROR: toRoman should always return uppercase
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 148, in testToRomanCase
    self.assertEqual(numeral, numeral.upper())
AttributeError: 'None' object has no attribute 'upper'</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with malformed antecedents
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 133, in testMalformedAntecedent
    self.assertRaises(roman1.InvalidRomanNumeralError, roman1.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with repeated pairs of numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 127, in testRepeatedPairs
    self.assertRaises(roman1.InvalidRomanNumeralError, roman1.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with too many repeated numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 122, in testTooManyRepeatedNumerals
    self.assertRaises(roman1.InvalidRomanNumeralError, roman1.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should give known result with known input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 99, in testFromRomanKnownValues
    self.assertEqual(integer, result)
  File "c:\python21\lib\unittest.py", line 273, in failUnlessEqual
    raise self.failureException, (msg or '%s != %s' % (first, second))
AssertionError: 1 != None</span><span class="computeroutput">
======================================================================
FAIL: toRoman should give known result with known input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 93, in testToRomanKnownValues
    self.assertEqual(numeral, result)
  File "c:\python21\lib\unittest.py", line 273, in failUnlessEqual
    raise self.failureException, (msg or '%s != %s' % (first, second))
AssertionError: I != None</span><span class="computeroutput">
======================================================================
FAIL: fromRoman(toRoman(n))==n for all n
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 141, in testSanity
    self.assertEqual(integer, result)
  File "c:\python21\lib\unittest.py", line 273, in failUnlessEqual
    raise self.failureException, (msg or '%s != %s' % (first, second))
AssertionError: 1 != None</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with non-integer input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 116, in testNonInteger
    self.assertRaises(roman1.NotIntegerError, roman1.toRoman, 0.5)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: NotIntegerError</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with negative input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 112, in testNegative
    self.assertRaises(roman1.OutOfRangeError, roman1.toRoman, -1)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: OutOfRangeError</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with large input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 104, in testTooLarge
    self.assertRaises(roman1.OutOfRangeError, roman1.toRoman, 4000)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: OutOfRangeError</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with 0 input                                 </span><a name="roman.stage1.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage1\romantest1.py", line 108, in testZero
    self.assertRaises(roman1.OutOfRangeError, roman1.toRoman, 0)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: OutOfRangeError                                        </span><a name="roman.stage1.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
----------------------------------------------------------------------
Ran 12 tests in 0.040s                                                 </span><a name="roman.stage1.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"><span class="computeroutput">

FAILED (failures=10, errors=2)                                         </span><a name="roman.stage1.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Running the script runs <tt class="function">unittest.main()</tt>, which runs each test case, which is to say each method defined in each class within <tt class="filename">romantest.py</tt>.  For each test case, it prints out the <tt class="literal">doc string</tt> of the method and whether that test passed or failed.  As expected, none of the test cases passed.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">For each failed test case, <tt class="filename">unittest</tt> displays the trace information showing exactly what happened.  In this case, the call to <tt class="function">assertRaises</tt> (also called <tt class="function">failUnlessRaises</tt>) raised an <tt class="errorcode">AssertionError</tt> because it was expecting <tt class="function">toRoman</tt> to raise an <tt class="errorcode">OutOfRangeError</tt> and it didn't.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">After the detail, <tt class="filename">unittest</tt> displays a summary of how many tests were performed and how long it took.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage1.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Overall, the unit test failed because at least one test case did not pass.  When a test case doesn't pass, <tt class="filename">unittest</tt> distinguishes between failures and errors.  A failure is a call to an <tt class="function">assertXYZ</tt> method, like <tt class="function">assertEqual</tt> or <tt class="function">assertRaises</tt>, that fails because the asserted condition is not true or the expected exception was not raised.  An error is any other sort
                              of exception raised in the code you're testing or the unit test case itself.  For instance, the <tt class="function">testFromRomanCase</tt> method (&#8220;<span class="quote"><tt class="function">fromRoman</tt> should only accept uppercase input</span>&#8221;) was an error, because the call to <tt class="function">numeral.upper()</tt> raised an <tt class="errorcode">AttributeError</tt> exception, because <tt class="function">toRoman</tt> was supposed to return a string but didn't.  But <tt class="function">testZero</tt> (&#8220;<span class="quote"><tt class="function">toRoman</tt> should fail with 0 input</span>&#8221;) was a failure, because the call to <tt class="function">fromRoman</tt> did not raise the <tt class="errorcode">InvalidRomanNumeral</tt> exception that <tt class="function">assertRaises</tt> was looking for.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.stage2"></a>14.2.&nbsp;<tt class="filename">roman.py</tt>, stage 2
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that you have the framework of the <tt class="filename">roman</tt> module laid out, it's time to start writing code and passing test cases.
                  </p>
               </div>
               <div class="example"><a name="roman.stage2.example"></a><h3 class="title">Example&nbsp;14.3.&nbsp;<tt class="filename">roman2.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage2/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Convert to and from Roman numerals"""

#Define exceptions
class RomanError(Exception): pass
class OutOfRangeError(RomanError): pass
class NotIntegerError(RomanError): pass
class InvalidRomanNumeralError(RomanError): pass

#Define digit mapping
romanNumeralMap = (('M',  1000), <a name="roman.stage2.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
                   ('CM', 900),
                   ('D',  500),
                   ('CD', 400),
                   ('C',  100),
                   ('XC', 90),
                   ('L',  50),
                   ('XL', 40),
                   ('X',  10),
                   ('IX', 9),
                   ('V',  5),
                   ('IV', 4),
                   ('I',  1))

def toRoman(n):
    """convert integer to Roman numeral"""
    result = ""
    for numeral, integer in romanNumeralMap:
        while n &gt;= integer:      <a name="roman.stage2.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
            result += numeral
            n -= integer
    return result

def fromRoman(s):
    """convert Roman numeral to integer"""
    pass
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage2.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">romanNumeralMap</tt> is a tuple of tuples which defines three things:
                              <div class="orderedlist">
                                 <ol type="1">
                                    <li>The character representations of the most basic Roman numerals.  Note that this is not just the single-character Roman numerals;
                                       you're also defining two-character pairs like <tt class="literal">CM</tt> (&#8220;<span class="quote">one hundred less than one thousand</span>&#8221;); this will make the <tt class="function">toRoman</tt> code simpler later.
                                    </li>
                                    <li>The order of the Roman numerals.  They are listed in descending value order, from <tt class="literal">M</tt> all the way down to <tt class="literal">I</tt>.
                                    </li>
                                    <li>The value of each Roman numeral.  Each inner tuple is a pair of <tt class="literal">(<i class="replaceable">numeral</i>, <i class="replaceable">value</i>)</tt>.
                                    </li>
                                 </ol>
                              </div>
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage2.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here's where your rich data structure pays off, because you don't need any special logic to handle the subtraction rule. 
                              To convert to Roman numerals, you simply iterate through <tt class="varname">romanNumeralMap</tt> looking for the largest integer value less than or equal to the input.  Once found, you add the Roman numeral representation
                              to the end of the output, subtract the corresponding integer value from the input, lather, rinse, repeat.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e33197"></a><h3 class="title">Example&nbsp;14.4.&nbsp;How <tt class="function">toRoman</tt> works
                  </h3>
                  <p>If you're not clear how <tt class="function">toRoman</tt> works, add a <tt class="function">print</tt> statement to the end of the <tt class="literal">while</tt> loop:
                  </p><pre class="programlisting">
        while n &gt;= integer:
            result += numeral
            n -= integer
            print 'subtracting', integer, 'from input, adding', numeral, 'to output'</pre><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import roman2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">roman2.toRoman(1424)</span>
<span class="computeroutput">subtracting 1000 from input, adding M to output
subtracting 400 from input, adding CD to output
subtracting 10 from input, adding X to output
subtracting 10 from input, adding X to output
subtracting 4 from input, adding IV to output
'MCDXXIV'</span>
</pre></div>
               <p>So <tt class="function">toRoman</tt> appears to work, at least in this manual spot check.  But will it pass the unit testing?  Well no, not entirely.
               </p>
               <div class="example"><a name="d0e33236"></a><h3 class="title">Example&nbsp;14.5.&nbsp;Output of <tt class="filename">romantest2.py</tt> against <tt class="filename">roman2.py</tt></h3>
                  <p>Remember to run <tt class="filename">romantest2.py</tt> with the <tt class="literal">-v</tt> command-line flag to enable verbose mode.
                  </p><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... FAIL
toRoman should always return uppercase ... ok                  </span><a name="roman.stage2.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
fromRoman should fail with malformed antecedents ... FAIL
fromRoman should fail with repeated pairs of numerals ... FAIL
fromRoman should fail with too many repeated numerals ... FAIL
fromRoman should give known result with known input ... FAIL
toRoman should give known result with known input ... ok       </span><a name="roman.stage2.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
fromRoman(toRoman(n))==n for all n ... FAIL
toRoman should fail with non-integer input ... FAIL            </span><a name="roman.stage2.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"><span class="computeroutput">
toRoman should fail with negative input ... FAIL
toRoman should fail with large input ... FAIL
toRoman should fail with 0 input ... FAIL</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage2.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">toRoman</tt> does, in fact, always return uppercase, because <tt class="varname">romanNumeralMap</tt> defines the Roman numeral representations as uppercase.  So this test passes already.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage2.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Here's the big news: this version of the <tt class="function">toRoman</tt> function passes the <a href="#roman.testtoromanknownvalues.example" title="Example&nbsp;13.2.&nbsp;testToRomanKnownValues">known values test</a>.  Remember, it's not comprehensive, but it does put the function through its paces with a variety of good inputs, including
                              inputs that produce every single-character Roman numeral, the largest possible input (<tt class="literal">3999</tt>), and the input that produces the longest possible Roman numeral (<tt class="literal">3888</tt>).  At this point, you can be reasonably confident that the function works for any good input value you could throw at it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage2.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">However, the function does not &#8220;<span class="quote">work</span>&#8221; for bad values; it fails every single <a href="#roman.tobadinput.example" title="Example&nbsp;13.3.&nbsp;Testing bad input to toRoman">bad input test</a>.  That makes sense, because you didn't include any checks for bad input.  Those test cases look for specific exceptions to
                              be raised (via <tt class="function">assertRaises</tt>), and you're never raising them.  You'll do that in the next stage.
                           </td>
                        </tr>
                     </table>
                  </div>
                  <p>Here's the rest of the output of the unit test, listing the details of all the failures.  You're down to 10.</p><pre class="screen"><span class="computeroutput">
======================================================================
FAIL: fromRoman should only accept uppercase input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 156, in testFromRomanCase
    roman2.fromRoman, numeral.lower())
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with malformed antecedents
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 133, in testMalformedAntecedent
    self.assertRaises(roman2.InvalidRomanNumeralError, roman2.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with repeated pairs of numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 127, in testRepeatedPairs
    self.assertRaises(roman2.InvalidRomanNumeralError, roman2.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with too many repeated numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 122, in testTooManyRepeatedNumerals
    self.assertRaises(roman2.InvalidRomanNumeralError, roman2.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should give known result with known input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 99, in testFromRomanKnownValues
    self.assertEqual(integer, result)
  File "c:\python21\lib\unittest.py", line 273, in failUnlessEqual
    raise self.failureException, (msg or '%s != %s' % (first, second))
AssertionError: 1 != None</span><span class="computeroutput">
======================================================================
FAIL: fromRoman(toRoman(n))==n for all n
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 141, in testSanity
    self.assertEqual(integer, result)
  File "c:\python21\lib\unittest.py", line 273, in failUnlessEqual
    raise self.failureException, (msg or '%s != %s' % (first, second))
AssertionError: 1 != None</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with non-integer input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 116, in testNonInteger
    self.assertRaises(roman2.NotIntegerError, roman2.toRoman, 0.5)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: NotIntegerError</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with negative input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 112, in testNegative
    self.assertRaises(roman2.OutOfRangeError, roman2.toRoman, -1)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: OutOfRangeError</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with large input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 104, in testTooLarge
    self.assertRaises(roman2.OutOfRangeError, roman2.toRoman, 4000)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: OutOfRangeError</span><span class="computeroutput">
======================================================================
FAIL: toRoman should fail with 0 input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage2\romantest2.py", line 108, in testZero
    self.assertRaises(roman2.OutOfRangeError, roman2.toRoman, 0)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: OutOfRangeError</span><span class="computeroutput">
----------------------------------------------------------------------
Ran 12 tests in 0.320s

FAILED (failures=10)</span></pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.stage3"></a>14.3.&nbsp;<tt class="filename">roman.py</tt>, stage 3
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that <tt class="function">toRoman</tt> behaves correctly with good input (integers from <tt class="literal">1</tt> to <tt class="literal">3999</tt>), it's time to make it behave correctly with bad input (everything else).
                  </p>
               </div>
               <div class="example"><a name="d0e33364"></a><h3 class="title">Example&nbsp;14.6.&nbsp;<tt class="filename">roman3.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage3/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Convert to and from Roman numerals"""

#Define exceptions
class RomanError(Exception): pass
class OutOfRangeError(RomanError): pass
class NotIntegerError(RomanError): pass
class InvalidRomanNumeralError(RomanError): pass

#Define digit mapping
romanNumeralMap = (('M',  1000),
                   ('CM', 900),
                   ('D',  500),
                   ('CD', 400),
                   ('C',  100),
                   ('XC', 90),
                   ('L',  50),
                   ('XL', 40),
                   ('X',  10),
                   ('IX', 9),
                   ('V',  5),
                   ('IV', 4),
                   ('I',  1))

def toRoman(n):
    """convert integer to Roman numeral"""
    if not (0 &lt; n &lt; 4000):                                             <a name="roman.stage3.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        raise OutOfRangeError, "number out of range (must be 1..3999)" <a name="roman.stage3.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    if int(n) &lt;&gt; n:                                                    <a name="roman.stage3.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
        raise NotIntegerError, "non-integers can not be converted"

    result = ""                                                        <a name="roman.stage3.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
    for numeral, integer in romanNumeralMap:
        while n &gt;= integer:
            result += numeral
            n -= integer
    return result

def fromRoman(s):
    """convert Roman numeral to integer"""
    pass
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a nice <span class="application">Python</span>ic shortcut: multiple comparisons at once.  This is equivalent to <tt class="literal">if not ((0 &lt; n) and (n &lt; 4000))</tt>, but it's much easier to read.  This is the range check, and it should catch inputs that are too large, negative, or zero.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You raise exceptions yourself with the <tt class="literal">raise</tt> statement.  You can raise any of the built-in exceptions, or you can raise any of your custom exceptions that you've defined.
                               The second parameter, the error message, is optional; if given, it is displayed in the traceback that is printed if the exception
                              is never handled.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the non-integer check.  Non-integers can not be converted to Roman numerals.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The rest of the function is unchanged.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e33410"></a><h3 class="title">Example&nbsp;14.7.&nbsp;Watching <tt class="function">toRoman</tt> handle bad input
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import roman3</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">roman3.toRoman(4000)</span>
<span class="traceback">Traceback (most recent call last):
  File "&lt;interactive input&gt;", line 1, in ?
  File "roman3.py", line 27, in toRoman
    raise OutOfRangeError, "number out of range (must be 1..3999)"
OutOfRangeError: number out of range (must be 1..3999)</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">roman3.toRoman(1.5)</span>
<span class="traceback">Traceback (most recent call last):
  File "&lt;interactive input&gt;", line 1, in ?
  File "roman3.py", line 29, in toRoman
    raise NotIntegerError, "non-integers can not be converted"
NotIntegerError: non-integers can not be converted</span>
</pre></div>
               <div class="example"><a name="d0e33439"></a><h3 class="title">Example&nbsp;14.8.&nbsp;Output of <tt class="filename">romantest3.py</tt> against <tt class="filename">roman3.py</tt></h3><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... FAIL
toRoman should always return uppercase ... ok
fromRoman should fail with malformed antecedents ... FAIL
fromRoman should fail with repeated pairs of numerals ... FAIL
fromRoman should fail with too many repeated numerals ... FAIL
fromRoman should give known result with known input ... FAIL
toRoman should give known result with known input ... ok </span><a name="roman.stage3.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
fromRoman(toRoman(n))==n for all n ... FAIL
toRoman should fail with non-integer input ... ok        </span><a name="roman.stage3.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
toRoman should fail with negative input ... ok           </span><a name="roman.stage3.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"><span class="computeroutput">
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">toRoman</tt> still passes the <a href="#roman.testtoromanknownvalues.example" title="Example&nbsp;13.2.&nbsp;testToRomanKnownValues">known values test</a>, which is comforting.  All the tests that passed in <a href="#roman.stage2" title="14.2.&nbsp;roman.py, stage 2">stage 2</a> still pass, so the latest code hasn't broken anything.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">More exciting is the fact that all of the <a href="#roman.tobadinput.example" title="Example&nbsp;13.3.&nbsp;Testing bad input to toRoman">bad input tests</a> now pass.  This test, <tt class="function">testNonInteger</tt>, passes because of the <tt class="literal">int(n) &lt;&gt; n</tt> check.  When a non-integer is passed to <tt class="function">toRoman</tt>, the <tt class="literal">int(n) &lt;&gt; n</tt> check notices it and raises the <tt class="errorcode">NotIntegerError</tt> exception, which is what <tt class="function">testNonInteger</tt> is looking for.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This test, <tt class="function">testNegative</tt>, passes because of the <tt class="literal">not (0 &lt; n &lt; 4000)</tt> check, which raises an <tt class="errorcode">OutOfRangeError</tt> exception, which is what <tt class="function">testNegative</tt> is looking for.
                           </td>
                        </tr>
                     </table>
                  </div><pre class="screen"><span class="computeroutput">
======================================================================
FAIL: fromRoman should only accept uppercase input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage3\romantest3.py", line 156, in testFromRomanCase
    roman3.fromRoman, numeral.lower())
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with malformed antecedents
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage3\romantest3.py", line 133, in testMalformedAntecedent
    self.assertRaises(roman3.InvalidRomanNumeralError, roman3.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with repeated pairs of numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage3\romantest3.py", line 127, in testRepeatedPairs
    self.assertRaises(roman3.InvalidRomanNumeralError, roman3.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with too many repeated numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage3\romantest3.py", line 122, in testTooManyRepeatedNumerals
    self.assertRaises(roman3.InvalidRomanNumeralError, roman3.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should give known result with known input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage3\romantest3.py", line 99, in testFromRomanKnownValues
    self.assertEqual(integer, result)
  File "c:\python21\lib\unittest.py", line 273, in failUnlessEqual
    raise self.failureException, (msg or '%s != %s' % (first, second))
AssertionError: 1 != None</span><span class="computeroutput">
======================================================================
FAIL: fromRoman(toRoman(n))==n for all n
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage3\romantest3.py", line 141, in testSanity
    self.assertEqual(integer, result)
  File "c:\python21\lib\unittest.py", line 273, in failUnlessEqual
    raise self.failureException, (msg or '%s != %s' % (first, second))
AssertionError: 1 != None</span><span class="computeroutput">
----------------------------------------------------------------------
Ran 12 tests in 0.401s

FAILED (failures=6)</span> <a name="roman.stage3.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage3.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You're down to 6 failures, and all of them involve <tt class="function">fromRoman</tt>: the known values test, the three separate bad input tests, the case check, and the sanity check.  That means that <tt class="function">toRoman</tt> has passed all the tests it can pass by itself.  (It's involved in the sanity check, but that also requires that <tt class="function">fromRoman</tt> be written, which it isn't yet.)  Which means that you must stop coding <tt class="function">toRoman</tt> now.  No tweaking, no twiddling, no extra checks &#8220;<span class="quote">just in case</span>&#8221;.  Stop.  Now.  Back away from the keyboard.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e33558"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">The most important thing that comprehensive unit testing can tell you is when to stop coding.  When all the unit tests for
                        a function pass, stop coding the function.  When all the unit tests for an entire module pass, stop coding the module.
                     </td>
                  </tr>
               </table>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.stage4"></a>14.4.&nbsp;<tt class="filename">roman.py</tt>, stage 4
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that <tt class="function">toRoman</tt> is done, it's time to start coding <tt class="function">fromRoman</tt>.  Thanks to the rich data structure that maps individual Roman numerals to integer values, this is no more difficult than
                     the <tt class="function">toRoman</tt> function.
                  </p>
               </div>
               <div class="example"><a name="d0e33582"></a><h3 class="title">Example&nbsp;14.9.&nbsp;<tt class="filename">roman4.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage4/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Convert to and from Roman numerals"""

#Define exceptions
class RomanError(Exception): pass
class OutOfRangeError(RomanError): pass
class NotIntegerError(RomanError): pass
class InvalidRomanNumeralError(RomanError): pass

#Define digit mapping
romanNumeralMap = (('M',  1000),
                   ('CM', 900),
                   ('D',  500),
                   ('CD', 400),
                   ('C',  100),
                   ('XC', 90),
                   ('L',  50),
                   ('XL', 40),
                   ('X',  10),
                   ('IX', 9),
                   ('V',  5),
                   ('IV', 4),
                   ('I',  1))

# toRoman function omitted for clarity (it hasn't changed)

def fromRoman(s):
    """convert Roman numeral to integer"""
    result = 0
    index = 0
    for numeral, integer in romanNumeralMap:
        while s[index:index+len(numeral)] == numeral: <a name="roman.stage4.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
            result += integer
            index += len(numeral)
    return result
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage4.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The pattern here is the same as <a href="#roman.stage2.example" title="Example&nbsp;14.3.&nbsp;roman2.py"><tt class="function">toRoman</tt></a>.  You iterate through your Roman numeral data structure (a tuple of tuples), and instead of matching the highest integer
                              values as often as possible, you match the &#8220;<span class="quote">highest</span>&#8221; Roman numeral character strings as often as possible.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e33611"></a><h3 class="title">Example&nbsp;14.10.&nbsp;How <tt class="function">fromRoman</tt> works
                  </h3>
                  <p>If you're not clear how <tt class="function">fromRoman</tt> works, add a <tt class="function">print</tt> statement to the end of the <tt class="literal">while</tt> loop:
                  </p><pre class="programlisting">
        while s[index:index+len(numeral)] == numeral:
            result += integer
            index += len(numeral)
            print 'found', numeral, 'of length', len(numeral), ', adding', integer</pre><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import roman4</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">roman4.fromRoman('MCMLXXII')</span>
<span class="computeroutput">found M , of length 1, adding 1000
found CM , of length 2, adding 900
found L , of length 1, adding 50
found X , of length 1, adding 10
found X , of length 1, adding 10
found I , of length 1, adding 1
found I , of length 1, adding 1
1972</span></pre></div>
               <div class="example"><a name="d0e33644"></a><h3 class="title">Example&nbsp;14.11.&nbsp;Output of <tt class="filename">romantest4.py</tt> against <tt class="filename">roman4.py</tt></h3><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... FAIL
toRoman should always return uppercase ... ok
fromRoman should fail with malformed antecedents ... FAIL
fromRoman should fail with repeated pairs of numerals ... FAIL
fromRoman should fail with too many repeated numerals ... FAIL
fromRoman should give known result with known input ... ok </span><a name="roman.stage4.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
toRoman should give known result with known input ... ok
fromRoman(toRoman(n))==n for all n ... ok                  </span><a name="roman.stage4.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage4.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Two pieces of exciting news here.  The first is that <tt class="function">fromRoman</tt> works for good input, at least for all the <a href="#roman.testtoromanknownvalues.example" title="Example&nbsp;13.2.&nbsp;testToRomanKnownValues">known values</a> you test.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage4.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The second is that the <a href="#roman.sanity.example" title="Example&nbsp;13.5.&nbsp;Testing toRoman against fromRoman">sanity check</a> also passed.  Combined with the known values tests, you can be reasonably sure that both <tt class="function">toRoman</tt> and <tt class="function">fromRoman</tt> work properly for all possible good values.  (This is not guaranteed; it is theoretically possible that <tt class="function">toRoman</tt> has a bug that produces the wrong Roman numeral for some particular set of inputs, <span class="emphasis"><em>and</em></span> that <tt class="function">fromRoman</tt> has a reciprocal bug that produces the same wrong integer values for exactly that set of Roman numerals that <tt class="function">toRoman</tt> generated incorrectly.  Depending on your application and your requirements, this possibility may bother you; if so, write
                              more comprehensive test cases until it doesn't bother you.)
                           </td>
                        </tr>
                     </table>
                  </div><pre class="screen"><span class="computeroutput">
======================================================================
FAIL: fromRoman should only accept uppercase input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 156, in testFromRomanCase
    roman4.fromRoman, numeral.lower())
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with malformed antecedents
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 133, in testMalformedAntecedent
    self.assertRaises(roman4.InvalidRomanNumeralError, roman4.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with repeated pairs of numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 127, in testRepeatedPairs
    self.assertRaises(roman4.InvalidRomanNumeralError, roman4.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with too many repeated numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 122, in testTooManyRepeatedNumerals
    self.assertRaises(roman4.InvalidRomanNumeralError, roman4.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
----------------------------------------------------------------------
Ran 12 tests in 1.222s

FAILED (failures=4)</span></pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.stage5"></a>14.5.&nbsp;<tt class="filename">roman.py</tt>, stage 5
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now that <tt class="function">fromRoman</tt> works properly with good input, it's time to fit in the last piece of the puzzle: making it work properly with bad input.
                     That means finding a way to look at a string and determine if it's a valid Roman numeral.  This is inherently more difficult
                     than <a href="#roman.stage3" title="14.3.&nbsp;roman.py, stage 3">validating numeric input</a> in <tt class="function">toRoman</tt>, but you have a powerful tool at your disposal: regular expressions.
                  </p>
               </div>
               <p>If you're not familiar with regular expressions and didn't read <a href="#re" title="Chapter&nbsp;7.&nbsp;Regular Expressions">Chapter&nbsp;7, <i>Regular Expressions</i></a>, now would be a good time.
               </p>
               <p>As you saw in <a href="#re.roman" title="7.3.&nbsp;Case Study: Roman Numerals">Section&nbsp;7.3, &#8220;Case Study: Roman Numerals&#8221;</a>, there are several simple rules for constructing a Roman numeral, using the letters <tt class="literal">M</tt>, <tt class="literal">D</tt>, <tt class="literal">C</tt>, <tt class="literal">L</tt>, <tt class="literal">X</tt>, <tt class="literal">V</tt>, and <tt class="literal">I</tt>.  Let's review the rules:
               </p>
               <div class="orderedlist">
                  <ol type="1">
                     <li>Characters are additive.  <tt class="literal">I</tt> is <tt class="constant">1</tt>, <tt class="literal">II</tt> is <tt class="literal">2</tt>, and <tt class="literal">III</tt> is <tt class="literal">3</tt>.  <tt class="literal">VI</tt> is <tt class="literal">6</tt> (literally, &#8220;<span class="quote"><tt class="literal">5</tt> and <tt class="literal">1</tt></span>&#8221;), <tt class="literal">VII</tt> is <tt class="literal">7</tt>, and <tt class="literal">VIII</tt> is <tt class="literal">8</tt>.
                     </li>
                     <li>The tens characters (<tt class="literal">I</tt>, <tt class="literal">X</tt>, <tt class="literal">C</tt>, and <tt class="literal">M</tt>) can be repeated up to three times.  At <tt class="literal">4</tt>, you need to subtract from the next highest fives character.  You can't represent <tt class="literal">4</tt> as <tt class="literal">IIII</tt>; instead, it is represented as <tt class="literal">IV</tt> (&#8220;<span class="quote"><tt class="literal">1</tt> less than <tt class="literal">5</tt></span>&#8221;).  <tt class="literal">40</tt> is written as <tt class="literal">XL</tt> (&#8220;<span class="quote"><tt class="literal">10</tt> less than <tt class="literal">50</tt></span>&#8221;), <tt class="literal">41</tt> as <tt class="literal">XLI</tt>, <tt class="literal">42</tt> as <tt class="literal">XLII</tt>, <tt class="literal">43</tt> as <tt class="literal">XLIII</tt>, and then <tt class="literal">44</tt> as <tt class="literal">XLIV</tt> (&#8220;<span class="quote"><tt class="literal">10</tt> less than <tt class="literal">50</tt>, then <tt class="literal">1</tt> less than <tt class="literal">5</tt></span>&#8221;).
                     </li>
                     <li>Similarly, at <tt class="literal">9</tt>, you need to subtract from the next highest tens character: <tt class="literal">8</tt> is <tt class="literal">VIII</tt>, but <tt class="literal">9</tt> is <tt class="literal">IX</tt> (&#8220;<span class="quote"><tt class="literal">1</tt> less than <tt class="literal">10</tt></span>&#8221;), not <tt class="literal">VIIII</tt> (since the <tt class="literal">I</tt> character can not be repeated four times).  <tt class="literal">90</tt> is <tt class="literal">XC</tt>, <tt class="literal">900</tt> is <tt class="literal">CM</tt>.
                     </li>
                     <li>The fives characters can not be repeated.  <tt class="literal">10</tt> is always represented as <tt class="literal">X</tt>, never as <tt class="literal">VV</tt>.  <tt class="literal">100</tt> is always <tt class="literal">C</tt>, never <tt class="literal">LL</tt>.
                     </li>
                     <li>Roman numerals are always written highest to lowest, and read left to right, so order of characters matters very much.  <tt class="literal">DC</tt> is <tt class="literal">600</tt>; <tt class="literal">CD</tt> is a completely different number (<tt class="literal">400</tt>, &#8220;<span class="quote"><tt class="literal">100</tt> less than <tt class="literal">500</tt></span>&#8221;).  <tt class="literal">CI</tt> is <tt class="literal">101</tt>; <tt class="literal">IC</tt> is not even a valid Roman numeral (because you can't subtract <tt class="literal">1</tt> directly from <tt class="literal">100</tt>; you would need to write it as <tt class="literal">XCIX</tt>, &#8220;<span class="quote"><tt class="literal">10</tt> less than <tt class="literal">100</tt>, then <tt class="literal">1</tt> less than <tt class="literal">10</tt></span>&#8221;).
                     </li>
                  </ol>
               </div>
               <div class="example"><a name="d0e34010"></a><h3 class="title">Example&nbsp;14.12.&nbsp;<tt class="filename">roman5.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage5/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Convert to and from Roman numerals"""
import re

#Define exceptions
class RomanError(Exception): pass
class OutOfRangeError(RomanError): pass
class NotIntegerError(RomanError): pass
class InvalidRomanNumeralError(RomanError): pass

#Define digit mapping
romanNumeralMap = (('M',  1000),
                   ('CM', 900),
                   ('D',  500),
                   ('CD', 400),
                   ('C',  100),
                   ('XC', 90),
                   ('L',  50),
                   ('XL', 40),
                   ('X',  10),
                   ('IX', 9),
                   ('V',  5),
                   ('IV', 4),
                   ('I',  1))

def toRoman(n):
    """convert integer to Roman numeral"""
    if not (0 &lt; n &lt; 4000):
        raise OutOfRangeError, "number out of range (must be 1..3999)"
    if int(n) &lt;&gt; n:
        raise NotIntegerError, "non-integers can not be converted"

    result = ""
    for numeral, integer in romanNumeralMap:
        while n &gt;= integer:
            result += numeral
            n -= integer
    return result

#Define pattern to detect valid Roman numerals
romanNumeralPattern = '^M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)(IX|IV|V?I?I?I?)$' <a name="roman.stage5.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

def fromRoman(s):
    """convert Roman numeral to integer"""
    if not re.search(romanNumeralPattern, s):                                    <a name="roman.stage5.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        raise InvalidRomanNumeralError, 'Invalid Roman numeral: %s' % s

    result = 0
    index = 0
    for numeral, integer in romanNumeralMap:
        while s[index:index+len(numeral)] == numeral:
            result += integer
            index += len(numeral)
    return result
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage5.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is just a continuation of the pattern you discussed in <a href="#re.roman" title="7.3.&nbsp;Case Study: Roman Numerals">Section&nbsp;7.3, &#8220;Case Study: Roman Numerals&#8221;</a>.  The tens places is either <tt class="literal">XC</tt> (<tt class="literal">90</tt>), <tt class="literal">XL</tt> (<tt class="literal">40</tt>), or an optional <tt class="literal">L</tt> followed by 0 to 3 optional <tt class="literal">X</tt> characters.  The ones place is either <tt class="literal">IX</tt> (<tt class="literal">9</tt>), <tt class="literal">IV</tt> (<tt class="literal">4</tt>), or an optional <tt class="literal">V</tt> followed by 0 to 3 optional <tt class="literal">I</tt> characters.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage5.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Having encoded all that logic into a regular expression, the code to check for invalid Roman numerals becomes trivial.  If
                              <tt class="function">re.search</tt> returns an object, then the regular expression matched and the input is valid; otherwise, the input is invalid.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>At this point, you are allowed to be skeptical that that big ugly regular expression could possibly catch all the types of
                  invalid Roman numerals.  But don't take my word for it, look at the results:
               </p>
               <div class="example"><a name="d0e34080"></a><h3 class="title">Example&nbsp;14.13.&nbsp;Output of <tt class="filename">romantest5.py</tt> against <tt class="filename">roman5.py</tt></h3><pre class="screen"><span class="computeroutput">
fromRoman should only accept uppercase input ... ok          </span><a name="roman.stage5.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
toRoman should always return uppercase ... ok
fromRoman should fail with malformed antecedents ... ok      </span><a name="roman.stage5.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
fromRoman should fail with repeated pairs of numerals ... ok </span><a name="roman.stage5.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"><span class="computeroutput">
fromRoman should fail with too many repeated numerals ... ok
fromRoman should give known result with known input ... ok
toRoman should give known result with known input ... ok
fromRoman(toRoman(n))==n for all n ... ok
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok

----------------------------------------------------------------------
Ran 12 tests in 2.864s

OK                                                           </span><a name="roman.stage5.4.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage5.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">One thing I didn't mention about regular expressions is that, by default, they are case-sensitive.  Since the regular expression
                              <tt class="varname">romanNumeralPattern</tt> was expressed in uppercase characters, the <tt class="function">re.search</tt> check will reject any input that isn't completely uppercase.  So the uppercase input test passes.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage5.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">More importantly, the bad input tests pass.  For instance, the malformed antecedents test checks cases like <tt class="literal">MCMC</tt>.  As you've seen, this does not match the regular expression, so <tt class="function">fromRoman</tt> raises an <tt class="errorcode">InvalidRomanNumeralError</tt> exception, which is what the malformed antecedents test case is looking for, so the test passes.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage5.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In fact, all the bad input tests pass.  This regular expression catches everything you could think of when you made your test
                              cases.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.stage5.4.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">And the anticlimax award of the year goes to the word &#8220;<span class="quote"><tt class="literal">OK</tt></span>&#8221;, which is printed by the <tt class="filename">unittest</tt> module when all the tests pass.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e34136"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">When all of your tests pass, stop coding.</td>
                  </tr>
               </table>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="roman2"></a>Chapter&nbsp;15.&nbsp;Refactoring
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.bugs"></a>15.1.&nbsp;Handling bugs
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Despite your best efforts to write comprehensive unit tests, bugs happen.  What do I mean by &#8220;<span class="quote">bug</span>&#8221;?  A bug is a test case you haven't written yet.
                  </p>
               </div>
               <div class="example"><a name="d0e34158"></a><h3 class="title">Example&nbsp;15.1.&nbsp;The bug</h3><pre class="screen"><tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import roman5</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">roman5.fromRoman("")</span> <a name="roman.bugs.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">0</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.bugs.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember in the <a href="#roman.stage5" title="14.5.&nbsp;roman.py, stage 5">previous section</a> when you kept seeing that an empty string would match the regular expression you were using to check for valid Roman numerals?
                               Well, it turns out that this is still true for the final version of the regular expression.  And that's a bug; you want an
                              empty string to raise an <tt class="errorcode">InvalidRomanNumeralError</tt> exception just like any other sequence of characters that don't represent a valid Roman numeral.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>After reproducing the bug, and before fixing it, you should write a test case that fails, thus illustrating the bug.</p>
               <div class="example"><a name="d0e34188"></a><h3 class="title">Example&nbsp;15.2.&nbsp;Testing for the bug (<tt class="filename">romantest61.py</tt>)
                  </h3><pre class="programlisting">
class FromRomanBadInput(unittest.TestCase):                                      

    # previous test cases omitted for clarity (they haven't changed)

    def testBlank(self):
        """fromRoman should fail with blank string"""
        self.assertRaises(roman.InvalidRomanNumeralError, roman.fromRoman, "") <a name="roman.bugs.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.bugs.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Pretty simple stuff here.  Call <tt class="function">fromRoman</tt> with an empty string and make sure it raises an <tt class="errorcode">InvalidRomanNumeralError</tt> exception.  The hard part was finding the bug; now that you know about it, testing for it is the easy part.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Since your code has a bug, and you now have a test case that tests this bug, the test case will fail:</p>
               <div class="example"><a name="d0e34210"></a><h3 class="title">Example&nbsp;15.3.&nbsp;Output of <tt class="filename">romantest61.py</tt> against <tt class="filename">roman61.py</tt></h3><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... ok
toRoman should always return uppercase ... ok
fromRoman should fail with blank string ... FAIL
fromRoman should fail with malformed antecedents ... ok
fromRoman should fail with repeated pairs of numerals ... ok
fromRoman should fail with too many repeated numerals ... ok
fromRoman should give known result with known input ... ok
toRoman should give known result with known input ... ok
fromRoman(toRoman(n))==n for all n ... ok
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok

======================================================================
FAIL: fromRoman should fail with blank string
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage6\romantest61.py", line 137, in testBlank
    self.assertRaises(roman61.InvalidRomanNumeralError, roman61.fromRoman, "")
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
----------------------------------------------------------------------
Ran 13 tests in 2.864s

FAILED (failures=1)</span></pre></div>
               <p><span class="emphasis"><em>Now</em></span> you can fix the bug.
               </p>
               <div class="example"><a name="d0e34229"></a><h3 class="title">Example&nbsp;15.4.&nbsp;Fixing the bug (<tt class="filename">roman62.py</tt>)
                  </h3>
                  <p>This file is available in <tt class="filename">py/roman/stage6/</tt> in the examples directory.
                  </p><pre class="programlisting">
def fromRoman(s):
    """convert Roman numeral to integer"""
    if not s: <a name="roman.bugs.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        raise InvalidRomanNumeralError, 'Input can not be blank'
    if not re.search(romanNumeralPattern, s):
        raise InvalidRomanNumeralError, 'Invalid Roman numeral: %s' % s

    result = 0
    index = 0
    for numeral, integer in romanNumeralMap:
        while s[index:index+len(numeral)] == numeral:
            result += integer
            index += len(numeral)
    return result
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.bugs.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Only two lines of code are required: an explicit check for an empty string, and a <tt class="literal">raise</tt> statement.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e34251"></a><h3 class="title">Example&nbsp;15.5.&nbsp;Output of <tt class="filename">romantest62.py</tt> against <tt class="filename">roman62.py</tt></h3><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... ok
toRoman should always return uppercase ... ok
fromRoman should fail with blank string ... ok </span><a name="roman.bugs.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
fromRoman should fail with malformed antecedents ... ok
fromRoman should fail with repeated pairs of numerals ... ok
fromRoman should fail with too many repeated numerals ... ok
fromRoman should give known result with known input ... ok
toRoman should give known result with known input ... ok
fromRoman(toRoman(n))==n for all n ... ok
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok

----------------------------------------------------------------------
Ran 13 tests in 2.834s

OK</span> <a name="roman.bugs.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.bugs.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The blank string test case now passes, so the bug is fixed.</td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.bugs.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">All the other test cases still pass, which means that this bug fix didn't break anything else.  Stop coding.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Coding this way does not make fixing bugs any easier.  Simple bugs (like this one) require simple test cases; complex bugs
                  will require complex test cases.  In a testing-centric environment, it may <span class="emphasis"><em>seem</em></span> like it takes longer to fix a bug, since you need to articulate in code exactly what the bug is (to write the test case),
                  then fix the bug itself.  Then if the test case doesn't pass right away, you need to figure out whether the fix was wrong,
                  or whether the test case itself has a bug in it.  However, in the long run, this back-and-forth between test code and code
                  tested pays for itself, because it makes it more likely that bugs are fixed correctly the first time.  Also, since you can
                  easily re-run <span class="emphasis"><em>all</em></span> the test cases along with your new one, you are much less likely to break old code when fixing new code.  Today's unit test
                  is tomorrow's regression test.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.change"></a>15.2.&nbsp;Handling changing requirements
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Despite your best efforts to pin your customers to the ground and extract exact requirements from them on pain of horrible
                     nasty things involving scissors and hot wax, requirements will change.  Most customers don't know what they want until they
                     see it, and even if they do, they aren't that good at articulating what they want precisely enough to be useful.  And even
                     if they do, they'll want more in the next release anyway.  So be prepared to update your test cases as requirements change.
                  </p>
               </div>
               <p>Suppose, for instance, that you wanted to expand the range of the Roman numeral conversion functions.  Remember <a href="#roman.divein" title="13.2.&nbsp;Diving in">the rule</a> that said that no character could be repeated more than three times?  Well, the Romans were willing to make an exception
                  to that rule by having 4 <tt class="literal">M</tt> characters in a row to represent <tt class="literal">4000</tt>.  If you make this change, you'll be able to expand the range of convertible numbers from <tt class="literal">1..3999</tt> to <tt class="literal">1..4999</tt>.  But first, you need to make some changes to the test cases.
               </p>
               <div class="example"><a name="d0e34307"></a><h3 class="title">Example&nbsp;15.6.&nbsp;Modifying test cases for new requirements (<tt class="filename">romantest71.py</tt>)
                  </h3>
                  <p>This file is available in <tt class="filename">py/roman/stage7/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
import roman71
import unittest

class KnownValues(unittest.TestCase):
    knownValues = ( (1, 'I'),
                    (2, 'II'),
                    (3, 'III'),
                    (4, 'IV'),
                    (5, 'V'),
                    (6, 'VI'),
                    (7, 'VII'),
                    (8, 'VIII'),
                    (9, 'IX'),
                    (10, 'X'),
                    (50, 'L'),
                    (100, 'C'),
                    (500, 'D'),
                    (1000, 'M'),
                    (31, 'XXXI'),
                    (148, 'CXLVIII'),
                    (294, 'CCXCIV'),
                    (312, 'CCCXII'),
                    (421, 'CDXXI'),
                    (528, 'DXXVIII'),
                    (621, 'DCXXI'),
                    (782, 'DCCLXXXII'),
                    (870, 'DCCCLXX'),
                    (941, 'CMXLI'),
                    (1043, 'MXLIII'),
                    (1110, 'MCX'),
                    (1226, 'MCCXXVI'),
                    (1301, 'MCCCI'),
                    (1485, 'MCDLXXXV'),
                    (1509, 'MDIX'),
                    (1607, 'MDCVII'),
                    (1754, 'MDCCLIV'),
                    (1832, 'MDCCCXXXII'),
                    (1993, 'MCMXCIII'),
                    (2074, 'MMLXXIV'),
                    (2152, 'MMCLII'),
                    (2212, 'MMCCXII'),
                    (2343, 'MMCCCXLIII'),
                    (2499, 'MMCDXCIX'),
                    (2574, 'MMDLXXIV'),
                    (2646, 'MMDCXLVI'),
                    (2723, 'MMDCCXXIII'),
                    (2892, 'MMDCCCXCII'),
                    (2975, 'MMCMLXXV'),
                    (3051, 'MMMLI'),
                    (3185, 'MMMCLXXXV'),
                    (3250, 'MMMCCL'),
                    (3313, 'MMMCCCXIII'),
                    (3408, 'MMMCDVIII'),
                    (3501, 'MMMDI'),
                    (3610, 'MMMDCX'),
                    (3743, 'MMMDCCXLIII'),
                    (3844, 'MMMDCCCXLIV'),
                    (3888, 'MMMDCCCLXXXVIII'),
                    (3940, 'MMMCMXL'),
                    (3999, 'MMMCMXCIX'),
                    (4000, 'MMMM'),                                       <a name="roman.change.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
                    (4500, 'MMMMD'),
                    (4888, 'MMMMDCCCLXXXVIII'),
                    (4999, 'MMMMCMXCIX'))

    def testToRomanKnownValues(self):
        """toRoman should give known result with known input"""
        for integer, numeral in self.knownValues:
            result = roman71.toRoman(integer)
            self.assertEqual(numeral, result)

    def testFromRomanKnownValues(self):
        """fromRoman should give known result with known input"""
        for integer, numeral in self.knownValues:
            result = roman71.fromRoman(numeral)
            self.assertEqual(integer, result)

class ToRomanBadInput(unittest.TestCase):
    def testTooLarge(self):
        """toRoman should fail with large input"""
        self.assertRaises(roman71.OutOfRangeError, roman71.toRoman, 5000) <a name="roman.change.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">

    def testZero(self):
        """toRoman should fail with 0 input"""
        self.assertRaises(roman71.OutOfRangeError, roman71.toRoman, 0)

    def testNegative(self):
        """toRoman should fail with negative input"""
        self.assertRaises(roman71.OutOfRangeError, roman71.toRoman, -1)

    def testNonInteger(self):
        """toRoman should fail with non-integer input"""
        self.assertRaises(roman71.NotIntegerError, roman71.toRoman, 0.5)

class FromRomanBadInput(unittest.TestCase):
    def testTooManyRepeatedNumerals(self):
        """fromRoman should fail with too many repeated numerals"""
        for s in ('MMMMM', 'DD', 'CCCC', 'LL', 'XXXX', 'VV', 'IIII'):     <a name="roman.change.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
            self.assertRaises(roman71.InvalidRomanNumeralError, roman71.fromRoman, s)

    def testRepeatedPairs(self):
        """fromRoman should fail with repeated pairs of numerals"""
        for s in ('CMCM', 'CDCD', 'XCXC', 'XLXL', 'IXIX', 'IVIV'):
            self.assertRaises(roman71.InvalidRomanNumeralError, roman71.fromRoman, s)

    def testMalformedAntecedent(self):
        """fromRoman should fail with malformed antecedents"""
        for s in ('IIMXCC', 'VX', 'DCM', 'CMM', 'IXIV',
                  'MCMC', 'XCX', 'IVI', 'LM', 'LD', 'LC'):
            self.assertRaises(roman71.InvalidRomanNumeralError, roman71.fromRoman, s)

    def testBlank(self):
        """fromRoman should fail with blank string"""
        self.assertRaises(roman71.InvalidRomanNumeralError, roman71.fromRoman, "")

class SanityCheck(unittest.TestCase):
    def testSanity(self):
        """fromRoman(toRoman(n))==n for all n"""
        for integer in range(1, 5000):                                    <a name="roman.change.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
            numeral = roman71.toRoman(integer)
            result = roman71.fromRoman(numeral)
            self.assertEqual(integer, result)

class CaseCheck(unittest.TestCase):
    def testToRomanCase(self):
        """toRoman should always return uppercase"""
        for integer in range(1, 5000):
            numeral = roman71.toRoman(integer)
            self.assertEqual(numeral, numeral.upper())

    def testFromRomanCase(self):
        """fromRoman should only accept uppercase input"""
        for integer in range(1, 5000):
            numeral = roman71.toRoman(integer)
            roman71.fromRoman(numeral.upper())
            self.assertRaises(roman71.InvalidRomanNumeralError,
                              roman71.fromRoman, numeral.lower())

if __name__ == "__main__":
    unittest.main()
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The existing known values don't change (they're all still reasonable values to test), but you need to add a few more in the
                              <tt class="literal">4000</tt> range.  Here I've included <tt class="literal">4000</tt> (the shortest), <tt class="literal">4500</tt> (the second shortest), <tt class="literal">4888</tt> (the longest), and <tt class="literal">4999</tt> (the largest).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The definition of &#8220;<span class="quote">large input</span>&#8221; has changed.  This test used to call <tt class="function">toRoman</tt> with <tt class="literal">4000</tt> and expect an error; now that <tt class="literal">4000-4999</tt> are good values, you need to bump this up to <tt class="literal">5000</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The definition of &#8220;<span class="quote">too many repeated numerals</span>&#8221; has also changed.  This test used to call <tt class="function">fromRoman</tt> with <tt class="literal">'MMMM'</tt> and expect an error; now that <tt class="literal">MMMM</tt> is considered a valid Roman numeral, you need to bump this up to <tt class="literal">'MMMMM'</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The sanity check and case checks loop through every number in the range, from <tt class="constant">1</tt> to <tt class="literal">3999</tt>.  Since the range has now expanded, these <tt class="literal">for</tt> loops need to be updated as well to go up to <tt class="literal">4999</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now your test cases are up to date with the new requirements, but your code is not, so you expect several of the test cases
                  to fail.
               </p>
               <div class="example"><a name="d0e34405"></a><h3 class="title">Example&nbsp;15.7.&nbsp;Output of <tt class="filename">romantest71.py</tt> against <tt class="filename">roman71.py</tt></h3><pre class="screen"><span class="computeroutput">
fromRoman should only accept uppercase input ... ERROR        </span><a name="roman.change.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
toRoman should always return uppercase ... ERROR
fromRoman should fail with blank string ... ok
fromRoman should fail with malformed antecedents ... ok
fromRoman should fail with repeated pairs of numerals ... ok
fromRoman should fail with too many repeated numerals ... ok
fromRoman should give known result with known input ... ERROR </span><a name="roman.change.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
toRoman should give known result with known input ... ERROR   </span><a name="roman.change.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"><span class="computeroutput">
fromRoman(toRoman(n))==n for all n ... ERROR                  </span><a name="roman.change.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"><span class="computeroutput">
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok
</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Our case checks now fail because they loop from <tt class="constant">1</tt> to <tt class="literal">4999</tt>, but <tt class="function">toRoman</tt> only accepts numbers from <tt class="constant">1</tt> to <tt class="literal">3999</tt>, so it will fail as soon the test case hits <tt class="literal">4000</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">fromRoman</tt> known values test will fail as soon as it hits <tt class="literal">'MMMM'</tt>, because <tt class="function">fromRoman</tt> still thinks this is an invalid Roman numeral.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">toRoman</tt> known values test will fail as soon as it hits <tt class="literal">4000</tt>, because <tt class="function">toRoman</tt> still thinks this is out of range.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The sanity check will also fail as soon as it hits <tt class="literal">4000</tt>, because <tt class="function">toRoman</tt> still thinks this is out of range.
                           </td>
                        </tr>
                     </table>
                  </div><pre class="screen"><span class="computeroutput">
======================================================================
ERROR: fromRoman should only accept uppercase input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage7\romantest71.py", line 161, in testFromRomanCase
    numeral = roman71.toRoman(integer)
  File "roman71.py", line 28, in toRoman
    raise OutOfRangeError, "number out of range (must be 1..3999)"
OutOfRangeError: number out of range (must be 1..3999)</span><span class="computeroutput">
======================================================================
ERROR: toRoman should always return uppercase
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage7\romantest71.py", line 155, in testToRomanCase
    numeral = roman71.toRoman(integer)
  File "roman71.py", line 28, in toRoman
    raise OutOfRangeError, "number out of range (must be 1..3999)"
OutOfRangeError: number out of range (must be 1..3999)</span><span class="computeroutput">
======================================================================
ERROR: fromRoman should give known result with known input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage7\romantest71.py", line 102, in testFromRomanKnownValues
    result = roman71.fromRoman(numeral)
  File "roman71.py", line 47, in fromRoman
    raise InvalidRomanNumeralError, 'Invalid Roman numeral: %s' % s
InvalidRomanNumeralError: Invalid Roman numeral: MMMM</span><span class="computeroutput">
======================================================================
ERROR: toRoman should give known result with known input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage7\romantest71.py", line 96, in testToRomanKnownValues
    result = roman71.toRoman(integer)
  File "roman71.py", line 28, in toRoman
    raise OutOfRangeError, "number out of range (must be 1..3999)"
OutOfRangeError: number out of range (must be 1..3999)</span><span class="computeroutput">
======================================================================
ERROR: fromRoman(toRoman(n))==n for all n
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage7\romantest71.py", line 147, in testSanity
    numeral = roman71.toRoman(integer)
  File "roman71.py", line 28, in toRoman
    raise OutOfRangeError, "number out of range (must be 1..3999)"
OutOfRangeError: number out of range (must be 1..3999)</span><span class="computeroutput">
----------------------------------------------------------------------
Ran 13 tests in 2.213s

FAILED (errors=5)</span></pre></div>
               <p>Now that you have test cases that fail due to the new requirements, you can think about fixing the code to bring it in line
                  with the test cases.  (One thing that takes some getting used to when you first start coding unit tests is that the code being
                  tested is never &#8220;<span class="quote">ahead</span>&#8221; of the test cases.  While it's behind, you still have some work to do, and as soon as it catches up to the test cases, you
                  stop coding.)
               </p>
               <div class="example"><a name="d0e34511"></a><h3 class="title">Example&nbsp;15.8.&nbsp;Coding the new requirements (<tt class="filename">roman72.py</tt>)
                  </h3>
                  <p>This file is available in <tt class="filename">py/roman/stage7/</tt> in the examples directory.
                  </p><pre class="programlisting">
"""Convert to and from Roman numerals"""
import re

#Define exceptions
class RomanError(Exception): pass
class OutOfRangeError(RomanError): pass
class NotIntegerError(RomanError): pass
class InvalidRomanNumeralError(RomanError): pass

#Define digit mapping
romanNumeralMap = (('M',  1000),
                   ('CM', 900),
                   ('D',  500),
                   ('CD', 400),
                   ('C',  100),
                   ('XC', 90),
                   ('L',  50),
                   ('XL', 40),
                   ('X',  10),
                   ('IX', 9),
                   ('V',  5),
                   ('IV', 4),
                   ('I',  1))

def toRoman(n):
    """convert integer to Roman numeral"""
    if not (0 &lt; n &lt; 5000):                                                         <a name="roman.change.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        raise OutOfRangeError, "number out of range (must be 1..4999)"
    if int(n) &lt;&gt; n:
        raise NotIntegerError, "non-integers can not be converted"

    result = ""
    for numeral, integer in romanNumeralMap:
        while n &gt;= integer:
            result += numeral
            n -= integer
    return result

#Define pattern to detect valid Roman numerals
romanNumeralPattern = '^M?M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)(IX|IV|V?I?I?I?)$' <a name="roman.change.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">

def fromRoman(s):
    """convert Roman numeral to integer"""
    if not s:
        raise InvalidRomanNumeralError, 'Input can not be blank'
    if not re.search(romanNumeralPattern, s):
        raise InvalidRomanNumeralError, 'Invalid Roman numeral: %s' % s

    result = 0
    index = 0
    for numeral, integer in romanNumeralMap:
        while s[index:index+len(numeral)] == numeral:
            result += integer
            index += len(numeral)
    return result
</pre></div>
               <div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#roman.change.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left"><tt class="function">toRoman</tt> only needs one small change, in the range check.  Where you used to check <tt class="literal">0 &lt; n &lt; 4000</tt>, you now check <tt class="literal">0 &lt; n &lt; 5000</tt>.  And you change the error message that you <tt class="literal">raise</tt> to reflect the new acceptable range (<tt class="literal">1..4999</tt> instead of <tt class="literal">1..3999</tt>).  You don't need to make any changes to the rest of the function; it handles the new cases already.  (It merrily adds <tt class="literal">'M'</tt> for each thousand that it finds; given <tt class="literal">4000</tt>, it will spit out <tt class="literal">'MMMM'</tt>.  The only reason it didn't do this before is that you explicitly stopped it with the range check.)
                        </td>
                     </tr>
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#roman.change.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">You don't need to make any changes to <tt class="function">fromRoman</tt> at all.  The only change is to <tt class="varname">romanNumeralPattern</tt>; if you look closely, you'll notice that you added another optional <tt class="literal">M</tt> in the first section of the regular expression.  This will allow up to 4 <tt class="literal">M</tt> characters instead of 3, meaning you will allow the Roman numeral equivalents of <tt class="literal">4999</tt> instead of <tt class="literal">3999</tt>.  The actual <tt class="function">fromRoman</tt> function is completely general; it just looks for repeated Roman numeral characters and adds them up, without caring how
                           many times they repeat.  The only reason it didn't handle <tt class="literal">'MMMM'</tt> before is that you explicitly stopped it with the regular expression pattern matching.
                        </td>
                     </tr>
                  </table>
               </div>
               <p>You may be skeptical that these two small changes are all that you need.  Hey, don't take my word for it; see for yourself:</p>
               <div class="example"><a name="roman.roman72.output"></a><h3 class="title">Example&nbsp;15.9.&nbsp;Output of <tt class="filename">romantest72.py</tt> against <tt class="filename">roman72.py</tt></h3><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... ok
toRoman should always return uppercase ... ok
fromRoman should fail with blank string ... ok
fromRoman should fail with malformed antecedents ... ok
fromRoman should fail with repeated pairs of numerals ... ok
fromRoman should fail with too many repeated numerals ... ok
fromRoman should give known result with known input ... ok
toRoman should give known result with known input ... ok
fromRoman(toRoman(n))==n for all n ... ok
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok

----------------------------------------------------------------------
Ran 13 tests in 3.685s

OK</span> <a name="roman.change.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.change.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">All the test cases pass.  Stop coding.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Comprehensive unit testing means never having to rely on a programmer who says &#8220;<span class="quote">Trust me.</span>&#8221;
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.refactoring"></a>15.3.&nbsp;Refactoring
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The best thing about comprehensive unit testing is not the feeling you get when all your test cases finally pass, or even
                     the feeling you get when someone else blames you for breaking their code and you can actually <span class="emphasis"><em>prove</em></span> that you didn't.  The best thing about unit testing is that it gives you the freedom to refactor mercilessly.
                  </p>
               </div>
               <p>Refactoring is the process of taking working code and making it work better.  Usually, &#8220;<span class="quote">better</span>&#8221; means &#8220;<span class="quote">faster</span>&#8221;, although it can also mean &#8220;<span class="quote">using less memory</span>&#8221;, or &#8220;<span class="quote">using less disk space</span>&#8221;, or simply &#8220;<span class="quote">more elegantly</span>&#8221;.  Whatever it means to you, to your project, in your environment, refactoring is important to the long-term health of any
                  program.
               </p>
               <p>Here, &#8220;<span class="quote">better</span>&#8221; means &#8220;<span class="quote">faster</span>&#8221;.  Specifically, the <tt class="function">fromRoman</tt> function is slower than it needs to be, because of that big nasty regular expression that you use to validate Roman numerals.
                  It's probably not worth trying to do away with the regular expression altogether (it would be difficult, and it might not
                  end up any faster), but you can speed up the function by precompiling the regular expression.
               </p>
               <div class="example"><a name="d0e34647"></a><h3 class="title">Example&nbsp;15.10.&nbsp;Compiling regular expressions</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import re</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">pattern = '^M?M?M?$'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search(pattern, 'M')</span>               <a name="roman.refactoring.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 01090490&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">compiledPattern = re.compile(pattern)</span> <a name="roman.refactoring.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">compiledPattern</span>
<span class="computeroutput">&lt;SRE_Pattern object at 00F06E28&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">dir(compiledPattern)</span>                  <a name="roman.refactoring.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['findall', 'match', 'scanner', 'search', 'split', 'sub', 'subn']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">compiledPattern.search('M')</span>           <a name="roman.refactoring.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">&lt;SRE_Match object at 01104928&gt;</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the syntax you've seen before: <tt class="function">re.search</tt> takes a regular expression as a string (<tt class="varname">pattern</tt>) and a string to match against it (<tt class="literal">'M'</tt>).  If the pattern matches, the function returns a match object which can be queried to find out exactly what matched and
                              how.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the new syntax: <tt class="function">re.compile</tt> takes a regular expression as a string and returns a pattern object.  Note there is no string to match here.  Compiling a
                              regular expression has nothing to do with matching it against any specific strings (like <tt class="literal">'M'</tt>); it only involves the regular expression itself.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The compiled pattern object returned from <tt class="function">re.compile</tt> has several useful-looking functions, including several (like <tt class="function">search</tt> and <tt class="function">sub</tt>) that are available directly in the <tt class="filename">re</tt> module.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Calling the compiled pattern object's <tt class="function">search</tt> function with the string <tt class="literal">'M'</tt> accomplishes the same thing as calling <tt class="function">re.search</tt> with both the regular expression and the string <tt class="literal">'M'</tt>.  Only much, much faster.  (In fact, the <tt class="function">re.search</tt> function simply compiles the regular expression and calls the resulting pattern object's <tt class="function">search</tt> method for you.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e34764"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Whenever you are going to use a regular expression more than once, you should compile it to get a pattern object, then call
                        the methods on the pattern object directly.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="d0e34769"></a><h3 class="title">Example&nbsp;15.11.&nbsp;Compiled regular expressions in <tt class="filename">roman81.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage8/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
# toRoman and rest of module omitted for clarity

romanNumeralPattern = \
    re.compile('^M?M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)(IX|IV|V?I?I?I?)$') <a name="roman.refactoring.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

def fromRoman(s):
    """convert Roman numeral to integer"""
    if not s:
        raise InvalidRomanNumeralError, 'Input can not be blank'
    if not romanNumeralPattern.search(s):                                    <a name="roman.refactoring.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        raise InvalidRomanNumeralError, 'Invalid Roman numeral: %s' % s

    result = 0
    index = 0
    for numeral, integer in romanNumeralMap:
        while s[index:index+len(numeral)] == numeral:
            result += integer
            index += len(numeral)
    return result
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This looks very similar, but in fact a lot has changed.  <tt class="varname">romanNumeralPattern</tt> is no longer a string; it is a pattern object which was returned from <tt class="function">re.compile</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">That means that you can call methods on <tt class="varname">romanNumeralPattern</tt> directly.  This will be much, much faster than calling <tt class="function">re.search</tt> every time.  The regular expression is compiled once and stored in <tt class="varname">romanNumeralPattern</tt> when the module is first imported; then, every time you call <tt class="function">fromRoman</tt>, you can immediately match the input string against the regular expression, without any intermediate steps occurring under
                              the covers.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So how much faster is it to compile regular expressions?  See for yourself:</p>
               <div class="example"><a name="roman.stage8.1.output"></a><h3 class="title">Example&nbsp;15.12.&nbsp;Output of <tt class="filename">romantest81.py</tt> against <tt class="filename">roman81.py</tt></h3><pre class="screen"><span class="computeroutput">.............          </span><a name="roman.refactoring.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
----------------------------------------------------------------------
Ran 13 tests in 3.385s </span><a name="roman.refactoring.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">

OK</span>                     <a name="roman.refactoring.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Just a note in passing here: this time, I ran the unit test <span class="emphasis"><em>without</em></span> the <tt class="option">-v</tt> option, so instead of the full <tt class="literal">doc string</tt> for each test, you only get a dot for each test that passes.  (If a test failed, you'd get an <tt class="literal">F</tt>, and if it had an error, you'd get an <tt class="literal">E</tt>.  You'd still get complete tracebacks for each failure and error, so you could track down any problems.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You ran <tt class="literal">13</tt> tests in <tt class="literal">3.385</tt> seconds, compared to <a href="#roman.roman72.output" title="Example&nbsp;15.9.&nbsp;Output of romantest72.py against roman72.py"><tt class="literal">3.685</tt> seconds</a> without precompiling the regular expressions.  That's an <tt class="literal">8%</tt> improvement overall, and remember that most of the time spent during the unit test is spent doing other things.  (Separately,
                              I time-tested the regular expressions by themselves, apart from the rest of the unit tests, and found that compiling this
                              regular expression speeds up the <tt class="function">search</tt> by an average of <tt class="literal">54%</tt>.)  Not bad for such a simple fix.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Oh, and in case you were wondering, precompiling the regular expression didn't break anything, and you just proved it.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>There is one other performance optimization that I want to try.  Given the complexity of regular expression syntax, it should
                  come as no surprise that there is frequently more than one way to write the same expression.  After some discussion about
                  this module on <a href="http://groups.google.com/groups?group=comp.lang.python">comp.lang.python</a>, someone suggested that I try using the <tt class="literal">{<i class="replaceable">m</i>,<i class="replaceable">n</i>}</tt> syntax for the optional repeated characters.
               </p>
               <div class="example"><a name="d0e34895"></a><h3 class="title">Example&nbsp;15.13.&nbsp;<tt class="filename">roman82.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage8/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
# rest of program omitted for clarity

#old version
#romanNumeralPattern = \
#   re.compile('^M?M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)(IX|IV|V?I?I?I?)$')

#new version
romanNumeralPattern = \
    re.compile('^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$') <a name="roman.refactoring.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You have replaced <tt class="literal">M?M?M?M?</tt> with <tt class="literal">M{0,4}</tt>.  Both mean the same thing: &#8220;<span class="quote">match 0 to 4 <tt class="literal">M</tt> characters</span>&#8221;.  Similarly, <tt class="literal">C?C?C?</tt> became <tt class="literal">C{0,3}</tt> (&#8220;<span class="quote">match 0 to 3 <tt class="literal">C</tt> characters</span>&#8221;) and so forth for <tt class="literal">X</tt> and <tt class="literal">I</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>This form of the regular expression is a little shorter (though not any more readable).  The big question is, is it any faster?</p>
               <div class="example"><a name="d0e34949"></a><h3 class="title">Example&nbsp;15.14.&nbsp;Output of <tt class="filename">romantest82.py</tt> against <tt class="filename">roman82.py</tt></h3><pre class="screen"><span class="computeroutput">.............
----------------------------------------------------------------------
Ran 13 tests in 3.315s </span><a name="roman.refactoring.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">

OK</span>                     <a name="roman.refactoring.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Overall, the unit tests run 2% faster with this form of regular expression.  That doesn't sound exciting, but remember that
                              the <tt class="function">search</tt> function is a small part of the overall unit test; most of the time is spent doing other things.  (Separately, I time-tested
                              just the regular expressions, and found that the <tt class="function">search</tt> function is <tt class="literal">11%</tt> faster with this syntax.)  By precompiling the regular expression and rewriting part of it to use this new syntax, you've
                              improved the regular expression performance by over <tt class="literal">60%</tt>, and improved the overall performance of the entire unit test by over <tt class="literal">10%</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">More important than any performance boost is the fact that the module still works perfectly.  This is the freedom I was talking
                              about earlier: the freedom to tweak, change, or rewrite any piece of it and verify that you haven't messed anything up in
                              the process.  This is not a license to endlessly tweak your code just for the sake of tweaking it; you had a very specific
                              objective (&#8220;<span class="quote">make <tt class="function">fromRoman</tt> faster</span>&#8221;), and you were able to accomplish that objective without any lingering doubts about whether you introduced new bugs in the
                              process.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>One other tweak I would like to make, and then I promise I'll stop refactoring and put this module to bed.  As you've seen
                  repeatedly, regular expressions can get pretty hairy and unreadable pretty quickly.  I wouldn't like to come back to this
                  module in six months and try to maintain it.  Sure, the test cases pass, so I know that it works, but if I can't figure out
                  <span class="emphasis"><em>how</em></span> it works, it's still going to be difficult to add new features, fix new bugs, or otherwise maintain it.  As you saw in <a href="#re.verbose" title="7.5.&nbsp;Verbose Regular Expressions">Section&nbsp;7.5, &#8220;Verbose Regular Expressions&#8221;</a>, <span class="application">Python</span> provides a way to document your logic line-by-line.
               </p>
               <div class="example"><a name="d0e35003"></a><h3 class="title">Example&nbsp;15.15.&nbsp;<tt class="filename">roman83.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage8/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
# rest of program omitted for clarity

#old version
#romanNumeralPattern = \
#   re.compile('^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$')

#new version
romanNumeralPattern = re.compile('''
    ^                   # beginning of string
    M{0,4}              # thousands - 0 to 4 M's
    (CM|CD|D?C{0,3})    # hundreds - 900 (CM), 400 (CD), 0-300 (0 to 3 C's),
                        #            or 500-800 (D, followed by 0 to 3 C's)
    (XC|XL|L?X{0,3})    # tens - 90 (XC), 40 (XL), 0-30 (0 to 3 X's),
                        #        or 50-80 (L, followed by 0 to 3 X's)
    (IX|IV|V?I{0,3})    # ones - 9 (IX), 4 (IV), 0-3 (0 to 3 I's),
                        #        or 5-8 (V, followed by 0 to 3 I's)
    $                   # end of string
    ''', re.VERBOSE) <a name="roman.refactoring.6.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.6.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">re.compile</tt> function can take an optional second argument, which is a set of one or more flags that control various options about the
                              compiled regular expression.  Here you're specifying the <tt class="literal">re.VERBOSE</tt> flag, which tells <span class="application">Python</span> that there are in-line comments within the regular expression itself.  The comments and all the whitespace around them are
                              <span class="emphasis"><em>not</em></span> considered part of the regular expression; the <tt class="function">re.compile</tt> function simply strips them all out when it compiles the expression.  This new, &#8220;<span class="quote">verbose</span>&#8221; version is identical to the old version, but it is infinitely more readable.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e35043"></a><h3 class="title">Example&nbsp;15.16.&nbsp;Output of <tt class="filename">romantest83.py</tt> against <tt class="filename">roman83.py</tt></h3><pre class="screen"><span class="computeroutput">.............
----------------------------------------------------------------------
Ran 13 tests in 3.315s </span><a name="roman.refactoring.7.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">

OK</span>                     <a name="roman.refactoring.7.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.7.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This new, &#8220;<span class="quote">verbose</span>&#8221; version runs at exactly the same speed as the old version.  In fact, the compiled pattern objects are the same, since the
                              <tt class="function">re.compile</tt> function strips out all the stuff you added.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#roman.refactoring.7.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This new, &#8220;<span class="quote">verbose</span>&#8221; version passes all the same tests as the old version.  Nothing has changed, except that the programmer who comes back to
                              this module in six months stands a fighting chance of understanding how the function works.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.postscript"></a>15.4.&nbsp;Postscript
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>A clever reader read the <a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">previous section</a> and took it to the next level.  The biggest headache (and performance drain) in the program as it is currently written is
                     the regular expression, which is required because you have no other way of breaking down a Roman numeral.  But there's only
                     5000 of them; why don't you just build a lookup table once, then simply read that?  This idea gets even better when you realize
                     that you don't need to use regular expressions at all.  As you build the lookup table for converting integers to Roman numerals,
                     you can build the reverse lookup table to convert Roman numerals to integers.
                  </p>
               </div>
               <p>And best of all, he already had a complete set of unit tests.  He changed over half the code in the module, but the unit tests
                  stayed the same, so he could prove that his code worked just as well as the original.
               </p>
               <div class="example"><a name="d0e35088"></a><h3 class="title">Example&nbsp;15.17.&nbsp;<tt class="filename">roman9.py</tt></h3>
                  <p>This file is available in <tt class="filename">py/roman/stage9/</tt> in the examples directory.
                  </p>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
#Define exceptions
class RomanError(Exception): pass
class OutOfRangeError(RomanError): pass
class NotIntegerError(RomanError): pass
class InvalidRomanNumeralError(RomanError): pass

#Roman numerals must be less than 5000
MAX_ROMAN_NUMERAL = 4999

#Define digit mapping
romanNumeralMap = (('M',  1000),
                   ('CM', 900),
                   ('D',  500),
                   ('CD', 400),
                   ('C',  100),
                   ('XC', 90),
                   ('L',  50),
                   ('XL', 40),
                   ('X',  10),
                   ('IX', 9),
                   ('V',  5),
                   ('IV', 4),
                   ('I',  1))

#Create tables for fast conversion of roman numerals.
#See fillLookupTables() below.
toRomanTable = [ None ]  # Skip an index since Roman numerals have no zero
fromRomanTable = {}

def toRoman(n):
    """convert integer to Roman numeral"""
    if not (0 &lt; n &lt;= MAX_ROMAN_NUMERAL):
        raise OutOfRangeError, "number out of range (must be 1..%s)" % MAX_ROMAN_NUMERAL
    if int(n) &lt;&gt; n:
        raise NotIntegerError, "non-integers can not be converted"
    return toRomanTable[n]

def fromRoman(s):
    """convert Roman numeral to integer"""
    if not s:
        raise InvalidRomanNumeralError, "Input can not be blank"
    if not fromRomanTable.has_key(s):
        raise InvalidRomanNumeralError, "Invalid Roman numeral: %s" % s
    return fromRomanTable[s]

def toRomanDynamic(n):
    """convert integer to Roman numeral using dynamic programming"""
    result = ""
    for numeral, integer in romanNumeralMap:
        if n &gt;= integer:
            result = numeral
            n -= integer
            break
    if n &gt; 0:
        result += toRomanTable[n]
    return result

def fillLookupTables():
    """compute all the possible roman numerals"""
    #Save the values in two global tables to convert to and from integers.
    for integer in range(1, MAX_ROMAN_NUMERAL + 1):
        romanNumber = toRomanDynamic(integer)
        toRomanTable.append(romanNumber)
        fromRomanTable[romanNumber] = integer

fillLookupTables()
</pre></div>
               <p>So how fast is it?</p>
               <div class="example"><a name="d0e35106"></a><h3 class="title">Example&nbsp;15.18.&nbsp;Output of <tt class="filename">romantest9.py</tt> against <tt class="filename">roman9.py</tt></h3><pre class="screen">
<span class="computeroutput">
.............
----------------------------------------------------------------------
Ran 13 tests in 0.791s

OK
</span>
</pre></div>
               <p>Remember, the best performance you ever got in the original version was 13 tests in 3.315 seconds.  Of course, it's not entirely
                  a fair comparison, because this version will take longer to import (when it fills the lookup tables).  But since import is
                  only done once, this is negligible in the long run.
               </p>
               <p>The moral of the story?</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Simplicity is a virtue.</li>
                     <li>Especially when regular expressions are involved.</li>
                     <li>And unit tests can give you the confidence to do large-scale refactoring... even if you didn't write the original code.</li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="roman.summary"></a>15.5.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Unit testing is a powerful concept which, if properly implemented, can both reduce maintenance costs and increase flexibility
                     in any long-term project.  It is also important to understand that unit testing is not a panacea, a Magic Problem Solver,
                     or a silver bullet.  Writing good test cases is hard, and keeping them up to date takes discipline (especially when customers
                     are screaming for critical bug fixes).  Unit testing is not a replacement for other forms of testing, including functional
                     testing, integration testing, and user acceptance testing.  But it is feasible, and it does work, and once you've seen it
                     work, you'll wonder how you ever got along without it.
                  </p>
               </div>
               <p>This chapter covered a lot of ground, and much of it wasn't even <span class="application">Python</span>-specific.  There are unit testing frameworks for many languages, all of which require you to understand the same basic concepts:
               </p>
               <div class="highlights">
                  <div class="itemizedlist">
                     <ul>
                        <li>Designing test cases that are specific, automated, and independent</li>
                        <li>Writing test cases <span class="emphasis"><em>before</em></span> the code they are testing
                        </li>
                        <li>Writing tests that <a href="#roman.success" title="13.4.&nbsp;Testing for success">test good input</a> and check for proper results
                        </li>
                        <li>Writing tests that <a href="#roman.failure" title="13.5.&nbsp;Testing for failure">test bad input</a> and check for proper failures
                        </li>
                        <li>Writing and updating test cases to <a href="#roman.bugs" title="15.1.&nbsp;Handling bugs">illustrate bugs</a> or <a href="#roman.change" title="15.2.&nbsp;Handling changing requirements">reflect new requirements</a></li>
                        <li><a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">Refactoring</a> mercilessly to improve performance, scalability, readability, maintainability, or whatever other -ility you're lacking
                        </li>
                     </ul>
                  </div>
               </div>
               <p>Additionally, you should be comfortable doing all of the following <span class="application">Python</span>-specific things:
               </p>
               <div class="highlights">
                  <div class="itemizedlist">
                     <ul>
                        <li><a href="#roman.testtoromanknownvalues.example" title="Example&nbsp;13.2.&nbsp;testToRomanKnownValues">Subclassing <tt class="literal">unittest.TestCase</tt></a> and writing methods for individual test cases
                        </li>
                        <li>Using <a href="#roman.testtoromanknownvalues.example" title="Example&nbsp;13.2.&nbsp;testToRomanKnownValues"><tt class="function">assertEqual</tt></a> to check that a function returns a known value
                        </li>
                        <li>Using <a href="#roman.tobadinput.example" title="Example&nbsp;13.3.&nbsp;Testing bad input to toRoman"><tt class="function">assertRaises</tt></a> to check that a function raises a known exception
                        </li>
                        <li>Calling <a href="#roman.stage1.output" title="Example&nbsp;14.2.&nbsp;Output of romantest1.py against roman1.py"><tt class="literal">unittest.main()</tt></a> in your <tt class="literal">if __name__</tt> clause to run all your test cases at once
                        </li>
                        <li>Running unit tests in <a href="#roman.stage1.output" title="Example&nbsp;14.2.&nbsp;Output of romantest1.py against roman1.py">verbose</a> or <a href="#roman.stage8.1.output" title="Example&nbsp;15.12.&nbsp;Output of romantest81.py against roman81.py">regular</a> mode
                        </li>
                     </ul>
                  </div>
               </div>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li><a href="http://www.xprogramming.com/">XProgramming.com</a> has links to <a href="http://www.xprogramming.com/software.htm">download unit testing frameworks</a> for many different languages.
                     </li>
                  </ul>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="regression"></a>Chapter&nbsp;16.&nbsp;Functional Programming
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.divein"></a>16.1.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>In <a href="#roman" title="Chapter&nbsp;13.&nbsp;Unit Testing">Chapter&nbsp;13, <i>Unit Testing</i></a>, you learned about the philosophy of unit testing.  In <a href="#roman1.5" title="Chapter&nbsp;14.&nbsp;Test-First Programming">Chapter&nbsp;14, <i>Test-First Programming</i></a>, you stepped through the implementation of basic unit tests in <span class="application">Python</span>.  In <a href="#roman2" title="Chapter&nbsp;15.&nbsp;Refactoring">Chapter&nbsp;15, <i>Refactoring</i></a>, you saw how unit testing makes large-scale refactoring easier.  This chapter will build on those sample programs, but here
                     we will focus more on advanced <span class="application">Python</span>-specific techniques, rather than on unit testing itself.
                  </p>
               </div>
               <p>The following is a complete <span class="application">Python</span> program that acts as a cheap and simple regression testing framework.  It takes unit tests that you've written for individual
                  modules, collects them all into one big test suite, and runs them all at once.  I actually use this script as part of the
                  build process for this book; I have unit tests for several of the example programs (not just the <tt class="filename">roman.py</tt> module featured in <a href="#roman" title="Chapter&nbsp;13.&nbsp;Unit Testing">Chapter&nbsp;13, <i>Unit Testing</i></a>), and the first thing my automated build script does is run this program to make sure all my examples still work.  If this
                  regression test fails, the build immediately stops.  I don't want to release non-working examples any more than you want to
                  download them and sit around scratching your head and yelling at your monitor and wondering why they don't work.
               </p>
               <div class="example"><a name="d0e35275"></a><h3 class="title">Example&nbsp;16.1.&nbsp;<tt class="filename">regression.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
"""Regression testing framework

This module will search for scripts in the same directory named
XYZtest.py.  Each such script should be a test suite that tests a
module through PyUnit.  (As of Python 2.1, PyUnit is included in
the standard library as "unittest".)  This script will aggregate all
found test suites into one big test suite and run them all at once.
"""

import sys, os, re, unittest

def regressionTest():
    path = os.path.abspath(os.path.dirname(sys.argv[0]))   
    files = os.listdir(path)                               
    test = re.compile("test\.py$", re.IGNORECASE)          
    files = filter(test.search, files)                     
    filenameToModuleName = lambda f: os.path.splitext(f)[0]
    moduleNames = map(filenameToModuleName, files)         
    modules = map(__import__, moduleNames)                 
    load = unittest.defaultTestLoader.loadTestsFromModule  
    return unittest.TestSuite(map(load, modules))          

if __name__ == "__main__":                   
    unittest.main(defaultTest="regressionTest")
</pre></div>
               <p>Running this script in the same directory as the rest of the example scripts that come with this book will find all the unit
                  tests, named <tt class="filename"><i class="replaceable"><tt>module</tt></i>test.py</tt>, run them as a single test, and pass or fail them all at once.
               </p>
               <div class="example"><a name="d0e35293"></a><h3 class="title">Example&nbsp;16.2.&nbsp;Sample output of <tt class="filename">regression.py</tt></h3><pre class="screen">
<tt class="prompt">[you@localhost py]$ </tt><span class="userinput">python regression.py -v</span>
<span class="computeroutput">help should fail with no object ... ok                             </span><a name="regression.divein.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"><span class="computeroutput">
help should return known result for apihelper ... ok
help should honor collapse argument ... ok
help should honor spacing argument ... ok
buildConnectionString should fail with list input ... ok           </span><a name="regression.divein.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"><span class="computeroutput">
buildConnectionString should fail with string input ... ok
buildConnectionString should fail with tuple input ... ok
buildConnectionString handles empty dictionary ... ok
buildConnectionString returns known result with known input ... ok
fromRoman should only accept uppercase input ... ok                </span><a name="regression.divein.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"><span class="computeroutput">
toRoman should always return uppercase ... ok
fromRoman should fail with blank string ... ok
fromRoman should fail with malformed antecedents ... ok
fromRoman should fail with repeated pairs of numerals ... ok
fromRoman should fail with too many repeated numerals ... ok
fromRoman should give known result with known input ... ok
toRoman should give known result with known input ... ok
fromRoman(toRoman(n))==n for all n ... ok
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok
kgp a ref test ... ok
kgp b ref test ... ok
kgp c ref test ... ok
kgp d ref test ... ok
kgp e ref test ... ok
kgp f ref test ... ok
kgp g ref test ... ok

----------------------------------------------------------------------
Ran 29 tests in 2.799s

OK</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.divein.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first 5 tests are from <tt class="filename">apihelpertest.py</tt>, which tests the example script from <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.divein.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The next 5 tests are from <tt class="filename">odbchelpertest.py</tt>, which tests the example script from <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.divein.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The rest are from <tt class="filename">romantest.py</tt>, which you studied in depth in <a href="#roman" title="Chapter&nbsp;13.&nbsp;Unit Testing">Chapter&nbsp;13, <i>Unit Testing</i></a>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.path"></a>16.2.&nbsp;Finding the path
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>When running <span class="application">Python</span> scripts from the command line, it is sometimes useful to know where the currently running script is located on disk.
                  </p>
               </div>
               <p>This is one of those obscure little tricks that is virtually impossible to figure out on your own, but simple to remember
                  once you see it.  The key to it is <tt class="literal">sys.argv</tt>.  As you saw in <a href="#kgp" title="Chapter&nbsp;9.&nbsp;XML Processing">Chapter&nbsp;9, <i>XML Processing</i></a>, this is a list that holds the list of command-line arguments.  However, it also holds the name of the running script, exactly
                  as it was called from the command line, and this is enough information to determine its location.
               </p>
               <div class="example"><a name="d0e35359"></a><h3 class="title">Example&nbsp;16.3.&nbsp;<tt class="filename">fullpath.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
import sys, os

print 'sys.argv[0] =', sys.argv[0]             <a name="regression.path.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
pathname = os.path.dirname(sys.argv[0])        <a name="regression.path.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
print 'path =', pathname
print 'full path =', os.path.abspath(pathname) <a name="regression.path.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Regardless of how you run a script, <tt class="literal">sys.argv[0]</tt> will always contain the name of the script, exactly as it appears on the command line.  This may or may not include any path
                              information, as you'll see shortly.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">os.path.dirname</tt> takes a filename as a string and returns the directory path portion.  If the given filename does not include any path information,
                              <tt class="function">os.path.dirname</tt> returns an empty string.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">os.path.abspath</tt> is the key here.  It takes a pathname, which can be partial or even blank, and returns a fully qualified pathname.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p><tt class="function">os.path.abspath</tt> deserves further explanation.  It is very flexible; it can take any kind of pathname.
               </p>
               <div class="example"><a name="d0e35399"></a><h3 class="title">Example&nbsp;16.4.&nbsp;Further explanation of <tt class="function">os.path.abspath</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import os</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.getcwd()</span>                        <a name="regression.path.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">/home/you</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.abspath('')</span>                <a name="regression.path.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">/home/you</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.abspath('.ssh')</span>            <a name="regression.path.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">/home/you/.ssh</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.abspath('/home/you/.ssh')</span> <a name="regression.path.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">/home/you/.ssh</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os.path.abspath('.ssh/../foo/')</span>    <a name="regression.path.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">/home/you/foo</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">os.getcwd()</tt> returns the current working directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Calling <tt class="function">os.path.abspath</tt> with an empty string returns the current working directory, same as <tt class="function">os.getcwd()</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Calling <tt class="function">os.path.abspath</tt> with a partial pathname constructs a fully qualified pathname out of it, based on the current working directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Calling <tt class="function">os.path.abspath</tt> with a full pathname simply returns it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">os.path.abspath</tt> also <span class="emphasis"><em>normalizes</em></span> the pathname it returns.  Note that this example worked even though I don't actually have a 'foo' directory.  <tt class="function">os.path.abspath</tt> never checks your actual disk; this is all just string manipulation.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="os.path.abspath.exist.note"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">The pathnames and filenames you pass to <tt class="function">os.path.abspath</tt> do not need to exist.
                     </td>
                  </tr>
               </table><a name="os.path.normpath.note"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%"><tt class="function">os.path.abspath</tt> not only constructs full path names, it also normalizes them.  That means that if you are in the <tt class="filename">/usr/</tt> directory, <tt class="literal">os.path.abspath('bin/../local/bin')</tt> will return <tt class="filename">/usr/local/bin</tt>.  It normalizes the path by making it as simple as possible.  If you just want to normalize a pathname like this without
                        turning it into a full pathname, use <tt class="function">os.path.normpath</tt> instead.
                     </td>
                  </tr>
               </table>
               <div class="example"><a name="d0e35527"></a><h3 class="title">Example&nbsp;16.5.&nbsp;Sample output from <tt class="filename">fullpath.py</tt></h3><pre class="screen">
<tt class="prompt">[you@localhost py]$ </tt><span class="userinput">python /home/you/diveintopython/common/py/fullpath.py</span> <a name="regression.path.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">sys.argv[0] = /home/you/diveintopython/common/py/fullpath.py
path = /home/you/diveintopython/common/py
full path = /home/you/diveintopython/common/py</span>
<tt class="prompt">[you@localhost diveintopython]$ </tt><span class="userinput">python common/py/fullpath.py</span>               <a name="regression.path.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">sys.argv[0] = common/py/fullpath.py
path = common/py
full path = /home/you/diveintopython/common/py</span>
<tt class="prompt">[you@localhost diveintopython]$ </tt><span class="userinput">cd common/py</span>
<tt class="prompt">[you@localhost py]$ </tt><span class="userinput">python fullpath.py</span>                                     <a name="regression.path.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">sys.argv[0] = fullpath.py
path = 
full path = /home/you/diveintopython/common/py</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">In the first case, <tt class="literal">sys.argv[0]</tt> includes the full path of the script.  You can then use the <tt class="function">os.path.dirname</tt> function to strip off the script name and return the full directory name, and <tt class="function">os.path.abspath</tt> simply returns what you give it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If the script is run by using a partial pathname, <tt class="literal">sys.argv[0]</tt> will still contain exactly what appears on the command line.  <tt class="function">os.path.dirname</tt> will then give you a partial pathname (relative to the current directory), and <tt class="function">os.path.abspath</tt> will construct a full pathname from the partial pathname.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If the script is run from the current directory without giving any path, <tt class="function">os.path.dirname</tt> will simply return an empty string.  Given an empty string, <tt class="function">os.path.abspath</tt> returns the current directory, which is what you want, since the script was run from the current directory.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="os.path.abspath.crossplatform.note"></a><table class="note" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">Like the other functions in the <tt class="filename">os</tt> and <tt class="filename">os.path</tt> modules, <tt class="function">os.path.abspath</tt> is cross-platform.  Your results will look slightly different than my examples if you're running on Windows (which uses backslash
                        as a path separator) or <span class="abbrev">Mac</span> <span class="acronym">OS</span> (which uses colons), but they'll still work.  That's the whole point of the <tt class="filename">os</tt> module.
                     </td>
                  </tr>
               </table>
               <p><b>Addendum.&nbsp;</b>One reader was dissatisfied with this solution, and wanted to be able to run all the unit tests in the current directory,
                  not the directory where <tt class="filename">regression.py</tt> is located.  He suggests this approach instead:
               </p>
               <div class="example"><a name="regression.path.cwd.example"></a><h3 class="title">Example&nbsp;16.6.&nbsp;Running scripts in the current directory</h3><pre class="programlisting">import sys, os, re, unittest

def regressionTest():
    path = os.getcwd()       <a name="regression.path.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    sys.path.append(path)    <a name="regression.path.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    files = os.listdir(path) <a name="regression.path.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Instead of setting <tt class="varname">path</tt> to the directory where the currently running script is located, you set it to the current working directory instead.  This
                              will be whatever directory you were in before you ran the script, which is not necessarily the same as the directory the script
                              is in. (Read that sentence a few times until you get it.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Append this directory to the <span class="application">Python</span> library search path, so that when you dynamically import the unit test modules later, <span class="application">Python</span> can find them.  You didn't need to do this when <tt class="varname">path</tt> was the directory of the currently running script, because <span class="application">Python</span> always looks in that directory.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.path.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The rest of the function is the same.</td>
                        </tr>
                     </table>
                  </div>
                  <p>This technique will allow you to re-use this <tt class="filename">regression.py</tt> script on multiple projects.  Just put the script in a common directory, then change to the project's directory before running
                     it.  All of that project's unit tests will be found and tested, instead of the unit tests in the common directory where <tt class="filename">regression.py</tt> is located.
                  </p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.filter"></a>16.3.&nbsp;Filtering lists revisited
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You're already familiar with <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">using list comprehensions to filter lists</a>.  There is another way to accomplish this same thing, which some people feel is more expressive.
                  </p>
               </div>
               <p><span class="application">Python</span> has a built-in <tt class="function">filter</tt> function which takes two arguments, a function and a list, and returns a list.<sup>[<a name="d0e35697" href="#ftn.d0e35697">7</a>]</sup>  The function passed as the first argument to <tt class="function">filter</tt> must itself take one argument, and the list that <tt class="function">filter</tt> returns will contain all the elements from the list passed to <tt class="function">filter</tt> for which the function passed to <tt class="function">filter</tt> returns true.
               </p>
               <p>Got all that?  It's not as difficult as it sounds.</p>
               <div class="example"><a name="d0e35724"></a><h3 class="title">Example&nbsp;16.7.&nbsp;Introducing <tt class="function">filter</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def odd(n):</span>                 <a name="regression.filter.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">return n % 2</span>
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = [1, 2, 3, 5, 9, 10, 256, -3]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filter(odd, li)</span>             <a name="regression.filter.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">[1, 3, 5, 9, -3]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[e for e in li if odd(e)]</span>   <a name="regression.filter.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filteredList = []</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for n in li:</span>                <a name="regression.filter.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">if odd(n):</span>
<tt class="prompt">...     </tt><span class="userinput">    filteredList.append(n)</span>
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filteredList</span>
<span class="computeroutput">[1, 3, 5, 9, -3]</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">odd</tt> uses the built-in mod function &#8220;<span class="quote"><tt class="literal">%</tt></span>&#8221; to return <tt class="constant">True</tt> if <tt class="varname">n</tt> is odd and <tt class="constant">False</tt> if <tt class="varname">n</tt> is even.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">filter</tt> takes two arguments, a function (<tt class="function">odd</tt>) and a list (<tt class="varname">li</tt>).  It loops through the list and calls <tt class="function">odd</tt> with each element.  If <tt class="function">odd</tt> returns a true value (remember, any non-zero value is true in <span class="application">Python</span>), then the element is included in the returned list, otherwise it is filtered out.  The result is a list of only the odd
                              numbers from the original list, in the same order as they appeared in the original.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You could accomplish the same thing using list comprehensions, as you saw in <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">Section&nbsp;4.5, &#8220;Filtering Lists&#8221;</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You could also accomplish the same thing with a <tt class="literal">for</tt> loop.  Depending on your programming background, this may seem more &#8220;<span class="quote">straightforward</span>&#8221;, but functions like <tt class="function">filter</tt> are much more expressive.  Not only is it easier to write, it's easier to read, too.  Reading the <tt class="literal">for</tt> loop is like standing too close to a painting; you see all the details, but it may take a few seconds to be able to step
                              back and see the bigger picture: &#8220;<span class="quote">Oh, you're just filtering the list!</span>&#8221;
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e35864"></a><h3 class="title">Example&nbsp;16.8.&nbsp;<tt class="function">filter</tt> in <tt class="filename">regression.py</tt></h3><pre class="programlisting">
    files = os.listdir(path)                                <a name="regression.filter.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    test = re.compile("test\.py$", re.IGNORECASE)           <a name="regression.filter.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    files = filter(test.search, files)                      <a name="regression.filter.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#regression.path" title="16.2.&nbsp;Finding the path">Section&nbsp;16.2, &#8220;Finding the path&#8221;</a>, <tt class="varname">path</tt> may contain the full or partial pathname of the directory of the currently running script, or it may contain an empty string
                              if the script is being run from the current directory.  Either way, <tt class="varname">files</tt> will end up with the names of the files in the same directory as this script you're running.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is a compiled regular expression.  As you saw in <a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">Section&nbsp;15.3, &#8220;Refactoring&#8221;</a>, if you're going to use the same regular expression over and over, you should compile it for faster performance.  The compiled
                              object has a <tt class="function">search</tt> method which takes a single argument, the string to search.  If the regular expression matches the string, the <tt class="function">search</tt> method returns a <tt class="classname">Match</tt> object containing information about the regular expression match; otherwise it returns <tt class="literal">None</tt>, the <span class="application">Python</span> null value.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">For each element in the <tt class="varname">files</tt> list, you're going to call the <tt class="function">search</tt> method of the compiled regular expression object, <tt class="varname">test</tt>.  If the regular expression matches, the method will return a <tt class="classname">Match</tt> object, which <span class="application">Python</span> considers to be true, so the element will be included in the list returned by <tt class="function">filter</tt>.  If the regular expression does not match, the <tt class="function">search</tt> method will return <tt class="literal">None</tt>, which <span class="application">Python</span> considers to be false, so the element will not be included.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p><b>Historical note.&nbsp;</b>Versions of <span class="application">Python</span> prior to 2.0 did not have <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehensions</a>, so you couldn't <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">filter using list comprehensions</a>; the <tt class="function">filter</tt> function was the only game in town.  Even with the introduction of list comprehensions in 2.0, some people still prefer the
                  old-style <tt class="function">filter</tt> (and its companion function, <tt class="function">map</tt>, which you'll see later in this chapter).  Both techniques work at the moment, so which one you use is a matter of style.
                  There is discussion that <tt class="function">map</tt> and <tt class="function">filter</tt> might be deprecated in a future version of <span class="application">Python</span>, but no decision has been made.
               </p>
               <div class="example"><a name="d0e35972"></a><h3 class="title">Example&nbsp;16.9.&nbsp;Filtering using list comprehensions instead</h3><pre class="programlisting">
    files = os.listdir(path)                               
    test = re.compile("test\.py$", re.IGNORECASE)          
    files = [f for f in files if test.search(f)] <a name="regression.filter.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.filter.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This will accomplish exactly the same result as using the <tt class="function">filter</tt> function.  Which way is more expressive?  That's up to you.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.map"></a>16.4.&nbsp;Mapping lists revisited
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You're already familiar with using <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehensions</a> to map one list into another.  There is another way to accomplish the same thing, using the built-in <tt class="function">map</tt> function.  It works much the same way as the <a href="#regression.filter" title="16.3.&nbsp;Filtering lists revisited"><tt class="function">filter</tt></a> function.
                  </p>
               </div>
               <div class="example"><a name="d0e36003"></a><h3 class="title">Example&nbsp;16.10.&nbsp;Introducing <tt class="function">map</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def double(n):</span>
<tt class="prompt">...     </tt>return n*2
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = [1, 2, 3, 5, 9, 10, 256, -3]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">map(double, li)</span>                       <a name="regression.map.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[2, 4, 6, 10, 18, 20, 512, -6]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">[double(n) for n in li]</span>               <a name="regression.map.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">[2, 4, 6, 10, 18, 20, 512, -6]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">newlist = []</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for n in li:</span>                          <a name="regression.map.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">newlist.append(double(n))</span>
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">newlist</span>
<span class="computeroutput">[2, 4, 6, 10, 18, 20, 512, -6]</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.map.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">map</tt> takes a function and a list<sup>[<a name="d0e36079" href="#ftn.d0e36079">8</a>]</sup> and returns a new list by calling the function with each element of the list in order.  In this case, the function simply
                              multiplies each element by 2.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.map.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You could accomplish the same thing with a list comprehension.  List comprehensions were first introduced in <span class="application">Python</span> 2.0; <tt class="function">map</tt> has been around forever.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.map.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You could, if you insist on thinking like a <span class="application">Visual Basic</span> programmer, use a <tt class="literal">for</tt> loop to accomplish the same thing.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e36107"></a><h3 class="title">Example&nbsp;16.11.&nbsp;<tt class="function">map</tt> with lists of mixed datatypes
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">li = [5, 'a', (2, 'b')]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">map(double, li)</span>                       <a name="regression.map.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[10, 'aa', (2, 'b', 2, 'b')]</span></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.map.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As a side note, I'd like to point out that <tt class="function">map</tt> works just as well with lists of mixed datatypes, as long as the function you're using correctly handles each type.  In this
                              case, the <tt class="function">double</tt> function simply multiplies the given argument by 2, and <span class="application">Python</span> Does The Right Thing depending on the datatype of the argument.  For integers, this means actually multiplying it by 2; for
                              strings, it means concatenating the string with itself; for tuples, it means making a new tuple that has all of the elements
                              of the original, then all of the elements of the original again.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>All right, enough play time.  Let's look at some real code.</p>
               <div class="example"><a name="d0e36143"></a><h3 class="title">Example&nbsp;16.12.&nbsp;<tt class="function">map</tt> in <tt class="filename">regression.py</tt></h3><pre class="programlisting">
    filenameToModuleName = lambda f: os.path.splitext(f)[0] <a name="regression.map.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    moduleNames = map(filenameToModuleName, files)          <a name="regression.map.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.map.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions">Section&nbsp;4.7, &#8220;Using lambda Functions&#8221;</a>, <tt class="literal">lambda</tt> defines an inline function.  And as you saw in <a href="#splittingpathnames.example" title="Example&nbsp;6.17.&nbsp;Splitting Pathnames">Example&nbsp;6.17, &#8220;Splitting Pathnames&#8221;</a>, <tt class="function">os.path.splitext</tt> takes a filename and returns a tuple <tt class="literal">(<i class="replaceable">name</i>, <i class="replaceable">extension</i>)</tt>.  So <tt class="function">filenameToModuleName</tt> is a function which will take a filename and strip off the file extension, and return just the name.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.map.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Calling <tt class="function">map</tt> takes each filename listed in <tt class="varname">files</tt>, passes it to the function <tt class="function">filenameToModuleName</tt>, and returns a list of the return values of each of those function calls.  In other words, you strip the file extension off
                              of each filename, and store the list of all those stripped filenames in <tt class="varname">moduleNames</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>As you'll see in the rest of the chapter, you can extend this type of data-centric thinking all the way to the final goal,
                  which is to define and execute a single test suite that contains the tests from all of those individual test suites.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.datacentric"></a>16.5.&nbsp;Data-centric programming
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>By now you're probably scratching your head wondering why this is better than using <tt class="literal">for</tt> loops and straight function calls.  And that's a perfectly valid question.  Mostly, it's a matter of perspective.  Using
                     <tt class="function">map</tt> and <tt class="function">filter</tt> forces you to center your thinking around your data.
                  </p>
               </div>
               <p>In this case, you started with no data at all; the first thing you did was <a href="#regression.path" title="16.2.&nbsp;Finding the path">get the directory path</a> of the current script, and got a list of files in that directory.  That was the bootstrap, and it gave you real data to work
                  with: a list of filenames.
               </p>
               <p>However, you knew you didn't care about all of those files, only the ones that were actually test suites.  You had <span class="emphasis"><em>too much data</em></span>, so you needed to <tt class="function">filter</tt> it.  How did you know which data to keep?  You needed a test to decide, so you defined one and passed it to the <tt class="function">filter</tt> function.  In this case you used a regular expression to decide, but the concept would be the same regardless of how you
                  constructed the test.
               </p>
               <p>Now you had the filenames of each of the test suites (and only the test suites, since everything else had been filtered out),
                  but you really wanted module names instead.  You had the right amount of data, but it was <span class="emphasis"><em>in the wrong format</em></span>.  So you defined a function that would transform a single filename into a module name, and you mapped that function onto
                  the entire list.  From one filename, you can get a module name; from a list of filenames, you can get a list of module names.
               </p>
               <p>Instead of <tt class="function">filter</tt>, you could have used a <tt class="literal">for</tt> loop with an <tt class="literal">if</tt> statement.  Instead of <tt class="function">map</tt>, you could have used a <tt class="literal">for</tt> loop with a function call.  But using <tt class="literal">for</tt> loops like that is busywork.  At best, it simply wastes time; at worst, it introduces obscure bugs.  For instance, you need
                  to figure out how to test for the condition &#8220;<span class="quote">is this file a test suite?</span>&#8221; anyway; that's the application-specific logic, and no language can write that for us.  But once you've figured that out,
                  do you really want go to all the trouble of defining a new empty list and writing a <tt class="literal">for</tt> loop and an <tt class="literal">if</tt> statement and manually calling <tt class="function">append</tt> to add each element to the new list if it passes the condition and then keeping track of which variable holds the new filtered
                  data and which one holds the old unfiltered data?  Why not just define the test condition, then let <span class="application">Python</span> do the rest of that work for us?
               </p>
               <p>Oh sure, you could try to be fancy and delete elements in place without creating a new list.  But you've been burned by that
                  before.  Trying to modify a data structure that you're looping through can be tricky.  You delete an element, then loop to
                  the next element, and suddenly you've skipped one.  Is <span class="application">Python</span> one of the languages that works that way?  How long would it take you to figure it out?  Would you remember for certain whether
                  it was safe the next time you tried?  Programmers spend so much time and make so many mistakes dealing with purely technical
                  issues like this, and it's all pointless.  It doesn't advance your program at all; it's just busywork.
               </p>
               <p>I resisted list comprehensions when I first learned <span class="application">Python</span>, and I resisted <tt class="function">filter</tt> and <tt class="function">map</tt> even longer.  I insisted on making my life more difficult, sticking to the familiar way of <tt class="literal">for</tt> loops and <tt class="literal">if</tt> statements and step-by-step code-centric programming.  And my <span class="application">Python</span> programs looked a lot like <span class="application">Visual Basic</span> programs, detailing every step of every operation in every function.  And they had all the same types of little problems
                  and obscure bugs.  And it was all pointless.
               </p>
               <p>Let it all go.  Busywork code is not important.  Data is important.  And data is not difficult.  It's only data.  If you have
                  too much, filter it.  If it's not what you want, map it.  Focus on the data; leave the busywork behind.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.import"></a>16.6.&nbsp;Dynamically importing modules
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>OK, enough philosophizing.  Let's talk about dynamically importing modules.</p>
               </div>
               <p>First, let's look at how you normally import modules.  The <tt class="literal">import <i class="replaceable">module</i></tt> syntax looks in the search path for the named module and imports it by name.  You can even import multiple modules at once
                  this way, with a comma-separated list.  You did this on the very first line of this chapter's script.
               </p>
               <div class="example"><a name="d0e36316"></a><h3 class="title">Example&nbsp;16.13.&nbsp;Importing multiple modules at once</h3><pre class="programlisting">
import sys, os, re, unittest <a name="regression.import.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.import.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This imports four modules at once: <tt class="filename">sys</tt> (for system functions and access to the command line parameters), <tt class="filename">os</tt> (for operating system functions like directory listings), <tt class="filename">re</tt> (for regular expressions), and <tt class="filename">unittest</tt> (for unit testing).
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now let's do the same thing, but with dynamic imports.</p>
               <div class="example"><a name="d0e36341"></a><h3 class="title">Example&nbsp;16.14.&nbsp;Importing modules dynamically</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys = __import__('sys')</span>           <a name="regression.import.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os = __import__('os')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re = __import__('re')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">unittest = __import__('unittest')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys</span>                               <a name="regression.import.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="computeroutput">&lt;module 'sys' (built-in)&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">os</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="computeroutput">&lt;module 'os' from '/usr/local/lib/python2.2/os.pyc'&gt;</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.import.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The built-in <tt class="function">__import__</tt> function accomplishes the same goal as using the <tt class="literal">import</tt> statement, but it's an actual function, and it takes a string as an argument.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.import.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The variable <tt class="varname">sys</tt> is now the <tt class="filename">sys</tt> module, just as if you had said <tt class="literal">import sys</tt>.  The variable <tt class="varname">os</tt> is now the <tt class="filename">os</tt> module, and so forth.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So <tt class="function">__import__</tt> imports a module, but takes a string argument to do it.  In this case the module you imported was just a hard-coded string,
                  but it could just as easily be a variable, or the result of a function call.  And the variable that you assign the module
                  to doesn't need to match the module name, either.  You could import a series of modules and assign them to a list.
               </p>
               <div class="example"><a name="d0e36423"></a><h3 class="title">Example&nbsp;16.15.&nbsp;Importing a list of modules dynamically</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">moduleNames = ['sys', 'os', 're', 'unittest']</span> <a name="regression.import.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">moduleNames</span>
<span class="computeroutput">['sys', 'os', 're', 'unittest']</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">modules = map(__import__, moduleNames)</span>        <a name="regression.import.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">modules</span>                                       <a name="regression.import.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">[&lt;module 'sys' (built-in)&gt;,
&lt;module 'os' from 'c:\Python22\lib\os.pyc'&gt;,
&lt;module 're' from 'c:\Python22\lib\re.pyc'&gt;,
&lt;module 'unittest' from 'c:\Python22\lib\unittest.pyc'&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">modules[0].version</span>                            <a name="regression.import.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'2.2.2 (#37, Nov 26 2002, 10:24:37) [MSC 32 bit (Intel)]'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import sys</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">sys.version</span>
<span class="computeroutput">'2.2.2 (#37, Nov 26 2002, 10:24:37) [MSC 32 bit (Intel)]'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.import.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">moduleNames</tt> is just a list of strings.  Nothing fancy, except that the strings happen to be names of modules that you could import, if
                              you wanted to.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.import.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Surprise, you wanted to import them, and you did, by mapping the <tt class="function">__import__</tt> function onto the list.  Remember, this takes each element of the list (<tt class="varname">moduleNames</tt>) and calls the function (<tt class="function">__import__</tt>) over and over, once with each element of the list, builds a list of the return values, and returns the result.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.import.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">So now from a list of strings, you've created a list of actual modules.  (Your paths may be different, depending on your operating
                              system, where you installed Python, the phase of the moon, etc.)
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.import.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To drive home the point that these are real modules, let's look at some module attributes.  Remember, <tt class="varname">modules[0]</tt> <span class="emphasis"><em>is</em></span> the <tt class="filename">sys</tt> module, so <tt class="varname">modules[0].version</tt> <span class="emphasis"><em>is</em></span> <tt class="varname">sys.version</tt>.  All the other attributes and methods of these modules are also available.  There's nothing magic about the <tt class="literal">import</tt> statement, and there's nothing magic about modules.  Modules are objects.  Everything is an object.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now you should be able to put this all together and figure out what most of this chapter's code sample is doing.</p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.alltogether"></a>16.7.&nbsp;Putting it all together
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You've learned enough now to deconstruct the first seven lines of this chapter's code sample: reading a directory and importing
                     selected modules within it.
                  </p>
               </div>
               <div class="example"><a name="d0e36538"></a><h3 class="title">Example&nbsp;16.16.&nbsp;The <tt class="function">regressionTest</tt> function
                  </h3><pre class="programlisting">
def regressionTest():
    path = os.path.abspath(os.path.dirname(sys.argv[0]))   
    files = os.listdir(path)                               
    test = re.compile("test\.py$", re.IGNORECASE)          
    files = filter(test.search, files)                     
    filenameToModuleName = lambda f: os.path.splitext(f)[0]
    moduleNames = map(filenameToModuleName, files)         
    modules = map(__import__, moduleNames)                 
load = unittest.defaultTestLoader.loadTestsFromModule  
return unittest.TestSuite(map(load, modules))          
</pre></div>
               <p>Let's look at it line by line, interactively.  Assume that the current directory is <tt class="filename">c:\diveintopython\py</tt>, which contains the examples that come with this book, including this chapter's script.  As you saw in <a href="#regression.path" title="16.2.&nbsp;Finding the path">Section&nbsp;16.2, &#8220;Finding the path&#8221;</a>, the script directory will end up in the <tt class="varname">path</tt> variable, so let's start hard-code that and go from there.
               </p>
               <div class="example"><a name="d0e36556"></a><h3 class="title">Example&nbsp;16.17.&nbsp;Step 1: Get all the files</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import sys, os, re, unittest</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">path = r'c:\diveintopython\py'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">files = os.listdir(path)                               </span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">files</span> <a name="regression.alltogether.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">['BaseHTMLProcessor.py', 'LICENSE.txt', 'apihelper.py', 'apihelpertest.py',
'argecho.py', 'autosize.py', 'builddialectexamples.py', 'dialect.py',
'fileinfo.py', 'fullpath.py', 'kgptest.py', 'makerealworddoc.py',
'odbchelper.py', 'odbchelpertest.py', 'parsephone.py', 'piglatin.py',
'plural.py', 'pluraltest.py', 'pyfontify.py', 'regression.py', 'roman.py', 'romantest.py',
'uncurly.py', 'unicode2koi8r.py', 'urllister.py', 'kgp', 'plural', 'roman',
'colorize.py']</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">files</tt> is a list of all the files and directories in the script's directory.  (If you've been running some of the examples already,
                              you may also see some <tt class="filename">.pyc</tt> files in there as well.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e36595"></a><h3 class="title">Example&nbsp;16.18.&nbsp;Step 2: Filter to find the files you care about</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">test = re.compile("test\.py$", re.IGNORECASE)          </span> <a name="regression.alltogether.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">files = filter(test.search, files)                     </span> <a name="regression.alltogether.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">files</span>                                                   <a name="regression.alltogether.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">['apihelpertest.py', 'kgptest.py', 'odbchelpertest.py', 'pluraltest.py', 'romantest.py']</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This regular expression will match any string that ends with <tt class="literal">test.py</tt>.  Note that you need to escape the period, since a period in a regular expression usually means &#8220;<span class="quote">match any single character</span>&#8221;, but you actually want to match a literal period instead.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The compiled regular expression acts like a function, so you can use it to filter the large list of files and directories,
                              to find the ones that match the regular expression.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">And you're left with the list of unit testing scripts, because they were the only ones named <tt class="filename">SOMETHINGtest.py</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e36643"></a><h3 class="title">Example&nbsp;16.19.&nbsp;Step 3: Map filenames to module names</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filenameToModuleName = lambda f: os.path.splitext(f)[0]</span> <a name="regression.alltogether.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filenameToModuleName('romantest.py')</span>                    <a name="regression.alltogether.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'romantest'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">filenameToModuleName('odchelpertest.py')</span>
<span class="computeroutput">'odbchelpertest'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">moduleNames = map(filenameToModuleName, files)         </span> <a name="regression.alltogether.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">moduleNames</span>                                             <a name="regression.alltogether.3.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">['apihelpertest', 'kgptest', 'odbchelpertest', 'pluraltest', 'romantest']</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions">Section&nbsp;4.7, &#8220;Using lambda Functions&#8221;</a>, <tt class="literal">lambda</tt> is a quick-and-dirty way of creating an inline, one-line function.  This one takes a filename with an extension and returns
                              just the filename part, using the standard library function <tt class="function">os.path.splitext</tt> that you saw in <a href="#splittingpathnames.example" title="Example&nbsp;6.17.&nbsp;Splitting Pathnames">Example&nbsp;6.17, &#8220;Splitting Pathnames&#8221;</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">filenameToModuleName</tt> is a function.  There's nothing magic about <tt class="literal">lambda</tt> functions as opposed to regular functions that you define with a <tt class="literal">def</tt> statement.  You can call the <tt class="varname">filenameToModuleName</tt> function like any other, and it does just what you wanted it to do: strips the file extension off of its argument.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Now you can apply this function to each file in the list of unit test files, using <tt class="function">map</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.3.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">And the result is just what you wanted: a list of modules, as strings.</td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e36727"></a><h3 class="title">Example&nbsp;16.20.&nbsp;Step 4: Mapping module names to modules</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">modules = map(__import__, moduleNames)                 </span> <a name="regression.alltogether.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">modules</span>                                                 <a name="regression.alltogether.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">[&lt;module 'apihelpertest' from 'apihelpertest.py'&gt;,
&lt;module 'kgptest' from 'kgptest.py'&gt;,
&lt;module 'odbchelpertest' from 'odbchelpertest.py'&gt;,
&lt;module 'pluraltest' from 'pluraltest.py'&gt;,
&lt;module 'romantest' from 'romantest.py'&gt;]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">modules[-1]</span>                                             <a name="regression.alltogether.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;module 'romantest' from 'romantest.py'&gt;</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw in <a href="#regression.import" title="16.6.&nbsp;Dynamically importing modules">Section&nbsp;16.6, &#8220;Dynamically importing modules&#8221;</a>, you can use a combination of <tt class="function">map</tt> and <tt class="function">__import__</tt> to map a list of module names (as strings) into actual modules (which you can call or access like any other module).
                              
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">modules</tt> is now a list of modules, fully accessible like any other module.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The last module in the list <span class="emphasis"><em>is</em></span> the <tt class="filename">romantest</tt> module, just as if you had said <tt class="literal">import romantest</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e36788"></a><h3 class="title">Example&nbsp;16.21.&nbsp;Step 5: Loading the modules into a test suite</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">load = unittest.defaultTestLoader.loadTestsFromModule  </span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">map(load, modules)</span>                     <a name="regression.alltogether.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">[&lt;unittest.TestSuite tests=[
  &lt;unittest.TestSuite tests=[&lt;apihelpertest.BadInput testMethod=testNoObject&gt;]&gt;,
  &lt;unittest.TestSuite tests=[&lt;apihelpertest.KnownValues testMethod=testApiHelper&gt;]&gt;,
  &lt;unittest.TestSuite tests=[
    &lt;apihelpertest.ParamChecks testMethod=testCollapse&gt;, 
    &lt;apihelpertest.ParamChecks testMethod=testSpacing&gt;]&gt;, 
    ...
  ]
]</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">unittest.TestSuite(map(load, modules))</span> <a name="regression.alltogether.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">These are real module objects.  Not only can you access them like any other module, instantiate classes and call functions,
                              you can also introspect into the module to figure out which classes and functions it has in the first place.  That's what
                              the <tt class="function">loadTestsFromModule</tt> method does: it introspects into each module and returns a <tt class="literal">unittest.TestSuite</tt> object for each module.  Each <tt class="literal">TestSuite</tt> object actually contains a list of <tt class="literal">TestSuite</tt> objects, one for each <tt class="literal">TestCase</tt> class in your module, and each of those <tt class="literal">TestSuite</tt> objects contains a list of tests, one for each test method in your module.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#regression.alltogether.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Finally, you wrap the list of <tt class="literal">TestSuite</tt> objects into one big test suite.  The <tt class="filename">unittest</tt> module has no problem traversing this tree of nested test suites within test suites; eventually it gets down to an individual
                              test method and executes it, verifies that it passes or fails, and moves on to the next one.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>This introspection process is what the <tt class="filename">unittest</tt> module usually does for us.  Remember that magic-looking <tt class="literal">unittest.main()</tt> function that our individual test modules called to kick the whole thing off?  <tt class="function">unittest.main()</tt> actually creates an instance of <tt class="literal">unittest.TestProgram</tt>, which in turn creates an instance of a <tt class="literal">unittest.defaultTestLoader</tt> and loads it up with the module that called it.  (How does it get a reference to the module that called it if you don't give
                  it one?  By using the equally-magic <tt class="literal">__import__('__main__')</tt> command, which dynamically imports the currently-running module.  I could write a book on all the tricks and techniques used
                  in the <tt class="filename">unittest</tt> module, but then I'd never finish this one.)
               </p>
               <div class="example"><a name="d0e36869"></a><h3 class="title">Example&nbsp;16.22.&nbsp;Step 6: Telling <tt class="filename">unittest</tt> to use your test suite
                  </h3><pre class="programlisting">
if __name__ == "__main__":                   
    unittest.main(defaultTest="regressionTest") <a name="regression.alltogether.6.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre></div>
               <div class="calloutlist">
                  <table border="0" summary="Callout list">
                     <tr>
                        <td width="12" valign="top" align="left"><a href="#regression.alltogether.6.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                        </td>
                        <td valign="top" align="left">Instead of letting the <tt class="filename">unittest</tt> module do all its magic for us, you've done most of it yourself.  You've created a function (<tt class="function">regressionTest</tt>) that imports the modules yourself, calls <tt class="literal">unittest.defaultTestLoader</tt> yourself, and wraps it all up in a test suite.  Now all you need to do is tell <tt class="filename">unittest</tt> that, instead of looking for tests and building a test suite in the usual way, it should just call the <tt class="function">regressionTest</tt> function, which returns a ready-to-use <tt class="literal">TestSuite</tt>.
                        </td>
                     </tr>
                  </table>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="regression.summary"></a>16.8.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The <tt class="filename">regression.py</tt> program and its output should now make perfect sense.
                  </p>
               </div>
               <p>You should now feel comfortable doing all of these things:</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Manipulating <a href="#regression.path" title="16.2.&nbsp;Finding the path">path information</a> from the command line.
                     </li>
                     <li>Filtering lists <a href="#regression.filter" title="16.3.&nbsp;Filtering lists revisited">using <tt class="function">filter</tt></a> instead of list comprehensions.
                     </li>
                     <li>Mapping lists <a href="#regression.map" title="16.4.&nbsp;Mapping lists revisited">using <tt class="function">map</tt></a> instead of list comprehensions.
                     </li>
                     <li>Dynamically <a href="#regression.import" title="16.6.&nbsp;Dynamically importing modules">importing modules</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="footnotes"><br><hr width="100" align="left">
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e35697" href="#d0e35697">7</a>] </sup>Technically, the second argument to <tt class="function">filter</tt> can be any sequence, including lists, tuples, and custom classes that act like lists by defining the <tt class="function">__getitem__</tt> special method.  If possible, <tt class="function">filter</tt> will return the same datatype as you give it, so filtering a list returns a list, but filtering a tuple returns a tuple.
                  </p>
               </div>
               <div class="footnote">
                  <p><sup>[<a name="ftn.d0e36079" href="#d0e36079">8</a>] </sup>Again, I should point out that <tt class="function">map</tt> can take a list, a tuple, or any object that acts like a sequence.  See previous footnote about <tt class="function">filter</tt>.
                  </p>
               </div>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="plural"></a>Chapter&nbsp;17.&nbsp;Dynamic functions
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.divein"></a>17.1.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>I want to talk about plural nouns.  Also, functions that return other functions, advanced regular expressions, and generators.
                     Generators are new in <span class="application">Python</span> 2.3.  But first, let's talk about how to make plural nouns.
                  </p>
               </div>
               <p>If you haven't read <a href="#re" title="Chapter&nbsp;7.&nbsp;Regular Expressions">Chapter&nbsp;7, <i>Regular Expressions</i></a>, now would be a good time.  This chapter assumes you understand the basics of regular expressions, and quickly descends into
                  more advanced uses.
               </p>
               <p>English is a schizophrenic language that borrows from a lot of other languages, and the rules for making singular nouns into
                  plural nouns are varied and complex.  There are rules, and then there are exceptions to those rules, and then there are exceptions
                  to the exceptions.
               </p>
               <p>If you grew up in an English-speaking country or learned English in a formal school setting, you're probably familiar with
                  the basic rules:
               </p>
               <div class="orderedlist">
                  <ol type="1">
                     <li>If a word ends in S, X, or Z, add ES.  &#8220;<span class="quote">Bass</span>&#8221; becomes &#8220;<span class="quote">basses</span>&#8221;, &#8220;<span class="quote">fax</span>&#8221; becomes &#8220;<span class="quote">faxes</span>&#8221;, and &#8220;<span class="quote">waltz</span>&#8221; becomes &#8220;<span class="quote">waltzes</span>&#8221;.
                     </li>
                     <li>If a word ends in a noisy H, add ES; if it ends in a silent H, just add S.  What's a noisy H?  One that gets combined with
                        other letters to make a sound that you can hear.  So &#8220;<span class="quote">coach</span>&#8221; becomes &#8220;<span class="quote">coaches</span>&#8221; and &#8220;<span class="quote">rash</span>&#8221; becomes &#8220;<span class="quote">rashes</span>&#8221;, because you can hear the CH and SH sounds when you say them.  But &#8220;<span class="quote">cheetah</span>&#8221; becomes &#8220;<span class="quote">cheetahs</span>&#8221;, because the H is silent.
                     </li>
                     <li>If a word ends in Y that sounds like I, change the Y to IES; if the Y is combined with a vowel to sound like something else,
                        just add S.  So &#8220;<span class="quote">vacancy</span>&#8221; becomes &#8220;<span class="quote">vacancies</span>&#8221;, but &#8220;<span class="quote">day</span>&#8221; becomes &#8220;<span class="quote">days</span>&#8221;.
                     </li>
                     <li>If all else fails, just add S and hope for the best.</li>
                  </ol>
               </div>
               <p>(I know, there are a lot of exceptions.  &#8220;<span class="quote">Man</span>&#8221; becomes &#8220;<span class="quote">men</span>&#8221; and &#8220;<span class="quote">woman</span>&#8221; becomes &#8220;<span class="quote">women</span>&#8221;, but &#8220;<span class="quote">human</span>&#8221; becomes &#8220;<span class="quote">humans</span>&#8221;.  &#8220;<span class="quote">Mouse</span>&#8221; becomes &#8220;<span class="quote">mice</span>&#8221; and &#8220;<span class="quote">louse</span>&#8221; becomes &#8220;<span class="quote">lice</span>&#8221;, but &#8220;<span class="quote">house</span>&#8221; becomes &#8220;<span class="quote">houses</span>&#8221;.  &#8220;<span class="quote">Knife</span>&#8221; becomes &#8220;<span class="quote">knives</span>&#8221; and &#8220;<span class="quote">wife</span>&#8221; becomes &#8220;<span class="quote">wives</span>&#8221;, but &#8220;<span class="quote">lowlife</span>&#8221; becomes &#8220;<span class="quote">lowlifes</span>&#8221;.  And don't even get me started on words that are their own plural, like &#8220;<span class="quote">sheep</span>&#8221;, &#8220;<span class="quote">deer</span>&#8221;, and &#8220;<span class="quote">haiku</span>&#8221;.)
               </p>
               <p>Other languages are, of course, completely different.</p>
               <p>Let's design a module that pluralizes nouns.  Start with just English nouns, and just these four rules, but keep in mind that
                  you'll inevitably need to add more rules, and you may eventually need to add more languages.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.stage1"></a>17.2.&nbsp;<tt class="filename">plural.py</tt>, stage 1
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>So you're looking at words, which at least in English are strings of characters.  And you have rules that say you need to
                     find different combinations of characters, and then do different things to them.  This sounds like a job for regular expressions.
                  </p>
               </div>
               <div class="example"><a name="d0e37108"></a><h3 class="title">Example&nbsp;17.1.&nbsp;<tt class="filename">plural1.py</tt></h3><pre class="programlisting">
import re

def plural(noun):                            
    if re.search('[sxz]$', noun):             <a name="plural.stage1.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        return re.sub('$', 'es', noun)        <a name="plural.stage1.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    elif re.search('[^aeioudgkprt]h$', noun):
        return re.sub('$', 'es', noun)       
    elif re.search('[^aeiou]y$', noun):      
        return re.sub('y$', 'ies', noun)     
    else:                                    
        return noun + 's'                    
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">OK, this is a regular expression, but it uses a syntax you didn't see in <a href="#re" title="Chapter&nbsp;7.&nbsp;Regular Expressions">Chapter&nbsp;7, <i>Regular Expressions</i></a>.  The square brackets mean &#8220;<span class="quote">match exactly one of these characters</span>&#8221;.  So <tt class="literal">[sxz]</tt> means &#8220;<span class="quote"><tt class="literal">s</tt>, or <tt class="literal">x</tt>, or <tt class="literal">z</tt></span>&#8221;, but only one of them.  The <tt class="literal">$</tt> should be familiar; it matches the end of string.  So you're checking to see if <tt class="varname">noun</tt> ends with <tt class="literal">s</tt>, <tt class="literal">x</tt>, or <tt class="literal">z</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This <tt class="function">re.sub</tt> function performs regular expression-based string substitutions.  Let's look at it in more detail.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e37161"></a><h3 class="title">Example&nbsp;17.2.&nbsp;Introducing <tt class="function">re.sub</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import re</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search('[abc]', 'Mark')</span>   <a name="plural.stage1.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x001C1FA8&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('[abc]', 'o', 'Mark')</span> <a name="plural.stage1.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'Mork'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('[abc]', 'o', 'rock')</span> <a name="plural.stage1.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">'rook'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('[abc]', 'o', 'caps')</span> <a name="plural.stage1.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">'oops'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Does the string <tt class="literal">Mark</tt> contain <tt class="literal">a</tt>, <tt class="literal">b</tt>, or <tt class="literal">c</tt>?  Yes, it contains <tt class="literal">a</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">OK, now find <tt class="literal">a</tt>, <tt class="literal">b</tt>, or <tt class="literal">c</tt>, and replace it with <tt class="literal">o</tt>.  <tt class="literal">Mark</tt> becomes <tt class="literal">Mork</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The same function turns <tt class="literal">rock</tt> into <tt class="literal">rook</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You might think this would turn <tt class="literal">caps</tt> into <tt class="literal">oaps</tt>, but it doesn't.  <tt class="literal">re.sub</tt> replaces <span class="emphasis"><em>all</em></span> of the matches, not just the first one.  So this regular expression turns <tt class="literal">caps</tt> into <tt class="literal">oops</tt>, because both the <tt class="literal">c</tt> and the <tt class="literal">a</tt> get turned into <tt class="literal">o</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e37292"></a><h3 class="title">Example&nbsp;17.3.&nbsp;Back to <tt class="filename">plural1.py</tt></h3><pre class="programlisting">
import re

def plural(noun):                            
    if re.search('[sxz]$', noun):            
        return re.sub('$', 'es', noun)        <a name="plural.stage1.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    elif re.search('[^aeioudgkprt]h$', noun): <a name="plural.stage1.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        return re.sub('$', 'es', noun)        <a name="plural.stage1.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
    elif re.search('[^aeiou]y$', noun):      
        return re.sub('y$', 'ies', noun)     
    else:                                    
        return noun + 's'                    
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Back to the <tt class="function">plural</tt> function.  What are you doing?  You're replacing the end of string with <tt class="literal">es</tt>.  In other words, adding <tt class="literal">es</tt> to the string.  You could accomplish the same thing with string concatenation, for example <tt class="literal">noun + 'es'</tt>, but I'm using regular expressions for everything, for consistency, for reasons that will become clear later in the chapter.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Look closely, this is another new variation.  The <tt class="literal">^</tt> as the first character inside the square brackets means something special: negation.  <tt class="literal">[^abc]</tt> means &#8220;<span class="quote">any single character <span class="emphasis"><em>except</em></span> <tt class="literal">a</tt>, <tt class="literal">b</tt>, or <tt class="literal">c</tt></span>&#8221;.  So <tt class="literal">[^aeioudgkprt]</tt> means any character except <tt class="literal">a</tt>, <tt class="literal">e</tt>, <tt class="literal">i</tt>, <tt class="literal">o</tt>, <tt class="literal">u</tt>, <tt class="literal">d</tt>, <tt class="literal">g</tt>, <tt class="literal">k</tt>, <tt class="literal">p</tt>, <tt class="literal">r</tt>, or <tt class="literal">t</tt>.  Then that character needs to be followed by <tt class="literal">h</tt>, followed by end of string.  You're looking for words that end in H where the H can be heard.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Same pattern here: match words that end in Y, where the character before the Y is <span class="emphasis"><em>not</em></span> <tt class="literal">a</tt>, <tt class="literal">e</tt>, <tt class="literal">i</tt>, <tt class="literal">o</tt>, or <tt class="literal">u</tt>.  You're looking for words that end in Y that sounds like I.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e37404"></a><h3 class="title">Example&nbsp;17.4.&nbsp;More on negation regular expressions</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import re</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search('[^aeiou]y$', 'vacancy')</span> <a name="plural.stage1.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">&lt;_sre.SRE_Match object at 0x001C1FA8&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search('[^aeiou]y$', 'boy')</span>     <a name="plural.stage1.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search('[^aeiou]y$', 'day')</span>
<tt class="prompt">&gt;&gt;&gt; </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.search('[^aeiou]y$', 'pita')</span>    <a name="plural.stage1.4.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">vacancy</tt> matches this regular expression, because it ends in <tt class="literal">cy</tt>, and <tt class="literal">c</tt> is not <tt class="literal">a</tt>, <tt class="literal">e</tt>, <tt class="literal">i</tt>, <tt class="literal">o</tt>, or <tt class="literal">u</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">boy</tt> does not match, because it ends in <tt class="literal">oy</tt>, and you specifically said that the character before the <tt class="literal">y</tt> could not be <tt class="literal">o</tt>.  <tt class="literal">day</tt> does not match, because it ends in <tt class="literal">ay</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.4.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">pita</tt> does not match, because it does not end in <tt class="literal">y</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e37507"></a><h3 class="title">Example&nbsp;17.5.&nbsp;More on <tt class="function">re.sub</tt></h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('y$', 'ies', 'vacancy')</span>              <a name="plural.stage1.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">'vacancies'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('y$', 'ies', 'agency')</span>
<span class="computeroutput">'agencies'</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">re.sub('([^aeiou])y$', r'\1ies', 'vacancy')</span> <a name="plural.stage1.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">'vacancies'</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This regular expression turns <tt class="literal">vacancy</tt> into <tt class="literal">vacancies</tt> and <tt class="literal">agency</tt> into <tt class="literal">agencies</tt>, which is what you wanted.  Note that it would also turn <tt class="literal">boy</tt> into <tt class="literal">boies</tt>, but that will never happen in the function because you did that <tt class="function">re.search</tt> first to find out whether you should do this <tt class="function">re.sub</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage1.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Just in passing, I want to point out that it is possible to combine these two regular expressions (one to find out if the
                              rule applies, and another to actually apply it) into a single regular expression.  Here's what that would look like.  Most
                              of it should look familiar: you're using a remembered group, which you learned in <a href="#re.phone" title="7.6.&nbsp;Case study: Parsing Phone Numbers">Section&nbsp;7.6, &#8220;Case study: Parsing Phone Numbers&#8221;</a>, to remember the character before the <tt class="literal">y</tt>.  Then in the substitution string, you use a new syntax, <tt class="literal">\1</tt>, which means &#8220;<span class="quote">hey, that first group you remembered?  put it here</span>&#8221;.  In this case, you remember the <tt class="literal">c</tt> before the <tt class="literal">y</tt>, and then when you do the substitution, you substitute <tt class="literal">c</tt> in place of <tt class="literal">c</tt>, and <tt class="literal">ies</tt> in place of <tt class="literal">y</tt>.  (If you have more than one remembered group, you can use <tt class="literal">\2</tt> and <tt class="literal">\3</tt> and so on.)
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Regular expression substitutions are extremely powerful, and the <tt class="literal">\1</tt> syntax makes them even more powerful.  But combining the entire operation into one regular expression is also much harder
                  to read, and it doesn't directly map to the way you first described the pluralizing rules.  You originally laid out rules
                  like &#8220;<span class="quote">if the word ends in S, X, or Z, then add ES</span>&#8221;.  And if you look at this function, you have two lines of code that say &#8220;<span class="quote">if the word ends in S, X, or Z, then add ES</span>&#8221;.  It doesn't get much more direct than that.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.stage2"></a>17.3.&nbsp;<tt class="filename">plural.py</tt>, stage 2
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now you're going to add a level of abstraction.  You started by defining a list of rules: if this, then do that, otherwise
                     go to the next rule.  Let's temporarily complicate part of the program so you can simplify another part.
                  </p>
               </div>
               <div class="example"><a name="d0e37629"></a><h3 class="title">Example&nbsp;17.6.&nbsp;<tt class="filename">plural2.py</tt></h3><pre class="programlisting">
import re

def match_sxz(noun):                          
    return re.search('[sxz]$', noun)          

def apply_sxz(noun):                          
    return re.sub('$', 'es', noun)            

def match_h(noun):                            
    return re.search('[^aeioudgkprt]h$', noun)

def apply_h(noun):                            
    return re.sub('$', 'es', noun)            

def match_y(noun):                            
    return re.search('[^aeiou]y$', noun)      
        
def apply_y(noun):                            
    return re.sub('y$', 'ies', noun)          

def match_default(noun):                      
    return 1                                  
        
def apply_default(noun):                      
    return noun + 's'                         

rules = ((match_sxz, apply_sxz),
         (match_h, apply_h),
         (match_y, apply_y),
         (match_default, apply_default)
         )                                     <a name="plural.stage2.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

def plural(noun):                             
    for matchesRule, applyRule in rules:       <a name="plural.stage2.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        if matchesRule(noun):                  <a name="plural.stage2.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
            return applyRule(noun)             <a name="plural.stage2.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage2.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This version looks more complicated (it's certainly longer), but it does exactly the same thing: try to match four different
                              rules, in order, and apply the appropriate regular expression when a match is found.  The difference is that each individual
                              match and apply rule is defined in its own function, and the functions are then listed in this <tt class="varname">rules</tt> variable, which is a tuple of tuples.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage2.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Using a <tt class="literal">for</tt> loop, you can pull out the match and apply rules two at a time (one match, one apply) from the <tt class="varname">rules</tt> tuple.  On the first iteration of the <tt class="literal">for</tt> loop, <tt class="varname">matchesRule</tt> will get <tt class="function">match_sxz</tt>, and <tt class="varname">applyRule</tt> will get <tt class="function">apply_sxz</tt>.  On the second iteration (assuming you get that far), <tt class="varname">matchesRule</tt> will be assigned <tt class="function">match_h</tt>, and <tt class="varname">applyRule</tt> will be assigned <tt class="function">apply_h</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage2.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Remember that <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">everything in <span class="application">Python</span> is an object</a>, including functions.  <tt class="varname">rules</tt> contains actual functions; not names of functions, but actual functions.  When they get assigned in the <tt class="literal">for</tt> loop, then <tt class="varname">matchesRule</tt> and <tt class="varname">applyRule</tt> are actual functions that you can call.  So on the first iteration of the <tt class="literal">for</tt> loop, this is equivalent to calling <tt class="function">matches_sxz(noun)</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage2.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">On the first iteration of the <tt class="literal">for</tt> loop, this is equivalent to calling <tt class="function">apply_sxz(noun)</tt>, and so forth.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>If this additional level of abstraction is confusing, try unrolling the function to see the equivalence.  This <tt class="literal">for</tt> loop is equivalent to the following:
               </p>
               <div class="example"><a name="d0e37727"></a><h3 class="title">Example&nbsp;17.7.&nbsp;Unrolling the <tt class="function">plural</tt> function
                  </h3><pre class="programlisting">
def plural(noun):
    if match_sxz(noun):
        return apply_sxz(noun)
    if match_h(noun):
        return apply_h(noun)
    if match_y(noun):
        return apply_y(noun)
    if match_default(noun):
        return apply_default(noun)
</pre></div>
               <p>The benefit here is that that <tt class="function">plural</tt> function is now simplified.  It takes a list of rules, defined elsewhere, and iterates through them in a generic fashion.
                  Get a match rule; does it match?  Then call the apply rule.  The rules could be defined anywhere, in any way.  The <tt class="function">plural</tt> function doesn't care.
               </p>
               <p>Now, was adding this level of abstraction worth it?  Well, not yet.  Let's consider what it would take to add a new rule to
                  the function.  Well, in the previous example, it would require adding an <tt class="literal">if</tt> statement to the <tt class="function">plural</tt> function.  In this example, it would require adding two functions, <tt class="function">match_foo</tt> and <tt class="function">apply_foo</tt>, and then updating the <tt class="varname">rules</tt> list to specify where in the order the new match and apply functions should be called relative to the other rules.
               </p>
               <p>This is really just a stepping stone to the next section.  Let's move on.</p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.stage3"></a>17.4.&nbsp;<tt class="filename">plural.py</tt>, stage 3
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Defining separate named functions for each match and apply rule isn't really necessary.  You never call them directly; you
                     define them in the <tt class="varname">rules</tt> list and call them through there.  Let's streamline the rules definition by anonymizing those functions.
                  </p>
               </div>
               <div class="example"><a name="d0e37775"></a><h3 class="title">Example&nbsp;17.8.&nbsp;<tt class="filename">plural3.py</tt></h3><pre class="programlisting">
import re

rules = \
  (
    (
     lambda word: re.search('[sxz]$', word),
     lambda word: re.sub('$', 'es', word)
    ),
    (
     lambda word: re.search('[^aeioudgkprt]h$', word),
     lambda word: re.sub('$', 'es', word)
    ),
    (
     lambda word: re.search('[^aeiou]y$', word),
     lambda word: re.sub('y$', 'ies', word)
    ),
    (
     lambda word: re.search('$', word),
     lambda word: re.sub('$', 's', word)
    )
   )                                           <a name="plural.stage3.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

def plural(noun):                             
    for matchesRule, applyRule in rules:       <a name="plural.stage3.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        if matchesRule(noun):                 
            return applyRule(noun)            
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage3.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This is the same set of rules as you defined in stage 2.  The only difference is that instead of defining named functions
                              like <tt class="function">match_sxz</tt> and <tt class="function">apply_sxz</tt>, you have &#8220;<span class="quote">inlined</span>&#8221; those function definitions directly into the <tt class="varname">rules</tt> list itself, using <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions">lambda functions</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage3.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Note that the <tt class="function">plural</tt> function hasn't changed at all.  It iterates through a set of rule functions, checks the first rule, and if it returns a
                              true value, calls the second rule and returns the value.  Same as above, word for word.  The only difference is that the rule
                              functions were defined inline, anonymously, using lambda functions.  But the <tt class="function">plural</tt> function doesn't care how they were defined; it just gets a list of rules and blindly works through them.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Now to add a new rule, all you need to do is define the functions directly in the <tt class="varname">rules</tt> list itself: one match rule, and one apply rule.  But defining the rule functions inline like this makes it very clear that
                  you have some unnecessary duplication here.  You have four pairs of functions, and they all follow the same pattern.  The
                  match function is a single call to <tt class="function">re.search</tt>, and the apply function is a single call to <tt class="function">re.sub</tt>.  Let's factor out these similarities.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.stage4"></a>17.5.&nbsp;<tt class="filename">plural.py</tt>, stage 4
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Let's factor out the duplication in the code so that defining new rules can be easier.</p>
               </div>
               <div class="example"><a name="plural.stage4.example.1"></a><h3 class="title">Example&nbsp;17.9.&nbsp;<tt class="filename">plural4.py</tt></h3><pre class="programlisting">
import re

def buildMatchAndApplyFunctions((pattern, search, replace)):  
    matchFunction = lambda word: re.search(pattern, word)      <a name="plural.stage4.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    applyFunction = lambda word: re.sub(search, replace, word) <a name="plural.stage4.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    return (matchFunction, applyFunction)                      <a name="plural.stage4.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="function">buildMatchAndApplyFunctions</tt> is a function that builds other functions dynamically.  It takes <tt class="varname">pattern</tt>, <tt class="varname">search</tt> and <tt class="varname">replace</tt> (actually it takes a tuple, but more on that in a minute), and you can build the match function using the <tt class="literal">lambda</tt> syntax to be a function that takes one parameter (<tt class="varname">word</tt>) and calls <tt class="function">re.search</tt> with the <tt class="varname">pattern</tt> that was passed to the <tt class="function">buildMatchAndApplyFunctions</tt> function, and the <tt class="varname">word</tt> that was passed to the match function you're building.  Whoa.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Building the apply function works the same way.  The apply function is a function that takes one parameter, and calls <tt class="function">re.sub</tt> with the <tt class="varname">search</tt> and <tt class="varname">replace</tt> parameters that were passed to the <tt class="function">buildMatchAndApplyFunctions</tt> function, and the <tt class="varname">word</tt> that was passed to the apply function you're building.  This technique of using the values of outside parameters within a
                              dynamic function is called <span class="emphasis"><em>closures</em></span>.  You're essentially defining constants within the apply function you're building: it takes one parameter (<tt class="varname">word</tt>), but it then acts on that plus two other values (<tt class="varname">search</tt> and <tt class="varname">replace</tt>) which were set when you defined the apply function.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Finally, the <tt class="function">buildMatchAndApplyFunctions</tt> function returns a tuple of two values: the two functions you just created.  The constants you defined within those functions
                              (<tt class="varname">pattern</tt> within <tt class="varname">matchFunction</tt>, and <tt class="varname">search</tt> and <tt class="varname">replace</tt> within <tt class="varname">applyFunction</tt>) stay with those functions, even after you return from <tt class="function">buildMatchAndApplyFunctions</tt>.  That's insanely cool.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>If this is incredibly confusing (and it should be, this is weird stuff), it may become clearer when you see how to use it.</p>
               <div class="example"><a name="d0e37935"></a><h3 class="title">Example&nbsp;17.10.&nbsp;<tt class="filename">plural4.py</tt> continued
                  </h3><pre class="programlisting">
patterns = \
  (
    ('[sxz]$', '$', 'es'),
    ('[^aeioudgkprt]h$', '$', 'es'),
    ('(qu|[^aeiou])y$', 'y$', 'ies'),
    ('$', '$', 's')
  )                                                 <a name="plural.stage4.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
rules = map(buildMatchAndApplyFunctions, patterns)  <a name="plural.stage4.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Our pluralization rules are now defined as a series of strings (not functions).  The first string is the regular expression
                              that you would use in <tt class="function">re.search</tt> to see if this rule matches; the second and third are the search and replace expressions you would use in <tt class="function">re.sub</tt> to actually apply the rule to turn a noun into its plural.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">This line is magic.  It takes the list of strings in <tt class="varname">patterns</tt> and turns them into a list of functions.  How?  By mapping the strings to the <tt class="function">buildMatchAndApplyFunctions</tt> function, which just happens to take three strings as parameters and return a tuple of two functions.  This means that <tt class="varname">rules</tt> ends up being exactly the same as the previous example: a list of tuples, where each tuple is a pair of functions, where
                              the first function is the match function that calls <tt class="function">re.search</tt>, and the second function is the apply function that calls <tt class="function">re.sub</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>I swear I am not making this up: <tt class="varname">rules</tt> ends up with exactly the same list of functions as the previous example.  Unroll the <tt class="varname">rules</tt> definition, and you'll get this:
               </p>
               <div class="example"><a name="d0e37982"></a><h3 class="title">Example&nbsp;17.11.&nbsp;Unrolling the rules definition</h3><pre class="programlisting">
rules = \
  (
    (
     lambda word: re.search('[sxz]$', word),
     lambda word: re.sub('$', 'es', word)
    ),
    (
     lambda word: re.search('[^aeioudgkprt]h$', word),
     lambda word: re.sub('$', 'es', word)
    ),
    (
     lambda word: re.search('[^aeiou]y$', word),
     lambda word: re.sub('y$', 'ies', word)
    ),
    (
     lambda word: re.search('$', word),
     lambda word: re.sub('$', 's', word)
    )
   )                                          
</pre></div>
               <div class="example"><a name="plural.finishing.up"></a><h3 class="title">Example&nbsp;17.12.&nbsp;<tt class="filename">plural4.py</tt>, finishing up
                  </h3><pre class="programlisting">
def plural(noun):                                  
    for matchesRule, applyRule in rules:            <a name="plural.stage4.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        if matchesRule(noun):                      
            return applyRule(noun)                 
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since the <tt class="varname">rules</tt> list is the same as the previous example, it should come as no surprise that the <tt class="function">plural</tt> function hasn't changed.  Remember, it's completely generic; it takes a list of rule functions and calls them in order. 
                              It doesn't care how the rules are defined.  In <a href="#plural.stage2" title="17.3.&nbsp;plural.py, stage 2">stage 2</a>, they were defined as seperate named functions.  In <a href="#plural.stage3" title="17.4.&nbsp;plural.py, stage 3">stage 3</a>, they were defined as anonymous <tt class="literal">lambda</tt> functions.  Now in stage 4, they are built dynamically by mapping the <tt class="function">buildMatchAndApplyFunctions</tt> function onto a list of raw strings.  Doesn't matter; the <tt class="function">plural</tt> function still works the same way.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>Just in case that wasn't mind-blowing enough, I must confess that there was a subtlety in the definition of <tt class="function">buildMatchAndApplyFunctions</tt> that I skipped over.  Let's go back and take another look.
               </p>
               <div class="example"><a name="d0e38026"></a><h3 class="title">Example&nbsp;17.13.&nbsp;Another look at <tt class="function">buildMatchAndApplyFunctions</tt></h3><pre class="programlisting">
def buildMatchAndApplyFunctions((pattern, search, replace)):   <a name="plural.stage4.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Notice the double parentheses?  This function doesn't actually take three parameters; it actually takes one parameter, a tuple
                              of three elements.  But the tuple is expanded when the function is called, and the three elements of the tuple are each assigned
                              to different variables: <tt class="varname">pattern</tt>, <tt class="varname">search</tt>, and <tt class="varname">replace</tt>.  Confused yet?  Let's see it in action.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="d0e38048"></a><h3 class="title">Example&nbsp;17.14.&nbsp;Expanding tuples when calling functions</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def foo((a, b, c)):</span>
<tt class="prompt">...     </tt><span class="userinput">print c</span>
<tt class="prompt">...     </tt><span class="userinput">print b</span>
<tt class="prompt">...     </tt><span class="userinput">print a</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">parameters = ('apple', 'bear', 'catnap')</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">foo(parameters)</span> <a name="plural.stage4.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<span class="computeroutput">catnap</span>
<span class="computeroutput">bear</span>
<span class="computeroutput">apple</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage4.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The proper way to call the function <tt class="function">foo</tt> is with a tuple of three elements.  When the function is called, the elements are assigned to different local variables within
                              <tt class="function">foo</tt>.
                           </td>
                        </tr>
                     </table>
                  </div>
                  <p>Now let's go back and see why this auto-tuple-expansion trick was necessary.  <tt class="varname">patterns</tt> was a list of tuples, and each tuple had three elements.  When you called <tt class="literal">map(buildMatchAndApplyFunctions, patterns)</tt>, that means that <tt class="function">buildMatchAndApplyFunctions</tt> is <span class="emphasis"><em>not</em></span> getting called with three parameters.  Using <tt class="function">map</tt> to map a single list onto a function always calls the function with a single parameter: each element of the list.  In the
                     case of <tt class="varname">patterns</tt>, each element of the list is a tuple, so <tt class="function">buildMatchAndApplyFunctions</tt> always gets called with the tuple, and you use the auto-tuple-expansion trick in the definition of <tt class="function">buildMatchAndApplyFunctions</tt> to assign the elements of that tuple to named variables that you can work with.
                  </p>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.stage5"></a>17.6.&nbsp;<tt class="filename">plural.py</tt>, stage 5
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You've factored out all the duplicate code and added enough abstractions so that the pluralization rules are defined in a
                     list of strings.  The next logical step is to take these strings and put them in a separate file, where they can be maintained
                     separately from the code that uses them.
                  </p>
               </div>
               <p>First, let's create a text file that contains the rules you want.  No fancy data structures, just space- (or tab-)delimited
                  strings in three columns.  You'll call it <tt class="filename">rules.en</tt>; &#8220;<span class="quote">en</span>&#8221; stands for English.  These are the rules for pluralizing English nouns.  You could add other rule files for other languages
                  later.
               </p>
               <div class="example"><a name="d0e38148"></a><h3 class="title">Example&nbsp;17.15.&nbsp;<tt class="filename">rules.en</tt></h3><pre class="programlisting">
[sxz]$                  $               es
[^aeioudgkprt]h$        $               es
[^aeiou]y$              y$              ies
$                       $               s
</pre></div>
               <p>Now let's see how you can use this rules file.</p>
               <div class="example"><a name="d0e38156"></a><h3 class="title">Example&nbsp;17.16.&nbsp;<tt class="filename">plural5.py</tt></h3><pre class="programlisting">
import re
import string                                                                     

def buildRule((pattern, search, replace)):                                        
    return lambda word: re.search(pattern, word) and re.sub(search, replace, word) <a name="plural.stage5.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">

def plural(noun, language='en'):                             <a name="plural.stage5.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
    lines = file('rules.%s' % language).readlines()          <a name="plural.stage5.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
    patterns = map(string.split, lines)                      <a name="plural.stage5.1.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
    rules = map(buildRule, patterns)                         <a name="plural.stage5.1.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
    for rule in rules:                                      
        result = rule(noun)                                  <a name="plural.stage5.1.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
        if result: return result                            
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage5.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You're still using the closures technique here (building a function dynamically that uses variables defined outside the function),
                              but now you've combined the separate match and apply functions into one.  (The reason for this change will become clear in
                              the next section.)  This will let you accomplish the same thing as having two functions, but you'll need to call it differently,
                              as you'll see in a minute.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage5.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Our <tt class="function">plural</tt> function now takes an optional second parameter, <tt class="varname">language</tt>, which defaults to <tt class="literal">en</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage5.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You use the <tt class="varname">language</tt> parameter to construct a filename, then open the file and read the contents into a list.  If <tt class="varname">language</tt> is <tt class="literal">en</tt>, then you'll open the <tt class="filename">rules.en</tt> file, read the entire thing, break it up by carriage returns, and return a list.  Each line of the file will be one element
                              in the list.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage5.1.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">As you saw, each line in the file really has three values, but they're separated by whitespace (tabs or spaces, it makes no
                              difference).  Mapping the <tt class="function">string.split</tt> function onto this list will create a new list where each element is a tuple of three strings.  So a line like <tt class="literal">[sxz]$ $ es</tt> will be broken up into the tuple <tt class="literal">('[sxz]$', '$', 'es')</tt>.  This means that <tt class="varname">patterns</tt> will end up as a list of tuples, just like you hard-coded it in <a href="#plural.stage4" title="17.5.&nbsp;plural.py, stage 4">stage 4</a>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage5.1.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">If <tt class="varname">patterns</tt> is a list of tuples, then <tt class="varname">rules</tt> will be a list of the functions created dynamically by each call to <tt class="function">buildRule</tt>.  Calling <tt class="function">buildRule(('[sxz]$', '$', 'es'))</tt> returns a function that takes a single parameter, <tt class="varname">word</tt>.  When this returned function is called, it will execute <tt class="literal">re.search('[sxz]$', word) and re.sub('$', 'es', word)</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage5.1.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Because you're now building a combined match-and-apply function, you need to call it differently.  Just call the function,
                              and if it returns something, then that's the plural; if it returns nothing (<tt class="literal">None</tt>), then the rule didn't match and you need to try another rule.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So the improvement here is that you've completely separated the pluralization rules into an external file.  Not only can the
                  file be maintained separately from the code, but you've set up a naming scheme where the same <tt class="function">plural</tt> function can use different rule files, based on the <tt class="varname">language</tt> parameter.
               </p>
               <p>The downside here is that you're reading that file every time you call the <tt class="function">plural</tt> function.  I thought I could get through this entire book without using the phrase &#8220;<span class="quote">left as an exercise for the reader</span>&#8221;, but here you go: building a caching mechanism for the language-specific rule files that auto-refreshes itself if the rule
                  files change between calls <span class="emphasis"><em>is left as an exercise for the reader</em></span>.  Have fun.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.stage6"></a>17.7.&nbsp;<tt class="filename">plural.py</tt>, stage 6
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>Now you're ready to talk about generators.</p>
               </div>
               <div class="example"><a name="d0e38279"></a><h3 class="title">Example&nbsp;17.17.&nbsp;<tt class="filename">plural6.py</tt></h3><pre class="programlisting">
import re

def rules(language):                                                                 
    for line in file('rules.%s' % language):                                         
        pattern, search, replace = line.split()                                      
        yield lambda word: re.search(pattern, word) and re.sub(search, replace, word)

def plural(noun, language='en'):      
    for applyRule in rules(language): 
        result = applyRule(noun)      
        if result: return result      
</pre></div>
               <p>This uses a technique called generators, which I'm not even going to try to explain until you look at a simpler example first.</p>
               <div class="example"><a name="plural.introducing.generators"></a><h3 class="title">Example&nbsp;17.18.&nbsp;Introducing generators</h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">def make_counter(x):</span>
<tt class="prompt">...     </tt><span class="userinput">print 'entering make_counter'</span>
<tt class="prompt">...     </tt><span class="userinput">while 1:</span>
<tt class="prompt">...     </tt><span class="userinput">    yield x</span>               <a name="plural.stage6.2.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">    print 'incrementing x'</span>
<tt class="prompt">...     </tt><span class="userinput">    x = x + 1</span>
<tt class="prompt">...     </tt>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter = make_counter(2)</span> <a name="plural.stage6.2.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter</span>                   <a name="plural.stage6.2.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">&lt;generator object at 0x001C9C10&gt;</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter.next()</span>            <a name="plural.stage6.2.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
<span class="computeroutput">entering make_counter
2</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter.next()</span>            <a name="plural.stage6.2.5"></a><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12">
<span class="computeroutput">incrementing x
3</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">counter.next()</span>            <a name="plural.stage6.2.6"></a><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12">
<span class="computeroutput">incrementing x
4</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.2.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The presence of the <tt class="literal">yield</tt> keyword in <tt class="function">make_counter</tt> means that this is not a normal function.  It is a special kind of function which generates values one at a time.  You can
                              think of it as a resumable function.  Calling it will return a generator that can be used to generate successive values of
                              <tt class="varname">x</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.2.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">To create an instance of the <tt class="function">make_counter</tt> generator, just call it like any other function.  Note that this does not actually execute the function code.  You can tell
                              this because the first line of <tt class="function">make_counter</tt> is a <tt class="function">print</tt> statement, but nothing has been printed yet.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.2.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="function">make_counter</tt> function returns a generator object.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.2.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The first time you call the <tt class="function">next()</tt> method on the generator object, it executes the code in <tt class="function">make_counter</tt> up to the first <tt class="literal">yield</tt> statement, and then returns the value that was yielded.  In this case, that will be <tt class="literal">2</tt>, because you originally created the generator by calling <tt class="function">make_counter(2)</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.2.5"><img src="images/callouts/5.png" alt="5" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Repeatedly calling <tt class="function">next()</tt> on the generator object <span class="emphasis"><em>resumes where you left off</em></span> and continues until you hit the next <tt class="literal">yield</tt> statement.  The next line of code waiting to be executed is the <tt class="function">print</tt> statement that prints <tt class="literal">incrementing x</tt>, and then after that the <tt class="literal">x = x + 1</tt> statement that actually increments it.  Then you loop through the <tt class="literal">while</tt> loop again, and the first thing you do is <tt class="literal">yield x</tt>, which returns the current value of <tt class="varname">x</tt> (now 3).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.2.6"><img src="images/callouts/6.png" alt="6" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The second time you call <tt class="function">counter.next()</tt>, you do all the same things again, but this time <tt class="varname">x</tt> is now <tt class="literal">4</tt>.  And so forth.  Since <tt class="function">make_counter</tt> sets up an infinite loop, you could theoretically do this forever, and it would just keep incrementing <tt class="varname">x</tt> and spitting out values.  But let's look at more productive uses of generators instead.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <div class="example"><a name="plural.fib.example"></a><h3 class="title">Example&nbsp;17.19.&nbsp;Using generators instead of recursion</h3><pre class="programlisting">
def fibonacci(max):
    a, b = 0, 1       <a name="plural.stage6.3.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
    while a &lt; max:
        yield a       <a name="plural.stage6.3.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        a, b = b, a+b <a name="plural.stage6.3.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.3.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The Fibonacci sequence is a sequence of numbers where each number is the sum of the two numbers before it.  It starts with
                              <tt class="constant">0</tt> and <tt class="constant">1</tt>, goes up slowly at first, then more and more rapidly.  To start the sequence, you need two variables: <tt class="varname">a</tt> starts at <tt class="constant">0</tt>, and <tt class="varname">b</tt> starts at <tt class="constant">1</tt>.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.3.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">a</tt> is the current number in the sequence, so yield it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.3.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="varname">b</tt> is the next number in the sequence, so assign that to <tt class="varname">a</tt>, but also calculate the next value (<tt class="literal">a+b</tt>) and assign that to <tt class="varname">b</tt> for later use.  Note that this happens in parallel; if <tt class="varname">a</tt> is <tt class="literal">3</tt> and <tt class="varname">b</tt> is <tt class="literal">5</tt>, then <tt class="literal">a, b = b, a+b</tt> will set <tt class="varname">a</tt> to <tt class="literal">5</tt> (the previous value of <tt class="varname">b</tt>) and <tt class="varname">b</tt> to <tt class="literal">8</tt> (the sum of the previous values of <tt class="varname">a</tt> and <tt class="varname">b</tt>).
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>So you have a function that spits out successive Fibonacci numbers.  Sure, you could do that with recursion, but this way
                  is easier to read.  Also, it works well with <tt class="literal">for</tt> loops.
               </p>
               <div class="example"><a name="d0e38564"></a><h3 class="title">Example&nbsp;17.20.&nbsp;Generators in <tt class="literal">for</tt> loops
                  </h3><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">for n in fibonacci(1000):</span> <a name="plural.stage6.4.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">...     </tt><span class="userinput">print n,</span>              <a name="plural.stage6.4.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.4.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">You can use a generator like <tt class="function">fibonacci</tt> in a <tt class="literal">for</tt> loop directly.  The <tt class="literal">for</tt> loop will create the generator object and successively call the <tt class="function">next()</tt> method to get values to assign to the <tt class="literal">for</tt> loop index variable (<tt class="varname">n</tt>).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.4.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Each time through the <tt class="literal">for</tt> loop, <tt class="varname">n</tt> gets a new value from the <tt class="literal">yield</tt> statement in <tt class="function">fibonacci</tt>, and all you do is print it out.  Once <tt class="function">fibonacci</tt> runs out of numbers (<tt class="varname">a</tt> gets bigger than <tt class="varname">max</tt>, which in this case is <tt class="literal">1000</tt>), then the <tt class="literal">for</tt> loop exits gracefully.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>OK, let's go back to the <tt class="function">plural</tt> function and see how you're using this.
               </p>
               <div class="example"><a name="d0e38646"></a><h3 class="title">Example&nbsp;17.21.&nbsp;Generators that generate dynamic functions</h3><pre class="programlisting">
def rules(language):                                                                 
    for line in file('rules.%s' % language):                                          <a name="plural.stage6.5.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
        pattern, search, replace = line.split()                                       <a name="plural.stage6.5.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
        yield lambda word: re.search(pattern, word) and re.sub(search, replace, word) <a name="plural.stage6.5.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">

def plural(noun, language='en'):      
    for applyRule in rules(language):  <a name="plural.stage6.5.4"></a><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12">
        result = applyRule(noun)      
        if result: return result      
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.5.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><tt class="literal">for line in file(...)</tt> is a common idiom for reading lines from a file, one line at a time.  It works because <span class="emphasis"><em><tt class="function">file</tt> actually returns a generator</em></span> whose <tt class="function">next()</tt> method returns the next line of the file.  That is so insanely cool, I wet myself just thinking about it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.5.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">No magic here.  Remember that the lines of the rules file have three values separated by whitespace, so <tt class="literal">line.split()</tt> returns a tuple of 3 values, and you assign those values to 3 local variables.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.5.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left"><span class="emphasis"><em>And then you yield.</em></span>  What do you yield?  A function, built dynamically with <tt class="literal">lambda</tt>, that is actually a closure (it uses the local variables <tt class="varname">pattern</tt>, <tt class="varname">search</tt>, and <tt class="varname">replace</tt> as constants).  In other words, <tt class="function">rules</tt> is a generator that spits out rule functions.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#plural.stage6.5.4"><img src="images/callouts/4.png" alt="4" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Since <tt class="function">rules</tt> is a generator, you can use it directly in a <tt class="literal">for</tt> loop.  The first time through the <tt class="literal">for</tt> loop, you will call the <tt class="function">rules</tt> function, which will open the rules file, read the first line out of it, dynamically build a function that matches and applies
                              the first rule defined in the rules file, and yields the dynamically built function.  The second time through the <tt class="literal">for</tt> loop, you will pick up where you left off in <tt class="function">rules</tt> (which was in the middle of the <tt class="literal">for line in file(...)</tt> loop), read the second line of the rules file, dynamically build another function that matches and applies the second rule
                              defined in the rules file, and yields it.  And so forth.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div>
               <p>What have you gained over <a href="#plural.stage5" title="17.6.&nbsp;plural.py, stage 5">stage 5</a>?  In stage 5, you read the entire rules file and built a list of all the possible rules before you even tried the first one.
                  Now with generators, you can do everything lazily: you open the first and read the first rule and create a function to try
                  it, but if that works you don't ever read the rest of the file or create any other functions.
               </p>
               <div class="itemizedlist">
                  <h3 class="title">Further reading</h3>
                  <ul>
                     <li><a href="http://www.python.org/peps/pep-0255.html">PEP 255</a> defines generators.
                     </li>
                     <li><a href="http://www.activestate.com/ASPN/Python/Cookbook/" title="growing archive of annotated code samples"><span class="application">Python</span> Cookbook</a> has <a href="http://www.google.com/search?q=generators+cookbook+site:aspn.activestate.com">many more examples of generators</a>.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="plural.summary"></a>17.8.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>You talked about several different advanced techniques in this chapter.  Not all of them are appropriate for every situation.</p>
               </div>
               <p>You should now be comfortable with all of these techniques:</p>
               <div class="itemizedlist">
                  <ul>
                     <li>Performing <a href="#plural.stage1" title="17.2.&nbsp;plural.py, stage 1">string substitution with regular expressions</a>.
                     </li>
                     <li>Treating <a href="#plural.stage2" title="17.3.&nbsp;plural.py, stage 2">functions as objects</a>, storing them in lists, assigning them to variables, and calling them through those variables.
                     </li>
                     <li>Building <a href="#plural.stage3" title="17.4.&nbsp;plural.py, stage 3">dynamic functions with <tt class="literal">lambda</tt></a>.
                     </li>
                     <li>Building <a href="#plural.stage4" title="17.5.&nbsp;plural.py, stage 4">closures</a>, dynamic functions that contain surrounding variables as constants.
                     </li>
                     <li>Building <a href="#plural.stage6" title="17.7.&nbsp;plural.py, stage 6">generators</a>, resumable functions that perform incremental logic and return different values each time you call them.
                     </li>
                  </ul>
               </div>
               <p>Adding abstractions, building functions dynamically, building closures, and using generators can all make your code simpler,
                  more readable, and more flexible.  But they can also end up making it more difficult to debug later.  It's up to you to find
                  the right balance between simplicity and power.
               </p>
            </div>
         </div>
         <div class="chapter" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="soundex"></a>Chapter&nbsp;18.&nbsp;Performance Tuning
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="abstract">
               <p>Performance tuning is a many-splendored thing.  Just because <span class="application">Python</span> is an interpreted language doesn't mean you shouldn't worry about code optimization.  But don't worry about it <span class="emphasis"><em>too</em></span> much.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soundex.divein"></a>18.1.&nbsp;Diving in
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>There are so many pitfalls involved in optimizing your code, it's hard to know where to start.</p>
               </div>
               <p>Let's start here: <span class="emphasis"><em>are you sure you need to do it at all?</em></span>  Is your code really so bad?  Is it worth the time to tune it?  Over the lifetime of your application, how much time is going
                  to be spent running that code, compared to the time spent waiting for a remote database server, or waiting for user input?
               </p>
               <p>Second, <span class="emphasis"><em>are you sure you're done coding?</em></span>  Premature optimization is like spreading frosting on a half-baked cake.  You spend hours or days (or more) optimizing your
                  code for performance, only to discover it doesn't do what you need it to do.  That's time down the drain.
               </p>
               <p>This is not to say that code optimization is worthless, but you need to look at the whole system and decide whether it's the
                  best use of your time.  Every minute you spend optimizing code is a minute you're not spending adding new features, or writing
                  documentation, or playing with your kids, or writing unit tests.
               </p>
               <p>Oh yes, unit tests.  It should go without saying that you need a complete set of unit tests before you begin performance tuning.
                  The last thing you need is to introduce new bugs while fiddling with your algorithms.
               </p>
               <p>With these caveats in place, let's look at some techniques for optimizing <span class="application">Python</span> code.  The code in question is an implementation of the Soundex algorithm.  Soundex was a method used in the early 20th century
                  for categorizing surnames in the United States census.  It grouped similar-sounding names together, so even if a name was
                  misspelled, researchers had a chance of finding it.  Soundex is still used today for much the same reason, although of course
                  we use computerized database servers now.  Most database servers include a Soundex function.
               </p>
               <p>There are several subtle variations of the Soundex algorithm.  This is the one used in this chapter:</p>
               <div class="orderedlist">
                  <ol type="1">
                     <li>Keep the first letter of the name as-is.</li>
                     <li>Convert the remaining letters to digits, according to a specific table:
                        <div class="itemizedlist">
                           <ul>
                              <li>B, F, P, and V become 1.</li>
                              <li>C, G, J, K, Q, S, X, and Z become 2.</li>
                              <li>D and T become 3.</li>
                              <li>L becomes 4.</li>
                              <li>M and N become 5.</li>
                              <li>R becomes 6.</li>
                              <li>All other letters become 9.</li>
                           </ul>
                        </div>
                     </li>
                     <li>Remove consecutive duplicates.</li>
                     <li>Remove all 9s altogether.</li>
                     <li>If the result is shorter than four characters (the first letter plus three digits), pad the result with trailing zeros.</li>
                     <li>if the result is longer than four characters, discard everything after the fourth character.</li>
                  </ol>
               </div>
               <p>For example, my name, <tt class="literal">Pilgrim</tt>, becomes P942695.  That has no consecutive duplicates, so nothing to do there.  Then you remove the 9s, leaving P4265.  That's
                  too long, so you discard the excess character, leaving P426.
               </p>
               <p>Another example: <tt class="literal">Woo</tt> becomes W99, which becomes W9, which becomes W, which gets padded with zeros to become W000.
               </p>
               <p>Here's a first attempt at a Soundex function:</p>
               <div class="example"><a name="d0e38889"></a><h3 class="title">Example&nbsp;18.1.&nbsp;<tt class="filename">soundex/stage1/soundex1a.py</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="programlisting">
import string, re

charToSoundex = {"A": "9",
                 "B": "1",
                 "C": "2",
                 "D": "3",
                 "E": "9",
                 "F": "1",
                 "G": "2",
                 "H": "9",
                 "I": "9",
                 "J": "2",
                 "K": "2",
                 "L": "4",
                 "M": "5",
                 "N": "5",
                 "O": "9",
                 "P": "1",
                 "Q": "2",
                 "R": "6",
                 "S": "2",
                 "T": "3",
                 "U": "9",
                 "V": "1",
                 "W": "9",
                 "X": "2",
                 "Y": "9",
                 "Z": "2"}

def soundex(source):
    "convert string to Soundex equivalent"

    # Soundex requirements:
    # source string must be at least 1 character
    # and must consist entirely of letters
    allChars = string.uppercase + string.lowercase
    if not re.search('^[%s]+$' % allChars, source):
        return "0000"

    # Soundex algorithm:
    # 1. make first character uppercase
    source = source[0].upper() + source[1:]
    
    # 2. translate all other characters to Soundex digits
    digits = source[0]
    for s in source[1:]:
        s = s.upper()
        digits += charToSoundex[s]

    # 3. remove consecutive duplicates
    digits2 = digits[0]
    for d in digits[1:]:
        if digits2[-1] != d:
            digits2 += d
        
    # 4. remove all "9"s
    digits3 = re.sub('9', '', digits2)
    
    # 5. pad end with "0"s to 4 characters
    while len(digits3) &lt; 4:
        digits3 += "0"
        
    # 6. return first 4 characters
    return digits3[:4]

if __name__ == '__main__':
    from timeit import Timer
    names = ('Woo', 'Pilgrim', 'Flingjingwaller')
    for name in names:
        statement = "soundex('%s')" % name
        t = Timer(statement, "from __main__ import soundex")
        print name.ljust(15), soundex(name), min(t.repeat())
</pre></div>
               <div class="itemizedlist">
                  <h3 class="title">Further Reading on Soundex</h3>
                  <ul>
                     <li><a href="http://www.avotaynu.com/soundex.html">Soundexing and Genealogy</a> gives a chronology of the evolution of the Soundex and its regional variations.
                     </li>
                  </ul>
               </div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soundex.timeit"></a>18.2.&nbsp;Using the <tt class="filename">timeit</tt> Module
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The most important thing you need to know about optimizing <span class="application">Python</span> code is that you shouldn't write your own timing function.
                  </p>
               </div>
               <p>Timing short pieces of code is incredibly complex.  How much processor time is your computer devoting to running this code?
                  Are there things running in the background?  Are you sure?  Every modern computer has background processes running, some all
                  the time, some intermittently.  Cron jobs fire off at consistent intervals; background services occasionally &#8220;<span class="quote">wake up</span>&#8221; to do useful things like check for new mail, connect to instant messaging servers, check for application updates, scan for
                  viruses, check whether a disk has been inserted into your CD drive in the last 100 nanoseconds, and so on.  Before you start
                  your timing tests, turn everything off and disconnect from the network.  Then turn off all the things you forgot to turn off
                  the first time, then turn off the service that's incessantly checking whether the network has come back yet, then ...
               </p>
               <p>And then there's the matter of the variations introduced by the timing framework itself.  Does the <span class="application">Python</span> interpreter cache method name lookups?  Does it cache code block compilations?  Regular expressions?  Will your code have
                  side effects if run more than once?  Don't forget that you're dealing with small fractions of a second, so small mistakes
                  in your timing framework will irreparably skew your results.
               </p>
               <p>The <span class="application">Python</span> community has a saying: &#8220;<span class="quote"><span class="application">Python</span> comes with batteries included.</span>&#8221;  Don't write your own timing framework.  <span class="application">Python</span> 2.3 comes with a perfectly good one called <tt class="filename">timeit</tt>.
               </p>
               <div class="example"><a name="d0e38948"></a><h3 class="title">Example&nbsp;18.2.&nbsp;Introducing <tt class="filename">timeit</tt></h3>
                  <p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
                  </p><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">import timeit</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t = timeit.Timer("soundex.soundex('Pilgrim')",</span>
<tt class="prompt">...     </tt><span class="userinput">"import soundex")</span>   <a name="soundex.timeit.1.1"></a><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t.timeit()</span>              <a name="soundex.timeit.1.2"></a><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12">
<span class="computeroutput">8.21683733547</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">t.repeat(3, 2000000)</span>    <a name="soundex.timeit.1.3"></a><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12">
<span class="computeroutput">[16.48319309109, 16.46128984923, 16.44203948912]</span>
</pre><div class="calloutlist">
                     <table border="0" summary="Callout list">
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soundex.timeit.1.1"><img src="images/callouts/1.png" alt="1" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The <tt class="filename">timeit</tt> module defines one class, <tt class="classname">Timer</tt>, which takes two arguments.  Both arguments are strings.  The first argument is the statement you wish to time; in this case,
                              you are timing a call to the Soundex function within the <tt class="filename">soundex</tt> with an argument of <tt class="literal">'Pilgrim'</tt>.  The second argument to the <tt class="classname">Timer</tt> class is the import statement that sets up the environment for the statement.  Internally, <tt class="filename">timeit</tt> sets up an isolated virtual environment, manually executes the setup statement (importing the <tt class="filename">soundex</tt> module), then manually compiles and executes the timed statement (calling the Soundex function).
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soundex.timeit.1.2"><img src="images/callouts/2.png" alt="2" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">Once you have the <tt class="classname">Timer</tt> object, the easiest thing to do is call <tt class="methodname">timeit()</tt>, which calls your function 1 million times and returns the number of seconds it took to do it.
                           </td>
                        </tr>
                        <tr>
                           <td width="12" valign="top" align="left"><a href="#soundex.timeit.1.3"><img src="images/callouts/3.png" alt="3" border="0" width="12" height="12"></a> 
                           </td>
                           <td valign="top" align="left">The other major method of the <tt class="classname">Timer</tt> object is <tt class="methodname">repeat()</tt>, which takes two optional arguments.  The first argument is the number of times to repeat the entire test, and the second
                              argument is the number of times to call the timed statement within each test.  Both arguments are optional, and they default
                              to <tt class="literal">3</tt> and <tt class="literal">1000000</tt> respectively.  The <tt class="methodname">repeat()</tt> method returns a list of the times each test cycle took, in seconds.
                           </td>
                        </tr>
                     </table>
                  </div>
               </div><a name="d0e39049"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">You can use the <tt class="filename">timeit</tt> module on the command line to test an existing <span class="application">Python</span> program, without modifying the code.  See <a href="http://docs.python.org/lib/node396.html">http://docs.python.org/lib/node396.html</a> for documentation on the command-line flags.
                     </td>
                  </tr>
               </table>
               <p>Note that <tt class="methodname">repeat()</tt> returns a list of times.  The times will almost never be identical, due to slight variations in how much processor time the
                  <span class="application">Python</span> interpreter is getting (and those pesky background processes that you can't get rid of).  Your first thought might be to
                  say &#8220;<span class="quote">Let's take the average and call that The True Number.</span>&#8221;
               </p>
               <p>In fact, that's almost certainly wrong.  The tests that took longer didn't take longer because of variations in your code
                  or in the <span class="application">Python</span> interpreter; they took longer because of those pesky background processes, or other factors outside of the <span class="application">Python</span> interpreter that you can't fully eliminate.  If the different timing results differ by more than a few percent, you still
                  have too much variability to trust the results.  Otherwise, take the minimum time and discard the rest.
               </p>
               <p><span class="application">Python</span> has a handy <tt class="function">min</tt> function that takes a list and returns the smallest value:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">min(t.repeat(3, 1000000))</span>
<span class="computeroutput">8.22203948912</span>
</pre></div><a name="d0e39097"></a><table class="tip" border="0" summary="">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                  </tr>
                  <tr>
                     <td colspan="2" align="left" valign="top" width="99%">The <tt class="filename">timeit</tt> module only works if you already know what piece of code you need to optimize.  If you have a larger <span class="application">Python</span> program and don't know where your performance problems are, check out <a href="http://docs.python.org/lib/module-hotshot.html">the <tt class="filename">hotshot</tt> module.</a></td>
                  </tr>
               </table>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soundex.stage1"></a>18.3.&nbsp;Optimizing Regular Expressions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The first thing the Soundex function checks is whether the input is a non-empty string of letters.  What's the best way to
                     do this?
                  </p>
               </div>
               <p>If you answered &#8220;<span class="quote">regular expressions</span>&#8221;, go sit in the corner and contemplate your bad instincts.  Regular expressions are almost never the right answer; they should
                  be avoided whenever possible.  Not only for performance reasons, but simply because they're difficult to debug and maintain.
                  Also for performance reasons.
               </p>
               <p>This code fragment from <tt class="filename">soundex/stage1/soundex1a.py</tt> checks whether the function argument <tt class="varname">source</tt> is a word made entirely of letters, with at least one letter (not the empty string):
               </p>
               <div class="informalexample"><pre class="programlisting">
    allChars = string.uppercase + string.lowercase
    if not re.search('^[%s]+$' % allChars, source):
        return "0000"
</pre></div>
               <p>How does <tt class="filename">soundex1a.py</tt> perform?  For convenience, the <tt class="literal">__main__</tt> section of the script contains this code that calls the <tt class="filename">timeit</tt> module, sets up a timing test with three different names, tests each name three times, and displays the minimum time for
                  each:
               </p>
               <div class="informalexample"><pre class="programlisting">
if __name__ == '__main__':
    from timeit import Timer
    names = ('Woo', 'Pilgrim', 'Flingjingwaller')
    for name in names:
        statement = "soundex('%s')" % name
        t = Timer(statement, "from __main__ import soundex")
        print name.ljust(15), soundex(name), min(t.repeat())
</pre></div>
               <p>So how does <tt class="filename">soundex1a.py</tt> perform with this regular expression?
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage1&gt;</tt><span class="userinput">python soundex1a.py</span>
<span class="computeroutput">Woo             W000 19.3356647283
Pilgrim         P426 24.0772053431
Flingjingwaller F452 35.0463220884</span>
</pre></div>
               <p>As you might expect, the algorithm takes significantly longer when called with longer names.  There will be a few things we
                  can do to narrow that gap (make the function take less relative time for longer input), but the nature of the algorithm dictates
                  that it will never run in constant time.
               </p>
               <p>The other thing to keep in mind is that we are testing a representative sample of names.  <tt class="literal">Woo</tt> is a kind of trivial case, in that it gets shorted down to a single letter and then padded with zeros.  <tt class="literal">Pilgrim</tt> is a normal case, of average length and a mixture of significant and ignored letters.  <tt class="literal">Flingjingwaller</tt> is extraordinarily long and contains consecutive duplicates.  Other tests might also be helpful, but this hits a good range
                  of different cases.
               </p>
               <p>So what about that regular expression?  Well, it's inefficient.  Since the expression is testing for ranges of characters
                  (<tt class="literal">A-Z</tt> in uppercase, and <tt class="literal">a-z</tt> in lowercase), we can use a shorthand regular expression syntax.  Here is <tt class="filename">soundex/stage1/soundex1b.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    if not re.search('^[A-Za-z]+$', source):
        return "0000"
</pre></div>
               <p><tt class="filename">timeit</tt> says <tt class="filename">soundex1b.py</tt> is slightly faster than <tt class="filename">soundex1a.py</tt>, but nothing to get terribly excited about:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage1&gt;</tt><span class="userinput">python soundex1b.py</span>
<span class="computeroutput">Woo             W000 17.1361133887
Pilgrim         P426 21.8201693232
Flingjingwaller F452 32.7262294509</span>
</pre></div>
               <p>We saw in <a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">Section&nbsp;15.3, &#8220;Refactoring&#8221;</a> that regular expressions can be compiled and reused for faster results.  Since this regular expression never changes across
                  function calls, we can compile it once and use the compiled version.  Here is <tt class="filename">soundex/stage1/soundex1c.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
isOnlyChars = re.compile('^[A-Za-z]+$').search
def soundex(source):
    if not isOnlyChars(source):
        return "0000"
</pre></div>
               <p>Using a compiled regular expression in <tt class="filename">soundex1c.py</tt> is significantly faster:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage1&gt;</tt><span class="userinput">python soundex1c.py</span>
<span class="computeroutput">Woo             W000 14.5348347346
Pilgrim         P426 19.2784703084
Flingjingwaller F452 30.0893873383</span>
</pre></div>
               <p>But is this the wrong path?  The logic here is simple: the input <tt class="varname">source</tt> needs to be non-empty, and it needs to be composed entirely of letters.  Wouldn't it be faster to write a loop checking each
                  character, and do away with regular expressions altogether?
               </p>
               <p>Here is <tt class="filename">soundex/stage1/soundex1d.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    if not source:
        return "0000"
    for c in source:
        if not ('A' &lt;= c &lt;= 'Z') and not ('a' &lt;= c &lt;= 'z'):
            return "0000"
</pre></div>
               <p>It turns out that this technique in <tt class="filename">soundex1d.py</tt> is <span class="emphasis"><em>not</em></span> faster than using a compiled regular expression (although it is faster than using a non-compiled regular expression):
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage1&gt;</tt><span class="userinput">python soundex1d.py</span>
<span class="computeroutput">Woo             W000 15.4065058548
Pilgrim         P426 22.2753567842
Flingjingwaller F452 37.5845122774</span>
</pre></div>
               <p>Why isn't <tt class="filename">soundex1d.py</tt> faster?  The answer lies in the interpreted nature of <span class="application">Python</span>.  The regular expression engine is written in C, and compiled to run natively on your computer.  On the other hand, this
                  loop is written in <span class="application">Python</span>, and runs through the <span class="application">Python</span> interpreter.  Even though the loop is relatively simple, it's not simple enough to make up for the overhead of being interpreted.
                  Regular expressions are never the right answer... except when they are.
               </p>
               <p>It turns out that <span class="application">Python</span> offers an obscure string method.  You can be excused for not knowing about it, since it's never been mentioned in this book.
                  The method is called <tt class="methodname">isalpha()</tt>, and it checks whether a string contains only letters.
               </p>
               <p>This is <tt class="filename">soundex/stage1/soundex1e.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    if (not source) and (not source.isalpha()):
        return "0000"
</pre></div>
               <p>How much did we gain by using this specific method in <tt class="filename">soundex1e.py</tt>?  Quite a bit.
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage1&gt;</tt><span class="userinput">python soundex1e.py</span>
<span class="computeroutput">Woo             W000 13.5069504644
Pilgrim         P426 18.2199394057
Flingjingwaller F452 28.9975225902</span>
</pre></div>
               <div class="example"><a name="d0e39318"></a><h3 class="title">Example&nbsp;18.3.&nbsp;Best Result So Far: <tt class="filename">soundex/stage1/soundex1e.py</tt></h3><pre class="programlisting">
import string, re

charToSoundex = {"A": "9",
                 "B": "1",
                 "C": "2",
                 "D": "3",
                 "E": "9",
                 "F": "1",
                 "G": "2",
                 "H": "9",
                 "I": "9",
                 "J": "2",
                 "K": "2",
                 "L": "4",
                 "M": "5",
                 "N": "5",
                 "O": "9",
                 "P": "1",
                 "Q": "2",
                 "R": "6",
                 "S": "2",
                 "T": "3",
                 "U": "9",
                 "V": "1",
                 "W": "9",
                 "X": "2",
                 "Y": "9",
                 "Z": "2"}

def soundex(source):
    if (not source) and (not source.isalpha()):
        return "0000"
    source = source[0].upper() + source[1:]
    digits = source[0]
    for s in source[1:]:
        s = s.upper()
        digits += charToSoundex[s]
    digits2 = digits[0]
    for d in digits[1:]:
        if digits2[-1] != d:
            digits2 += d
    digits3 = re.sub('9', '', digits2)
    while len(digits3) &lt; 4:
        digits3 += "0"
    return digits3[:4]

if __name__ == '__main__':
    from timeit import Timer
    names = ('Woo', 'Pilgrim', 'Flingjingwaller')
    for name in names:
        statement = "soundex('%s')" % name
        t = Timer(statement, "from __main__ import soundex")
        print name.ljust(15), soundex(name), min(t.repeat())
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soundex.stage2"></a>18.4.&nbsp;Optimizing Dictionary Lookups
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The second step of the Soundex algorithm is to convert characters to digits in a specific pattern.  What's the best way to
                     do this?
                  </p>
               </div>
               <p>The most obvious solution is to define a dictionary with individual characters as keys and their corresponding digits as values,
                  and do dictionary lookups on each character.  This is what we have in <tt class="filename">soundex/stage1/soundex1c.py</tt> (the current best result so far):
               </p>
               <div class="informalexample"><pre class="programlisting">
charToSoundex = {"A": "9",
                 "B": "1",
                 "C": "2",
                 "D": "3",
                 "E": "9",
                 "F": "1",
                 "G": "2",
                 "H": "9",
                 "I": "9",
                 "J": "2",
                 "K": "2",
                 "L": "4",
                 "M": "5",
                 "N": "5",
                 "O": "9",
                 "P": "1",
                 "Q": "2",
                 "R": "6",
                 "S": "2",
                 "T": "3",
                 "U": "9",
                 "V": "1",
                 "W": "9",
                 "X": "2",
                 "Y": "9",
                 "Z": "2"}

def soundex(source):
    # ... input check omitted for brevity ...
    source = source[0].upper() + source[1:]
    digits = source[0]
    for s in source[1:]:
        s = s.upper()
        digits += charToSoundex[s]
</pre></div>
               <p>You timed <tt class="filename">soundex1c.py</tt> already; this is how it performs:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage1&gt;</tt><span class="userinput">python soundex1c.py</span>
<span class="computeroutput">Woo             W000 14.5341678901
Pilgrim         P426 19.2650071448
Flingjingwaller F452 30.1003563302</span>
</pre></div>
               <p>This code is straightforward, but is it the best solution?  Calling <tt class="methodname">upper()</tt> on each individual character seems inefficient; it would probably be better to call <tt class="methodname">upper()</tt> once on the entire string.
               </p>
               <p>Then there's the matter of incrementally building the <tt class="varname">digits</tt> string.  Incrementally building strings like this is horribly inefficient; internally, the <span class="application">Python</span> interpreter needs to create a new string each time through the loop, then discard the old one.
               </p>
               <p><span class="application">Python</span> is good at lists, though.  It can treat a string as a list of characters automatically.  And lists are easy to combine into
                  strings again, using the string method <tt class="methodname">join()</tt>.
               </p>
               <p>Here is <tt class="filename">soundex/stage2/soundex2a.py</tt>, which converts letters to digits by using &#8614; and <tt class="literal">lambda</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
def soundex(source):
    # ...
    source = source.upper()
    digits = source[0] + "".join(map(lambda c: charToSoundex[c], source[1:]))
</pre></div>
               <p>Surprisingly, <tt class="filename">soundex2a.py</tt> is not faster:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage2&gt;</tt><span class="userinput">python soundex2a.py</span>
<span class="computeroutput">Woo             W000 15.0097526362
Pilgrim         P426 19.254806407
Flingjingwaller F452 29.3790847719</span>
</pre></div>
               <p>The overhead of the anonymous <tt class="literal">lambda</tt> function kills any performance you gain by dealing with the string as a list of characters.
               </p>
               <p><tt class="filename">soundex/stage2/soundex2b.py</tt> uses a list comprehension instead of &#8614; and <tt class="literal">lambda</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    source = source.upper()
    digits = source[0] + "".join([charToSoundex[c] for c in source[1:]])
</pre></div>
               <p>Using a list comprehension in <tt class="filename">soundex2b.py</tt> is faster than using &#8614; and <tt class="literal">lambda</tt> in <tt class="filename">soundex2a.py</tt>, but still not faster than the original code (incrementally building a string in <tt class="filename">soundex1c.py</tt>):
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage2&gt;</tt><span class="userinput">python soundex2b.py</span>
<span class="computeroutput">Woo             W000 13.4221324219
Pilgrim         P426 16.4901234654
Flingjingwaller F452 25.8186157738</span>
</pre></div>
               <p>It's time for a radically different approach.  Dictionary lookups are a general purpose tool.  Dictionary keys can be any
                  length string (or many other data types), but in this case we are only dealing with single-character keys <span class="emphasis"><em>and</em></span> single-character values.  It turns out that <span class="application">Python</span> has a specialized function for handling exactly this situation: the <tt class="function">string.maketrans</tt> function.
               </p>
               <p>This is <tt class="filename">soundex/stage2/soundex2c.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
allChar = string.uppercase + string.lowercase
charToSoundex = string.maketrans(allChar, "91239129922455912623919292" * 2)
def soundex(source):
    # ...
    digits = source[0].upper() + source[1:].translate(charToSoundex)
</pre></div>
               <p>What the heck is going on here?  <tt class="function">string.maketrans</tt> creates a translation matrix between two strings: the first argument and the second argument.  In this case, the first argument
                  is the string <tt class="literal">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz</tt>, and the second argument is the string <tt class="literal">9123912992245591262391929291239129922455912623919292</tt>.  See the pattern?  It's the same conversion pattern we were setting up longhand with a dictionary.  A maps to 9, B maps
                  to 1, C maps to 2, and so forth.  But it's not a dictionary; it's a specialized data structure that you can access using the
                  string method <tt class="methodname">translate</tt>, which translates each character into the corresponding digit, according to the matrix defined by <tt class="function">string.maketrans</tt>.
               </p>
               <p><tt class="filename">timeit</tt> shows that <tt class="filename">soundex2c.py</tt> is significantly faster than defining a dictionary and looping through the input and building the output incrementally:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage2&gt;</tt><span class="userinput">python soundex2c.py</span>
<span class="computeroutput">Woo             W000 11.437645008
Pilgrim         P426 13.2825062962
Flingjingwaller F452 18.5570110168</span>
</pre></div>
               <p>You're not going to get much better than that.  <span class="application">Python</span> has a specialized function that does exactly what you want to do; use it and move on.
               </p>
               <div class="example"><a name="d0e39507"></a><h3 class="title">Example&nbsp;18.4.&nbsp;Best Result So Far: <tt class="filename">soundex/stage2/soundex2c.py</tt></h3><pre class="programlisting">
import string, re

allChar = string.uppercase + string.lowercase
charToSoundex = string.maketrans(allChar, "91239129922455912623919292" * 2)
isOnlyChars = re.compile('^[A-Za-z]+$').search

def soundex(source):
    if not isOnlyChars(source):
        return "0000"
    digits = source[0].upper() + source[1:].translate(charToSoundex)
    digits2 = digits[0]
    for d in digits[1:]:
        if digits2[-1] != d:
            digits2 += d
    digits3 = re.sub('9', '', digits2)
    while len(digits3) &lt; 4:
        digits3 += "0"
    return digits3[:4]

if __name__ == '__main__':
    from timeit import Timer
    names = ('Woo', 'Pilgrim', 'Flingjingwaller')
    for name in names:
        statement = "soundex('%s')" % name
        t = Timer(statement, "from __main__ import soundex")
        print name.ljust(15), soundex(name), min(t.repeat())
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soundex.stage3"></a>18.5.&nbsp;Optimizing List Operations
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The third step in the Soundex algorithm is eliminating consecutive duplicate digits.  What's the best way to do this?</p>
               </div>
               <p>Here's the code we have so far, in <tt class="filename">soundex/stage2/soundex2c.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits2 = digits[0]
    for d in digits[1:]:
        if digits2[-1] != d:
            digits2 += d
</pre></div>
               <p>Here are the performance results for <tt class="filename">soundex2c.py</tt>:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage2&gt;</tt><span class="userinput">python soundex2c.py</span>
<span class="computeroutput">Woo             W000 12.6070768771
Pilgrim         P426 14.4033353401
Flingjingwaller F452 19.7774882003</span>
</pre></div>
               <p>The first thing to consider is whether it's efficient to check <tt class="varname">digits[-1]</tt> each time through the loop.  Are list indexes expensive?  Would we be better off maintaining the last digit in a separate
                  variable, and checking that instead?
               </p>
               <p>To answer this question, here is <tt class="filename">soundex/stage3/soundex3a.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits2 = ''
    last_digit = ''
    for d in digits:
        if d != last_digit:
            digits2 += d
            last_digit = d
</pre></div>
               <p><tt class="filename">soundex3a.py</tt> does not run any faster than <tt class="filename">soundex2c.py</tt>, and may even be slightly slower (although it's not enough of a difference to say for sure):
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage3&gt;</tt><span class="userinput">python soundex3a.py</span>
<span class="computeroutput">Woo             W000 11.5346048171
Pilgrim         P426 13.3950636184
Flingjingwaller F452 18.6108927252</span>
</pre></div>
               <p>Why isn't <tt class="filename">soundex3a.py</tt> faster?  It turns out that list indexes in <span class="application">Python</span> are extremely efficient.  Repeatedly accessing <tt class="varname">digits2[-1]</tt> is no problem at all.  On the other hand, manually maintaining the last seen digit in a separate variable means we have <span class="emphasis"><em>two</em></span> variable assignments for each digit we're storing, which wipes out any small gains we might have gotten from eliminating
                  the list lookup.
               </p>
               <p>Let's try something radically different.  If it's possible to treat a string as a list of characters, it should be possible
                  to use a list comprehension to iterate through the list.  The problem is, the code needs access to the previous character
                  in the list, and that's not easy to do with a straightforward list comprehension.
               </p>
               <p>However, it is possible to create a list of index numbers using the built-in <tt class="function">range()</tt> function, and use those index numbers to progressively search through the list and pull out each character that is different
                  from the previous character.  That will give you a list of characters, and you can use the string method <tt class="methodname">join()</tt> to reconstruct a string from that.
               </p>
               <p>Here is <tt class="filename">soundex/stage3/soundex3b.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits2 = "".join([digits[i] for i in range(len(digits))
                       if i == 0 or digits[i-1] != digits[i]])
</pre></div>
               <p>Is this faster?  In a word, no.</p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage3&gt;</tt><span class="userinput">python soundex3b.py</span>
<span class="computeroutput">Woo             W000 14.2245271396
Pilgrim         P426 17.8337165757
Flingjingwaller F452 25.9954005327</span>
</pre></div>
               <p>It's possible that the techniques so far as have been &#8220;<span class="quote">string-centric</span>&#8221;.  <span class="application">Python</span> can convert a string into a list of characters with a single command: <tt class="function">list('abc')</tt> returns <tt class="literal">['a', 'b', 'c']</tt>.  Furthermore, lists can be <span class="emphasis"><em>modified in place</em></span> very quickly.  Instead of incrementally building a new list (or string) out of the source string, why not move elements around
                  within a single list?
               </p>
               <p>Here is <tt class="filename">soundex/stage3/soundex3c.py</tt>, which modifies a list in place to remove consecutive duplicate elements:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits = list(source[0].upper() + source[1:].translate(charToSoundex))
    i=0
    for item in digits:
        if item==digits[i]: continue
        i+=1
        digits[i]=item
    del digits[i+1:]
    digits2 = "".join(digits)
</pre></div>
               <p>Is this faster than <tt class="filename">soundex3a.py</tt> or <tt class="filename">soundex3b.py</tt>?  No, in fact it's the slowest method yet:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage3&gt;</tt><span class="userinput">python soundex3c.py</span>
<span class="computeroutput">Woo             W000 14.1662554878
Pilgrim         P426 16.0397885765
Flingjingwaller F452 22.1789341942</span>
</pre></div>
               <p>We haven't made any progress here at all, except to try and rule out several &#8220;<span class="quote">clever</span>&#8221; techniques.  The fastest code we've seen so far was the original, most straightforward method (<tt class="filename">soundex2c.py</tt>).  Sometimes it doesn't pay to be clever.
               </p>
               <div class="example"><a name="d0e39674"></a><h3 class="title">Example&nbsp;18.5.&nbsp;Best Result So Far: <tt class="filename">soundex/stage2/soundex2c.py</tt></h3><pre class="programlisting">
import string, re

allChar = string.uppercase + string.lowercase
charToSoundex = string.maketrans(allChar, "91239129922455912623919292" * 2)
isOnlyChars = re.compile('^[A-Za-z]+$').search

def soundex(source):
    if not isOnlyChars(source):
        return "0000"
    digits = source[0].upper() + source[1:].translate(charToSoundex)
    digits2 = digits[0]
    for d in digits[1:]:
        if digits2[-1] != d:
            digits2 += d
    digits3 = re.sub('9', '', digits2)
    while len(digits3) &lt; 4:
        digits3 += "0"
    return digits3[:4]

if __name__ == '__main__':
    from timeit import Timer
    names = ('Woo', 'Pilgrim', 'Flingjingwaller')
    for name in names:
        statement = "soundex('%s')" % name
        t = Timer(statement, "from __main__ import soundex")
        print name.ljust(15), soundex(name), min(t.repeat())
</pre></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soundex.stage4"></a>18.6.&nbsp;Optimizing String Manipulation
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>The final step of the Soundex algorithm is padding short results with zeros, and truncating long results.  What is the best
                     way to do this?
                  </p>
               </div>
               <p>This is what we have so far, taken from <tt class="filename">soundex/stage2/soundex2c.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits3 = re.sub('9', '', digits2)
    while len(digits3) &lt; 4:
        digits3 += "0"
    return digits3[:4]
</pre></div>
               <p>These are the results for <tt class="filename">soundex2c.py</tt>:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage2&gt;</tt><span class="userinput">python soundex2c.py</span>
<span class="computeroutput">Woo             W000 12.6070768771
Pilgrim         P426 14.4033353401
Flingjingwaller F452 19.7774882003</span>
</pre></div>
               <p>The first thing to consider is replacing that regular expression with a loop.  This code is from <tt class="filename">soundex/stage4/soundex4a.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits3 = ''
    for d in digits2:
        if d != '9':
            digits3 += d
</pre></div>
               <p>Is <tt class="filename">soundex4a.py</tt> faster?  Yes it is:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage4&gt;</tt><span class="userinput">python soundex4a.py</span>
<span class="computeroutput">Woo             W000 6.62865531792
Pilgrim         P426 9.02247576158
Flingjingwaller F452 13.6328416042</span>
</pre></div>
               <p>But wait a minute.  A loop to remove characters from a string?  We can use a simple string method for that.  Here's <tt class="filename">soundex/stage4/soundex4b.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits3 = digits2.replace('9', '')
</pre></div>
               <p>Is <tt class="filename">soundex4b.py</tt> faster?  That's an interesting question.  It depends on the input:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage4&gt;</tt><span class="userinput">python soundex4b.py</span>
<span class="computeroutput">Woo             W000 6.75477414029
Pilgrim         P426 7.56652144337
Flingjingwaller F452 10.8727729362</span>
</pre></div>
               <p>The string method in <tt class="filename">soundex4b.py</tt> is faster than the loop for most names, but it's actually slightly slower than <tt class="filename">soundex4a.py</tt> in the trivial case (of a very short name).  Performance optimizations aren't always uniform; tuning that makes one case
                  faster can sometimes make other cases slower.  In this case, the majority of cases will benefit from the change, so let's
                  leave it at that, but the principle is an important one to remember.
               </p>
               <p>Last but not least, let's examine the final two steps of the algorithm: padding short results with zeros, and truncating long
                  results to four characters.  The code you see in <tt class="filename">soundex4b.py</tt> does just that, but it's horribly inefficient.  Take a look at <tt class="filename">soundex/stage4/soundex4c.py</tt> to see why:
               </p>
               <div class="informalexample"><pre class="programlisting">
    digits3 += '000'
    return digits3[:4]
</pre></div>
               <p>Why do we need a <tt class="literal">while</tt> loop to pad out the result?  We know in advance that we're going to truncate the result to four characters, and we know that
                  we already have at least one character (the initial letter, which is passed unchanged from the original <tt class="varname">source</tt> variable).  That means we can simply add three zeros to the output, then truncate it.  Don't get stuck in a rut over the
                  exact wording of the problem; looking at the problem slightly differently can lead to a simpler solution.
               </p>
               <p>How much speed do we gain in <tt class="filename">soundex4c.py</tt> by dropping the <tt class="literal">while</tt> loop?  It's significant:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage4&gt;</tt><span class="userinput">python soundex4c.py</span>
<span class="computeroutput">Woo             W000 4.89129791636
Pilgrim         P426 7.30642134685
Flingjingwaller F452 10.689832367</span>
</pre></div>
               <p>Finally, there is still one more thing you can do to these three lines of code to make them faster: you can combine them into
                  one line.  Take a look at <tt class="filename">soundex/stage4/soundex4d.py</tt>:
               </p>
               <div class="informalexample"><pre class="programlisting">
    return (digits2.replace('9', '') + '000')[:4]
</pre></div>
               <p>Putting all this code on one line in <tt class="filename">soundex4d.py</tt> is barely faster than <tt class="filename">soundex4c.py</tt>:
               </p>
               <div class="informalexample"><pre class="screen">
<tt class="prompt">C:\samples\soundex\stage4&gt;</tt><span class="userinput">python soundex4d.py</span>
<span class="computeroutput">Woo             W000 4.93624105857
Pilgrim         P426 7.19747593619
Flingjingwaller F452 10.5490700634</span>
</pre></div>
               <p>It is also significantly less readable, and for not much performance gain.  Is that worth it?  I hope you have good comments.
                  Performance isn't everything.  Your optimization efforts must always be balanced against threats to your program's readability
                  and maintainability.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="soundex.summary"></a>18.7.&nbsp;Summary
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="abstract">
                  <p>This chapter has illustrated several important aspects of performance tuning in <span class="application">Python</span>, and performance tuning in general.
                  </p>
               </div>
               <div class="itemizedlist">
                  <ul>
                     <li>If you need to choose between regular expressions and writing a loop, choose regular expressions.  The regular expression
                        engine is compiled in C and runs natively on your computer; your loop is written in <span class="application">Python</span> and runs through the <span class="application">Python</span> interpreter.
                     </li>
                     <li>If you need to choose between regular expressions and string methods, choose string methods.  Both are compiled in C, so choose
                        the simpler one.
                     </li>
                     <li>General-purpose dictionary lookups are fast, but specialtiy functions such as <tt class="function">string.maketrans</tt> and string methods such as <tt class="methodname">isalpha()</tt> are faster.  If <span class="application">Python</span> has a custom-tailored function for you, use it.
                     </li>
                     <li>Don't be too clever.  Sometimes the most obvious algorithm is also the fastest.</li>
                     <li>Don't sweat it too much.  Performance isn't everything.</li>
                  </ul>
               </div>
               <p>I can't emphasize that last point strongly enough.  Over the course of this chapter, you made this function three times faster
                  and saved 20 seconds over 1 million function calls.  Great.  Now think: over the course of those million function calls, how
                  many seconds will your surrounding application wait for a database connection?  Or wait for disk I/O?  Or wait for user input?
                  Don't spend too much time over-optimizing one algorithm, or you'll ignore obvious improvements somewhere else.  Develop an
                  instinct for the sort of code that <span class="application">Python</span> runs well, correct obvious blunders if you find them, and leave the rest alone.
               </p>
            </div>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="furtherreading"></a>Appendix&nbsp;A.&nbsp;Further reading
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <p><a href="../#install">Chapter&nbsp;1.&nbsp;Installing Python</a></p>
            <ul></ul>
            <p><a href="../#odbchelper">Chapter&nbsp;2.&nbsp;Your First Python Program</a></p>
            <ul>
               <li><a href="../#odbchelper.docstring">2.3.&nbsp;Documenting Functions</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/peps/pep-0257.html">PEP 257</a> defines <tt class="literal">doc string</tt> conventions.
                     </li>
                     <li><a href="http://www.python.org/doc/essays/styleguide.html"><i class="citetitle"><span class="application">Python</span> Style Guide</i></a> discusses how to write a good <tt class="literal">doc string</tt>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses conventions for <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006750000000000000000">spacing in <tt class="literal">doc string</tt>s</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e4665">2.4.2.&nbsp;What's an Object?</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> explains exactly what it means to say that <a href="http://www.python.org/doc/current/ref/objects.html">everything in <span class="application">Python</span> is an object</a>, because some people are pedantic and like to discuss this sort of thing at great length.
                     </li>
                     <li><a href="http://www.effbot.org/guides/">eff-bot</a> summarizes <a href="http://www.effbot.org/guides/python-objects.htm"><span class="application">Python</span> objects</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.indenting">2.5.&nbsp;Indenting Code</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> discusses cross-platform indentation issues and <a href="http://www.python.org/doc/current/ref/indentation.html">shows various indentation errors</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/essays/styleguide.html"><i class="citetitle"><span class="application">Python</span> Style Guide</i></a> discusses good indentation style.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.testing">2.6.&nbsp;Testing Modules</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> discusses the low-level details of <a href="http://www.python.org/doc/current/ref/import.html">importing modules</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#datatypes">Chapter&nbsp;3.&nbsp;Native Datatypes</a></p>
            <ul>
               <li><a href="../#d0e5450">3.1.3.&nbsp;Deleting Items From Dictionaries</a><p></p>
                  <ul>
                     <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> teaches about dictionaries and shows how to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap10.htm">use dictionaries to model sparse matrices</a>.
                     </li>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> has a lot of <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/541">example code using dictionaries</a>.
                     </li>
                     <li><a href="http://www.activestate.com/ASPN/Python/Cookbook/" title="growing archive of annotated code samples"><span class="application">Python</span> Cookbook</a> discusses <a href="http://www.activestate.com/ASPN/Python/Cookbook/Recipe/52306">how to sort the values of a dictionary by key</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/typesmapping.html">all the dictionary methods</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e6392">3.2.5.&nbsp;Using List Operators</a><p></p>
                  <ul>
                     <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> teaches about lists and makes an important point about <a href="http://www.ibiblio.org/obp/thinkCSpy/chap08.htm">passing lists as function arguments</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007110000000000000000">use lists as stacks and queues</a>.
                     </li>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/534">common questions about lists</a> and has a lot of <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/540">example code using lists</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/typesseq-mutable.html">all the list methods</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.tuple">3.3.&nbsp;Introducing Tuples</a><p></p>
                  <ul>
                     <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> teaches about tuples and shows how to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap10.htm">concatenate tuples</a>.
                     </li>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> shows how to <a href="http://www.faqts.com/knowledge-base/view.phtml/aid/4553/fid/587">sort a tuple</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007300000000000000000">define a tuple with one element</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.multiassign">3.4.2.&nbsp;Assigning Multiple Values at Once</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> shows examples of <a href="http://www.python.org/doc/current/ref/implicit-joining.html">when you can skip the line continuation character</a> and <a href="http://www.python.org/doc/current/ref/explicit-joining.html">when you need to use it</a>.
                     </li>
                     <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> shows how to use multi-variable assignment to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap09.htm">swap the values of two variables</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.stringformatting">3.5.&nbsp;Formatting Strings</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/typesseq-strings.html">all the string formatting format characters</a>.
                     </li>
                     <li><a href="http://www-gnats.gnu.org:8080/cgi-bin/info2www?(gawk)Top"><i class="citetitle">Effective <span class="acronym">AWK</span> Programming</i></a> discusses <a href="http://www-gnats.gnu.org:8080/cgi-bin/info2www?(gawk)Control+Letters">all the format characters</a> and advanced string formatting techniques like <a href="http://www-gnats.gnu.org:8080/cgi-bin/info2www?(gawk)Format+Modifiers">specifying width, precision, and zero-padding</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.map">3.6.&nbsp;Mapping Lists</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses another way to map lists <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007130000000000000000">using the built-in <tt class="function">map</tt> function</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007140000000000000000">do nested list comprehensions</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.join">3.7.&nbsp;Joining Lists and Splitting Strings</a><p></p>
                  <ul>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/480">common questions about strings</a> and has a lot of <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/539">example code using strings</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/string-methods.html">all the string methods</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-string.html"><tt class="filename">string</tt> module</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/FAQ.html"><i class="citetitle">The Whole <span class="application">Python</span> <span class="acronym">FAQ</span></i></a> explains <a href="http://www.python.org/cgi-bin/faqw.py?query=4.96&amp;querytype=simple&amp;casefold=yes&amp;req=search">why <tt class="function">join</tt> is a string method</a> instead of a list method.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#apihelper">Chapter&nbsp;4.&nbsp;The Power Of Introspection</a></p>
            <ul>
               <li><a href="../#apihelper.optional">4.2.&nbsp;Using Optional and Named Arguments</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses exactly <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006710000000000000000">when and how default arguments are evaluated</a>, which matters when the default value is a list or an expression with side effects.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e8958">4.3.3.&nbsp;Built-In Functions</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents <a href="http://www.python.org/doc/current/lib/built-in-funcs.html">all the built-in functions</a> and <a href="http://www.python.org/doc/current/lib/module-exceptions.html">all the built-in exceptions</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#apihelper.filter">4.5.&nbsp;Filtering Lists</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses another way to filter lists <a href="http://www.python.org/doc/current/tut/node7.html#SECTION007130000000000000000">using the built-in <tt class="function">filter</tt> function</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e9975">4.6.1.&nbsp;Using the and-or Trick</a><p></p>
                  <ul>
                     <li><a href="http://www.activestate.com/ASPN/Python/Cookbook/" title="growing archive of annotated code samples"><span class="application">Python</span> Cookbook</a> discusses <a href="http://www.activestate.com/ASPN/Python/Cookbook/Recipe/52310">alternatives to the <tt class="literal">and-or</tt> trick</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e10403">4.7.1.&nbsp;Real-World lambda Functions</a><p></p>
                  <ul>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> discusses using <tt class="literal">lambda</tt> to <a href="http://www.faqts.com/knowledge-base/view.phtml/aid/6081/fid/241">call functions indirectly</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> shows how to <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006740000000000000000">access outside variables from inside a <tt class="literal">lambda</tt> function</a>.  (<a href="http://python.sourceforge.net/peps/pep-0227.html"><span class="acronym">PEP</span> 227</a> explains how this will change in future versions of <span class="application">Python</span>.)
                     </li>
                     <li><a href="http://www.python.org/doc/FAQ.html"><i class="citetitle">The Whole <span class="application">Python</span> <span class="acronym">FAQ</span></i></a> has examples of <a href="http://www.python.org/cgi-bin/faqw.py?query=4.15&amp;querytype=simple&amp;casefold=yes&amp;req=search">obfuscated one-liners using <tt class="literal">lambda</tt></a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#fileinfo">Chapter&nbsp;5.&nbsp;Objects and Object-Orientation</a></p>
            <ul>
               <li><a href="../#fileinfo.fromimport">5.2.&nbsp;Importing Modules Using from module import</a><p></p>
                  <ul>
                     <li><a href="http://www.effbot.org/guides/">eff-bot</a> has more to say on <a href="http://www.effbot.org/guides/import-confusion.htm"><tt class="literal">import <i class="replaceable">module</i></tt> <span class="foreignphrase"><i class="foreignphrase"><span class="acronym">vs.</span></i></span> <tt class="literal">from <i class="replaceable">module</i> import</tt></a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses advanced import techniques, including <a href="http://www.python.org/doc/current/tut/node8.html#SECTION008410000000000000000"><tt class="literal">from <i class="replaceable">module</i> import *</tt></a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e11896">5.3.2.&nbsp;Knowing When to Use self and __init__</a><p></p>
                  <ul>
                     <li><a href="http://www.freenetpages.co.uk/hp/alan.gauld/" title="Python book for first-time programmers"><i class="citetitle">Learning to Program</i></a> has a gentler <a href="http://www.freenetpages.co.uk/hp/alan.gauld/tutclass.htm">introduction to classes</a>.
                     </li>
                     <li><a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> shows how to <a href="http://www.ibiblio.org/obp/thinkCSpy/chap12.htm">use classes to model compound datatypes</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> has an in-depth look at <a href="http://www.python.org/doc/current/tut/node11.html">classes, namespaces, and inheritance</a>.
                     </li>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/242">common questions about classes</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e12165">5.4.1.&nbsp;Garbage Collection</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/specialattrs.html">built-in attributes like <tt class="literal">__class__</tt></a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-gc.html"><tt class="filename">gc</tt> module</a>, which gives you low-level control over <span class="application">Python</span>'s garbage collection.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.userdict">5.5.&nbsp;Exploring UserDict: A Wrapper Class</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-UserDict.html"><tt class="filename">UserDict</tt> module</a> and the <a href="http://www.python.org/doc/current/lib/module-copy.html"><tt class="filename">copy</tt> module</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.morespecial">5.7.&nbsp;Advanced Special Class Methods</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> documents <a href="http://www.python.org/doc/current/ref/specialnames.html">all the special class methods</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.private">5.9.&nbsp;Private Functions</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses the inner workings of <a href="http://www.python.org/doc/current/tut/node11.html#SECTION0011600000000000000000">private variables</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#filehandling">Chapter&nbsp;6.&nbsp;Exceptions and File Handling</a></p>
            <ul>
               <li><a href="../#d0e14344">6.1.1.&nbsp;Using Exceptions For Other Purposes</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses <a href="http://www.python.org/doc/current/tut/node10.html#SECTION0010400000000000000000">defining and raising your own exceptions, and handling multiple exceptions at once</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/module-exceptions.html">all the built-in exceptions</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-getpass.html">getpass</a> module.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-traceback.html"><tt class="filename">traceback</tt> module</a>, which provides low-level access to exception attributes after an exception is raised.
                     </li>
                     <li><a href="http://www.python.org/doc/current/ref/"><i class="citetitle"><span class="application">Python</span> Reference Manual</i></a> discusses the inner workings of the <a href="http://www.python.org/doc/current/ref/try.html"><tt class="literal">try...except</tt> block</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e15055">6.2.4.&nbsp;Writing to Files</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses reading and writing files, including how to <a href="http://www.python.org/doc/current/tut/node9.html#SECTION009210000000000000000">read a file one line at a time into a list</a>.
                     </li>
                     <li><a href="http://www.effbot.org/guides/">eff-bot</a> discusses efficiency and performance of <a href="http://www.effbot.org/guides/readline-performance.htm">various ways of reading a file</a>.
                     </li>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/552">common questions about files</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes <a href="http://www.python.org/doc/current/lib/bltin-file-objects.html">all the file object methods</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.modules">6.4.&nbsp;Using sys.modules</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/doc/current/tut/tut.html"><i class="citetitle"><span class="application">Python</span> Tutorial</i></a> discusses exactly <a href="http://www.python.org/doc/current/tut/node6.html#SECTION006710000000000000000">when and how default arguments are evaluated</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-sys.html"><tt class="filename">sys</tt></a> module.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.os">6.5.&nbsp;Working with Directories</a><p></p>
                  <ul>
                     <li><a href="http://www.faqts.com/knowledge-base/index.phtml/fid/199/"><span class="application">Python</span> Knowledge Base</a> answers <a href="http://www.faqts.com/knowledge-base/index.phtml/fid/240">questions about the <tt class="filename">os</tt> module</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> documents the <a href="http://www.python.org/doc/current/lib/module-os.html"><tt class="filename">os</tt></a> module and the <a href="http://www.python.org/doc/current/lib/module-os.path.html"><tt class="filename">os.path</tt></a> module.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#re">Chapter&nbsp;7.&nbsp;Regular Expressions</a></p>
            <ul>
               <li><a href="../#re.phone">7.6.&nbsp;Case study: Parsing Phone Numbers</a><p></p>
                  <ul>
                     <li><a href="http://py-howto.sourceforge.net/regex/regex.html">Regular Expression HOWTO</a> teaches about regular expressions and how to use them in <span class="application">Python</span>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes the <a href="http://www.python.org/doc/current/lib/module-re.html"><tt class="filename">re</tt> module</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#dialect">Chapter&nbsp;8.&nbsp;HTML Processing</a></p>
            <ul>
               <li><a href="../#dialect.basehtml">8.4.&nbsp;Introducing BaseHTMLProcessor.py</a><p></p>
                  <ul>
                     <li><a href="http://www.w3.org/">W3C</a> discusses <a href="http://www.w3.org/TR/REC-html40/charset.html#entities">character and entity references</a>.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> confirms your suspicions that <a href="http://www.python.org/doc/current/lib/module-htmlentitydefs.html">the <tt class="filename">htmlentitydefs</tt> module</a> is exactly what it sounds like.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.alltogether">8.9.&nbsp;Putting it all together</a><p></p>
                  <ul>
                     <li>You thought I was kidding about the server-side scripting idea.  So did I, until I found <a href="http://rinkworks.com/dialect/">this web-based dialectizer</a>.  Unfortunately, source code does not appear to be available.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#kgp">Chapter&nbsp;9.&nbsp;XML Processing</a></p>
            <ul>
               <li><a href="../#kgp.unicode">9.4.&nbsp;Unicode</a><p></p>
                  <ul>
                     <li><a href="http://www.unicode.org/">Unicode.org</a> is the home page of the unicode standard, including a brief <a href="http://www.unicode.org/standard/principles.html">technical introduction</a>.
                     </li>
                     <li><a href="http://www.reportlab.com/i18n/python_unicode_tutorial.html">Unicode Tutorial</a> has some more examples of how to use <span class="application">Python</span>'s unicode functions, including how to force <span class="application">Python</span> to coerce unicode into <span class="acronym">ASCII</span> even when it doesn't really want to.
                     </li>
                     <li><a href="http://www.python.org/peps/pep-0263.html">PEP 263</a> goes into more detail about how and when to define a character encoding in your <tt class="filename">.py</tt> files.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#streams">Chapter&nbsp;10.&nbsp;Scripts and Streams</a></p>
            <ul></ul>
            <p><a href="../#oa">Chapter&nbsp;11.&nbsp;HTTP Web Services</a></p>
            <ul>
               <li><a href="../#oa.divein">11.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li>Paul Prescod believes that <a href="http://webservices.xml.com/pub/a/ws/2002/02/06/rest.html">pure HTTP web services are the future of the Internet</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#soap">Chapter&nbsp;12.&nbsp;SOAP Web Services</a></p>
            <ul>
               <li><a href="../#soap.divein">12.1.&nbsp;Diving In</a><p></p>
                  <ul>
                     <li><a href="http://www.xmethods.net/">http://www.xmethods.net/</a> is a repository of public access <span class="acronym">SOAP</span> web services.
                     </li>
                     <li>The <a href="http://www.w3.org/TR/soap/"><span class="acronym">SOAP</span> specification</a> is surprisingly readable, if you like that sort of thing.
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soap.troubleshooting">12.8.&nbsp;Troubleshooting SOAP Web Services</a><p></p>
                  <ul>
                     <li><a href="http://www-106.ibm.com/developerworks/webservices/library/ws-pyth17.html">New developments for <span class="application">SOAPpy</span></a> steps through trying to connect to another <span class="acronym">SOAP</span> service that doesn't quite work as advertised.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#roman">Chapter&nbsp;13.&nbsp;Unit Testing</a></p>
            <ul>
               <li><a href="../#roman.intro">13.1.&nbsp;Introduction to Roman numerals</a><p></p>
                  <ul>
                     <li><a href="http://www.wilkiecollins.demon.co.uk/roman/front.htm">This site</a> has more on Roman numerals, including a fascinating <a href="http://www.wilkiecollins.demon.co.uk/roman/intro.htm">history</a> of how Romans and other civilizations really used them (short answer: haphazardly and inconsistently).
                     </li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.romantest">13.3.&nbsp;Introducing romantest.py</a><p></p>
                  <ul>
                     <li><a href="http://pyunit.sourceforge.net/">The <span class="application">PyUnit</span> home page</a> has an in-depth discussion of <a href="http://pyunit.sourceforge.net/pyunit.html">using the <tt class="filename">unittest</tt> framework</a>, including advanced features not covered in this chapter.
                     </li>
                     <li><a href="http://pyunit.sourceforge.net/pyunit.html">The <span class="application">PyUnit</span> <span class="acronym">FAQ</span></a> explains <a href="http://pyunit.sourceforge.net/pyunit.html#WHERE">why test cases are stored separately</a> from the code they test.
                     </li>
                     <li><a href="http://www.python.org/doc/current/lib/"><i class="citetitle"><span class="application">Python</span> Library Reference</i></a> summarizes the <a href="http://www.python.org/doc/current/lib/module-unittest.html"><tt class="filename">unittest</tt></a> module.
                     </li>
                     <li><a href="http://www.extremeprogramming.org/">ExtremeProgramming.org</a> discusses <a href="http://www.extremeprogramming.org/rules/unittests.html">why you should write unit tests</a>.
                     </li>
                     <li><a href="http://www.c2.com/cgi/wiki">The Portland Pattern Repository</a> has an ongoing discussion of <a href="http://www.c2.com/cgi/wiki?UnitTests">unit tests</a>, including a <a href="http://www.c2.com/cgi/wiki?StandardDefinitionOfUnitTest">standard definition</a>, why you should <a href="http://www.c2.com/cgi/wiki?CodeUnitTestFirst">code unit tests first</a>, and several in-depth <a href="http://www.c2.com/cgi/wiki?UnitTestTrial">case studies</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#roman1.5">Chapter&nbsp;14.&nbsp;Test-First Programming</a></p>
            <ul></ul>
            <p><a href="../#roman2">Chapter&nbsp;15.&nbsp;Refactoring</a></p>
            <ul>
               <li><a href="../#roman.summary">15.5.&nbsp;Summary</a><p></p>
                  <ul>
                     <li><a href="http://www.xprogramming.com/">XProgramming.com</a> has links to <a href="http://www.xprogramming.com/software.htm">download unit testing frameworks</a> for many different languages.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#regression">Chapter&nbsp;16.&nbsp;Functional Programming</a></p>
            <ul></ul>
            <p><a href="../#plural">Chapter&nbsp;17.&nbsp;Dynamic functions</a></p>
            <ul>
               <li><a href="../#plural.stage6">17.7.&nbsp;plural.py, stage 6</a><p></p>
                  <ul>
                     <li><a href="http://www.python.org/peps/pep-0255.html">PEP 255</a> defines generators.
                     </li>
                     <li><a href="http://www.activestate.com/ASPN/Python/Cookbook/" title="growing archive of annotated code samples"><span class="application">Python</span> Cookbook</a> has <a href="http://www.google.com/search?q=generators+cookbook+site:aspn.activestate.com">many more examples of generators</a>.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#soundex">Chapter&nbsp;18.&nbsp;Performance Tuning</a></p>
            <ul>
               <li><a href="../#soundex.divein">18.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li><a href="http://www.avotaynu.com/soundex.html">Soundexing and Genealogy</a> gives a chronology of the evolution of the Soundex and its regional variations.
                     </li>
                  </ul>
                  <p></p>
               </li>
            </ul>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="abstracts"></a>Appendix&nbsp;B.&nbsp;A 5-minute review
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <p><a href="../#install">Chapter&nbsp;1.&nbsp;Installing Python</a></p>
            <ul>
               <li><a href="../#install.choosing">1.1.&nbsp;Which Python is right for you?</a><blockquote>
                     <div class="abstract">
                        <p>The first thing you need to do with <span class="application">Python</span> is install it.  Or do you?
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.windows">1.2.&nbsp;Python on Windows</a><blockquote>
                     <div class="abstract">
                        <p>On Windows, you have a couple choices for installing <span class="application">Python</span>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.macosx">1.3.&nbsp;Python on Mac OS X</a><blockquote>
                     <div class="abstract">
                        <p>On <span class="abbrev">Mac</span> <span class="acronym">OS</span> X, you have two choices for installing <span class="application">Python</span>: install it, or don't install it.  You probably want to install it.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.macos9">1.4.&nbsp;Python on Mac OS 9</a><blockquote>
                     <div class="abstract">
                        <p><span class="abbrev">Mac</span> <span class="acronym">OS</span> 9 does not come with any version of <span class="application">Python</span>, but installation is very simple, and there is only one choice.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.redhat">1.5.&nbsp;Python on RedHat Linux</a><blockquote>
                     <div class="abstract">
                        <p>Download the latest <span class="application">Python</span> <span class="acronym">RPM</span> by going to <a href="http://www.python.org/ftp/python/">http://www.python.org/ftp/python/</a> and selecting the highest version number listed, then selecting the <tt class="filename">rpms/</tt> directory within that.  Then download the <span class="acronym">RPM</span> with the highest version number.  You can install it with the <span><b class="command">rpm</b></span> command, as shown here:
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.debian">1.6.&nbsp;Python on Debian GNU/Linux</a><blockquote>
                     <div class="abstract">
                        <p>If you are lucky enough to be running Debian <span class="acronym">GNU</span>/Linux, you install <span class="application">Python</span> through the <span><b class="command">apt</b></span> command.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.source">1.7.&nbsp;Python Installation from Source</a><blockquote>
                     <div class="abstract">
                        <p>If you prefer to build from source, you can download the <span class="application">Python</span> source code from <a href="http://www.python.org/ftp/python/">http://www.python.org/ftp/python/</a>.  Select the highest version number listed, download the <tt class="filename">.tgz</tt> file), and then do the usual <b class="userinput"><tt>configure</tt></b>, <b class="userinput"><tt>make</tt></b>, <b class="userinput"><tt>make install</tt></b> dance.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.shell">1.8.&nbsp;The Interactive Shell</a><blockquote>
                     <div class="abstract">
                        <p>Now that you have <span class="application">Python</span> installed, what's this interactive shell thing you're running?
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#install.summary">1.9.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>You should now have a version of <span class="application">Python</span> installed that works for you.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#odbchelper">Chapter&nbsp;2.&nbsp;Your First Python Program</a></p>
            <ul>
               <li><a href="../#odbchelper.divein">2.1.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>Here is a complete, working <span class="application">Python</span> program.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.funcdef">2.2.&nbsp;Declaring Functions</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> has functions like most other languages, but it does not have separate header files like <span class="application"><span class="acronym">C++</span></span> or <tt class="literal">interface</tt>/<tt class="literal">implementation</tt> sections like <span class="application">Pascal</span>.  When you need a function, just declare it, like this:
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.docstring">2.3.&nbsp;Documenting Functions</a><blockquote>
                     <div class="abstract">
                        <p>You can document a <span class="application">Python</span> function by giving it a <tt class="literal">doc string</tt>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.objects">2.4.&nbsp;Everything Is an Object</a><blockquote>
                     <div class="abstract">
                        <p>A function, like everything else in <span class="application">Python</span>, is an object.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.indenting">2.5.&nbsp;Indenting Code</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> functions have no explicit <tt class="literal">begin</tt> or <tt class="literal">end</tt>, and no curly braces to mark where the function code starts and stops.  The only delimiter is a colon (<tt class="literal">:</tt>) and the indentation of the code itself.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.testing">2.6.&nbsp;Testing Modules</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> modules are objects and have several useful attributes.  You can use this to easily test your modules as you write them.
                           Here's an example that uses the <tt class="literal">if</tt> <tt class="literal">__name__</tt> trick.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#datatypes">Chapter&nbsp;3.&nbsp;Native Datatypes</a></p>
            <ul>
               <li><a href="../#odbchelper.dict">3.1.&nbsp;Introducing Dictionaries</a><blockquote>
                     <div class="abstract">
                        <p>One of <span class="application">Python</span>'s built-in datatypes is the dictionary, which defines one-to-one relationships between keys and values.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.list">3.2.&nbsp;Introducing Lists</a><blockquote>
                     <div class="abstract">
                        <p>Lists are <span class="application">Python</span>'s workhorse datatype.  If your only experience with lists is arrays in <span class="application">Visual Basic</span> or (God forbid) the datastore in <span class="application">Powerbuilder</span>, brace yourself for <span class="application">Python</span> lists.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.tuple">3.3.&nbsp;Introducing Tuples</a><blockquote>
                     <div class="abstract">
                        <p>A tuple is an immutable list.  A tuple can not be changed in any way once it is created.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.vardef">3.4.&nbsp;Declaring variables</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> has local and global variables like most other languages, but it has no explicit variable declarations.  Variables spring
                           into existence by being assigned a value, and they are automatically destroyed when they go out of scope.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.stringformatting">3.5.&nbsp;Formatting Strings</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> supports formatting values into strings.  Although this can include very complicated expressions, the most basic usage is
                           to insert values into a string with the <tt class="literal">%s</tt> placeholder.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.map">3.6.&nbsp;Mapping Lists</a><blockquote>
                     <div class="abstract">
                        <p>One of the most powerful features of <span class="application">Python</span> is the list comprehension, which provides a compact way of mapping a list into another list by applying a function to each
                           of the elements of the list.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.join">3.7.&nbsp;Joining Lists and Splitting Strings</a><blockquote>
                     <div class="abstract">
                        <p>You have a list of key-value pairs in the form <tt class="literal"><i class="replaceable">key</i>=<i class="replaceable">value</i></tt>, and you want to join them into a single string.  To join any list of strings into a single string, use the <tt class="function">join</tt> method of a string object.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#odbchelper.summary">3.8.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>The <tt class="filename">odbchelper.py</tt> program and its output should now make perfect sense.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#apihelper">Chapter&nbsp;4.&nbsp;The Power Of Introspection</a></p>
            <ul>
               <li><a href="../#apihelper.divein">4.1.&nbsp;Diving In</a><blockquote>
                     <div class="abstract">
                        <p>Here is a complete, working <span class="application">Python</span> program.  You should understand a good deal about it just by looking at it.  The numbered lines illustrate concepts covered
                           in <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>.  Don't worry if the rest of the code looks intimidating; you'll learn all about it throughout this chapter.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.optional">4.2.&nbsp;Using Optional and Named Arguments</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> allows function arguments to have default values; if the function is called without the argument, the argument gets its default
                           value.  Futhermore, arguments can be specified in any order by using named arguments.  Stored procedures in <span class="application">SQL Server</span> Transact/<span class="acronym">SQL</span> can do this, so if you're a <span class="application">SQL Server</span> scripting guru, you can skim this part.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.builtin">4.3.&nbsp;Using type, str, dir, and Other Built-In Functions</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> has a small set of extremely useful built-in functions.  All other functions are partitioned off into modules.  This was
                           actually a conscious design decision, to keep the core language from getting bloated like other scripting languages (cough
                           cough, <span class="application">Visual Basic</span>).
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.getattr">4.4.&nbsp;Getting Object References With getattr</a><blockquote>
                     <div class="abstract">
                        <p>You already know that <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object"><span class="application">Python</span> functions are objects</a>.  What you don't know is that you can get a reference to a function without knowing its name until run-time, by using the
                           <tt class="function">getattr</tt> function.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.filter">4.5.&nbsp;Filtering Lists</a><blockquote>
                     <div class="abstract">
                        <p>As you know, <span class="application">Python</span> has powerful capabilities for mapping lists into other lists, via list comprehensions (<a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">Section&nbsp;3.6, &#8220;Mapping Lists&#8221;</a>).  This can be combined with a filtering mechanism, where some elements in the list are mapped while others are skipped entirely.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.andor">4.6.&nbsp;The Peculiar Nature of and and or</a><blockquote>
                     <div class="abstract">
                        <p>In <span class="application">Python</span>, <tt class="literal">and</tt> and <tt class="literal">or</tt> perform boolean logic as you would expect, but they do not return boolean values; instead, they return one of the actual
                           values they are comparing.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.lambda">4.7.&nbsp;Using lambda Functions</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> supports an interesting syntax that lets you define one-line mini-functions on the fly.  Borrowed from <span class="application">Lisp</span>, these so-called <tt class="literal">lambda</tt> functions can be used anywhere a function is required.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.alltogether">4.8.&nbsp;Putting It All Together</a><blockquote>
                     <div class="abstract">
                        <p>The last line of code, the only one you haven't deconstructed yet, is the one that does all the work.  But by now the work
                           is easy, because everything you need is already set up just the way you need it.  All the dominoes are in place; it's time
                           to knock them down.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#apihelper.summary">4.9.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>The <tt class="filename">apihelper.py</tt> program and its output should now make perfect sense.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#fileinfo">Chapter&nbsp;5.&nbsp;Objects and Object-Orientation</a></p>
            <ul>
               <li><a href="../#fileinfo.divein">5.1.&nbsp;Diving In</a><blockquote>
                     <div class="abstract">
                        <p>Here is a complete, working <span class="application">Python</span> program.  Read the <a href="#odbchelper.docstring" title="2.3.&nbsp;Documenting Functions"><tt class="literal">doc string</tt>s</a> of the module, the classes, and the functions to get an overview of what this program does and how it works.  As usual, don't
                           worry about the stuff you don't understand; that's what the rest of the chapter is for.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.fromimport">5.2.&nbsp;Importing Modules Using from module import</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> has two ways of importing modules.  Both are useful, and you should know when to use each.  One way, <tt class="literal">import <i class="replaceable">module</i></tt>, you've already seen in <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">Section&nbsp;2.4, &#8220;Everything Is an Object&#8221;</a>.  The other way accomplishes the same thing, but it has subtle and important differences.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.class">5.3.&nbsp;Defining Classes</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> is fully object-oriented: you can define your own classes, inherit from your own or built-in classes, and instantiate the
                           classes you've defined.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.create">5.4.&nbsp;Instantiating Classes</a><blockquote>
                     <div class="abstract">
                        <p>Instantiating classes in <span class="application">Python</span> is straightforward.  To instantiate a class, simply call the class as if it were a function, passing the arguments that the
                           <tt class="function">__init__</tt> method defines.  The return value will be the newly created object.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.userdict">5.5.&nbsp;Exploring UserDict: A Wrapper Class</a><blockquote>
                     <div class="abstract">
                        <p>As you've seen, <tt class="classname">FileInfo</tt> is a class that acts like a dictionary.  To explore this further, let's look at the <tt class="classname">UserDict</tt> class in the <tt class="filename">UserDict</tt> module, which is the ancestor of the <tt class="classname">FileInfo</tt> class.  This is nothing special; the class is written in <span class="application">Python</span> and stored in a <tt class="literal">.py</tt> file, just like any other <span class="application">Python</span> code.  In particular, it's stored in the <tt class="filename">lib</tt> directory in your <span class="application">Python</span> installation.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.specialmethods">5.6.&nbsp;Special Class Methods</a><blockquote>
                     <div class="abstract">
                        <p>In addition to normal class methods, there are a number of special methods that <span class="application">Python</span> classes can define.  Instead of being called directly by your code (like normal methods), special methods are called for
                           you by <span class="application">Python</span> in particular circumstances or when specific syntax is used.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.morespecial">5.7.&nbsp;Advanced Special Class Methods</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> has more special methods than just <tt class="function">__getitem__</tt> and <tt class="function">__setitem__</tt>.  Some of them let you emulate functionality that you may not even know about.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.classattributes">5.8.&nbsp;Introducing Class Attributes</a><blockquote>
                     <div class="abstract">
                        <p>You already know about <a href="#fileinfo.userdict.init.example" title="Example&nbsp;5.9.&nbsp;Defining the UserDict Class">data attributes</a>, which are variables owned by a specific instance of a class.  <span class="application">Python</span> also supports class attributes, which are variables owned by the class itself.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.private">5.9.&nbsp;Private Functions</a><blockquote>
                     <div class="abstract">
                        <p>Unlike in most languages, whether a <span class="application">Python</span> function, method, or attribute is private or public is determined entirely by its name.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.summary">5.10.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>That's it for the hard-core object trickery.  You'll see a real-world application of special class methods in <a href="#soap">Chapter 12</a>, which uses <tt class="function">getattr</tt> to create a proxy to a remote web service.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#filehandling">Chapter&nbsp;6.&nbsp;Exceptions and File Handling</a></p>
            <ul>
               <li><a href="../#fileinfo.exception">6.1.&nbsp;Handling Exceptions</a><blockquote>
                     <div class="abstract">
                        <p>Like many other programming languages, <span class="application">Python</span> has exception handling via <tt class="literal">try...except</tt> blocks.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.files">6.2.&nbsp;Working with File Objects</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> has a built-in function, <tt class="function">open</tt>, for opening a file on disk.  <tt class="function">open</tt> returns a file object, which has methods and attributes for getting information about and manipulating the opened file.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.for">6.3.&nbsp;Iterating with for Loops</a><blockquote>
                     <div class="abstract">
                        <p>Like most other languages, <span class="application">Python</span> has <tt class="literal">for</tt> loops.  The only reason you haven't seen them until now is that <span class="application">Python</span> is good at so many other things that you don't need them as often.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.modules">6.4.&nbsp;Using sys.modules</a><blockquote>
                     <div class="abstract">
                        <p>Modules, like everything else in <span class="application">Python</span>, are objects.  Once imported, you can always get a reference to a module through the global dictionary <tt class="literal"><tt class="filename">sys</tt>.modules</tt>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.os">6.5.&nbsp;Working with Directories</a><blockquote>
                     <div class="abstract">
                        <p>The <tt class="filename">os.path</tt> module has several functions for manipulating files and directories.  Here, we're looking at handling pathnames and listing
                           the contents of a directory.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.alltogether">6.6.&nbsp;Putting It All Together</a><blockquote>
                     <div class="abstract">
                        <p>Once again, all the dominoes are in place.  You've seen how each line of code works.  Now let's step back and see how it all
                           fits together.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#fileinfo.summary2">6.7.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>The <tt class="filename">fileinfo.py</tt> program introduced in <a href="#fileinfo">Chapter 5</a> should now make perfect sense.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#re">Chapter&nbsp;7.&nbsp;Regular Expressions</a></p>
            <ul>
               <li><a href="../#re.intro">7.1.&nbsp;Diving In</a><blockquote>
                     <div class="abstract">
                        <p>If what you're trying to do can be accomplished with string functions, you should use them.  They're fast and simple and easy
                           to read, and there's a lot to be said for fast, simple, readable code.  But if you find yourself using a lot of different
                           string functions with <tt class="literal">if</tt> statements to handle special cases, or if you're combining them with <tt class="function">split</tt> and <tt class="function">join</tt> and list comprehensions in weird unreadable ways, you may need to move up to regular expressions.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#re.matching">7.2.&nbsp;Case Study: Street Addresses</a><blockquote>
                     <div class="abstract">
                        <p>This series of examples was inspired by a real-life problem I had in my day job several years ago, when I needed to scrub
                           and standardize street addresses exported from a legacy system before importing them into a newer system.  (See, I don't just
                           make this stuff up; it's actually useful.)  This example shows how I approached the problem.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#re.roman">7.3.&nbsp;Case Study: Roman Numerals</a><blockquote>
                     <div class="abstract">
                        <p>You've most likely seen Roman numerals, even if you didn't recognize them.  You may have seen them in copyrights of old movies
                           and television shows (&#8220;<span class="quote">Copyright <tt class="literal">MCMXLVI</tt></span>&#8221; instead of &#8220;<span class="quote">Copyright <tt class="literal">1946</tt></span>&#8221;), or on the dedication walls of libraries or universities (&#8220;<span class="quote">established <tt class="literal">MDCCCLXXXVIII</tt></span>&#8221; instead of &#8220;<span class="quote">established <tt class="literal">1888</tt></span>&#8221;).  You may also have seen them in outlines and bibliographical references.  It's a system of representing numbers that really
                           does date back to the ancient Roman empire (hence the name).
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#re.nm">7.4.&nbsp;Using the {n,m} Syntax</a><blockquote>
                     <div class="abstract">
                        <p>In <a href="#re.roman" title="7.3.&nbsp;Case Study: Roman Numerals">the previous section</a>, you were dealing with a pattern where the same character could be repeated up to three times.  There is another way to express
                           this in regular expressions, which some people find more readable.  First look at the method we already used in the previous
                           example.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#re.verbose">7.5.&nbsp;Verbose Regular Expressions</a><blockquote>
                     <div class="abstract">
                        <p>So far you've just been dealing with what I'll call &#8220;<span class="quote">compact</span>&#8221; regular expressions.  As you've seen, they are difficult to read, and even if you figure out what one does, that's no guarantee
                           that you'll be able to understand it six months later.  What you really need is inline documentation.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#re.phone">7.6.&nbsp;Case study: Parsing Phone Numbers</a><blockquote>
                     <div class="abstract">
                        <p>So far you've concentrated on matching whole patterns.  Either the pattern matches, or it doesn't.  But regular expressions
                           are much more powerful than that.  When a regular expression <span class="emphasis"><em>does</em></span> match, you can pick out specific pieces of it.  You can find out what matched where.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#re.summary">7.7.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>This is just the tiniest tip of the iceberg of what regular expressions can do.  In other words, even though you're completely
                           overwhelmed by them now, believe me, you ain't seen nothing yet.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#dialect">Chapter&nbsp;8.&nbsp;HTML Processing</a></p>
            <ul>
               <li><a href="../#dialect.divein">8.1.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>I often see questions on <a href="http://groups.google.com/groups?group=comp.lang.python">comp.lang.python</a> like &#8220;<span class="quote">How can I list all the [headers|images|links] in my <span class="acronym">HTML</span> document?</span>&#8221;  &#8220;<span class="quote">How do I parse/translate/munge the text of my <span class="acronym">HTML</span> document but leave the tags alone?</span>&#8221;  &#8220;<span class="quote">How can I add/remove/quote attributes of all my <span class="acronym">HTML</span> tags at once?</span>&#8221;  This chapter will answer all of these questions.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.sgmllib">8.2.&nbsp;Introducing sgmllib.py</a><blockquote>
                     <div class="abstract">
                        <p><span class="acronym">HTML</span> processing is broken into three steps: breaking down the <span class="acronym">HTML</span> into its constituent pieces, fiddling with the pieces, and reconstructing the pieces into <span class="acronym">HTML</span> again.  The first step is done by <tt class="filename">sgmllib.py</tt>, a part of the standard <span class="application">Python</span> library.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.extract">8.3.&nbsp;Extracting data from HTML documents</a><blockquote>
                     <div class="abstract">
                        <p>To extract data from <span class="acronym">HTML</span> documents, subclass the <tt class="classname">SGMLParser</tt> class and define methods for each tag or entity you want to capture.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.basehtml">8.4.&nbsp;Introducing BaseHTMLProcessor.py</a><blockquote>
                     <div class="abstract">
                        <p><tt class="classname">SGMLParser</tt> doesn't produce anything by itself.  It parses and parses and parses, and it calls a method for each interesting thing it
                           finds, but the methods don't do anything.  <tt class="classname">SGMLParser</tt> is an <span class="acronym">HTML</span> <span class="emphasis"><em>consumer</em></span>: it takes <span class="acronym">HTML</span> and breaks it down into small, structured pieces.  As you saw in the <a href="#dialect.extract" title="8.3.&nbsp;Extracting data from HTML documents">previous section</a>, you can subclass <tt class="classname">SGMLParser</tt> to define classes that catch specific tags and produce useful things, like a list of all the links on a web page.  Now you'll
                           take this one step further by defining a class that catches everything <tt class="classname">SGMLParser</tt> throws at it and reconstructs the complete <span class="acronym">HTML</span> document.  In technical terms, this class will be an <span class="acronym">HTML</span> <span class="emphasis"><em>producer</em></span>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.locals">8.5.&nbsp;locals and globals</a><blockquote>
                     <div class="abstract">
                        <p>Let's digress from <span class="acronym">HTML</span> processing for a minute and talk about how <span class="application">Python</span> handles variables.  <span class="application">Python</span> has two built-in functions, <tt class="function">locals</tt> and <tt class="function">globals</tt>, which provide dictionary-based access to local and global variables.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.dictsub">8.6.&nbsp;Dictionary-based string formatting</a><blockquote>
                     <div class="abstract">
                        <p>There is an alternative form of string formatting that uses dictionaries instead of tuples of values.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.quoting">8.7.&nbsp;Quoting attribute values</a><blockquote>
                     <div class="abstract">
                        <p>A common question on <a href="http://groups.google.com/groups?group=comp.lang.python">comp.lang.python</a> is &#8220;<span class="quote">I have a bunch of <span class="acronym">HTML</span> documents with unquoted attribute values, and I want to properly quote them all.  How can I do this?</span>&#8221;<sup>[<a name="d0e21764" href="#ftn.d0e21764">4</a>]</sup>  (This is generally precipitated by a project manager who has found the <span class="acronym">HTML</span>-is-a-standard religion joining a large project and proclaiming that all pages must validate against an <span class="acronym">HTML</span> validator.  Unquoted attribute values are a common violation of the <span class="acronym">HTML</span> standard.)  Whatever the reason, unquoted attribute values are easy to fix by feeding <span class="acronym">HTML</span> through <tt class="classname">BaseHTMLProcessor</tt>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.dialectizer">8.8.&nbsp;Introducing dialect.py</a><blockquote>
                     <div class="abstract">
                        <p><tt class="classname">Dialectizer</tt> is a simple (and silly) descendant of <tt class="classname">BaseHTMLProcessor</tt>.  It runs blocks of text through a series of substitutions, but it makes sure that anything within a <tt class="literal"><tt class="sgmltag-element">&lt;pre&gt;</tt>...<tt class="sgmltag-element">&lt;/pre&gt;</tt></tt> block passes through unaltered.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.alltogether">8.9.&nbsp;Putting it all together</a><blockquote>
                     <div class="abstract">
                        <p>It's time to put everything you've learned so far to good use.  I hope you were paying attention.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#dialect.summary">8.10.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> provides you with a powerful tool, <tt class="filename">sgmllib.py</tt>, to manipulate <span class="acronym">HTML</span> by turning its structure into an object model.  You can use this tool in many different ways.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#kgp">Chapter&nbsp;9.&nbsp;XML Processing</a></p>
            <ul>
               <li><a href="../#kgp.divein">9.1.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>There are two basic ways to work with <span class="acronym">XML</span>.  One is called <span class="acronym">SAX</span> (&#8220;<span class="quote">Simple <span class="acronym">API</span> for <span class="acronym">XML</span></span>&#8221;), and it works by reading the <span class="acronym">XML</span> a little bit at a time and calling a method for each element it finds.  (If you read <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">Chapter&nbsp;8, <i>HTML Processing</i></a>, this should sound familiar, because that's how the <tt class="filename">sgmllib</tt> module works.)  The other is called <span class="acronym">DOM</span> (&#8220;<span class="quote">Document Object Model</span>&#8221;), and it works by reading in the entire <span class="acronym">XML</span> document at once and creating an internal representation of it using native <span class="application">Python</span> classes linked in a tree structure.  <span class="application">Python</span> has standard modules for both kinds of parsing, but this chapter will only deal with using the <span class="acronym">DOM</span>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.packages">9.2.&nbsp;Packages</a><blockquote>
                     <div class="abstract">
                        <p>Actually parsing an <span class="acronym">XML</span> document is very simple: one line of code.  However, before you get to that line of code, you need to take a short detour
                           to talk about packages.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.parse">9.3.&nbsp;Parsing XML</a><blockquote>
                     <div class="abstract">
                        <p>As I was saying, actually parsing an <span class="acronym">XML</span> document is very simple: one line of code.  Where you go from there is up to you.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.unicode">9.4.&nbsp;Unicode</a><blockquote>
                     <div class="abstract">
                        <p>Unicode is a system to represent characters from all the world's different languages.  When <span class="application">Python</span> parses an <span class="acronym">XML</span> document, all data is stored in memory as unicode.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.search">9.5.&nbsp;Searching for elements</a><blockquote>
                     <div class="abstract">
                        <p>Traversing <span class="acronym">XML</span> documents by stepping through each node can be tedious.  If you're looking for something in particular, buried deep within
                           your <span class="acronym">XML</span> document, there is a shortcut you can use to find it quickly: <tt class="function">getElementsByTagName</tt>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.attributes">9.6.&nbsp;Accessing element attributes</a><blockquote>
                     <div class="abstract">
                        <p><span class="acronym">XML</span> elements can have one or more attributes, and it is incredibly simple to access them once you have parsed an <span class="acronym">XML</span> document.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.segue">9.7.&nbsp;Segue</a><blockquote>
                     <div class="abstract">
                        <p>OK, that's it for the hard-core XML stuff.  The next chapter will continue to use these same example programs, but focus on
                           other aspects that make the program more flexible: using streams for input processing, using <tt class="function">getattr</tt> for method dispatching, and using command-line flags to allow users to reconfigure the program without changing the code.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#streams">Chapter&nbsp;10.&nbsp;Scripts and Streams</a></p>
            <ul>
               <li><a href="../#kgp.openanything">10.1.&nbsp;Abstracting input sources</a><blockquote>
                     <div class="abstract">
                        <p>One of <span class="application">Python</span>'s greatest strengths is its dynamic binding, and one powerful use of dynamic binding is the <span class="emphasis"><em>file-like object</em></span>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.stdio">10.2.&nbsp;Standard input, output, and error</a><blockquote>
                     <div class="abstract">
                        <p><span class="acronym">UNIX</span> users are already familiar with the concept of standard input, standard output, and standard error.  This section is for
                           the rest of you.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.cache">10.3.&nbsp;Caching node lookups</a><blockquote>
                     <div class="abstract">
                        <p><tt class="filename">kgp.py</tt> employs several tricks which may or may not be useful to you in your <span class="acronym">XML</span> processing.  The first one takes advantage of the consistent structure of the input documents to build a cache of nodes.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.child">10.4.&nbsp;Finding direct children of a node</a><blockquote>
                     <div class="abstract">
                        <p>Another useful techique when parsing <span class="acronym">XML</span> documents is finding all the direct child elements of a particular element.  For instance, in the grammar files, a <tt class="sgmltag-element">ref</tt> element can have several <tt class="sgmltag-element">p</tt> elements, each of which can contain many things, including other <tt class="sgmltag-element">p</tt> elements.  You want to find just the <tt class="sgmltag-element">p</tt> elements that are children of the <tt class="sgmltag-element">ref</tt>, not <tt class="sgmltag-element">p</tt> elements that are children of other <tt class="sgmltag-element">p</tt> elements.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.handler">10.5.&nbsp;Creating separate handlers by node type</a><blockquote>
                     <div class="abstract">
                        <p>The third useful <span class="acronym">XML</span> processing tip involves separating your code into logical functions, based on node types and element names.  Parsed <span class="acronym">XML</span> documents are made up of various types of nodes, each represented by a <span class="application">Python</span> object.  The root level of the document itself is represented by a <tt class="classname">Document</tt> object.  The <tt class="classname">Document</tt> then contains one or more <tt class="classname">Element</tt> objects (for actual <span class="acronym">XML</span> tags), each of which may contain other <tt class="classname">Element</tt> objects, <tt class="classname">Text</tt> objects (for bits of text), or <tt class="classname">Comment</tt> objects (for embedded comments).  <span class="application">Python</span> makes it easy to write a dispatcher to separate the logic for each node type.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.commandline">10.6.&nbsp;Handling command-line arguments</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> fully supports creating programs that can be run on the command line, complete with command-line arguments and either short-
                           or long-style flags to specify various options.  None of this is <span class="acronym">XML</span>-specific, but this script makes good use of command-line processing, so it seemed like a good time to mention it.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.alltogether">10.7.&nbsp;Putting it all together</a><blockquote>
                     <div class="abstract">
                        <p>You've covered a lot of ground.  Let's step back and see how all the pieces fit together.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#kgp.summary">10.8.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p><span class="application">Python</span> comes with powerful libraries for parsing and manipulating <span class="acronym">XML</span> documents.  The <tt class="filename">minidom</tt> takes an <span class="acronym">XML</span> file and parses it into <span class="application">Python</span> objects, providing for random access to arbitrary elements.  Furthermore, this chapter shows how <span class="application">Python</span> can be used to create a "real" standalone command-line script, complete with command-line flags, command-line arguments,
                           error handling, even the ability to take input from the piped result of a previous program.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#oa">Chapter&nbsp;11.&nbsp;HTTP Web Services</a></p>
            <ul>
               <li><a href="../#oa.divein">11.1.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>You've learned about <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">HTML processing</a> and <a href="#kgp" title="Chapter&nbsp;9.&nbsp;XML Processing">XML processing</a>, and along the way you saw <a href="#dialect.extract.urllib" title="Example&nbsp;8.5.&nbsp;Introducing urllib">how to download a web page</a> and <a href="#kgp.openanything.urllib" title="Example&nbsp;10.2.&nbsp;Parsing XML from a URL">how to parse XML from a URL</a>, but let's dive into the more general topic of HTTP web services.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.review">11.2.&nbsp;How not to fetch data over HTTP</a><blockquote>
                     <div class="abstract">
                        <p>Let's say you want to download a resource over HTTP, such as a syndicated Atom feed.  But you don't just want to download
                           it once; you want to download it over and over again, every hour, to get the latest news from the site that's offering the
                           news feed.  Let's do it the quick-and-dirty way first, and then see how you can do better.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.features">11.3.&nbsp;Features of HTTP</a><blockquote>
                     <div class="abstract">
                        <p>There are five important features of HTTP which you should support.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.debug">11.4.&nbsp;Debugging HTTP web services</a><blockquote>
                     <div class="abstract">
                        <p>First, let's turn on the debugging features of <span class="application">Python</span>'s HTTP library and see what's being sent over the wire.  This will be useful throughout the chapter, as you add more and
                           more features.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.useragent">11.5.&nbsp;Setting the User-Agent</a><blockquote>
                     <div class="abstract">
                        <p>The first step to improving your HTTP web services client is to identify yourself properly with a <tt class="literal">User-Agent</tt>.  To do that, you need to move beyond the basic <tt class="filename">urllib</tt> and dive into <tt class="filename">urllib2</tt>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.etags">11.6.&nbsp;Handling Last-Modified and ETag</a><blockquote>
                     <div class="abstract">
                        <p>Now that you know how to add custom HTTP headers to your web service requests, let's look at adding support for <tt class="literal">Last-Modified</tt> and <tt class="literal">ETag</tt> headers.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.redirect">11.7.&nbsp;Handling redirects</a><blockquote>
                     <div class="abstract">
                        <p>You can support permanent and temporary redirects using a different kind of custom URL handler.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.gzip">11.8.&nbsp;Handling compressed data</a><blockquote>
                     <div class="abstract">
                        <p>The last important HTTP feature you want to support is compression.  Many web services have the ability to send data compressed,
                           which can cut down the amount of data sent over the wire by 60% or more.  This is especially true of XML web services, since
                           XML data compresses very well.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.alltogether">11.9.&nbsp;Putting it all together</a><blockquote>
                     <div class="abstract">
                        <p>You've seen all the pieces for building an intelligent HTTP web services client.  Now let's see how they all fit together.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#oa.summary">11.10.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>The <tt class="filename">openanything.py</tt> and its functions should now make perfect sense.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#soap">Chapter&nbsp;12.&nbsp;SOAP Web Services</a></p>
            <ul>
               <li><a href="../#soap.divein">12.1.&nbsp;Diving In</a><blockquote>
                     <div class="abstract">
                        <p>You use Google, right?  It's a popular search engine.  Have you ever wished you could programmatically access Google search
                           results?  Now you can.  Here is a program to search Google from <span class="application">Python</span>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.install">12.2.&nbsp;Installing the SOAP Libraries</a><blockquote>
                     <div class="abstract">
                        <p>Unlike the other code in this book, this chapter relies on libraries that do not come pre-installed with <span class="application">Python</span>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.firststeps">12.3.&nbsp;First Steps with SOAP</a><blockquote>
                     <div class="abstract">
                        <p>The heart of <span class="acronym">SOAP</span> is the ability to call remote functions.  There are a number of public access <span class="acronym">SOAP</span> servers that provide simple functions for demonstration purposes.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.debug">12.4.&nbsp;Debugging SOAP Web Services</a><blockquote>
                     <div class="abstract">
                        <p>The <span class="acronym">SOAP</span> libraries provide an easy way to see what's going on behind the scenes.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.wsdl">12.5.&nbsp;Introducing WSDL</a><blockquote>
                     <div class="abstract">
                        <p>The <tt class="classname">SOAPProxy</tt> class proxies local method calls and transparently turns then into invocations of remote <span class="acronym">SOAP</span> methods.  As you've seen, this is a lot of work, and <tt class="classname">SOAPProxy</tt> does it quickly and transparently.  What it doesn't do is provide any means of method introspection.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.introspection">12.6.&nbsp;Introspecting SOAP Web Services with WSDL</a><blockquote>
                     <div class="abstract">
                        <p>Like many things in the web services arena, <span class="acronym">WSDL</span> has a long and checkered history, full of political strife and intrigue.  I will skip over this history entirely, since it
                           bores me to tears.  There were other standards that tried to do similar things, but <span class="acronym">WSDL</span> won, so let's learn how to use it.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.google">12.7.&nbsp;Searching Google</a><blockquote>
                     <div class="abstract">
                        <p>Let's finally turn to the sample code that you saw that the beginning of this chapter, which does something more useful and
                           exciting than get the current temperature.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.troubleshooting">12.8.&nbsp;Troubleshooting SOAP Web Services</a><blockquote>
                     <div class="abstract">
                        <p>Of course, the world of <span class="acronym">SOAP</span> web services is not all happiness and light.  Sometimes things go wrong.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soap.summary">12.9.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p><span class="acronym">SOAP</span> web services are very complicated.  The specification is very ambitious and tries to cover many different use cases for web
                           services.  This chapter has touched on some of the simpler use cases.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#roman">Chapter&nbsp;13.&nbsp;Unit Testing</a></p>
            <ul>
               <li><a href="../#roman.intro">13.1.&nbsp;Introduction to Roman numerals</a><blockquote>
                     <div class="abstract">
                        <p>In previous chapters, you &#8220;<span class="quote">dived in</span>&#8221; by immediately looking at code and trying to understand it as quickly as possible.  Now that you have some <span class="application">Python</span> under your belt, you're going to step back and look at the steps that happen <span class="emphasis"><em>before</em></span> the code gets written.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.divein">13.2.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>Now that you've completely defined the behavior you expect from your conversion functions, you're going to do something a
                           little unexpected: you're going to write a test suite that puts these functions through their paces and makes sure that they
                           behave the way you want them to.  You read that right: you're going to write code that tests code that you haven't written
                           yet.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.romantest">13.3.&nbsp;Introducing romantest.py</a><blockquote>
                     <div class="abstract">
                        <p>This is the complete test suite for your Roman numeral conversion functions, which are yet to be written but will eventually
                           be in <tt class="filename">roman.py</tt>.  It is not immediately obvious how it all fits together; none of these classes or methods reference any of the others. 
                           There are good reasons for this, as you'll see shortly.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.success">13.4.&nbsp;Testing for success</a><blockquote>
                     <div class="abstract">
                        <p>The most fundamental part of unit testing is constructing individual test cases.  A test case answers a single question about
                           the code it is testing.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.failure">13.5.&nbsp;Testing for failure</a><blockquote>
                     <div class="abstract">
                        <p>It is not enough to test that functions succeed when given good input; you must also test that they fail when given bad input.
                           And not just any sort of failure; they must fail in the way you expect.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.sanity">13.6.&nbsp;Testing for sanity</a><blockquote>
                     <div class="abstract">
                        <p>Often, you will find that a unit of code contains a set of reciprocal functions, usually in the form of conversion functions
                           where one converts A to B and the other converts B to A.  In these cases, it is useful to create a &#8220;<span class="quote">sanity check</span>&#8221; to make sure that you can convert A to B and back to A without losing precision, incurring rounding errors, or triggering
                           any other sort of bug.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#roman1.5">Chapter&nbsp;14.&nbsp;Test-First Programming</a></p>
            <ul>
               <li><a href="../#roman.stage1">14.1.&nbsp;roman.py, stage 1</a><blockquote>
                     <div class="abstract">
                        <p>Now that the unit tests are complete, it's time to start writing the code that the test cases are attempting to test.  You're
                           going to do this in stages, so you can see all the unit tests fail, then watch them pass one by one as you fill in the gaps
                           in <tt class="filename">roman.py</tt>.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.stage2">14.2.&nbsp;roman.py, stage 2</a><blockquote>
                     <div class="abstract">
                        <p>Now that you have the framework of the <tt class="filename">roman</tt> module laid out, it's time to start writing code and passing test cases.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.stage3">14.3.&nbsp;roman.py, stage 3</a><blockquote>
                     <div class="abstract">
                        <p>Now that <tt class="function">toRoman</tt> behaves correctly with good input (integers from <tt class="literal">1</tt> to <tt class="literal">3999</tt>), it's time to make it behave correctly with bad input (everything else).
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.stage4">14.4.&nbsp;roman.py, stage 4</a><blockquote>
                     <div class="abstract">
                        <p>Now that <tt class="function">toRoman</tt> is done, it's time to start coding <tt class="function">fromRoman</tt>.  Thanks to the rich data structure that maps individual Roman numerals to integer values, this is no more difficult than
                           the <tt class="function">toRoman</tt> function.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.stage5">14.5.&nbsp;roman.py, stage 5</a><blockquote>
                     <div class="abstract">
                        <p>Now that <tt class="function">fromRoman</tt> works properly with good input, it's time to fit in the last piece of the puzzle: making it work properly with bad input.
                           That means finding a way to look at a string and determine if it's a valid Roman numeral.  This is inherently more difficult
                           than <a href="#roman.stage3" title="14.3.&nbsp;roman.py, stage 3">validating numeric input</a> in <tt class="function">toRoman</tt>, but you have a powerful tool at your disposal: regular expressions.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#roman2">Chapter&nbsp;15.&nbsp;Refactoring</a></p>
            <ul>
               <li><a href="../#roman.bugs">15.1.&nbsp;Handling bugs</a><blockquote>
                     <div class="abstract">
                        <p>Despite your best efforts to write comprehensive unit tests, bugs happen.  What do I mean by &#8220;<span class="quote">bug</span>&#8221;?  A bug is a test case you haven't written yet.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.change">15.2.&nbsp;Handling changing requirements</a><blockquote>
                     <div class="abstract">
                        <p>Despite your best efforts to pin your customers to the ground and extract exact requirements from them on pain of horrible
                           nasty things involving scissors and hot wax, requirements will change.  Most customers don't know what they want until they
                           see it, and even if they do, they aren't that good at articulating what they want precisely enough to be useful.  And even
                           if they do, they'll want more in the next release anyway.  So be prepared to update your test cases as requirements change.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.refactoring">15.3.&nbsp;Refactoring</a><blockquote>
                     <div class="abstract">
                        <p>The best thing about comprehensive unit testing is not the feeling you get when all your test cases finally pass, or even
                           the feeling you get when someone else blames you for breaking their code and you can actually <span class="emphasis"><em>prove</em></span> that you didn't.  The best thing about unit testing is that it gives you the freedom to refactor mercilessly.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.postscript">15.4.&nbsp;Postscript</a><blockquote>
                     <div class="abstract">
                        <p>A clever reader read the <a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">previous section</a> and took it to the next level.  The biggest headache (and performance drain) in the program as it is currently written is
                           the regular expression, which is required because you have no other way of breaking down a Roman numeral.  But there's only
                           5000 of them; why don't you just build a lookup table once, then simply read that?  This idea gets even better when you realize
                           that you don't need to use regular expressions at all.  As you build the lookup table for converting integers to Roman numerals,
                           you can build the reverse lookup table to convert Roman numerals to integers.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#roman.summary">15.5.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>Unit testing is a powerful concept which, if properly implemented, can both reduce maintenance costs and increase flexibility
                           in any long-term project.  It is also important to understand that unit testing is not a panacea, a Magic Problem Solver,
                           or a silver bullet.  Writing good test cases is hard, and keeping them up to date takes discipline (especially when customers
                           are screaming for critical bug fixes).  Unit testing is not a replacement for other forms of testing, including functional
                           testing, integration testing, and user acceptance testing.  But it is feasible, and it does work, and once you've seen it
                           work, you'll wonder how you ever got along without it.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#regression">Chapter&nbsp;16.&nbsp;Functional Programming</a></p>
            <ul>
               <li><a href="../#regression.divein">16.1.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>In <a href="#roman" title="Chapter&nbsp;13.&nbsp;Unit Testing">Chapter&nbsp;13, <i>Unit Testing</i></a>, you learned about the philosophy of unit testing.  In <a href="#roman1.5" title="Chapter&nbsp;14.&nbsp;Test-First Programming">Chapter&nbsp;14, <i>Test-First Programming</i></a>, you stepped through the implementation of basic unit tests in <span class="application">Python</span>.  In <a href="#roman2" title="Chapter&nbsp;15.&nbsp;Refactoring">Chapter&nbsp;15, <i>Refactoring</i></a>, you saw how unit testing makes large-scale refactoring easier.  This chapter will build on those sample programs, but here
                           we will focus more on advanced <span class="application">Python</span>-specific techniques, rather than on unit testing itself.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#regression.path">16.2.&nbsp;Finding the path</a><blockquote>
                     <div class="abstract">
                        <p>When running <span class="application">Python</span> scripts from the command line, it is sometimes useful to know where the currently running script is located on disk.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#regression.filter">16.3.&nbsp;Filtering lists revisited</a><blockquote>
                     <div class="abstract">
                        <p>You're already familiar with <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">using list comprehensions to filter lists</a>.  There is another way to accomplish this same thing, which some people feel is more expressive.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#regression.map">16.4.&nbsp;Mapping lists revisited</a><blockquote>
                     <div class="abstract">
                        <p>You're already familiar with using <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">list comprehensions</a> to map one list into another.  There is another way to accomplish the same thing, using the built-in <tt class="function">map</tt> function.  It works much the same way as the <a href="#regression.filter" title="16.3.&nbsp;Filtering lists revisited"><tt class="function">filter</tt></a> function.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#regression.datacentric">16.5.&nbsp;Data-centric programming</a><blockquote>
                     <div class="abstract">
                        <p>By now you're probably scratching your head wondering why this is better than using <tt class="literal">for</tt> loops and straight function calls.  And that's a perfectly valid question.  Mostly, it's a matter of perspective.  Using
                           <tt class="function">map</tt> and <tt class="function">filter</tt> forces you to center your thinking around your data.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#regression.import">16.6.&nbsp;Dynamically importing modules</a><blockquote>
                     <div class="abstract">
                        <p>OK, enough philosophizing.  Let's talk about dynamically importing modules.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#regression.alltogether">16.7.&nbsp;Putting it all together</a><blockquote>
                     <div class="abstract">
                        <p>You've learned enough now to deconstruct the first seven lines of this chapter's code sample: reading a directory and importing
                           selected modules within it.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#regression.summary">16.8.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>The <tt class="filename">regression.py</tt> program and its output should now make perfect sense.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#plural">Chapter&nbsp;17.&nbsp;Dynamic functions</a></p>
            <ul>
               <li><a href="../#plural.divein">17.1.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>I want to talk about plural nouns.  Also, functions that return other functions, advanced regular expressions, and generators.
                           Generators are new in <span class="application">Python</span> 2.3.  But first, let's talk about how to make plural nouns.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#plural.stage1">17.2.&nbsp;plural.py, stage 1</a><blockquote>
                     <div class="abstract">
                        <p>So you're looking at words, which at least in English are strings of characters.  And you have rules that say you need to
                           find different combinations of characters, and then do different things to them.  This sounds like a job for regular expressions.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#plural.stage2">17.3.&nbsp;plural.py, stage 2</a><blockquote>
                     <div class="abstract">
                        <p>Now you're going to add a level of abstraction.  You started by defining a list of rules: if this, then do that, otherwise
                           go to the next rule.  Let's temporarily complicate part of the program so you can simplify another part.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#plural.stage3">17.4.&nbsp;plural.py, stage 3</a><blockquote>
                     <div class="abstract">
                        <p>Defining separate named functions for each match and apply rule isn't really necessary.  You never call them directly; you
                           define them in the <tt class="varname">rules</tt> list and call them through there.  Let's streamline the rules definition by anonymizing those functions.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#plural.stage4">17.5.&nbsp;plural.py, stage 4</a><blockquote>
                     <div class="abstract">
                        <p>Let's factor out the duplication in the code so that defining new rules can be easier.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#plural.stage5">17.6.&nbsp;plural.py, stage 5</a><blockquote>
                     <div class="abstract">
                        <p>You've factored out all the duplicate code and added enough abstractions so that the pluralization rules are defined in a
                           list of strings.  The next logical step is to take these strings and put them in a separate file, where they can be maintained
                           separately from the code that uses them.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#plural.stage6">17.7.&nbsp;plural.py, stage 6</a><blockquote>
                     <div class="abstract">
                        <p>Now you're ready to talk about generators.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#plural.summary">17.8.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>You talked about several different advanced techniques in this chapter.  Not all of them are appropriate for every situation.</p>
                     </div>
                  </blockquote>
               </li>
            </ul>
            <p><a href="../#soundex">Chapter&nbsp;18.&nbsp;Performance Tuning</a></p>
            <ul>
               <li><a href="../#soundex.divein">18.1.&nbsp;Diving in</a><blockquote>
                     <div class="abstract">
                        <p>There are so many pitfalls involved in optimizing your code, it's hard to know where to start.</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soundex.timeit">18.2.&nbsp;Using the timeit Module</a><blockquote>
                     <div class="abstract">
                        <p>The most important thing you need to know about optimizing <span class="application">Python</span> code is that you shouldn't write your own timing function.
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soundex.stage1">18.3.&nbsp;Optimizing Regular Expressions</a><blockquote>
                     <div class="abstract">
                        <p>The first thing the Soundex function checks is whether the input is a non-empty string of letters.  What's the best way to
                           do this?
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soundex.stage2">18.4.&nbsp;Optimizing Dictionary Lookups</a><blockquote>
                     <div class="abstract">
                        <p>The second step of the Soundex algorithm is to convert characters to digits in a specific pattern.  What's the best way to
                           do this?
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soundex.stage3">18.5.&nbsp;Optimizing List Operations</a><blockquote>
                     <div class="abstract">
                        <p>The third step in the Soundex algorithm is eliminating consecutive duplicate digits.  What's the best way to do this?</p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soundex.stage4">18.6.&nbsp;Optimizing String Manipulation</a><blockquote>
                     <div class="abstract">
                        <p>The final step of the Soundex algorithm is padding short results with zeros, and truncating long results.  What is the best
                           way to do this?
                        </p>
                     </div>
                  </blockquote>
               </li>
               <li><a href="../#soundex.summary">18.7.&nbsp;Summary</a><blockquote>
                     <div class="abstract">
                        <p>This chapter has illustrated several important aspects of performance tuning in <span class="application">Python</span>, and performance tuning in general.
                        </p>
                     </div>
                  </blockquote>
               </li>
            </ul>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="tips"></a>Appendix&nbsp;C.&nbsp;Tips and tricks
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <p><a href="../#install">Chapter&nbsp;1.&nbsp;Installing Python</a></p>
            <ul></ul>
            <p><a href="../#odbchelper">Chapter&nbsp;2.&nbsp;Your First Python Program</a></p>
            <ul>
               <li><a href="../#odbchelper.divein">2.1.&nbsp;Diving in</a><a name="tip.run.windows"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">ActivePython</span> <span class="acronym">IDE</span> on Windows, you can run the <span class="application">Python</span> program you're editing by choosing
                           <span class="guimenu">File</span>-&gt;<span class="guimenuitem"><span class="accel">R</span>un...</span> (<span><b class="shortcut"><span><b class="keycap">Ctrl</b></span>-<span class="keysym">R</span></b></span>).  Output is displayed in the interactive window.
                        </td>
                     </tr>
                  </table><a name="tip.run.mac"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">Python</span> <span class="acronym">IDE</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span>, you can run a <span class="application">Python</span> program with
                           <span class="guimenu">Python</span>-&gt;<span class="guimenuitem">Run window...</span> (<span><b class="shortcut"><span><b class="keycap">Cmd</b></span>-<span class="keysym">R</span></b></span>), but there is an important option you must set first.  Open the <tt class="filename">.py</tt> file in the <span class="acronym">IDE</span>, pop up the options menu by clicking the black triangle in the upper-right corner of the window, and make sure the <span class="guimenuitem">Run as __main__</span> option is checked.  This is a per-file setting, but you'll only need to do it once per file.
                        </td>
                     </tr>
                  </table><a name="tip.run.unix"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">On <span class="acronym">UNIX</span>-compatible systems (including <span class="abbrev">Mac</span> <span class="acronym">OS</span> X), you can run a <span class="application">Python</span> program from the command line: <b class="userinput"><tt>python <tt class="filename">odbchelper.py</tt></tt></b></td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.funcdef">2.2.&nbsp;Declaring Functions</a><a name="compare.funcdef.vb"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Visual Basic</span>, functions (that return a value) start with <tt class="literal">function</tt>, and subroutines (that do not return a value) start with <tt class="literal">sub</tt>.  There are no subroutines in <span class="application">Python</span>.  Everything is a function, all functions return a value (even if it's <tt class="literal">None</tt>), and all functions start with <tt class="literal">def</tt>.
                        </td>
                     </tr>
                  </table><a name="compare.funcdef.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Java</span>, <span class="application"><span class="acronym">C++</span></span>, and other statically-typed languages, you must specify the datatype of the function return value and each function argument.
                            In <span class="application">Python</span>, you never explicitly specify the datatype of anything.  Based on what value you assign, <span class="application">Python</span> keeps track of the datatype internally.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.docstring">2.3.&nbsp;Documenting Functions</a><a name="compare.quoting.perl"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Triple quotes are also an easy way to define a string with both single and double quotes, like <tt class="literal">qq/.../</tt> in <span class="application">Perl</span>.
                        </td>
                     </tr>
                  </table><a name="tip.docstring"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Many <span class="application">Python</span> <span class="acronym">IDE</span>s use the <tt class="literal">doc string</tt> to provide context-sensitive documentation, so that when you type a function name, its <tt class="literal">doc string</tt> appears as a tooltip.  This can be incredibly helpful, but it's only as good as the <tt class="literal">doc string</tt>s you write.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.objects">2.4.&nbsp;Everything Is an Object</a><a name="compare.import.perl"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">import</tt> in <span class="application">Python</span> is like <tt class="literal">require</tt> in <span class="application">Perl</span>.  Once you <tt class="literal">import</tt> a <span class="application">Python</span> module, you access its functions with <tt class="literal"><i class="replaceable">module</i>.<i class="replaceable">function</i></tt>; once you <tt class="literal">require</tt> a <span class="application">Perl</span> module, you access its functions with <tt class="literal"><i class="replaceable">module</i>::<i class="replaceable">function</i></tt>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.indenting">2.5.&nbsp;Indenting Code</a><a name="compare.lineend.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> uses carriage returns to separate statements and a colon and indentation to separate code blocks.  <span class="application"><span class="acronym">C++</span></span> and <span class="application">Java</span> use semicolons to separate statements and curly braces to separate code blocks.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.testing">2.6.&nbsp;Testing Modules</a><a name="compare.equals.c"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Like <span class="application"><span class="acronym">C</span></span>, <span class="application">Python</span> uses <tt class="literal">==</tt> for comparison and <tt class="literal">=</tt> for assignment.  Unlike <span class="application"><span class="acronym">C</span></span>, <span class="application">Python</span> does not support in-line assignment, so there's no chance of accidentally assigning the value you thought you were comparing.
                        </td>
                     </tr>
                  </table><a name="tip.mac.runasmain"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">On <span class="application">MacPython</span>, there is an additional step to make the <tt class="literal">if</tt> <tt class="literal">__name__</tt> trick work.  Pop up the module's options menu by clicking the black triangle in the upper-right corner of the window, and
                           make sure <span class="guimenuitem">Run as __main__</span> is checked.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#datatypes">Chapter&nbsp;3.&nbsp;Native Datatypes</a></p>
            <ul>
               <li><a href="../#odbchelper.dict">3.1.&nbsp;Introducing Dictionaries</a><a name="compare.dict.perl"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">A dictionary in <span class="application">Python</span> is like a hash in <span class="application">Perl</span>.  In <span class="application">Perl</span>, variables that store hashes always start with a <tt class="literal">%</tt> character.  In <span class="application">Python</span>, variables can be named anything, and <span class="application">Python</span> keeps track of the datatype internally.
                        </td>
                     </tr>
                  </table><a name="compare.dict.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">A dictionary in <span class="application">Python</span> is like an instance of the <tt class="classname">Hashtable</tt> class in <span class="application">Java</span>.
                        </td>
                     </tr>
                  </table><a name="compare.dict.vb"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">A dictionary in <span class="application">Python</span> is like an instance of the <tt class="classname">Scripting.Dictionary</tt> object in <span class="application">Visual Basic</span>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#d0e5269">3.1.2.&nbsp;Modifying Dictionaries</a><a name="tip.dictorder"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Dictionaries have no concept of order among elements.  It is incorrect to say that the elements are &#8220;<span class="quote">out of order</span>&#8221;; they are simply unordered.  This is an important distinction that will annoy you when you want to access the elements of
                           a dictionary in a specific, repeatable order (like alphabetical order by key).  There are ways of doing this, but they're
                           not built into the dictionary.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.list">3.2.&nbsp;Introducing Lists</a><a name="compare.list.perl"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">A list in <span class="application">Python</span> is like an array in <span class="application">Perl</span>.  In <span class="application">Perl</span>, variables that store arrays always start with the <tt class="literal">@</tt> character; in <span class="application">Python</span>, variables can be named anything, and <span class="application">Python</span> keeps track of the datatype internally.
                        </td>
                     </tr>
                  </table><a name="compare.list.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">A list in <span class="application">Python</span> is much more than an array in <span class="application">Java</span> (although it can be used as one if that's really all you want out of life).  A better analogy would be to the <tt class="classname">ArrayList</tt> class, which can hold arbitrary objects and can expand dynamically as new items are added.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#d0e6115">3.2.3.&nbsp;Searching Lists</a><a name="tip.boolean"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Before version 2.2.1, <span class="application">Python</span> had no separate boolean datatype.  To compensate for this, <span class="application">Python</span> accepted almost anything in a boolean context (like an <tt class="literal">if</tt> statement), according to the following rules:
                           <div class="itemizedlist">
                              <ul>
                                 <li><tt class="constant">0</tt> is false; all other numbers are true.
                                 </li>
                                 <li>An empty string (<tt class="literal">""</tt>) is false, all other strings are true.
                                 </li>
                                 <li>An empty list (<tt class="literal">[]</tt>) is false; all other lists are true.
                                 </li>
                                 <li>An empty tuple (<tt class="literal">()</tt>) is false; all other tuples are true.
                                 </li>
                                 <li>An empty dictionary (<tt class="literal">{}</tt>) is false; all other dictionaries are true.
                                 </li>
                              </ul>
                           </div>These rules still apply in <span class="application">Python</span> 2.2.1 and beyond, but now you can also use an actual boolean, which has a value of <tt class="literal">True</tt> or <tt class="literal">False</tt>.  Note the capitalization; these values, like everything else in <span class="application">Python</span>, are case-sensitive.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.tuple">3.3.&nbsp;Introducing Tuples</a><a name="tip.tuple"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Tuples can be converted into lists, and vice-versa.  The built-in <tt class="function">tuple</tt> function takes a list and returns a tuple with the same elements, and the <tt class="function">list</tt> function takes a tuple and returns a list.  In effect, <tt class="function">tuple</tt> freezes a list, and <tt class="function">list</tt> thaws a tuple.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.vardef">3.4.&nbsp;Declaring variables</a><a name="tip.multiline"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">When a command is split among several lines with the line-continuation marker (&#8220;<span class="quote"><tt class="literal">\</tt></span>&#8221;), the continued lines can be indented in any manner; <span class="application">Python</span>'s normally stringent indentation rules do not apply.  If your <span class="application">Python</span> <span class="acronym">IDE</span> auto-indents the continued line, you should probably accept its default unless you have a burning reason not to.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.stringformatting">3.5.&nbsp;Formatting Strings</a><a name="compare.stringformatting.c"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">String formatting in <span class="application">Python</span> uses the same syntax as the <tt class="function">sprintf</tt> function in <span class="application"><span class="acronym">C</span></span>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.join">3.7.&nbsp;Joining Lists and Splitting Strings</a><a name="tip.join"></a><table class="caution" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/caution.png" alt="Caution" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="function">join</tt> works only on lists of strings; it does not do any type coercion.  Joining a list that has one or more non-string elements
                           will raise an exception.
                        </td>
                     </tr>
                  </table><a name="tip.split"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="literal"><i class="replaceable">anystring</i>.<tt class="function">split</tt>(<i class="replaceable">delimiter</i>, 1)</tt> is a useful technique when you want to search a string for a substring and then work with everything before the substring
                           (which ends up in the first element of the returned list) and everything after it (which ends up in the second element).
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#apihelper">Chapter&nbsp;4.&nbsp;The Power Of Introspection</a></p>
            <ul>
               <li><a href="../#apihelper.optional">4.2.&nbsp;Using Optional and Named Arguments</a><a name="tip.arguments"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">The only thing you need to do to call a function is specify a value (somehow) for each required argument; the manner and order
                           in which you do that is up to you.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#d0e8958">4.3.3.&nbsp;Built-In Functions</a><a name="tip.manuals"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> comes with excellent reference manuals, which you should peruse thoroughly to learn all the modules <span class="application">Python</span> has to offer.  But unlike most languages, where you would find yourself referring back to the manuals or man pages to remind
                           yourself how to use these modules, <span class="application">Python</span> is largely self-documenting.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#apihelper.lambda">4.7.&nbsp;Using lambda Functions</a><a name="tip.lambda"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">lambda</tt> functions are a matter of style.  Using them is never required; anywhere you could use them, you could define a separate
                           normal function and use that instead.  I use them in places where I want to encapsulate specific, non-reusable code without
                           littering my code with a lot of little one-line functions.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#apihelper.alltogether">4.8.&nbsp;Putting It All Together</a><a name="compare.isnull.sql"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="acronym">SQL</span>, you must use <tt class="literal">IS NULL</tt> instead of <tt class="literal">= NULL</tt> to compare a null value.  In <span class="application">Python</span>, you can use either <tt class="literal">== None</tt> or <tt class="literal">is None</tt>, but <tt class="literal">is None</tt> is faster.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#fileinfo">Chapter&nbsp;5.&nbsp;Objects and Object-Orientation</a></p>
            <ul>
               <li><a href="../#fileinfo.fromimport">5.2.&nbsp;Importing Modules Using from module import</a><a name="compare.fromimport.perl"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">from <i class="replaceable">module</i> import *</tt> in <span class="application">Python</span> is like <tt class="literal">use <i class="replaceable">module</i></tt> in <span class="application">Perl</span>; <tt class="literal">import <i class="replaceable">module</i></tt> in <span class="application">Python</span> is like <tt class="literal">require <i class="replaceable">module</i></tt> in <span class="application">Perl</span>.
                        </td>
                     </tr>
                  </table><a name="compare.fromimport.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="literal">from <i class="replaceable">module</i> import *</tt> in <span class="application">Python</span> is like <tt class="literal">import <i class="replaceable">module</i>.*</tt> in <span class="application">Java</span>; <tt class="literal">import <i class="replaceable">module</i></tt> in <span class="application">Python</span> is like <tt class="literal">import <i class="replaceable">module</i></tt> in <span class="application">Java</span>.
                        </td>
                     </tr>
                  </table><a name="d0e11495"></a><table class="caution" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/caution.png" alt="Caution" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Use <tt class="literal">from module import *</tt> sparingly, because it makes it difficult to determine where a particular function or attribute came from, and that makes
                           debugging and refactoring more difficult.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.class">5.3.&nbsp;Defining Classes</a><a name="compare.pass.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">The <tt class="literal">pass</tt> statement in <span class="application">Python</span> is like an empty set of braces (<tt class="literal">{}</tt>) in <span class="application">Java</span> or <span class="application"><span class="acronym">C</span></span>.
                        </td>
                     </tr>
                  </table><a name="compare.extends.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Python</span>, the ancestor of a class is simply listed in parentheses immediately after the class name.  There is no special keyword like
                           <tt class="literal">extends</tt> in <span class="application">Java</span>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#d0e11720">5.3.1.&nbsp;Initializing and Coding Classes</a><a name="compare.self.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">By convention, the first argument of any <span class="application">Python</span> class method (the reference to the current instance) is called <tt class="literal">self</tt>.  This argument fills the role of the reserved word <tt class="literal">this</tt> in <span class="application"><span class="acronym">C++</span></span> or <span class="application">Java</span>, but <tt class="literal">self</tt> is not a reserved word in <span class="application">Python</span>, merely a naming convention.  Nonetheless, please don't call it anything but <tt class="literal">self</tt>; this is a very strong convention.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#d0e11896">5.3.2.&nbsp;Knowing When to Use self and __init__</a><a name="tip.initoptional"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="function">__init__</tt> methods are optional, but when you define one, you must remember to explicitly call the ancestor's <tt class="function">__init__</tt> method (if it defines one).  This is more generally true: whenever a descendant wants to extend the behavior of the ancestor,
                           the descendant method must explicitly call the ancestor method at the proper time, with the proper arguments.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.create">5.4.&nbsp;Instantiating Classes</a><a name="compare.new.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Python</span>, simply call a class as if it were a function to create a new instance of the class.  There is no explicit <tt class="literal">new</tt> operator like <span class="application"><span class="acronym">C++</span></span> or <span class="application">Java</span>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.userdict">5.5.&nbsp;Exploring UserDict: A Wrapper Class</a><a name="tip.locate"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">ActivePython</span> <span class="acronym">IDE</span> on Windows, you can quickly open any module in your library path by selecting
                           <span class="guimenu">File</span>-&gt;<span class="guimenuitem"><span class="accel">L</span>ocate...</span> (<span><b class="shortcut"><span><b class="keycap">Ctrl</b></span>-<span class="keysym">L</span></b></span>).
                        </td>
                     </tr>
                  </table><a name="compare.overloading"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><span class="application">Java</span> and <span class="application">Powerbuilder</span> support function overloading by argument list, <span class="foreignphrase"><i class="foreignphrase"><span class="acronym">i.e.</span></i></span> one class can have multiple methods with the same name but a different number of arguments, or arguments of different types.
                            Other languages (most notably <span class="acronym">PL/SQL</span>) even support function overloading by argument name; <span class="foreignphrase"><i class="foreignphrase"><span class="acronym">i.e.</span></i></span> one class can have multiple methods with the same name and the same number of arguments of the same type but different argument
                           names.  <span class="application">Python</span> supports neither of these; it has no form of function overloading whatsoever.  Methods are defined solely by their name,
                           and there can be only one method per class with a given name.  So if a descendant class has an <tt class="function">__init__</tt> method, it <span class="emphasis"><em>always</em></span> overrides the ancestor <tt class="function">__init__</tt> method, even if the descendant defines it with a different argument list.  And the same rule applies to any other method.
                        </td>
                     </tr>
                  </table><a name="fileinfo.derivedclasses"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Guido, the original author of <span class="application">Python</span>, explains method overriding this way: "Derived classes may override methods of their base classes. Because methods have no
                           special privileges when calling other methods of the same object, a method of a base class that calls another method defined
                           in the same base class, may in fact end up calling a method of a derived class that overrides it. (For <span class="application"><span class="acronym">C++</span></span> programmers: all methods in <span class="application">Python</span> are effectively virtual.)"  If that doesn't make sense to you (it confuses the hell out of me), feel free to ignore it. 
                           I just thought I'd pass it along.
                        </td>
                     </tr>
                  </table><a name="note.dataattributes"></a><table class="caution" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/caution.png" alt="Caution" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Always assign an initial value to all of an instance's data attributes in the <tt class="function">__init__</tt> method.  It will save you hours of debugging later, tracking down <tt class="classname">AttributeError</tt> exceptions because you're referencing uninitialized (and therefore non-existent) attributes.
                        </td>
                     </tr>
                  </table><a name="d0e12692"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In versions of <span class="application">Python</span> prior to 2.2, you could not directly subclass built-in datatypes like strings, lists, and dictionaries.  To compensate for
                           this, <span class="application">Python</span> comes with wrapper classes that mimic the behavior of these built-in datatypes: <tt class="classname">UserString</tt>, <tt class="classname">UserList</tt>, and <tt class="classname">UserDict</tt>.  Using a combination of normal and special methods, the <tt class="classname">UserDict</tt> class does an excellent imitation of a dictionary.  In <span class="application">Python</span> 2.2 and later, you can inherit classes directly from built-in datatypes like <tt class="classname">dict</tt>.  An example of this is given in the examples that come with this book, in <tt class="filename">fileinfo_fromdict.py</tt>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#d0e12822">5.6.1.&nbsp;Getting and Setting Items</a><a name="tip.self.call"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">When accessing data attributes within a class, you need to qualify the attribute name: <tt class="literal">self.<i class="replaceable">attribute</i></tt>.  When calling other methods within a class, you need to qualify the method name: <tt class="literal">self.<i class="replaceable">method</i></tt>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.morespecial">5.7.&nbsp;Advanced Special Class Methods</a><a name="compare.strequals.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Java</span>, you determine whether two string variables reference the same physical memory location by using <tt class="literal">str1 == str2</tt>.  This is called <span class="emphasis"><em>object identity</em></span>, and it is written in <span class="application">Python</span> as <tt class="literal">str1 is str2</tt>.  To compare string values in <span class="application">Java</span>, you would use <tt class="literal">str1.equals(str2)</tt>; in <span class="application">Python</span>, you would use <tt class="literal">str1 == str2</tt>.  <span class="application">Java</span> programmers who have been taught to believe that the world is a better place because <tt class="literal">==</tt> in <span class="application">Java</span> compares by identity instead of by value may have a difficult time adjusting to <span class="application">Python</span>'s lack of such &#8220;<span class="quote">gotchas</span>&#8221;.
                        </td>
                     </tr>
                  </table><a name="note.physical.v.logical"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">While other object-oriented languages only let you define the physical model of an object (&#8220;<span class="quote">this object has a <tt class="function">GetLength</tt> method</span>&#8221;), <span class="application">Python</span>'s special class methods like <tt class="function">__len__</tt> allow you to define the logical model of an object (&#8220;<span class="quote">this object has a length</span>&#8221;).
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.classattributes">5.8.&nbsp;Introducing Class Attributes</a><a name="compare.classattr.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Java</span>, both static variables (called class attributes in <span class="application">Python</span>) and instance variables (called data attributes in <span class="application">Python</span>) are defined immediately after the class definition (one with the <tt class="literal">static</tt> keyword, one without).  In <span class="application">Python</span>, only class attributes can be defined here; data attributes are defined in the <tt class="function">__init__</tt> method.
                        </td>
                     </tr>
                  </table><a name="d0e13711"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">There are no constants in <span class="application">Python</span>.  Everything can be changed if you try hard enough.  This fits with one of the core principles of <span class="application">Python</span>: bad behavior should be discouraged but not banned.  If you really want to change the value of <tt class="literal">None</tt>, you can do it, but don't come running to me when your code is impossible to debug.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.private">5.9.&nbsp;Private Functions</a><a name="tip.specialmethodnames"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In <span class="application">Python</span>, all special methods (like <a href="#fileinfo.specialmethods.setitem.example" title="Example&nbsp;5.13.&nbsp;The __setitem__ Special Method"><tt class="function">__setitem__</tt></a>) and built-in attributes (like <a href="#odbchelper.import" title="Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string"><tt class="literal">__doc__</tt></a>) follow a standard naming convention: they both start with and end with two underscores.  Don't name your own methods and
                           attributes this way, because it will only confuse you (and others) later.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#filehandling">Chapter&nbsp;6.&nbsp;Exceptions and File Handling</a></p>
            <ul>
               <li><a href="../#fileinfo.exception">6.1.&nbsp;Handling Exceptions</a><a name="compare.exceptions.java"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> uses <tt class="literal">try...except</tt> to handle exceptions and <tt class="literal">raise</tt> to generate them.  <span class="application">Java</span> and <span class="application"><span class="acronym">C++</span></span> use <tt class="literal">try...catch</tt> to handle exceptions, and <tt class="literal">throw</tt> to generate them.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.os">6.5.&nbsp;Working with Directories</a><a name="tip.os"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Whenever possible, you should use the functions in <tt class="filename">os</tt> and <tt class="filename">os.path</tt> for file, directory, and path manipulations.  These modules are wrappers for platform-specific modules, so functions like
                           <tt class="function">os.path.split</tt> work on <span class="acronym">UNIX</span>, Windows, <span class="abbrev">Mac</span> <span class="acronym">OS</span>, and any other platform supported by <span class="application">Python</span>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#re">Chapter&nbsp;7.&nbsp;Regular Expressions</a></p>
            <ul>
               <li><a href="../#re.nm">7.4.&nbsp;Using the {n,m} Syntax</a><a name="d0e18321"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">There is no way to programmatically determine that two regular expressions are equivalent.  The best you can do is write a
                           lot of test cases to make sure they behave the same way on all relevant inputs.  You'll talk more about writing test cases
                           later in this book.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#dialect">Chapter&nbsp;8.&nbsp;HTML Processing</a></p>
            <ul>
               <li><a href="../#dialect.sgmllib">8.2.&nbsp;Introducing sgmllib.py</a><a name="d0e20023"></a><table class="important" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> 2.0 had a bug where <tt class="classname">SGMLParser</tt> would not recognize declarations at all (<tt class="function">handle_decl</tt> would never be called), which meant that <tt class="sgmltag-element">DOCTYPE</tt>s were silently ignored.  This is fixed in <span class="application">Python</span> 2.1.
                        </td>
                     </tr>
                  </table><a name="tip.commandline.windows"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In the <span class="application">ActivePython</span> <span class="acronym">IDE</span> on Windows, you can specify command line arguments in the &#8220;<span class="quote">Run script</span>&#8221; dialog.  Separate multiple arguments with spaces.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#dialect.basehtml">8.4.&nbsp;Introducing BaseHTMLProcessor.py</a><a name="d0e20845"></a><table class="important" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">The <span class="acronym">HTML</span> specification requires that all non-<span class="acronym">HTML</span> (like client-side <span class="application">JavaScript</span>) must be enclosed in <span class="acronym">HTML</span> comments, but not all web pages do this properly (and all modern web browsers are forgiving if they don't).  <tt class="classname">BaseHTMLProcessor</tt> is not forgiving; if script is improperly embedded, it will be parsed as if it were <span class="acronym">HTML</span>.  For instance, if the script contains less-than and equals signs, <tt class="classname">SGMLParser</tt> may incorrectly think that it has found tags and attributes.  <tt class="classname">SGMLParser</tt> always converts tags and attribute names to lowercase, which may break the script, and <tt class="classname">BaseHTMLProcessor</tt> always encloses attribute values in double quotes (even if the original <span class="acronym">HTML</span> document used single quotes or no quotes), which will certainly break the script.  Always protect your client-side script
                           within <span class="acronym">HTML</span> comments.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#dialect.locals">8.5.&nbsp;locals and globals</a><a name="d0e21061"></a><table class="important" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><span class="application">Python</span> 2.2 introduced a subtle but important change that affects the namespace search order: nested scopes.  In versions of <span class="application">Python</span> prior to 2.2, when you reference a variable within a <a href="#fileinfo.nested" title="Example&nbsp;6.21.&nbsp;listDirectory">nested function</a> or <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions"><tt class="literal">lambda</tt> function</a>, <span class="application">Python</span> will search for that variable in the current (nested or <tt class="literal">lambda</tt>) function's namespace, then in the module's namespace.  <span class="application">Python</span> 2.2 will search for the variable in the current (nested or <tt class="literal">lambda</tt>) function's namespace, <span class="emphasis"><em>then in the parent function's namespace</em></span>, then in the module's namespace.  <span class="application">Python</span> 2.1 can work either way; by default, it works like <span class="application">Python</span> 2.0, but you can add the following line of code at the top of your module to make your module work like <span class="application">Python</span> 2.2:<pre class="programlisting">
from __future__ import nested_scopes</pre></td>
                     </tr>
                  </table><a name="tip.localsbyname"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Using the <tt class="function">locals</tt> and <tt class="function">globals</tt> functions, you can get the value of arbitrary variables dynamically, providing the variable name as a string.  This mirrors
                           the functionality of the <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr"><tt class="function">getattr</tt></a> function, which allows you to access arbitrary functions dynamically by providing the function name as a string.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#dialect.dictsub">8.6.&nbsp;Dictionary-based string formatting</a><a name="d0e21731"></a><table class="important" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/important.png" alt="Important" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Using dictionary-based string formatting with <tt class="function">locals</tt> is a convenient way of making complex string formatting expressions more readable, but it comes with a price.  There is a
                           slight performance hit in making the call to <tt class="function">locals</tt>, since <a href="#dialect.locals.readonly.example" title="Example&nbsp;8.12.&nbsp;locals is read-only, globals is not"><tt class="function">locals</tt> builds a copy</a> of the local namespace.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#kgp">Chapter&nbsp;9.&nbsp;XML Processing</a></p>
            <ul>
               <li><a href="../#kgp.packages">9.2.&nbsp;Packages</a><a name="d0e23185"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">A package is a directory with the special <tt class="filename">__init__.py</tt> file in it.  The <tt class="filename">__init__.py</tt> file defines the attributes and methods of the package.  It doesn't need to define anything; it can just be an empty file,
                           but it has to exist.  But if <tt class="filename">__init__.py</tt> doesn't exist, the directory is just a directory, not a package, and it can't be imported or contain modules or nested packages.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#kgp.attributes">9.6.&nbsp;Accessing element attributes</a><a name="d0e24744"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">This section may be a little confusing, because of some overlapping terminology.  Elements in an <span class="acronym">XML</span> document have attributes, and <span class="application">Python</span> objects also have attributes.  When you parse an <span class="acronym">XML</span> document, you get a bunch of <span class="application">Python</span> objects that represent all the pieces of the <span class="acronym">XML</span> document, and some of these <span class="application">Python</span> objects represent attributes of the <span class="acronym">XML</span> elements.  But the (<span class="application">Python</span>) objects that represent the (<span class="acronym">XML</span>) attributes also have (<span class="application">Python</span>) attributes, which are used to access various parts of the (<span class="acronym">XML</span>) attribute that the object represents.  I told you it was confusing.  I am open to suggestions on how to distinguish these
                           more clearly.
                        </td>
                     </tr>
                  </table><a name="d0e24990"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Like a dictionary, attributes of an <span class="acronym">XML</span> element have no ordering.  Attributes may <span class="emphasis"><em>happen to be</em></span> listed in a certain order in the original <span class="acronym">XML</span> document, and the <tt class="classname">Attr</tt> objects may <span class="emphasis"><em>happen to be</em></span> listed in a certain order when the <span class="acronym">XML</span> document is parsed into <span class="application">Python</span> objects, but these orders are arbitrary and should carry no special meaning.  You should always access individual attributes
                           by name, like the keys of a dictionary.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#streams">Chapter&nbsp;10.&nbsp;Scripts and Streams</a></p>
            <ul></ul>
            <p><a href="../#oa">Chapter&nbsp;11.&nbsp;HTTP Web Services</a></p>
            <ul>
               <li><a href="../#oa.etags">11.6.&nbsp;Handling Last-Modified and ETag</a><a name="tip.etag.vs.lastmodified"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">In these examples, the HTTP server has supported both <tt class="literal">Last-Modified</tt> and <tt class="literal">ETag</tt> headers, but not all servers do.  As a web services client, you should be prepared to support both, but you must code defensively
                           in case a server only supports one or the other, or neither.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#soap">Chapter&nbsp;12.&nbsp;SOAP Web Services</a></p>
            <ul></ul>
            <p><a href="../#roman">Chapter&nbsp;13.&nbsp;Unit Testing</a></p>
            <ul>
               <li><a href="../#roman.divein">13.2.&nbsp;Diving in</a><a name="note.unittest"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="filename">unittest</tt> is included with <span class="application">Python</span> 2.1 and later.  <span class="application">Python</span> 2.0 users can download it from <a href="http://pyunit.sourceforge.net/"><tt class="systemitem">pyunit.sourceforge.net</tt></a>.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#roman1.5">Chapter&nbsp;14.&nbsp;Test-First Programming</a></p>
            <ul>
               <li><a href="../#roman.stage3">14.3.&nbsp;roman.py, stage 3</a><a name="d0e33558"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">The most important thing that comprehensive unit testing can tell you is when to stop coding.  When all the unit tests for
                           a function pass, stop coding the function.  When all the unit tests for an entire module pass, stop coding the module.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
               <li><a href="../#roman.stage5">14.5.&nbsp;roman.py, stage 5</a><a name="d0e34136"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">When all of your tests pass, stop coding.</td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#roman2">Chapter&nbsp;15.&nbsp;Refactoring</a></p>
            <ul>
               <li><a href="../#roman.refactoring">15.3.&nbsp;Refactoring</a><a name="d0e34764"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Whenever you are going to use a regular expression more than once, you should compile it to get a pattern object, then call
                           the methods on the pattern object directly.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#regression">Chapter&nbsp;16.&nbsp;Functional Programming</a></p>
            <ul>
               <li><a href="../#regression.path">16.2.&nbsp;Finding the path</a><a name="os.path.abspath.exist.note"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">The pathnames and filenames you pass to <tt class="function">os.path.abspath</tt> do not need to exist.
                        </td>
                     </tr>
                  </table><a name="os.path.normpath.note"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%"><tt class="function">os.path.abspath</tt> not only constructs full path names, it also normalizes them.  That means that if you are in the <tt class="filename">/usr/</tt> directory, <tt class="literal">os.path.abspath('bin/../local/bin')</tt> will return <tt class="filename">/usr/local/bin</tt>.  It normalizes the path by making it as simple as possible.  If you just want to normalize a pathname like this without
                           turning it into a full pathname, use <tt class="function">os.path.normpath</tt> instead.
                        </td>
                     </tr>
                  </table><a name="os.path.abspath.crossplatform.note"></a><table class="note" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/note.png" alt="Note" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">Like the other functions in the <tt class="filename">os</tt> and <tt class="filename">os.path</tt> modules, <tt class="function">os.path.abspath</tt> is cross-platform.  Your results will look slightly different than my examples if you're running on Windows (which uses backslash
                           as a path separator) or <span class="abbrev">Mac</span> <span class="acronym">OS</span> (which uses colons), but they'll still work.  That's the whole point of the <tt class="filename">os</tt> module.
                        </td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#plural">Chapter&nbsp;17.&nbsp;Dynamic functions</a></p>
            <ul></ul>
            <p><a href="../#soundex">Chapter&nbsp;18.&nbsp;Performance Tuning</a></p>
            <ul>
               <li><a href="../#soundex.timeit">18.2.&nbsp;Using the timeit Module</a><a name="d0e39049"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">You can use the <tt class="filename">timeit</tt> module on the command line to test an existing <span class="application">Python</span> program, without modifying the code.  See <a href="http://docs.python.org/lib/node396.html">http://docs.python.org/lib/node396.html</a> for documentation on the command-line flags.
                        </td>
                     </tr>
                  </table><a name="d0e39097"></a><table class="tip" border="0" summary="">
                     <tr>
                        <td rowspan="2" align="center" valign="top" width="1%"><img src="images/tip.png" alt="Tip" title="" width="24" height="24"></td>
                     </tr>
                     <tr>
                        <td colspan="2" align="left" valign="top" width="99%">The <tt class="filename">timeit</tt> module only works if you already know what piece of code you need to optimize.  If you have a larger <span class="application">Python</span> program and don't know where your performance problems are, check out <a href="http://docs.python.org/lib/module-hotshot.html">the <tt class="filename">hotshot</tt> module.</a></td>
                     </tr>
                  </table>
                  <p></p>
               </li>
            </ul>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="examples"></a>Appendix&nbsp;D.&nbsp;List of examples
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <p><a href="../#install">Chapter&nbsp;1.&nbsp;Installing Python</a></p>
            <ul>
               <li><a href="../#install.macosx">1.3.&nbsp;Python on Mac OS X</a><p></p>
                  <ul>
                     <li><a href="../#d0e3331">Example&nbsp;1.1.&nbsp;Two versions of Python</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#install.redhat">1.5.&nbsp;Python on RedHat Linux</a><p></p>
                  <ul>
                     <li><a href="../#d0e3510">Example&nbsp;1.2.&nbsp;Installing on RedHat Linux 9</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#install.debian">1.6.&nbsp;Python on Debian GNU/Linux</a><p></p>
                  <ul>
                     <li><a href="../#d0e3634">Example&nbsp;1.3.&nbsp;Installing on Debian GNU/Linux</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#install.source">1.7.&nbsp;Python Installation from Source</a><p></p>
                  <ul>
                     <li><a href="../#d0e3716">Example&nbsp;1.4.&nbsp;Installing from source</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#install.shell">1.8.&nbsp;The Interactive Shell</a><p></p>
                  <ul>
                     <li><a href="../#d0e3829">Example&nbsp;1.5.&nbsp;First Steps in the Interactive Shell</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#odbchelper">Chapter&nbsp;2.&nbsp;Your First Python Program</a></p>
            <ul>
               <li><a href="../#odbchelper.divein">2.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li><a href="../#d0e3948">Example&nbsp;2.1.&nbsp;odbchelper.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.docstring">2.3.&nbsp;Documenting Functions</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.triplequotes">Example&nbsp;2.2.&nbsp;Defining the buildConnectionString Function's doc string</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.objects">2.4.&nbsp;Everything Is an Object</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.import">Example&nbsp;2.3.&nbsp;Accessing the buildConnectionString Function's doc string</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e4550">2.4.1.&nbsp;The Import Search Path</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.objects.sys.path">Example&nbsp;2.4.&nbsp;Import Search Path</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.indenting">2.5.&nbsp;Indenting Code</a><p></p>
                  <ul>
                     <li><a href="../#d0e4759">Example&nbsp;2.5.&nbsp;Indenting the buildConnectionString Function</a></li>
                     <li><a href="../#odbchelper.indenting.if">Example&nbsp;2.6.&nbsp;if Statements</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#datatypes">Chapter&nbsp;3.&nbsp;Native Datatypes</a></p>
            <ul>
               <li><a href="../#d0e5174">3.1.1.&nbsp;Defining Dictionaries</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.dict.define">Example&nbsp;3.1.&nbsp;Defining a Dictionary</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e5269">3.1.2.&nbsp;Modifying Dictionaries</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.dict.modify">Example&nbsp;3.2.&nbsp;Modifying a Dictionary</a></li>
                     <li><a href="../#odbchelper.dict.case">Example&nbsp;3.3.&nbsp;Dictionary Keys Are Case-Sensitive</a></li>
                     <li><a href="../#odbchelper.dictionarytypes">Example&nbsp;3.4.&nbsp;Mixing Datatypes in a Dictionary</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e5450">3.1.3.&nbsp;Deleting Items From Dictionaries</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.dict.del">Example&nbsp;3.5.&nbsp;Deleting Items from a Dictionary</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e5623">3.2.1.&nbsp;Defining Lists</a><p></p>
                  <ul>
                     <li><a href="../#d0e5626">Example&nbsp;3.6.&nbsp;Defining a List</a></li>
                     <li><a href="../#odbchelper.negative.example">Example&nbsp;3.7.&nbsp;Negative List Indices</a></li>
                     <li><a href="../#odbchelper.list.slice">Example&nbsp;3.8.&nbsp;Slicing a List</a></li>
                     <li><a href="../#odbchelper.list.slicing.example">Example&nbsp;3.9.&nbsp;Slicing Shorthand</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e5887">3.2.2.&nbsp;Adding Elements to Lists</a><p></p>
                  <ul>
                     <li><a href="../#d0e5890">Example&nbsp;3.10.&nbsp;Adding Elements to a List</a></li>
                     <li><a href="../#odbchelper.list.append.vs.extend">Example&nbsp;3.11.&nbsp;The Difference between extend and append</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e6115">3.2.3.&nbsp;Searching Lists</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.list.search">Example&nbsp;3.12.&nbsp;Searching a List</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e6277">3.2.4.&nbsp;Deleting List Elements</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.list.removingelements">Example&nbsp;3.13.&nbsp;Removing Elements from a List</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e6392">3.2.5.&nbsp;Using List Operators</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.list.operators">Example&nbsp;3.14.&nbsp;List Operators</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.tuple">3.3.&nbsp;Introducing Tuples</a><p></p>
                  <ul>
                     <li><a href="../#d0e6568">Example&nbsp;3.15.&nbsp;Defining a tuple</a></li>
                     <li><a href="../#odbchelper.tuplemethods">Example&nbsp;3.16.&nbsp;Tuples Have No Methods</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.vardef">3.4.&nbsp;Declaring variables</a><p></p>
                  <ul>
                     <li><a href="../#myparamsdef">Example&nbsp;3.17.&nbsp;Defining the myParams Variable</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e6873">3.4.1.&nbsp;Referencing Variables</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.unboundvariable">Example&nbsp;3.18.&nbsp;Referencing an Unbound Variable</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.multiassign">3.4.2.&nbsp;Assigning Multiple Values at Once</a><p></p>
                  <ul>
                     <li><a href="../#d0e6913">Example&nbsp;3.19.&nbsp;Assigning multiple values at once</a></li>
                     <li><a href="../#odbchelper.multiassign.range">Example&nbsp;3.20.&nbsp;Assigning Consecutive Values</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.stringformatting">3.5.&nbsp;Formatting Strings</a><p></p>
                  <ul>
                     <li><a href="../#d0e7165">Example&nbsp;3.21.&nbsp;Introducing String Formatting</a></li>
                     <li><a href="../#odbchelper.stringformatting.coerce">Example&nbsp;3.22.&nbsp;String Formatting vs. Concatenating</a></li>
                     <li><a href="../#odbchelper.stringformatting.numbers">Example&nbsp;3.23.&nbsp;Formatting Numbers</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.map">3.6.&nbsp;Mapping Lists</a><p></p>
                  <ul>
                     <li><a href="../#d0e7412">Example&nbsp;3.24.&nbsp;Introducing List Comprehensions</a></li>
                     <li><a href="../#odbchelper.items">Example&nbsp;3.25.&nbsp;The keys, values, and items Functions</a></li>
                     <li><a href="../#d0e7615">Example&nbsp;3.26.&nbsp;List Comprehensions in buildConnectionString, Step by Step</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#odbchelper.join">3.7.&nbsp;Joining Lists and Splitting Strings</a><p></p>
                  <ul>
                     <li><a href="../#odbchelper.join.example">Example&nbsp;3.27.&nbsp;Output of odbchelper.py</a></li>
                     <li><a href="../#odbchelper.split.example">Example&nbsp;3.28.&nbsp;Splitting a String</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#apihelper">Chapter&nbsp;4.&nbsp;The Power Of Introspection</a></p>
            <ul>
               <li><a href="../#apihelper.divein">4.1.&nbsp;Diving In</a><p></p>
                  <ul>
                     <li><a href="../#d0e8158">Example&nbsp;4.1.&nbsp;apihelper.py</a></li>
                     <li><a href="../#d0e8257">Example&nbsp;4.2.&nbsp;Sample Usage of apihelper.py</a></li>
                     <li><a href="../#d0e8294">Example&nbsp;4.3.&nbsp;Advanced Usage of apihelper.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#apihelper.optional">4.2.&nbsp;Using Optional and Named Arguments</a><p></p>
                  <ul>
                     <li><a href="../#d0e8401">Example&nbsp;4.4.&nbsp;Valid Calls of info</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e8510">4.3.1.&nbsp;The type Function</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.type.intro">Example&nbsp;4.5.&nbsp;Introducing type</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e8609">4.3.2.&nbsp;The str Function</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.str.intro">Example&nbsp;4.6.&nbsp;Introducing str</a></li>
                     <li><a href="../#apihelper.dir.intro">Example&nbsp;4.7.&nbsp;Introducing dir</a></li>
                     <li><a href="../#apihelper.builtin.callable">Example&nbsp;4.8.&nbsp;Introducing callable</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e8958">4.3.3.&nbsp;Built-In Functions</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.builtin.list">Example&nbsp;4.9.&nbsp;Built-in Attributes and Functions</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#apihelper.getattr">4.4.&nbsp;Getting Object References With getattr</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.getattr.intro">Example&nbsp;4.10.&nbsp;Introducing getattr</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e9194">4.4.1.&nbsp;getattr with Modules</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.getattr.example">Example&nbsp;4.11.&nbsp;The getattr Function in apihelper.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e9362">4.4.2.&nbsp;getattr As a Dispatcher</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.getattr.dispatch">Example&nbsp;4.12.&nbsp;Creating a Dispatcher with getattr</a></li>
                     <li><a href="../#apihelper.getattr.default">Example&nbsp;4.13.&nbsp;getattr Default Values</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#apihelper.filter">4.5.&nbsp;Filtering Lists</a><p></p>
                  <ul>
                     <li><a href="../#d0e9539">Example&nbsp;4.14.&nbsp;Introducing List Filtering</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#apihelper.andor">4.6.&nbsp;The Peculiar Nature of and and or</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.andor.intro.example">Example&nbsp;4.15.&nbsp;Introducing and</a></li>
                     <li><a href="../#d0e9812">Example&nbsp;4.16.&nbsp;Introducing or</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e9975">4.6.1.&nbsp;Using the and-or Trick</a><p></p>
                  <ul>
                     <li><a href="../#apihelper.andortrick.intro">Example&nbsp;4.17.&nbsp;Introducing the and-or Trick</a></li>
                     <li><a href="../#d0e10093">Example&nbsp;4.18.&nbsp;When the and-or Trick Fails</a></li>
                     <li><a href="../#d0e10205">Example&nbsp;4.19.&nbsp;Using the and-or Trick Safely</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#apihelper.lambda">4.7.&nbsp;Using lambda Functions</a><p></p>
                  <ul>
                     <li><a href="../#d0e10311">Example&nbsp;4.20.&nbsp;Introducing lambda Functions</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e10403">4.7.1.&nbsp;Real-World lambda Functions</a><p></p>
                  <ul>
                     <li><a href="../#d0e10444">Example&nbsp;4.21.&nbsp;split With No Arguments</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#apihelper.alltogether">4.8.&nbsp;Putting It All Together</a><p></p>
                  <ul>
                     <li><a href="../#d0e10681">Example&nbsp;4.22.&nbsp;Getting a doc string Dynamically</a></li>
                     <li><a href="../#d0e10793">Example&nbsp;4.23.&nbsp;Why Use str on a doc string?</a></li>
                     <li><a href="../#d0e10958">Example&nbsp;4.24.&nbsp;Introducing ljust</a></li>
                     <li><a href="../#d0e11026">Example&nbsp;4.25.&nbsp;Printing a List</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#fileinfo">Chapter&nbsp;5.&nbsp;Objects and Object-Orientation</a></p>
            <ul>
               <li><a href="../#fileinfo.divein">5.1.&nbsp;Diving In</a><p></p>
                  <ul>
                     <li><a href="../#d0e11177">Example&nbsp;5.1.&nbsp;fileinfo.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.fromimport">5.2.&nbsp;Importing Modules Using from module import</a><p></p>
                  <ul>
                     <li><a href="../#d0e11355">Example&nbsp;5.2.&nbsp;import module vs. from module import</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.class">5.3.&nbsp;Defining Classes</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.class.simplest">Example&nbsp;5.3.&nbsp;The Simplest Python Class</a></li>
                     <li><a href="../#fileinfo.class.example">Example&nbsp;5.4.&nbsp;Defining the FileInfo Class</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e11720">5.3.1.&nbsp;Initializing and Coding Classes</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.init.example">Example&nbsp;5.5.&nbsp;Initializing the FileInfo Class</a></li>
                     <li><a href="../#fileinfo.init.code.example">Example&nbsp;5.6.&nbsp;Coding the FileInfo Class</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.create">5.4.&nbsp;Instantiating Classes</a><p></p>
                  <ul>
                     <li><a href="../#d0e12003">Example&nbsp;5.7.&nbsp;Creating a FileInfo Instance</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e12165">5.4.1.&nbsp;Garbage Collection</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.scope">Example&nbsp;5.8.&nbsp;Trying to Implement a Memory Leak</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.userdict">5.5.&nbsp;Exploring UserDict: A Wrapper Class</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.userdict.init.example">Example&nbsp;5.9.&nbsp;Defining the UserDict Class</a></li>
                     <li><a href="../#fileinfo.userdict.normalmethods">Example&nbsp;5.10.&nbsp;UserDict Normal Methods</a></li>
                     <li><a href="../#fileinfo.userdict.fromdict">Example&nbsp;5.11.&nbsp;Inheriting Directly from Built-In Datatype dict</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e12822">5.6.1.&nbsp;Getting and Setting Items</a><p></p>
                  <ul>
                     <li><a href="../#d0e12825">Example&nbsp;5.12.&nbsp;The __getitem__ Special Method</a></li>
                     <li><a href="../#fileinfo.specialmethods.setitem.example">Example&nbsp;5.13.&nbsp;The __setitem__ Special Method</a></li>
                     <li><a href="../#d0e13038">Example&nbsp;5.14.&nbsp;Overriding __setitem__ in MP3FileInfo</a></li>
                     <li><a href="../#fileinfo.specialmethods.setname">Example&nbsp;5.15.&nbsp;Setting an MP3FileInfo's name</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.morespecial">5.7.&nbsp;Advanced Special Class Methods</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.morespecial.example">Example&nbsp;5.16.&nbsp;More Special Methods in UserDict</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.classattributes">5.8.&nbsp;Introducing Class Attributes</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.classattributes.intro">Example&nbsp;5.17.&nbsp;Introducing Class Attributes</a></li>
                     <li><a href="../#fileinfo.classattributes.writeable.example">Example&nbsp;5.18.&nbsp;Modifying Class Attributes</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.private">5.9.&nbsp;Private Functions</a><p></p>
                  <ul>
                     <li><a href="../#d0e13946">Example&nbsp;5.19.&nbsp;Trying to Call a Private Method</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#filehandling">Chapter&nbsp;6.&nbsp;Exceptions and File Handling</a></p>
            <ul>
               <li><a href="../#fileinfo.exception">6.1.&nbsp;Handling Exceptions</a><p></p>
                  <ul>
                     <li><a href="../#d0e14243">Example&nbsp;6.1.&nbsp;Opening a Non-Existent File</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e14344">6.1.1.&nbsp;Using Exceptions For Other Purposes</a><p></p>
                  <ul>
                     <li><a href="../#crossplatform.example">Example&nbsp;6.2.&nbsp;Supporting Platform-Specific Functionality</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.files">6.2.&nbsp;Working with File Objects</a><p></p>
                  <ul>
                     <li><a href="../#d0e14596">Example&nbsp;6.3.&nbsp;Opening a File</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e14670">6.2.1.&nbsp;Reading Files</a><p></p>
                  <ul>
                     <li><a href="../#d0e14675">Example&nbsp;6.4.&nbsp;Reading a File</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e14800">6.2.2.&nbsp;Closing Files</a><p></p>
                  <ul>
                     <li><a href="../#d0e14805">Example&nbsp;6.5.&nbsp;Closing a File</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e14928">6.2.3.&nbsp;Handling I/O Errors</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.files.incode">Example&nbsp;6.6.&nbsp;File Objects in MP3FileInfo</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e15055">6.2.4.&nbsp;Writing to Files</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.files.writeandappend">Example&nbsp;6.7.&nbsp;Writing to Files</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.for">6.3.&nbsp;Iterating with for Loops</a><p></p>
                  <ul>
                     <li><a href="../#d0e15255">Example&nbsp;6.8.&nbsp;Introducing the for Loop</a></li>
                     <li><a href="../#fileinfo.for.counter">Example&nbsp;6.9.&nbsp;Simple Counters</a></li>
                     <li><a href="../#dictionaryiter.example">Example&nbsp;6.10.&nbsp;Iterating Through a Dictionary</a></li>
                     <li><a href="../#fileinfo.multiassign.for.example">Example&nbsp;6.11.&nbsp;for Loop in MP3FileInfo</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.modules">6.4.&nbsp;Using sys.modules</a><p></p>
                  <ul>
                     <li><a href="../#d0e15693">Example&nbsp;6.12.&nbsp;Introducing sys.modules</a></li>
                     <li><a href="../#d0e15784">Example&nbsp;6.13.&nbsp;Using sys.modules</a></li>
                     <li><a href="../#d0e15859">Example&nbsp;6.14.&nbsp;The __module__ Class Attribute</a></li>
                     <li><a href="../#d0e15923">Example&nbsp;6.15.&nbsp;sys.modules in fileinfo.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.os">6.5.&nbsp;Working with Directories</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.os.path.join.example">Example&nbsp;6.16.&nbsp;Constructing Pathnames</a></li>
                     <li><a href="../#splittingpathnames.example">Example&nbsp;6.17.&nbsp;Splitting Pathnames</a></li>
                     <li><a href="../#fileinfo.listdir.example">Example&nbsp;6.18.&nbsp;Listing Directories</a></li>
                     <li><a href="../#d0e16376">Example&nbsp;6.19.&nbsp;Listing Directories in fileinfo.py</a></li>
                     <li><a href="../#fileinfo.os.glob.example">Example&nbsp;6.20.&nbsp;Listing Directories with glob</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#fileinfo.alltogether">6.6.&nbsp;Putting It All Together</a><p></p>
                  <ul>
                     <li><a href="../#fileinfo.nested">Example&nbsp;6.21.&nbsp;listDirectory</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#re">Chapter&nbsp;7.&nbsp;Regular Expressions</a></p>
            <ul>
               <li><a href="../#re.matching">7.2.&nbsp;Case Study: Street Addresses</a><p></p>
                  <ul>
                     <li><a href="../#d0e16923">Example&nbsp;7.1.&nbsp;Matching at the End of a String</a></li>
                     <li><a href="../#d0e17121">Example&nbsp;7.2.&nbsp;Matching Whole Words</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e17592">7.3.1.&nbsp;Checking for Thousands</a><p></p>
                  <ul>
                     <li><a href="../#d0e17600">Example&nbsp;7.3.&nbsp;Checking for Thousands</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e17785">7.3.2.&nbsp;Checking for Hundreds</a><p></p>
                  <ul>
                     <li><a href="../#re.roman.hundreds">Example&nbsp;7.4.&nbsp;Checking for Hundreds</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#re.nm">7.4.&nbsp;Using the {n,m} Syntax</a><p></p>
                  <ul>
                     <li><a href="../#d0e18113">Example&nbsp;7.5.&nbsp;The Old Way: Every Character Optional</a></li>
                     <li><a href="../#d0e18215">Example&nbsp;7.6.&nbsp;The New Way: From n o m</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e18326">7.4.1.&nbsp;Checking for Tens and Ones</a><p></p>
                  <ul>
                     <li><a href="../#re.tens.example">Example&nbsp;7.7.&nbsp;Checking for Tens</a></li>
                     <li><a href="../#re.nm.example">Example&nbsp;7.8.&nbsp;Validating Roman Numerals with {n,m}</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#re.verbose">7.5.&nbsp;Verbose Regular Expressions</a><p></p>
                  <ul>
                     <li><a href="../#d0e18777">Example&nbsp;7.9.&nbsp;Regular Expressions with Inline Comments</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#re.phone">7.6.&nbsp;Case study: Parsing Phone Numbers</a><p></p>
                  <ul>
                     <li><a href="../#re.phone.example">Example&nbsp;7.10.&nbsp;Finding Numbers</a></li>
                     <li><a href="../#d0e19043">Example&nbsp;7.11.&nbsp;Finding the Extension</a></li>
                     <li><a href="../#d0e19106">Example&nbsp;7.12.&nbsp;Handling Different Separators</a></li>
                     <li><a href="../#d0e19203">Example&nbsp;7.13.&nbsp;Handling Numbers Without Separators</a></li>
                     <li><a href="../#d0e19318">Example&nbsp;7.14.&nbsp;Handling Leading Characters</a></li>
                     <li><a href="../#d0e19396">Example&nbsp;7.15.&nbsp;Phone Number, Wherever I May Find Ye</a></li>
                     <li><a href="../#d0e19458">Example&nbsp;7.16.&nbsp;Parsing Phone Numbers (Final Version)</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#dialect">Chapter&nbsp;8.&nbsp;HTML Processing</a></p>
            <ul>
               <li><a href="../#dialect.divein">8.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li><a href="../#dialect.basehtml.listing">Example&nbsp;8.1.&nbsp;BaseHTMLProcessor.py</a></li>
                     <li><a href="../#d0e19707">Example&nbsp;8.2.&nbsp;dialect.py</a></li>
                     <li><a href="../#d0e19713">Example&nbsp;8.3.&nbsp;Output of dialect.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.sgmllib">8.2.&nbsp;Introducing sgmllib.py</a><p></p>
                  <ul>
                     <li><a href="../#d0e20080">Example&nbsp;8.4.&nbsp;Sample test of sgmllib.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.extract">8.3.&nbsp;Extracting data from HTML documents</a><p></p>
                  <ul>
                     <li><a href="../#dialect.extract.urllib">Example&nbsp;8.5.&nbsp;Introducing urllib</a></li>
                     <li><a href="../#dialect.extract.links">Example&nbsp;8.6.&nbsp;Introducing urllister.py</a></li>
                     <li><a href="../#dialect.feed.example">Example&nbsp;8.7.&nbsp;Using urllister.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.basehtml">8.4.&nbsp;Introducing BaseHTMLProcessor.py</a><p></p>
                  <ul>
                     <li><a href="../#dialect.basehtml.intro">Example&nbsp;8.8.&nbsp;Introducing BaseHTMLProcessor</a></li>
                     <li><a href="../#dialect.output.example">Example&nbsp;8.9.&nbsp;BaseHTMLProcessor output</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.locals">8.5.&nbsp;locals and globals</a><p></p>
                  <ul>
                     <li><a href="../#d0e21119">Example&nbsp;8.10.&nbsp;Introducing locals</a></li>
                     <li><a href="../#dialect.globals.example">Example&nbsp;8.11.&nbsp;Introducing globals</a></li>
                     <li><a href="../#dialect.locals.readonly.example">Example&nbsp;8.12.&nbsp;locals is read-only, globals is not</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.dictsub">8.6.&nbsp;Dictionary-based string formatting</a><p></p>
                  <ul>
                     <li><a href="../#d0e21518">Example&nbsp;8.13.&nbsp;Introducing dictionary-based string formatting</a></li>
                     <li><a href="../#dialect.unknownstarttag">Example&nbsp;8.14.&nbsp;Dictionary-based string formatting in BaseHTMLProcessor.py</a></li>
                     <li><a href="../#d0e21622">Example&nbsp;8.15.&nbsp;More dictionary-based string formatting</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.quoting">8.7.&nbsp;Quoting attribute values</a><p></p>
                  <ul>
                     <li><a href="../#dialect.quoting.example">Example&nbsp;8.16.&nbsp;Quoting attribute values</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.dialectizer">8.8.&nbsp;Introducing dialect.py</a><p></p>
                  <ul>
                     <li><a href="../#dialect.specifictags.example">Example&nbsp;8.17.&nbsp;Handling specific tags</a></li>
                     <li><a href="../#dialect.dialectizer.example">Example&nbsp;8.18.&nbsp;SGMLParser</a></li>
                     <li><a href="../#d0e22310">Example&nbsp;8.19.&nbsp;Overriding the handle_data method</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#dialect.alltogether">8.9.&nbsp;Putting it all together</a><p></p>
                  <ul>
                     <li><a href="../#d0e22387">Example&nbsp;8.20.&nbsp;The translate function, part 1</a></li>
                     <li><a href="../#d0e22433">Example&nbsp;8.21.&nbsp;The translate function, part 2: curiouser and curiouser</a></li>
                     <li><a href="../#d0e22614">Example&nbsp;8.22.&nbsp;The translate function, part 3</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#kgp">Chapter&nbsp;9.&nbsp;XML Processing</a></p>
            <ul>
               <li><a href="../#kgp.divein">9.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li><a href="../#d0e22845">Example&nbsp;9.1.&nbsp;kgp.py</a></li>
                     <li><a href="../#d0e22856">Example&nbsp;9.2.&nbsp;toolbox.py</a></li>
                     <li><a href="../#d0e22873">Example&nbsp;9.3.&nbsp;Sample output of kgp.py</a></li>
                     <li><a href="../#d0e22893">Example&nbsp;9.4.&nbsp;Simpler output from kgp.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.packages">9.2.&nbsp;Packages</a><p></p>
                  <ul>
                     <li><a href="../#d0e22925">Example&nbsp;9.5.&nbsp;Loading an XML document (a sneak peek)</a></li>
                     <li><a href="../#d0e22983">Example&nbsp;9.6.&nbsp;File layout of a package</a></li>
                     <li><a href="../#d0e23025">Example&nbsp;9.7.&nbsp;Packages are modules, too</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.parse">9.3.&nbsp;Parsing XML</a><p></p>
                  <ul>
                     <li><a href="../#d0e23245">Example&nbsp;9.8.&nbsp;Loading an XML document (for real this time)</a></li>
                     <li><a href="../#kgp.parse.gettingchildnodes.example">Example&nbsp;9.9.&nbsp;Getting child nodes</a></li>
                     <li><a href="../#d0e23458">Example&nbsp;9.10.&nbsp;toxml works on any node</a></li>
                     <li><a href="../#kgp.parse.childnodescanbetext.example">Example&nbsp;9.11.&nbsp;Child nodes can be text</a></li>
                     <li><a href="../#d0e23628">Example&nbsp;9.12.&nbsp;Drilling down all the way to text</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.unicode">9.4.&nbsp;Unicode</a><p></p>
                  <ul>
                     <li><a href="../#d0e23841">Example&nbsp;9.13.&nbsp;Introducing unicode</a></li>
                     <li><a href="../#d0e23908">Example&nbsp;9.14.&nbsp;Storing non-ASCII characters</a></li>
                     <li><a href="../#d0e24009">Example&nbsp;9.15.&nbsp;sitecustomize.py</a></li>
                     <li><a href="../#d0e24048">Example&nbsp;9.16.&nbsp;Effects of setting the default encoding</a></li>
                     <li><a href="../#d0e24123">Example&nbsp;9.17.&nbsp;Specifying encoding in .py files</a></li>
                     <li><a href="../#d0e24153">Example&nbsp;9.18.&nbsp;russiansample.xml</a></li>
                     <li><a href="../#d0e24188">Example&nbsp;9.19.&nbsp;Parsing russiansample.xml</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.search">9.5.&nbsp;Searching for elements</a><p></p>
                  <ul>
                     <li><a href="../#d0e24431">Example&nbsp;9.20.&nbsp;binary.xml</a></li>
                     <li><a href="../#d0e24464">Example&nbsp;9.21.&nbsp;Introducing getElementsByTagName</a></li>
                     <li><a href="../#d0e24526">Example&nbsp;9.22.&nbsp;Every element is searchable</a></li>
                     <li><a href="../#d0e24615">Example&nbsp;9.23.&nbsp;Searching is actually recursive</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.attributes">9.6.&nbsp;Accessing element attributes</a><p></p>
                  <ul>
                     <li><a href="../#d0e24787">Example&nbsp;9.24.&nbsp;Accessing element attributes</a></li>
                     <li><a href="../#d0e24922">Example&nbsp;9.25.&nbsp;Accessing individual attributes</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#streams">Chapter&nbsp;10.&nbsp;Scripts and Streams</a></p>
            <ul>
               <li><a href="../#kgp.openanything">10.1.&nbsp;Abstracting input sources</a><p></p>
                  <ul>
                     <li><a href="../#d0e25118">Example&nbsp;10.1.&nbsp;Parsing XML from a file</a></li>
                     <li><a href="../#kgp.openanything.urllib">Example&nbsp;10.2.&nbsp;Parsing XML from a URL</a></li>
                     <li><a href="../#d0e25321">Example&nbsp;10.3.&nbsp;Parsing XML from a string (the easy but inflexible way)</a></li>
                     <li><a href="../#kgp.openanything.stringio.example">Example&nbsp;10.4.&nbsp;Introducing StringIO</a></li>
                     <li><a href="../#d0e25526">Example&nbsp;10.5.&nbsp;Parsing XML from a string (the file-like object way)</a></li>
                     <li><a href="../#kgp.openanything.example">Example&nbsp;10.6.&nbsp;openAnything</a></li>
                     <li><a href="../#d0e25723">Example&nbsp;10.7.&nbsp;Using openAnything in kgp.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.stdio">10.2.&nbsp;Standard input, output, and error</a><p></p>
                  <ul>
                     <li><a href="../#d0e25781">Example&nbsp;10.8.&nbsp;Introducing stdout and stderr</a></li>
                     <li><a href="../#d0e25905">Example&nbsp;10.9.&nbsp;Redirecting output</a></li>
                     <li><a href="../#d0e26005">Example&nbsp;10.10.&nbsp;Redirecting error information</a></li>
                     <li><a href="../#kgp.stdio.print.example">Example&nbsp;10.11.&nbsp;Printing to stderr</a></li>
                     <li><a href="../#d0e26136">Example&nbsp;10.12.&nbsp;Chaining commands</a></li>
                     <li><a href="../#d0e26237">Example&nbsp;10.13.&nbsp;Reading from standard input in kgp.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.cache">10.3.&nbsp;Caching node lookups</a><p></p>
                  <ul>
                     <li><a href="../#d0e26362">Example&nbsp;10.14.&nbsp;loadGrammar</a></li>
                     <li><a href="../#d0e26435">Example&nbsp;10.15.&nbsp;Using the ref element cache</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.child">10.4.&nbsp;Finding direct children of a node</a><p></p>
                  <ul>
                     <li><a href="../#d0e26500">Example&nbsp;10.16.&nbsp;Finding direct child elements</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.handler">10.5.&nbsp;Creating separate handlers by node type</a><p></p>
                  <ul>
                     <li><a href="../#d0e26627">Example&nbsp;10.17.&nbsp;Class names of parsed XML objects</a></li>
                     <li><a href="../#d0e26733">Example&nbsp;10.18.&nbsp;parse, a generic XML node dispatcher</a></li>
                     <li><a href="../#d0e26769">Example&nbsp;10.19.&nbsp;Functions called by the parse dispatcher</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#kgp.commandline">10.6.&nbsp;Handling command-line arguments</a><p></p>
                  <ul>
                     <li><a href="../#d0e26871">Example&nbsp;10.20.&nbsp;Introducing sys.argv</a></li>
                     <li><a href="../#d0e26892">Example&nbsp;10.21.&nbsp;The contents of sys.argv</a></li>
                     <li><a href="../#d0e26982">Example&nbsp;10.22.&nbsp;Introducing getopt</a></li>
                     <li><a href="../#d0e27157">Example&nbsp;10.23.&nbsp;Handling command-line arguments in kgp.py</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#oa">Chapter&nbsp;11.&nbsp;HTTP Web Services</a></p>
            <ul>
               <li><a href="../#oa.divein">11.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li><a href="../#d0e27515">Example&nbsp;11.1.&nbsp;openanything.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#oa.review">11.2.&nbsp;How not to fetch data over HTTP</a><p></p>
                  <ul>
                     <li><a href="../#d0e27543">Example&nbsp;11.2.&nbsp;Downloading a feed the quick-and-dirty way</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#oa.debug">11.4.&nbsp;Debugging HTTP web services</a><p></p>
                  <ul>
                     <li><a href="../#d0e27789">Example&nbsp;11.3.&nbsp;Debugging HTTP</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#oa.useragent">11.5.&nbsp;Setting the User-Agent</a><p></p>
                  <ul>
                     <li><a href="../#d0e27984">Example&nbsp;11.4.&nbsp;Introducing urllib2</a></li>
                     <li><a href="../#d0e28108">Example&nbsp;11.5.&nbsp;Adding headers with the Request</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#oa.etags">11.6.&nbsp;Handling Last-Modified and ETag</a><p></p>
                  <ul>
                     <li><a href="../#oa.etags.example.1">Example&nbsp;11.6.&nbsp;Testing Last-Modified</a></li>
                     <li><a href="../#d0e28385">Example&nbsp;11.7.&nbsp;Defining URL handlers</a></li>
                     <li><a href="../#d0e28438">Example&nbsp;11.8.&nbsp;Using custom URL handlers</a></li>
                     <li><a href="../#oa.etags.example">Example&nbsp;11.9.&nbsp;Supporting ETag/If-None-Match</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#oa.redirect">11.7.&nbsp;Handling redirects</a><p></p>
                  <ul>
                     <li><a href="../#d0e28730">Example&nbsp;11.10.&nbsp;Accessing web services without a redirect handler</a></li>
                     <li><a href="../#d0e28866">Example&nbsp;11.11.&nbsp;Defining the redirect handler</a></li>
                     <li><a href="../#d0e28932">Example&nbsp;11.12.&nbsp;Using the redirect handler to detect permanent redirects</a></li>
                     <li><a href="../#d0e29025">Example&nbsp;11.13.&nbsp;Using the redirect handler to detect temporary redirects</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#oa.gzip">11.8.&nbsp;Handling compressed data</a><p></p>
                  <ul>
                     <li><a href="../#d0e29136">Example&nbsp;11.14.&nbsp;Telling the server you would like compressed data</a></li>
                     <li><a href="../#d0e29222">Example&nbsp;11.15.&nbsp;Decompressing the data</a></li>
                     <li><a href="../#d0e29389">Example&nbsp;11.16.&nbsp;Decompressing the data directly from the server</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#oa.alltogether">11.9.&nbsp;Putting it all together</a><p></p>
                  <ul>
                     <li><a href="../#d0e29475">Example&nbsp;11.17.&nbsp;The openanything function</a></li>
                     <li><a href="../#d0e29574">Example&nbsp;11.18.&nbsp;The fetch function</a></li>
                     <li><a href="../#d0e29650">Example&nbsp;11.19.&nbsp;Using openanything.py</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#soap">Chapter&nbsp;12.&nbsp;SOAP Web Services</a></p>
            <ul>
               <li><a href="../#soap.divein">12.1.&nbsp;Diving In</a><p></p>
                  <ul>
                     <li><a href="../#d0e29893">Example&nbsp;12.1.&nbsp;search.py</a></li>
                     <li><a href="../#d0e29906">Example&nbsp;12.2.&nbsp;Sample Usage of search.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e29967">12.2.1.&nbsp;Installing PyXML</a><p></p>
                  <ul>
                     <li><a href="../#d0e30044">Example&nbsp;12.3.&nbsp;Verifying PyXML Installation</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e30070">12.2.2.&nbsp;Installing fpconst</a><p></p>
                  <ul>
                     <li><a href="../#d0e30145">Example&nbsp;12.4.&nbsp;Verifying fpconst Installation</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#d0e30171">12.2.3.&nbsp;Installing SOAPpy</a><p></p>
                  <ul>
                     <li><a href="../#d0e30237">Example&nbsp;12.5.&nbsp;Verifying SOAPpy Installation</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soap.firststeps">12.3.&nbsp;First Steps with SOAP</a><p></p>
                  <ul>
                     <li><a href="../#d0e30286">Example&nbsp;12.6.&nbsp;Getting the Current Temperature</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soap.debug">12.4.&nbsp;Debugging SOAP Web Services</a><p></p>
                  <ul>
                     <li><a href="../#d0e30423">Example&nbsp;12.7.&nbsp;Debugging SOAP Web Services</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soap.introspection">12.6.&nbsp;Introspecting SOAP Web Services with WSDL</a><p></p>
                  <ul>
                     <li><a href="../#d0e30755">Example&nbsp;12.8.&nbsp;Discovering The Available Methods</a></li>
                     <li><a href="../#d0e30857">Example&nbsp;12.9.&nbsp;Discovering A Method's Arguments</a></li>
                     <li><a href="../#d0e30967">Example&nbsp;12.10.&nbsp;Discovering A Method's Return Values</a></li>
                     <li><a href="../#d0e31039">Example&nbsp;12.11.&nbsp;Calling A Web Service Through A WSDL Proxy</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soap.google">12.7.&nbsp;Searching Google</a><p></p>
                  <ul>
                     <li><a href="../#d0e31206">Example&nbsp;12.12.&nbsp;Introspecting Google Web Services</a></li>
                     <li><a href="../#d0e31392">Example&nbsp;12.13.&nbsp;Searching Google</a></li>
                     <li><a href="../#d0e31503">Example&nbsp;12.14.&nbsp;Accessing Secondary Information From Google</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soap.troubleshooting">12.8.&nbsp;Troubleshooting SOAP Web Services</a><p></p>
                  <ul>
                     <li><a href="../#d0e31615">Example&nbsp;12.15.&nbsp;Calling a Method With an Incorrectly Configured Proxy</a></li>
                     <li><a href="../#d0e31701">Example&nbsp;12.16.&nbsp;Calling a Method With the Wrong Arguments</a></li>
                     <li><a href="../#d0e31779">Example&nbsp;12.17.&nbsp;Calling a Method and Expecting the Wrong Number of Return Values</a></li>
                     <li><a href="../#d0e31834">Example&nbsp;12.18.&nbsp;Calling a Method With An Application-Specific Error</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#roman">Chapter&nbsp;13.&nbsp;Unit Testing</a></p>
            <ul>
               <li><a href="../#roman.romantest">13.3.&nbsp;Introducing romantest.py</a><p></p>
                  <ul>
                     <li><a href="../#d0e32173">Example&nbsp;13.1.&nbsp;romantest.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.success">13.4.&nbsp;Testing for success</a><p></p>
                  <ul>
                     <li><a href="../#roman.testtoromanknownvalues.example">Example&nbsp;13.2.&nbsp;testToRomanKnownValues</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.failure">13.5.&nbsp;Testing for failure</a><p></p>
                  <ul>
                     <li><a href="../#roman.tobadinput.example">Example&nbsp;13.3.&nbsp;Testing bad input to toRoman</a></li>
                     <li><a href="../#roman.frombadinput.example">Example&nbsp;13.4.&nbsp;Testing bad input to fromRoman</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.sanity">13.6.&nbsp;Testing for sanity</a><p></p>
                  <ul>
                     <li><a href="../#roman.sanity.example">Example&nbsp;13.5.&nbsp;Testing toRoman against fromRoman</a></li>
                     <li><a href="../#d0e32750">Example&nbsp;13.6.&nbsp;Testing for case</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#roman1.5">Chapter&nbsp;14.&nbsp;Test-First Programming</a></p>
            <ul>
               <li><a href="../#roman.stage1">14.1.&nbsp;roman.py, stage 1</a><p></p>
                  <ul>
                     <li><a href="../#d0e32864">Example&nbsp;14.1.&nbsp;roman1.py</a></li>
                     <li><a href="../#roman.stage1.output">Example&nbsp;14.2.&nbsp;Output of romantest1.py against roman1.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.stage2">14.2.&nbsp;roman.py, stage 2</a><p></p>
                  <ul>
                     <li><a href="../#roman.stage2.example">Example&nbsp;14.3.&nbsp;roman2.py</a></li>
                     <li><a href="../#d0e33197">Example&nbsp;14.4.&nbsp;How toRoman works</a></li>
                     <li><a href="../#d0e33236">Example&nbsp;14.5.&nbsp;Output of romantest2.py against roman2.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.stage3">14.3.&nbsp;roman.py, stage 3</a><p></p>
                  <ul>
                     <li><a href="../#d0e33364">Example&nbsp;14.6.&nbsp;roman3.py</a></li>
                     <li><a href="../#d0e33410">Example&nbsp;14.7.&nbsp;Watching toRoman handle bad input</a></li>
                     <li><a href="../#d0e33439">Example&nbsp;14.8.&nbsp;Output of romantest3.py against roman3.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.stage4">14.4.&nbsp;roman.py, stage 4</a><p></p>
                  <ul>
                     <li><a href="../#d0e33582">Example&nbsp;14.9.&nbsp;roman4.py</a></li>
                     <li><a href="../#d0e33611">Example&nbsp;14.10.&nbsp;How fromRoman works</a></li>
                     <li><a href="../#d0e33644">Example&nbsp;14.11.&nbsp;Output of romantest4.py against roman4.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.stage5">14.5.&nbsp;roman.py, stage 5</a><p></p>
                  <ul>
                     <li><a href="../#d0e34010">Example&nbsp;14.12.&nbsp;roman5.py</a></li>
                     <li><a href="../#d0e34080">Example&nbsp;14.13.&nbsp;Output of romantest5.py against roman5.py</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#roman2">Chapter&nbsp;15.&nbsp;Refactoring</a></p>
            <ul>
               <li><a href="../#roman.bugs">15.1.&nbsp;Handling bugs</a><p></p>
                  <ul>
                     <li><a href="../#d0e34158">Example&nbsp;15.1.&nbsp;The bug</a></li>
                     <li><a href="../#d0e34188">Example&nbsp;15.2.&nbsp;Testing for the bug (romantest61.py)</a></li>
                     <li><a href="../#d0e34210">Example&nbsp;15.3.&nbsp;Output of romantest61.py against roman61.py</a></li>
                     <li><a href="../#d0e34229">Example&nbsp;15.4.&nbsp;Fixing the bug (roman62.py)</a></li>
                     <li><a href="../#d0e34251">Example&nbsp;15.5.&nbsp;Output of romantest62.py against roman62.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.change">15.2.&nbsp;Handling changing requirements</a><p></p>
                  <ul>
                     <li><a href="../#d0e34307">Example&nbsp;15.6.&nbsp;Modifying test cases for new requirements (romantest71.py)</a></li>
                     <li><a href="../#d0e34405">Example&nbsp;15.7.&nbsp;Output of romantest71.py against roman71.py</a></li>
                     <li><a href="../#d0e34511">Example&nbsp;15.8.&nbsp;Coding the new requirements (roman72.py)</a></li>
                     <li><a href="../#roman.roman72.output">Example&nbsp;15.9.&nbsp;Output of romantest72.py against roman72.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.refactoring">15.3.&nbsp;Refactoring</a><p></p>
                  <ul>
                     <li><a href="../#d0e34647">Example&nbsp;15.10.&nbsp;Compiling regular expressions</a></li>
                     <li><a href="../#d0e34769">Example&nbsp;15.11.&nbsp;Compiled regular expressions in roman81.py</a></li>
                     <li><a href="../#roman.stage8.1.output">Example&nbsp;15.12.&nbsp;Output of romantest81.py against roman81.py</a></li>
                     <li><a href="../#d0e34895">Example&nbsp;15.13.&nbsp;roman82.py</a></li>
                     <li><a href="../#d0e34949">Example&nbsp;15.14.&nbsp;Output of romantest82.py against roman82.py</a></li>
                     <li><a href="../#d0e35003">Example&nbsp;15.15.&nbsp;roman83.py</a></li>
                     <li><a href="../#d0e35043">Example&nbsp;15.16.&nbsp;Output of romantest83.py against roman83.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#roman.postscript">15.4.&nbsp;Postscript</a><p></p>
                  <ul>
                     <li><a href="../#d0e35088">Example&nbsp;15.17.&nbsp;roman9.py</a></li>
                     <li><a href="../#d0e35106">Example&nbsp;15.18.&nbsp;Output of romantest9.py against roman9.py</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#regression">Chapter&nbsp;16.&nbsp;Functional Programming</a></p>
            <ul>
               <li><a href="../#regression.divein">16.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li><a href="../#d0e35275">Example&nbsp;16.1.&nbsp;regression.py</a></li>
                     <li><a href="../#d0e35293">Example&nbsp;16.2.&nbsp;Sample output of regression.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#regression.path">16.2.&nbsp;Finding the path</a><p></p>
                  <ul>
                     <li><a href="../#d0e35359">Example&nbsp;16.3.&nbsp;fullpath.py</a></li>
                     <li><a href="../#d0e35399">Example&nbsp;16.4.&nbsp;Further explanation of os.path.abspath</a></li>
                     <li><a href="../#d0e35527">Example&nbsp;16.5.&nbsp;Sample output from fullpath.py</a></li>
                     <li><a href="../#regression.path.cwd.example">Example&nbsp;16.6.&nbsp;Running scripts in the current directory</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#regression.filter">16.3.&nbsp;Filtering lists revisited</a><p></p>
                  <ul>
                     <li><a href="../#d0e35724">Example&nbsp;16.7.&nbsp;Introducing filter</a></li>
                     <li><a href="../#d0e35864">Example&nbsp;16.8.&nbsp;filter in regression.py</a></li>
                     <li><a href="../#d0e35972">Example&nbsp;16.9.&nbsp;Filtering using list comprehensions instead</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#regression.map">16.4.&nbsp;Mapping lists revisited</a><p></p>
                  <ul>
                     <li><a href="../#d0e36003">Example&nbsp;16.10.&nbsp;Introducing map</a></li>
                     <li><a href="../#d0e36107">Example&nbsp;16.11.&nbsp;map with lists of mixed datatypes</a></li>
                     <li><a href="../#d0e36143">Example&nbsp;16.12.&nbsp;map in regression.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#regression.import">16.6.&nbsp;Dynamically importing modules</a><p></p>
                  <ul>
                     <li><a href="../#d0e36316">Example&nbsp;16.13.&nbsp;Importing multiple modules at once</a></li>
                     <li><a href="../#d0e36341">Example&nbsp;16.14.&nbsp;Importing modules dynamically</a></li>
                     <li><a href="../#d0e36423">Example&nbsp;16.15.&nbsp;Importing a list of modules dynamically</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#regression.alltogether">16.7.&nbsp;Putting it all together</a><p></p>
                  <ul>
                     <li><a href="../#d0e36538">Example&nbsp;16.16.&nbsp;The regressionTest function</a></li>
                     <li><a href="../#d0e36556">Example&nbsp;16.17.&nbsp;Step 1: Get all the files</a></li>
                     <li><a href="../#d0e36595">Example&nbsp;16.18.&nbsp;Step 2: Filter to find the files you care about</a></li>
                     <li><a href="../#d0e36643">Example&nbsp;16.19.&nbsp;Step 3: Map filenames to module names</a></li>
                     <li><a href="../#d0e36727">Example&nbsp;16.20.&nbsp;Step 4: Mapping module names to modules</a></li>
                     <li><a href="../#d0e36788">Example&nbsp;16.21.&nbsp;Step 5: Loading the modules into a test suite</a></li>
                     <li><a href="../#d0e36869">Example&nbsp;16.22.&nbsp;Step 6: Telling unittest to use your test suite</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#plural">Chapter&nbsp;17.&nbsp;Dynamic functions</a></p>
            <ul>
               <li><a href="../#plural.stage1">17.2.&nbsp;plural.py, stage 1</a><p></p>
                  <ul>
                     <li><a href="../#d0e37108">Example&nbsp;17.1.&nbsp;plural1.py</a></li>
                     <li><a href="../#d0e37161">Example&nbsp;17.2.&nbsp;Introducing re.sub</a></li>
                     <li><a href="../#d0e37292">Example&nbsp;17.3.&nbsp;Back to plural1.py</a></li>
                     <li><a href="../#d0e37404">Example&nbsp;17.4.&nbsp;More on negation regular expressions</a></li>
                     <li><a href="../#d0e37507">Example&nbsp;17.5.&nbsp;More on re.sub</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#plural.stage2">17.3.&nbsp;plural.py, stage 2</a><p></p>
                  <ul>
                     <li><a href="../#d0e37629">Example&nbsp;17.6.&nbsp;plural2.py</a></li>
                     <li><a href="../#d0e37727">Example&nbsp;17.7.&nbsp;Unrolling the plural function</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#plural.stage3">17.4.&nbsp;plural.py, stage 3</a><p></p>
                  <ul>
                     <li><a href="../#d0e37775">Example&nbsp;17.8.&nbsp;plural3.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#plural.stage4">17.5.&nbsp;plural.py, stage 4</a><p></p>
                  <ul>
                     <li><a href="../#plural.stage4.example.1">Example&nbsp;17.9.&nbsp;plural4.py</a></li>
                     <li><a href="../#d0e37935">Example&nbsp;17.10.&nbsp;plural4.py continued</a></li>
                     <li><a href="../#d0e37982">Example&nbsp;17.11.&nbsp;Unrolling the rules definition</a></li>
                     <li><a href="../#plural.finishing.up">Example&nbsp;17.12.&nbsp;plural4.py, finishing up</a></li>
                     <li><a href="../#d0e38026">Example&nbsp;17.13.&nbsp;Another look at buildMatchAndApplyFunctions</a></li>
                     <li><a href="../#d0e38048">Example&nbsp;17.14.&nbsp;Expanding tuples when calling functions</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#plural.stage5">17.6.&nbsp;plural.py, stage 5</a><p></p>
                  <ul>
                     <li><a href="../#d0e38148">Example&nbsp;17.15.&nbsp;rules.en</a></li>
                     <li><a href="../#d0e38156">Example&nbsp;17.16.&nbsp;plural5.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#plural.stage6">17.7.&nbsp;plural.py, stage 6</a><p></p>
                  <ul>
                     <li><a href="../#d0e38279">Example&nbsp;17.17.&nbsp;plural6.py</a></li>
                     <li><a href="../#plural.introducing.generators">Example&nbsp;17.18.&nbsp;Introducing generators</a></li>
                     <li><a href="../#plural.fib.example">Example&nbsp;17.19.&nbsp;Using generators instead of recursion</a></li>
                     <li><a href="../#d0e38564">Example&nbsp;17.20.&nbsp;Generators in for loops</a></li>
                     <li><a href="../#d0e38646">Example&nbsp;17.21.&nbsp;Generators that generate dynamic functions</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
            <p><a href="../#soundex">Chapter&nbsp;18.&nbsp;Performance Tuning</a></p>
            <ul>
               <li><a href="../#soundex.divein">18.1.&nbsp;Diving in</a><p></p>
                  <ul>
                     <li><a href="../#d0e38889">Example&nbsp;18.1.&nbsp;soundex/stage1/soundex1a.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soundex.timeit">18.2.&nbsp;Using the timeit Module</a><p></p>
                  <ul>
                     <li><a href="../#d0e38948">Example&nbsp;18.2.&nbsp;Introducing timeit</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soundex.stage1">18.3.&nbsp;Optimizing Regular Expressions</a><p></p>
                  <ul>
                     <li><a href="../#d0e39318">Example&nbsp;18.3.&nbsp;Best Result So Far: soundex/stage1/soundex1e.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soundex.stage2">18.4.&nbsp;Optimizing Dictionary Lookups</a><p></p>
                  <ul>
                     <li><a href="../#d0e39507">Example&nbsp;18.4.&nbsp;Best Result So Far: soundex/stage2/soundex2c.py</a></li>
                  </ul>
                  <p></p>
               </li>
               <li><a href="../#soundex.stage3">18.5.&nbsp;Optimizing List Operations</a><p></p>
                  <ul>
                     <li><a href="../#d0e39674">Example&nbsp;18.5.&nbsp;Best Result So Far: soundex/stage2/soundex2c.py</a></li>
                  </ul>
                  <p></p>
               </li>
            </ul>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="revhistory"></a>Appendix&nbsp;E.&nbsp;Revision history
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="revhistory">
               <table border="1" width="100%" summary="Revision history">
                  <tr>
                     <th align="left" valign="top" colspan="2"><b>Revision History</b></th>
                  </tr>
                  <tr>
                     <td align="left">Revision 5.4</td>
                     <td align="left">2004-05-20</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#soap.divein" title="12.1.&nbsp;Diving In">Section&nbsp;12.1, &#8220;Diving In&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.install" title="12.2.&nbsp;Installing the SOAP Libraries">Section&nbsp;12.2, &#8220;Installing the SOAP Libraries&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.firststeps" title="12.3.&nbsp;First Steps with SOAP">Section&nbsp;12.3, &#8220;First Steps with SOAP&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.debug" title="12.4.&nbsp;Debugging SOAP Web Services">Section&nbsp;12.4, &#8220;Debugging SOAP Web Services&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.wsdl" title="12.5.&nbsp;Introducing WSDL">Section&nbsp;12.5, &#8220;Introducing WSDL&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.introspection" title="12.6.&nbsp;Introspecting SOAP Web Services with WSDL">Section&nbsp;12.6, &#8220;Introspecting SOAP Web Services with WSDL&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.google" title="12.7.&nbsp;Searching Google">Section&nbsp;12.7, &#8220;Searching Google&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.troubleshooting" title="12.8.&nbsp;Troubleshooting SOAP Web Services">Section&nbsp;12.8, &#8220;Troubleshooting SOAP Web Services&#8221;</a>.
                              </li>
                              <li>Added <a href="#soap.summary" title="12.9.&nbsp;Summary">Section&nbsp;12.9, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Incorporated technical reviewer revisions in <a href="#regression" title="Chapter&nbsp;16.&nbsp;Functional Programming">Chapter&nbsp;16, <i>Functional Programming</i></a> and <a href="#soundex" title="Chapter&nbsp;18.&nbsp;Performance Tuning">Chapter&nbsp;18, <i>Performance Tuning</i></a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 5.3</td>
                     <td align="left">2004-05-12</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <tt class="methodname">isalpha()</tt> example to <a href="#soundex.stage1" title="18.3.&nbsp;Optimizing Regular Expressions">Section&nbsp;18.3, &#8220;Optimizing Regular Expressions&#8221;</a>.  Thanks, Paul.
                              </li>
                              <li>Incorporated copyediting revisions into <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> and <a href="#filehandling" title="Chapter&nbsp;6.&nbsp;Exceptions and File Handling">Chapter&nbsp;6, <i>Exceptions and File Handling</i></a>.
                              </li>
                              <li>Fixed URL of <a href="#kgp.segue" title="9.7.&nbsp;Segue">Section&nbsp;9.7, &#8220;Segue&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 5.2</td>
                     <td align="left">2004-05-09</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Fixed URL of <a href="#roman.stage1" title="14.1.&nbsp;roman.py, stage 1">Section&nbsp;14.1, &#8220;roman.py, stage 1&#8221;</a>.
                              </li>
                              <li>Added <a href="#soundex.divein" title="18.1.&nbsp;Diving in">Section&nbsp;18.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Added <a href="#soundex.timeit" title="18.2.&nbsp;Using the timeit Module">Section&nbsp;18.2, &#8220;Using the timeit Module&#8221;</a>.
                              </li>
                              <li>Added <a href="#soundex.stage1" title="18.3.&nbsp;Optimizing Regular Expressions">Section&nbsp;18.3, &#8220;Optimizing Regular Expressions&#8221;</a>.
                              </li>
                              <li>Added <a href="#soundex.stage2" title="18.4.&nbsp;Optimizing Dictionary Lookups">Section&nbsp;18.4, &#8220;Optimizing Dictionary Lookups&#8221;</a>.
                              </li>
                              <li>Added <a href="#soundex.stage3" title="18.5.&nbsp;Optimizing List Operations">Section&nbsp;18.5, &#8220;Optimizing List Operations&#8221;</a>.
                              </li>
                              <li>Added <a href="#soundex.stage4" title="18.6.&nbsp;Optimizing String Manipulation">Section&nbsp;18.6, &#8220;Optimizing String Manipulation&#8221;</a>.
                              </li>
                              <li>Added <a href="#soundex.summary" title="18.7.&nbsp;Summary">Section&nbsp;18.7, &#8220;Summary&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 5.1</td>
                     <td align="left">2004-05-05</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Clarified <a href="#re.tens.example" title="Example&nbsp;7.7.&nbsp;Checking for Tens">Example&nbsp;7.7, &#8220;Checking for Tens&#8221;</a> and <a href="#re.nm.example" title="Example&nbsp;7.8.&nbsp;Validating Roman Numerals with {n,m}">Example&nbsp;7.8, &#8220;Validating Roman Numerals with {n,m}&#8221;</a>.
                              </li>
                              <li>Clarified <a href="#re.phone.example" title="Example&nbsp;7.10.&nbsp;Finding Numbers">Example&nbsp;7.10, &#8220;Finding Numbers&#8221;</a>.
                              </li>
                              <li>Fixed typo in <a href="#oa.etags.example.1" title="Example&nbsp;11.6.&nbsp;Testing Last-Modified">Example&nbsp;11.6, &#8220;Testing Last-Modified&#8221;</a>.  Thanks, Jesir.
                              </li>
                              <li>Fixed typo in <a href="#odbchelper.list.append.vs.extend" title="Example&nbsp;3.11.&nbsp;The Difference between extend and append">Example&nbsp;3.11, &#8220;The Difference between extend and append&#8221;</a>.  Thanks, Daniel.
                              </li>
                              <li>Incorporated technical reviewer revisions.</li>
                              <li>Incorporated copy editor revisions in <a href="#install" title="Chapter&nbsp;1.&nbsp;Installing Python">Chapter&nbsp;1, <i>Installing Python</i></a>, <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>, <a href="#datatypes" title="Chapter&nbsp;3.&nbsp;Native Datatypes">Chapter&nbsp;3, <i>Native Datatypes</i></a>, and <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 5.0</td>
                     <td align="left">2004-04-16</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#oa.divein" title="11.1.&nbsp;Diving in">Section&nbsp;11.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.review" title="11.2.&nbsp;How not to fetch data over HTTP">Section&nbsp;11.2, &#8220;How not to fetch data over HTTP&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.features" title="11.3.&nbsp;Features of HTTP">Section&nbsp;11.3, &#8220;Features of HTTP&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.debug" title="11.4.&nbsp;Debugging HTTP web services">Section&nbsp;11.4, &#8220;Debugging HTTP web services&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.useragent" title="11.5.&nbsp;Setting the User-Agent">Section&nbsp;11.5, &#8220;Setting the User-Agent&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.etags" title="11.6.&nbsp;Handling Last-Modified and ETag">Section&nbsp;11.6, &#8220;Handling Last-Modified and ETag&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.redirect" title="11.7.&nbsp;Handling redirects">Section&nbsp;11.7, &#8220;Handling redirects&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.gzip" title="11.8.&nbsp;Handling compressed data">Section&nbsp;11.8, &#8220;Handling compressed data&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.alltogether" title="11.9.&nbsp;Putting it all together">Section&nbsp;11.9, &#8220;Putting it all together&#8221;</a>.
                              </li>
                              <li>Added <a href="#oa.summary" title="11.10.&nbsp;Summary">Section&nbsp;11.10, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Added <a href="#odbchelper.list.append.vs.extend" title="Example&nbsp;3.11.&nbsp;The Difference between extend and append">Example&nbsp;3.11, &#8220;The Difference between extend and append&#8221;</a>.
                              </li>
                              <li>Changed descriptions of how to download <span class="application">Python</span> throughout <a href="#install" title="Chapter&nbsp;1.&nbsp;Installing Python">Chapter&nbsp;1, <i>Installing Python</i></a> to be more generic and less version-specific.
                              </li>
                              <li>Changed references of &#8220;<span class="quote">module</span>&#8221; to &#8220;<span class="quote">program</span>&#8221; in <a href="#odbchelper.divein" title="2.1.&nbsp;Diving in">Section&nbsp;2.1, &#8220;Diving in&#8221;</a> and <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">Section&nbsp;2.4, &#8220;Everything Is an Object&#8221;</a> since we haven't explained modules yet.
                              </li>
                              <li>Added explicit instructions in <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">Section&nbsp;2.4, &#8220;Everything Is an Object&#8221;</a> for the reader to open their <span class="application">Python</span> <span class="acronym">IDE</span> and follow along with the examples.
                              </li>
                              <li>Changed all examples and descriptions that referred to truth values <tt class="constant">1</tt> and <tt class="constant">0</tt> to refer to <tt class="constant">True</tt> and <tt class="constant">False</tt>.
                              </li>
                              <li>Updated <a href="#odbchelper.stringformatting.coerce" title="Example&nbsp;3.22.&nbsp;String Formatting vs. Concatenating">Example&nbsp;3.22, &#8220;String Formatting vs. Concatenating&#8221;</a> to show new <span class="application">Python</span> 2.3 <tt class="literal">TypeError</tt> message.
                              </li>
                              <li>Fixed typo in <a href="#plural.fib.example" title="Example&nbsp;17.19.&nbsp;Using generators instead of recursion">Example&nbsp;17.19, &#8220;Using generators instead of recursion&#8221;</a>.
                              </li>
                              <li>Fixed typo in <a href="#re.summary" title="7.7.&nbsp;Summary">Section&nbsp;7.7, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Fixed typo in <a href="#plural.stage4.example.1" title="Example&nbsp;17.9.&nbsp;plural4.py">Example&nbsp;17.9, &#8220;plural4.py&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.9</td>
                     <td align="left">2004-03-25</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Finished <a href="#regression.alltogether" title="16.7.&nbsp;Putting it all together">Section&nbsp;16.7, &#8220;Putting it all together&#8221;</a>.
                              </li>
                              <li>Added <a href="#regression.summary" title="16.8.&nbsp;Summary">Section&nbsp;16.8, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Split unit testing introduction into two chapters, <a href="#roman" title="Chapter&nbsp;13.&nbsp;Unit Testing">Chapter&nbsp;13, <i>Unit Testing</i></a> and <a href="#roman1.5" title="Chapter&nbsp;14.&nbsp;Test-First Programming">Chapter&nbsp;14, <i>Test-First Programming</i></a>.
                              </li>
                              <li>Fixed typo in <a href="#plural.finishing.up" title="Example&nbsp;17.12.&nbsp;plural4.py, finishing up">Example&nbsp;17.12, &#8220;plural4.py, finishing up&#8221;</a>.
                              </li>
                              <li>Fixed typo in <a href="#plural.introducing.generators" title="Example&nbsp;17.18.&nbsp;Introducing generators">Example&nbsp;17.18, &#8220;Introducing generators&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.8</td>
                     <td align="left">2004-03-25</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Finished <a href="#plural.stage6" title="17.7.&nbsp;plural.py, stage 6">Section&nbsp;17.7, &#8220;plural.py, stage 6&#8221;</a>.
                              </li>
                              <li>Finished <a href="#plural.summary" title="17.8.&nbsp;Summary">Section&nbsp;17.8, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Fixed broken links in <a href="#furtherreading" title="Appendix&nbsp;A.&nbsp;Further reading">Appendix&nbsp;A, <i>Further reading</i></a>, <a href="#abstracts" title="Appendix&nbsp;B.&nbsp;A 5-minute review">Appendix&nbsp;B, <i>A 5-minute review</i></a>, <a href="#tips" title="Appendix&nbsp;C.&nbsp;Tips and tricks">Appendix&nbsp;C, <i>Tips and tricks</i></a>, <a href="#examples" title="Appendix&nbsp;D.&nbsp;List of examples">Appendix&nbsp;D, <i>List of examples</i></a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.7</td>
                     <td align="left">2004-03-21</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#plural.divein" title="17.1.&nbsp;Diving in">Section&nbsp;17.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Added <a href="#plural.stage1" title="17.2.&nbsp;plural.py, stage 1">Section&nbsp;17.2, &#8220;plural.py, stage 1&#8221;</a>.
                              </li>
                              <li>Added <a href="#plural.stage2" title="17.3.&nbsp;plural.py, stage 2">Section&nbsp;17.3, &#8220;plural.py, stage 2&#8221;</a>.
                              </li>
                              <li>Added <a href="#plural.stage3" title="17.4.&nbsp;plural.py, stage 3">Section&nbsp;17.4, &#8220;plural.py, stage 3&#8221;</a>.
                              </li>
                              <li>Added <a href="#plural.stage4" title="17.5.&nbsp;plural.py, stage 4">Section&nbsp;17.5, &#8220;plural.py, stage 4&#8221;</a>.
                              </li>
                              <li>Added <a href="#plural.stage5" title="17.6.&nbsp;plural.py, stage 5">Section&nbsp;17.6, &#8220;plural.py, stage 5&#8221;</a>.
                              </li>
                              <li>Added <a href="#plural.stage6" title="17.7.&nbsp;plural.py, stage 6">Section&nbsp;17.7, &#8220;plural.py, stage 6&#8221;</a> (unfinished).
                              </li>
                              <li>Added <a href="#plural.summary" title="17.8.&nbsp;Summary">Section&nbsp;17.8, &#8220;Summary&#8221;</a> (unfinished).
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.6</td>
                     <td align="left">2004-03-14</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Finished <a href="#re.nm" title="7.4.&nbsp;Using the {n,m} Syntax">Section&nbsp;7.4, &#8220;Using the {n,m} Syntax&#8221;</a>.
                              </li>
                              <li>Finished <a href="#re.verbose" title="7.5.&nbsp;Verbose Regular Expressions">Section&nbsp;7.5, &#8220;Verbose Regular Expressions&#8221;</a>.
                              </li>
                              <li>Finished <a href="#re.phone" title="7.6.&nbsp;Case study: Parsing Phone Numbers">Section&nbsp;7.6, &#8220;Case study: Parsing Phone Numbers&#8221;</a>.
                              </li>
                              <li>Expanded <a href="#re.summary" title="7.7.&nbsp;Summary">Section&nbsp;7.7, &#8220;Summary&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.5</td>
                     <td align="left">2004-03-07</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#re.intro" title="7.1.&nbsp;Diving In">Section&nbsp;7.1, &#8220;Diving In&#8221;</a>.
                              </li>
                              <li>Added <a href="#re.nm" title="7.4.&nbsp;Using the {n,m} Syntax">Section&nbsp;7.4, &#8220;Using the {n,m} Syntax&#8221;</a> (incomplete).
                              </li>
                              <li>Added <a href="#re.verbose" title="7.5.&nbsp;Verbose Regular Expressions">Section&nbsp;7.5, &#8220;Verbose Regular Expressions&#8221;</a> (incomplete).
                              </li>
                              <li>Added <a href="#re.phone" title="7.6.&nbsp;Case study: Parsing Phone Numbers">Section&nbsp;7.6, &#8220;Case study: Parsing Phone Numbers&#8221;</a> (incomplete).
                              </li>
                              <li>Added <a href="#re.summary" title="7.7.&nbsp;Summary">Section&nbsp;7.7, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Moved <a href="#re.matching" title="7.2.&nbsp;Case Study: Street Addresses">Section&nbsp;7.2, &#8220;Case Study: Street Addresses&#8221;</a> and <a href="#re.roman" title="7.3.&nbsp;Case Study: Roman Numerals">Section&nbsp;7.3, &#8220;Case Study: Roman Numerals&#8221;</a> to regular expressions chapter.
                              </li>
                              <li>Added <a href="#fileinfo.os.glob.example" title="Example&nbsp;6.20.&nbsp;Listing Directories with glob">Example&nbsp;6.20, &#8220;Listing Directories with glob&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.files.writeandappend" title="Example&nbsp;6.7.&nbsp;Writing to Files">Example&nbsp;6.7, &#8220;Writing to Files&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.userdict.fromdict" title="Example&nbsp;5.11.&nbsp;Inheriting Directly from Built-In Datatype dict">Example&nbsp;5.11, &#8220;Inheriting Directly from Built-In Datatype dict&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.stdio.print.example" title="Example&nbsp;10.11.&nbsp;Printing to stderr">Example&nbsp;10.11, &#8220;Printing to stderr&#8221;</a>.
                              </li>
                              <li>Added <a href="#apihelper.getattr.dispatch" title="Example&nbsp;4.12.&nbsp;Creating a Dispatcher with getattr">Example&nbsp;4.12, &#8220;Creating a Dispatcher with getattr&#8221;</a> and <a href="#apihelper.getattr.default" title="Example&nbsp;4.13.&nbsp;getattr Default Values">Example&nbsp;4.13, &#8220;getattr Default Values&#8221;</a>.
                              </li>
                              <li>Added <a href="#odbchelper.indenting.if" title="Example&nbsp;2.6.&nbsp;if Statements">Example&nbsp;2.6, &#8220;if Statements&#8221;</a>.
                              </li>
                              <li>Added <a href="#odbchelper.stringformatting.numbers" title="Example&nbsp;3.23.&nbsp;Formatting Numbers">Example&nbsp;3.23, &#8220;Formatting Numbers&#8221;</a>.
                              </li>
                              <li>Split <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> into 2 chapters: <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> and <a href="#filehandling" title="Chapter&nbsp;6.&nbsp;Exceptions and File Handling">Chapter&nbsp;6, <i>Exceptions and File Handling</i></a>.
                              </li>
                              <li>Split <a href="#kgp" title="Chapter&nbsp;9.&nbsp;XML Processing">Chapter&nbsp;9, <i>XML Processing</i></a> into 2 chapters: <a href="#kgp" title="Chapter&nbsp;9.&nbsp;XML Processing">Chapter&nbsp;9, <i>XML Processing</i></a> and <a href="#streams" title="Chapter&nbsp;10.&nbsp;Scripts and Streams">Chapter&nbsp;10, <i>Scripts and Streams</i></a>.
                              </li>
                              <li>Split <a href="#roman" title="Chapter&nbsp;13.&nbsp;Unit Testing">Chapter&nbsp;13, <i>Unit Testing</i></a> into 2 chapters: <a href="#roman" title="Chapter&nbsp;13.&nbsp;Unit Testing">Chapter&nbsp;13, <i>Unit Testing</i></a> and <a href="#roman2" title="Chapter&nbsp;15.&nbsp;Refactoring">Chapter&nbsp;15, <i>Refactoring</i></a>.
                              </li>
                              <li>Renamed <tt class="function">help</tt> to <tt class="function">info</tt> in <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a>.
                              </li>
                              <li>Fixed incorrect back-reference in <a href="#dialect.locals" title="8.5.&nbsp;locals and globals">Section&nbsp;8.5, &#8220;locals and globals&#8221;</a>.
                              </li>
                              <li>Fixed broken example links in <a href="#dialect.divein" title="8.1.&nbsp;Diving in">Section&nbsp;8.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Fixed missing line in example in <a href="#kgp.divein" title="9.1.&nbsp;Diving in">Section&nbsp;9.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Fixed typo in <a href="#dialect.sgmllib" title="8.2.&nbsp;Introducing sgmllib.py">Section&nbsp;8.2, &#8220;Introducing sgmllib.py&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.4</td>
                     <td align="left">2003-10-08</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#install.choosing" title="1.1.&nbsp;Which Python is right for you?">Section&nbsp;1.1, &#8220;Which Python is right for you?&#8221;</a>.
                              </li>
                              <li>Added <a href="#install.windows" title="1.2.&nbsp;Python on Windows">Section&nbsp;1.2, &#8220;Python on Windows&#8221;</a>.
                              </li>
                              <li>Added <a href="#install.macosx" title="1.3.&nbsp;Python on Mac OS X">Section&nbsp;1.3, &#8220;Python on Mac OS X&#8221;</a>.
                              </li>
                              <li>Added <a href="#install.macos9" title="1.4.&nbsp;Python on Mac OS 9">Section&nbsp;1.4, &#8220;Python on Mac OS 9&#8221;</a>.
                              </li>
                              <li>Added <a href="#install.redhat" title="1.5.&nbsp;Python on RedHat Linux">Section&nbsp;1.5, &#8220;Python on RedHat Linux&#8221;</a>.
                              </li>
                              <li>Added <a href="#install.debian" title="1.6.&nbsp;Python on Debian GNU/Linux">Section&nbsp;1.6, &#8220;Python on Debian GNU/Linux&#8221;</a>.
                              </li>
                              <li>Added <a href="#install.source" title="1.7.&nbsp;Python Installation from Source">Section&nbsp;1.7, &#8220;Python Installation from Source&#8221;</a>.
                              </li>
                              <li>Added <a href="#install.summary" title="1.9.&nbsp;Summary">Section&nbsp;1.9, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Removed preface.</li>
                              <li>Fixed typo in <a href="#odbchelper.join.example" title="Example&nbsp;3.27.&nbsp;Output of odbchelper.py">Example&nbsp;3.27, &#8220;Output of odbchelper.py&#8221;</a>.
                              </li>
                              <li>Added link to PEP 257 in <a href="#odbchelper.docstring" title="2.3.&nbsp;Documenting Functions">Section&nbsp;2.3, &#8220;Documenting Functions&#8221;</a>.
                              </li>
                              <li>Fixed link to <a href="http://www.ibiblio.org/obp/thinkCSpy/" title="Python book for computer science majors"><i class="citetitle">How to Think Like a Computer Scientist</i></a> in <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">Section&nbsp;3.4.2, &#8220;Assigning Multiple Values at Once&#8221;</a>.
                              </li>
                              <li>Added note about implied assert in <a href="#odbchelper.tuple" title="3.3.&nbsp;Introducing Tuples">Section&nbsp;3.3, &#8220;Introducing Tuples&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.3</td>
                     <td align="left">2003-09-28</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#regression.import" title="16.6.&nbsp;Dynamically importing modules">Section&nbsp;16.6, &#8220;Dynamically importing modules&#8221;</a>.
                              </li>
                              <li>Added <a href="#regression.alltogether" title="16.7.&nbsp;Putting it all together">Section&nbsp;16.7, &#8220;Putting it all together&#8221;</a> (incomplete).
                              </li>
                              <li>Fixed links in <a href="#about" title="Appendix&nbsp;F.&nbsp;About the book">Appendix&nbsp;F, <i>About the book</i></a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.2.1</td>
                     <td align="left">2003-09-17</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Fixed links on index page.</li>
                              <li>Fixed syntax highlighting.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.2</td>
                     <td align="left">2003-09-12</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Fixed typos in <a href="#regression.map" title="16.4.&nbsp;Mapping lists revisited">Section&nbsp;16.4, &#8220;Mapping lists revisited&#8221;</a>, <a href="#regression.filter" title="16.3.&nbsp;Filtering lists revisited">Section&nbsp;16.3, &#8220;Filtering lists revisited&#8221;</a>, <a href="#re.matching" title="7.2.&nbsp;Case Study: Street Addresses">Section&nbsp;7.2, &#8220;Case Study: Street Addresses&#8221;</a>, and <a href="#kgp.commandline" title="10.6.&nbsp;Handling command-line arguments">Section&nbsp;10.6, &#8220;Handling command-line arguments&#8221;</a>.  Thanks, Doug.
                              </li>
                              <li>Fixed external link in <a href="#fileinfo.class" title="5.3.&nbsp;Defining Classes">Section&nbsp;5.3, &#8220;Defining Classes&#8221;</a>.  Thanks, Harry.
                              </li>
                              <li>Changed wording at the end of <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">Section&nbsp;4.5, &#8220;Filtering Lists&#8221;</a>.  Thanks, Paul.
                              </li>
                              <li>Added sentence in <a href="#roman.failure" title="13.5.&nbsp;Testing for failure">Section&nbsp;13.5, &#8220;Testing for failure&#8221;</a> to make it clearer that we're passing a function to <tt class="function">assertRaises</tt>, not a function name as a string.  Thanks, Stephen.
                              </li>
                              <li>Fixed typo in <a href="#dialect.dialectizer" title="8.8.&nbsp;Introducing dialect.py">Section&nbsp;8.8, &#8220;Introducing dialect.py&#8221;</a>.  Thanks, Wellie.
                              </li>
                              <li>Fixed links to dialectized examples.</li>
                              <li>Fixed external link to the history of Roman numerals.  Thanks to many concerned Roman numeral fans around the world.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.1</td>
                     <td align="left">2002-07-28</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#kgp.cache" title="10.3.&nbsp;Caching node lookups">Section&nbsp;10.3, &#8220;Caching node lookups&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.child" title="10.4.&nbsp;Finding direct children of a node">Section&nbsp;10.4, &#8220;Finding direct children of a node&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.handler" title="10.5.&nbsp;Creating separate handlers by node type">Section&nbsp;10.5, &#8220;Creating separate handlers by node type&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.commandline" title="10.6.&nbsp;Handling command-line arguments">Section&nbsp;10.6, &#8220;Handling command-line arguments&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.alltogether" title="10.7.&nbsp;Putting it all together">Section&nbsp;10.7, &#8220;Putting it all together&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.summary" title="10.8.&nbsp;Summary">Section&nbsp;10.8, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Fixed typo in <a href="#fileinfo.os" title="6.5.&nbsp;Working with Directories">Section&nbsp;6.5, &#8220;Working with Directories&#8221;</a>.  It's <tt class="function">os.getcwd()</tt>, not <tt class="function">os.path.getcwd()</tt>.  Thanks, Abhishek.
                              </li>
                              <li>Fixed typo in <a href="#odbchelper.join" title="3.7.&nbsp;Joining Lists and Splitting Strings">Section&nbsp;3.7, &#8220;Joining Lists and Splitting Strings&#8221;</a>.  When evaluated (instead of printed), the <span class="application">Python</span> <span class="acronym">IDE</span> will display single quotes around the output.
                              </li>
                              <li>Changed <tt class="function">str</tt> example in <a href="#apihelper.alltogether" title="4.8.&nbsp;Putting It All Together">Section&nbsp;4.8, &#8220;Putting It All Together&#8221;</a> to use a user-defined function, since <span class="application">Python</span> 2.2 obsoleted the old example by defining a <tt class="literal">doc string</tt> for the built-in dictionary methods.  Thanks Eric.
                              </li>
                              <li>Fixed typo in <a href="#kgp.unicode" title="9.4.&nbsp;Unicode">Section&nbsp;9.4, &#8220;Unicode&#8221;</a>, "anyway" to "anywhere".  Thanks Frank.
                              </li>
                              <li>Fixed typo in <a href="#roman.sanity" title="13.6.&nbsp;Testing for sanity">Section&nbsp;13.6, &#8220;Testing for sanity&#8221;</a>, doubled word "accept".  Thanks Ralph.
                              </li>
                              <li>Fixed typo in <a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">Section&nbsp;15.3, &#8220;Refactoring&#8221;</a>, <tt class="literal">C?C?C?</tt> matches 0 to 3 <tt class="literal">C</tt> characters, not 4.  Thanks Ralph.
                              </li>
                              <li>Clarified and expanded explanation of implied slice indices in <a href="#odbchelper.list.slicing.example" title="Example&nbsp;3.9.&nbsp;Slicing Shorthand">Example&nbsp;3.9, &#8220;Slicing Shorthand&#8221;</a>.  Thanks Petr.
                              </li>
                              <li>Added historical note in <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">Section&nbsp;5.5, &#8220;Exploring UserDict: A Wrapper Class&#8221;</a> now that <span class="application">Python</span> 2.2 supports subclassing built-in datatypes directly.
                              </li>
                              <li>Added explanation of <tt class="function">update</tt> dictionary method in <a href="#fileinfo.userdict.init.example" title="Example&nbsp;5.9.&nbsp;Defining the UserDict Class">Example&nbsp;5.9, &#8220;Defining the UserDict Class&#8221;</a>.  Thanks Petr.
                              </li>
                              <li>Clarified <span class="application">Python</span>'s lack of overloading in <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">Section&nbsp;5.5, &#8220;Exploring UserDict: A Wrapper Class&#8221;</a>.  Thanks Petr.
                              </li>
                              <li>Fixed typo in <a href="#dialect.basehtml.intro" title="Example&nbsp;8.8.&nbsp;Introducing BaseHTMLProcessor">Example&nbsp;8.8, &#8220;Introducing BaseHTMLProcessor&#8221;</a>.  <span class="acronym">HTML</span> comments end with two dashes and a bracket, not one.  Thanks Petr.
                              </li>
                              <li>Changed tense of note about nested scopes in <a href="#dialect.locals" title="8.5.&nbsp;locals and globals">Section&nbsp;8.5, &#8220;locals and globals&#8221;</a> now that <span class="application">Python</span> 2.2 is out.  Thanks Petr.
                              </li>
                              <li>Fixed typo in <a href="#dialect.unknownstarttag" title="Example&nbsp;8.14.&nbsp;Dictionary-based string formatting in BaseHTMLProcessor.py">Example&nbsp;8.14, &#8220;Dictionary-based string formatting in BaseHTMLProcessor.py&#8221;</a>; a space should have been a non-breaking space.  Thanks Petr.
                              </li>
                              <li>Added title to note on derived classes in <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">Section&nbsp;5.5, &#8220;Exploring UserDict: A Wrapper Class&#8221;</a>.  Thanks Petr.
                              </li>
                              <li>Added title to note on downloading <tt class="filename">unittest</tt> in <a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">Section&nbsp;15.3, &#8220;Refactoring&#8221;</a>.  Thanks Petr.
                              </li>
                              <li>Fixed typesetting problem in <a href="#regression.path.cwd.example" title="Example&nbsp;16.6.&nbsp;Running scripts in the current directory">Example&nbsp;16.6, &#8220;Running scripts in the current directory&#8221;</a>; tabs should have been spaces, and the line numbers were misaligned.  Thanks Petr.
                              </li>
                              <li>Fixed capitalization typo in the tip on truth values in <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">Section&nbsp;3.2, &#8220;Introducing Lists&#8221;</a>.  It's <tt class="literal">True</tt> and <tt class="literal">False</tt>, not <tt class="literal">true</tt> and <tt class="literal">false</tt>.  Thanks to everyone who pointed this out.
                              </li>
                              <li>Changed section titles of <a href="#odbchelper.dict" title="3.1.&nbsp;Introducing Dictionaries">Section&nbsp;3.1, &#8220;Introducing Dictionaries&#8221;</a>, <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">Section&nbsp;3.2, &#8220;Introducing Lists&#8221;</a>, and <a href="#odbchelper.tuple" title="3.3.&nbsp;Introducing Tuples">Section&nbsp;3.3, &#8220;Introducing Tuples&#8221;</a>. "Dictionaries 101" was a cute way of saying that this section was an beginner's introduction to dictionaries.  American
                                 colleges tend to use this numbering scheme to indicate introductory courses with no prerequisites, but apparently this is
                                 a distinctly American tradition, and it was unnecessarily confusing my international readers.  In my defense, when I initially
                                 wrote these sections a year and a half ago, it never occurred to me that I would have international readers.
                              </li>
                              <li>Upgraded to version 1.52 of the <span class="application">DocBook</span> <span class="acronym">XSL</span> stylesheets.
                              </li>
                              <li>Upgraded to version 6.52 of the <span class="application"><span class="acronym">SAXON</span></span> <span class="acronym">XSLT</span> processor from Michael Kay.
                              </li>
                              <li>Various accessibility-related stylesheet tweaks.</li>
                              <li>Somewhere between this revision and the last one, she said yes.  The wedding will be next spring.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.0-2</td>
                     <td align="left">2002-04-26</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Fixed typo in <a href="#apihelper.andor.intro.example" title="Example&nbsp;4.15.&nbsp;Introducing and">Example&nbsp;4.15, &#8220;Introducing and&#8221;</a>.
                              </li>
                              <li>Fixed typo in <a href="#odbchelper.objects.sys.path" title="Example&nbsp;2.4.&nbsp;Import Search Path">Example&nbsp;2.4, &#8220;Import Search Path&#8221;</a>.
                              </li>
                              <li>Fixed Windows help file (missing table of contents due to base stylesheet changes).</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 4.0</td>
                     <td align="left">2002-04-19</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Expanded <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">Section&nbsp;2.4, &#8220;Everything Is an Object&#8221;</a> to include more about import search paths.
                              </li>
                              <li>Fixed typo in <a href="#odbchelper.negative.example" title="Example&nbsp;3.7.&nbsp;Negative List Indices">Example&nbsp;3.7, &#8220;Negative List Indices&#8221;</a>.  Thanks to Brian for the correction.
                              </li>
                              <li>Rewrote the tip on truth values in <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">Section&nbsp;3.2, &#8220;Introducing Lists&#8221;</a>, now that <span class="application">Python</span> has a separate boolean datatype.
                              </li>
                              <li>Fixed typo in <a href="#fileinfo.fromimport" title="5.2.&nbsp;Importing Modules Using from module import">Section&nbsp;5.2, &#8220;Importing Modules Using from module import&#8221;</a> when comparing syntax to <span class="application">Java</span>.  Thanks to Rick for the correction.
                              </li>
                              <li>Added note in <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">Section&nbsp;5.5, &#8220;Exploring UserDict: A Wrapper Class&#8221;</a> about derived classes always overriding ancestor classes.
                              </li>
                              <li>Fixed typo in <a href="#fileinfo.classattributes.writeable.example" title="Example&nbsp;5.18.&nbsp;Modifying Class Attributes">Example&nbsp;5.18, &#8220;Modifying Class Attributes&#8221;</a>.  Thanks to Kevin for the correction.
                              </li>
                              <li>Added note in <a href="#fileinfo.exception" title="6.1.&nbsp;Handling Exceptions">Section&nbsp;6.1, &#8220;Handling Exceptions&#8221;</a> that you can define and raise your own exceptions.  Thanks to Rony for the suggestion.
                              </li>
                              <li>Fixed typo in <a href="#dialect.specifictags.example" title="Example&nbsp;8.17.&nbsp;Handling specific tags">Example&nbsp;8.17, &#8220;Handling specific tags&#8221;</a>.  Thanks for Rick for the correction.
                              </li>
                              <li>Added note in <a href="#dialect.dialectizer.example" title="Example&nbsp;8.18.&nbsp;SGMLParser">Example&nbsp;8.18, &#8220;SGMLParser&#8221;</a> about what the return codes mean.  Thanks to Howard for the suggestion.
                              </li>
                              <li>Added <tt class="function">str</tt> function when creating <tt class="classname">StringIO</tt> instance in <a href="#kgp.openanything.example" title="Example&nbsp;10.6.&nbsp;openAnything">Example&nbsp;10.6, &#8220;openAnything&#8221;</a>.  Thanks to Ganesan for the idea.
                              </li>
                              <li>Added link in <a href="#roman.romantest" title="13.3.&nbsp;Introducing romantest.py">Section&nbsp;13.3, &#8220;Introducing romantest.py&#8221;</a> to explanation of why test cases belong in a separate file.
                              </li>
                              <li>Changed <a href="#regression.path" title="16.2.&nbsp;Finding the path">Section&nbsp;16.2, &#8220;Finding the path&#8221;</a> to use <tt class="function">os.path.dirname</tt> instead of <tt class="literal">os.path.split</tt>.  Thanks to Marc for the idea.
                              </li>
                              <li>Added code samples (<tt class="filename">piglatin.py</tt>, <tt class="filename">parsephone.py</tt>, and <tt class="filename">plural.py</tt>) for the upcoming regular expressions chapter.
                              </li>
                              <li>Updated and expanded list of Python distributions on home page.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.9</td>
                     <td align="left">2002-01-01</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#kgp.unicode" title="9.4.&nbsp;Unicode">Section&nbsp;9.4, &#8220;Unicode&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.search" title="9.5.&nbsp;Searching for elements">Section&nbsp;9.5, &#8220;Searching for elements&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.attributes" title="9.6.&nbsp;Accessing element attributes">Section&nbsp;9.6, &#8220;Accessing element attributes&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.openanything" title="10.1.&nbsp;Abstracting input sources">Section&nbsp;10.1, &#8220;Abstracting input sources&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.stdio" title="10.2.&nbsp;Standard input, output, and error">Section&nbsp;10.2, &#8220;Standard input, output, and error&#8221;</a>.
                              </li>
                              <li>Added simple counter <tt class="literal">for</tt> loop examples (good usage and bad usage) in <a href="#fileinfo.for" title="6.3.&nbsp;Iterating with for Loops">Section&nbsp;6.3, &#8220;Iterating with for Loops&#8221;</a>.  Thanks to Kevin for the idea.
                              </li>
                              <li>Fixed typo in <a href="#odbchelper.items" title="Example&nbsp;3.25.&nbsp;The keys, values, and items Functions">Example&nbsp;3.25, &#8220;The keys, values, and items Functions&#8221;</a> (two elements of <tt class="literal">params.values()</tt> were reversed).
                              </li>
                              <li>Fixed mistake in <a href="#apihelper.builtin" title="4.3.&nbsp;Using type, str, dir, and Other Built-In Functions">Section&nbsp;4.3, &#8220;Using type, str, dir, and Other Built-In Functions&#8221;</a> with regards to the name of the <tt class="filename">__builtin__</tt> module.  Thanks to Denis for the correction.
                              </li>
                              <li>Added additional example in <a href="#regression.path" title="16.2.&nbsp;Finding the path">Section&nbsp;16.2, &#8220;Finding the path&#8221;</a> to show how to run unit tests in the current working directory, instead of the directory where <tt class="filename">regression.py</tt> is located.
                              </li>
                              <li>Modified explanation of how to derive a negative list index from a positive list index in <a href="#odbchelper.negative.example" title="Example&nbsp;3.7.&nbsp;Negative List Indices">Example&nbsp;3.7, &#8220;Negative List Indices&#8221;</a>.  Thanks to Renauld for the suggestion.
                              </li>
                              <li>Updated links on home page for downloading latest version of <span class="application">Python</span>.
                              </li>
                              <li>Added link on home page to Bruce Eckel's preliminary draft of <a href="http://www.mindview.net/Books/TIPython" title="advanced book on design patterns in Python"><i class="citetitle">Thinking in Python</i></a>, a marvelous (and advanced) book on design patterns and how to implement them in <span class="application">Python</span>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.8</td>
                     <td align="left">2001-11-18</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#regression.path" title="16.2.&nbsp;Finding the path">Section&nbsp;16.2, &#8220;Finding the path&#8221;</a>.
                              </li>
                              <li>Added <a href="#regression.filter" title="16.3.&nbsp;Filtering lists revisited">Section&nbsp;16.3, &#8220;Filtering lists revisited&#8221;</a>.
                              </li>
                              <li>Added <a href="#regression.map" title="16.4.&nbsp;Mapping lists revisited">Section&nbsp;16.4, &#8220;Mapping lists revisited&#8221;</a>.
                              </li>
                              <li>Added <a href="#regression.datacentric" title="16.5.&nbsp;Data-centric programming">Section&nbsp;16.5, &#8220;Data-centric programming&#8221;</a>.
                              </li>
                              <li>Expanded sample output in <a href="#regression.divein" title="16.1.&nbsp;Diving in">Section&nbsp;16.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Finished <a href="#kgp.parse" title="9.3.&nbsp;Parsing XML">Section&nbsp;9.3, &#8220;Parsing XML&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.7</td>
                     <td align="left">2001-09-30</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#kgp.packages" title="9.2.&nbsp;Packages">Section&nbsp;9.2, &#8220;Packages&#8221;</a>.
                              </li>
                              <li>Added <a href="#kgp.parse" title="9.3.&nbsp;Parsing XML">Section&nbsp;9.3, &#8220;Parsing XML&#8221;</a>.
                              </li>
                              <li>Cleaned up introductory paragraph in <a href="#kgp.divein" title="9.1.&nbsp;Diving in">Section&nbsp;9.1, &#8220;Diving in&#8221;</a>.  Thanks to Matt for this suggestion.
                              </li>
                              <li>Added <span class="application">Java</span> tip in <a href="#fileinfo.fromimport" title="5.2.&nbsp;Importing Modules Using from module import">Section&nbsp;5.2, &#8220;Importing Modules Using from module import&#8221;</a>.  Thanks to Ori for this suggestion.
                              </li>
                              <li>Fixed mistake in <a href="#apihelper.alltogether" title="4.8.&nbsp;Putting It All Together">Section&nbsp;4.8, &#8220;Putting It All Together&#8221;</a> where I implied that you could not use <tt class="literal">is None</tt> to compare to a null value in <span class="application">Python</span>.  In fact, you can, and it's faster than <tt class="literal">== None</tt>.  Thanks to Ori pointing this out.
                              </li>
                              <li>Clarified in <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">Section&nbsp;3.2, &#8220;Introducing Lists&#8221;</a> where I said that <tt class="literal">li = li + other</tt> was equivalent to <tt class="literal">li.extend(other)</tt>.  The result is the same, but <tt class="function">extend</tt> is faster because it doesn't create a new list.  Thanks to Denis pointing this out.
                              </li>
                              <li>Fixed mistake in <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">Section&nbsp;3.2, &#8220;Introducing Lists&#8221;</a> where I said that <tt class="literal">li += other</tt> was equivalent to <tt class="literal">li = li + other</tt>.  In fact, it's equivalent to <tt class="literal">li.extend(other)</tt>, since it doesn't create a new list.  Thanks to Denis pointing this out.
                              </li>
                              <li>Fixed typographical laziness in <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>; when I was writing it, I had not yet standardized on putting string literals in single quotes within the text.  They were
                                 set off by typography, but this is lost in some renditions of the book (like plain text), making it difficult to read.  Thanks
                                 to Denis for this suggestion.
                              </li>
                              <li>Fixed mistake in <a href="#odbchelper.funcdef" title="2.2.&nbsp;Declaring Functions">Section&nbsp;2.2, &#8220;Declaring Functions&#8221;</a> where I said that statically typed languages always use explicit variable + datatype declarations to enforce static typing.
                                  Most do, but there are some statically typed languages where the compiler figures out what type the variable is based on
                                 usage within the code.  Thanks to Tony for pointing this out.
                              </li>
                              <li>Added link to <a href="http://es.diveintopython.org/">Spanish translation</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.6.4</td>
                     <td align="left">2001-09-06</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added code in <tt class="classname">BaseHTMLProcessor</tt> to handle non-<span class="acronym">HTML</span> entity references, and added a note about it in <a href="#dialect.basehtml" title="8.4.&nbsp;Introducing BaseHTMLProcessor.py">Section&nbsp;8.4, &#8220;Introducing BaseHTMLProcessor.py&#8221;</a>.
                              </li>
                              <li>Modified <a href="#dialect.globals.example" title="Example&nbsp;8.11.&nbsp;Introducing globals">Example&nbsp;8.11, &#8220;Introducing globals&#8221;</a> to include <tt class="filename">htmlentitydefs</tt> in the output.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.6.3</td>
                     <td align="left">2001-09-04</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Fixed typo in <a href="#kgp.divein" title="9.1.&nbsp;Diving in">Section&nbsp;9.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Added link to <a href="http://kr.diveintopython.org/html/index.htm">Korean translation</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.6.2</td>
                     <td align="left">2001-08-31</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Fixed typo in <a href="#roman.sanity" title="13.6.&nbsp;Testing for sanity">Section&nbsp;13.6, &#8220;Testing for sanity&#8221;</a> (the last requirement was listed twice).
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.6</td>
                     <td align="left">2001-08-31</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Finished <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">Chapter&nbsp;8, <i>HTML Processing</i></a> with <a href="#dialect.alltogether" title="8.9.&nbsp;Putting it all together">Section&nbsp;8.9, &#8220;Putting it all together&#8221;</a> and <a href="#dialect.summary" title="8.10.&nbsp;Summary">Section&nbsp;8.10, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.postscript" title="15.4.&nbsp;Postscript">Section&nbsp;15.4, &#8220;Postscript&#8221;</a>.
                              </li>
                              <li>Started <a href="#kgp" title="Chapter&nbsp;9.&nbsp;XML Processing">Chapter&nbsp;9, <i>XML Processing</i></a> with <a href="#kgp.divein" title="9.1.&nbsp;Diving in">Section&nbsp;9.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Started <a href="#regression" title="Chapter&nbsp;16.&nbsp;Functional Programming">Chapter&nbsp;16, <i>Functional Programming</i></a> with <a href="#regression.divein" title="16.1.&nbsp;Diving in">Section&nbsp;16.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Fixed long-standing bug in colorizing script that improperly colorized the examples in <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">Chapter&nbsp;8, <i>HTML Processing</i></a>.
                              </li>
                              <li>Added link to <a href="http://fr.diveintopython.org/toc.html">French translation</a>.  They did the right thing and translated the source <span class="acronym">XML</span>, so they can re-use all my build scripts and make their work available in six different formats.
                              </li>
                              <li>Upgraded to version 1.43 of the <span class="application">DocBook</span> <span class="acronym">XSL</span> stylesheets.
                              </li>
                              <li>Upgraded to version 6.43 of the <span class="application"><span class="acronym">SAXON</span></span> <span class="acronym">XSLT</span> processor from Michael Kay.
                              </li>
                              <li>Massive stylesheet changes, moving away from a table-based layout and towards more appropriate use of cascading style sheets.
                                  Unfortunately, <span class="acronym">CSS</span> has as many compatibility problems as anything else, so there are still some tables used in the header and footer.  The resulting
                                 <span class="acronym">HTML</span> version looks worse in <span class="application">Netscape</span> 4, but better in modern browsers, including <span class="application">Netscape</span> 6, <span class="application">Mozilla</span>, <span class="application">Internet Explorer</span> 5, <span class="application">Opera</span> 5, <span class="application">Konqueror</span>, and <span class="application">iCab</span>.  And it's still completely readable in Lynx.  I love Lynx.  It was my first web browser.  You never forget your first.
                              </li>
                              <li>Moved to <a href="http://jakarta.apache.org/ant/"><span class="application">Ant</span></a> to have better control over the build process, which is especially important now that I'm juggling six output formats and
                                 two languages.
                              </li>
                              <li>Consolidated the available downloadable archives; previously, I had different files for each platform, because the .zip files
                                 that <span class="application">Python</span>'s <tt class="filename">zipfile</tt> module creates are non-standard and can't be opened by <span class="application">Aladdin Expander</span> on <span class="abbrev">Mac</span> <span class="acronym">OS</span>.  But the .zip files that <span class="application">Ant</span> creates are completely standard and cross-platform.  Go <span class="application">Ant</span>!
                              </li>
                              <li>Now hosting the complete <span class="acronym">XML</span> source, <span class="acronym">XSL</span> stylesheets, and associated scripts and libraries on SourceForge.  There's also <span class="acronym">CVS</span> access for the really adventurous.
                              </li>
                              <li>Re-licensed the example code under the new-and-improved <span class="acronym">GPL</span>-compatible <a href="http://www.python.org/2.1.1/license.html">Python 2.1.1 license</a>.  Thanks, Guido; people really do care, and it really does matter.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.5</td>
                     <td align="left">2001-06-26</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added explanation of strong/weak/static/dynamic datatypes in <a href="#odbchelper.funcdef" title="2.2.&nbsp;Declaring Functions">Section&nbsp;2.2, &#8220;Declaring Functions&#8221;</a>.
                              </li>
                              <li>Added case-sensitivity example in <a href="#odbchelper.dict" title="3.1.&nbsp;Introducing Dictionaries">Section&nbsp;3.1, &#8220;Introducing Dictionaries&#8221;</a>.
                              </li>
                              <li>Use <tt class="function">os.path.normcase</tt> in <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> to compensate for inferior operating systems whose files aren't case-sensitive.
                              </li>
                              <li>Fixed indentation problems in code samples in <span class="acronym">PDF</span> version.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.4</td>
                     <td align="left">2001-05-31</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#roman.stage5" title="14.5.&nbsp;roman.py, stage 5">Section&nbsp;14.5, &#8220;roman.py, stage 5&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.bugs" title="15.1.&nbsp;Handling bugs">Section&nbsp;15.1, &#8220;Handling bugs&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.change" title="15.2.&nbsp;Handling changing requirements">Section&nbsp;15.2, &#8220;Handling changing requirements&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.refactoring" title="15.3.&nbsp;Refactoring">Section&nbsp;15.3, &#8220;Refactoring&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.summary" title="15.5.&nbsp;Summary">Section&nbsp;15.5, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Fixed yet another stylesheet bug that was dropping nested <tt class="sgmltag-element">&lt;/span&gt;</tt> tags.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.3</td>
                     <td align="left">2001-05-24</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#roman.divein" title="13.2.&nbsp;Diving in">Section&nbsp;13.2, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.romantest" title="13.3.&nbsp;Introducing romantest.py">Section&nbsp;13.3, &#8220;Introducing romantest.py&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.success" title="13.4.&nbsp;Testing for success">Section&nbsp;13.4, &#8220;Testing for success&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.failure" title="13.5.&nbsp;Testing for failure">Section&nbsp;13.5, &#8220;Testing for failure&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.sanity" title="13.6.&nbsp;Testing for sanity">Section&nbsp;13.6, &#8220;Testing for sanity&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.stage1" title="14.1.&nbsp;roman.py, stage 1">Section&nbsp;14.1, &#8220;roman.py, stage 1&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.stage2" title="14.2.&nbsp;roman.py, stage 2">Section&nbsp;14.2, &#8220;roman.py, stage 2&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.stage3" title="14.3.&nbsp;roman.py, stage 3">Section&nbsp;14.3, &#8220;roman.py, stage 3&#8221;</a>.
                              </li>
                              <li>Added <a href="#roman.stage4" title="14.4.&nbsp;roman.py, stage 4">Section&nbsp;14.4, &#8220;roman.py, stage 4&#8221;</a>.
                              </li>
                              <li>Tweaked stylesheets in an endless quest for complete <span class="application">Netscape</span>/<span class="application">Mozilla</span> compatibility.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.2</td>
                     <td align="left">2001-05-03</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#dialect.dialectizer" title="8.8.&nbsp;Introducing dialect.py">Section&nbsp;8.8, &#8220;Introducing dialect.py&#8221;</a>.
                              </li>
                              <li>Added <a href="#re.matching" title="7.2.&nbsp;Case Study: Street Addresses">Section&nbsp;7.2, &#8220;Case Study: Street Addresses&#8221;</a>.
                              </li>
                              <li>Fixed bug in <tt class="function">handle_decl</tt> method that would produce incorrect declarations (adding a space where it couldn't be).
                              </li>
                              <li>Fixed bug in <span class="acronym">CSS</span> (introduced in 2.9) where body background color was missing.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.1</td>
                     <td align="left">2001-04-18</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added code in <a href="#dialect.divein" title="8.1.&nbsp;Diving in"><tt class="filename">BaseHTMLProcessor.py</tt></a> to handle declarations, now that <span class="application">Python</span> 2.1 supports them.
                              </li>
                              <li>Added note about nested scopes in <a href="#dialect.locals" title="8.5.&nbsp;locals and globals">Section&nbsp;8.5, &#8220;locals and globals&#8221;</a>.
                              </li>
                              <li>Fixed obscure bug in <a href="#dialect.basehtml.listing" title="Example&nbsp;8.1.&nbsp;BaseHTMLProcessor.py">Example&nbsp;8.1, &#8220;BaseHTMLProcessor.py&#8221;</a> where attribute values with character entities would not be properly escaped.
                              </li>
                              <li>Now recommending (but not requiring) <span class="application">Python</span> 2.1, due to its support of declarations in <tt class="filename">sgmllib.py</tt>.
                              </li>
                              <li>Updated download links on the <a href="http://diveintopython.org/">home page</a> to point to <span class="application">Python</span> 2.1, where available.
                              </li>
                              <li>Moved to versioned filenames, to help people who redistribute the book.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 3.0</td>
                     <td align="left">2001-04-16</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Fixed minor bug in code listing in <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">Chapter&nbsp;8, <i>HTML Processing</i></a>.
                              </li>
                              <li>Added link to Chinese translation on <a href="http://diveintopython.org/">home page</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.9</td>
                     <td align="left">2001-04-13</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#dialect.locals" title="8.5.&nbsp;locals and globals">Section&nbsp;8.5, &#8220;locals and globals&#8221;</a>.
                              </li>
                              <li>Added <a href="#dialect.dictsub" title="8.6.&nbsp;Dictionary-based string formatting">Section&nbsp;8.6, &#8220;Dictionary-based string formatting&#8221;</a>.
                              </li>
                              <li>Tightened code in <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">Chapter&nbsp;8, <i>HTML Processing</i></a>, specifically <tt class="classname">ChefDialectizer</tt>, to use fewer and simpler regular expressions.
                              </li>
                              <li>Fixed a stylesheet bug that was inserting blank pages between chapters in the <span class="acronym">PDF</span> version.
                              </li>
                              <li>Fixed a script bug that was stripping the <tt class="literal">DOCTYPE</tt> from the <a href="http://diveintopython.org/">home page</a>.
                              </li>
                              <li>Added link to <a href="http://www.activestate.com/ASPN/Python/Cookbook/" title="growing archive of annotated code samples"><span class="application">Python</span> Cookbook</a>, and added a few links to individual recipes in <a href="#furtherreading" title="Appendix&nbsp;A.&nbsp;Further reading">Appendix&nbsp;A, <i>Further reading</i></a>.
                              </li>
                              <li>Switched to <a href="http://www.google.com/services/free.html">Google</a> for searching on <tt class="systemitem">http://diveintopython.org/</tt>.
                              </li>
                              <li>Upgraded to version 1.36 of the <span class="application">DocBook</span> <span class="acronym">XSL</span> stylesheets, which was much more difficult than it sounds.  There may still be lingering bugs.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.8</td>
                     <td align="left">2001-03-26</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#dialect.extract" title="8.3.&nbsp;Extracting data from HTML documents">Section&nbsp;8.3, &#8220;Extracting data from HTML documents&#8221;</a>.
                              </li>
                              <li>Added <a href="#dialect.basehtml" title="8.4.&nbsp;Introducing BaseHTMLProcessor.py">Section&nbsp;8.4, &#8220;Introducing BaseHTMLProcessor.py&#8221;</a>.
                              </li>
                              <li>Added <a href="#dialect.quoting" title="8.7.&nbsp;Quoting attribute values">Section&nbsp;8.7, &#8220;Quoting attribute values&#8221;</a>.
                              </li>
                              <li>Tightened up code in <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a>, using the built-in function <tt class="function">callable</tt> instead of manually checking types.
                              </li>
                              <li>Moved <a href="#fileinfo.fromimport" title="5.2.&nbsp;Importing Modules Using from module import">Section&nbsp;5.2, &#8220;Importing Modules Using from module import&#8221;</a> from <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a> to <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a>.
                              </li>
                              <li>Fixed typo in code example in <a href="#fileinfo.divein" title="5.1.&nbsp;Diving In">Section&nbsp;5.1, &#8220;Diving In&#8221;</a> (added colon).
                              </li>
                              <li>Added several additional downloadable example scripts.</li>
                              <li>Added Windows Help output format.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.7</td>
                     <td align="left">2001-03-16</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#dialect.sgmllib" title="8.2.&nbsp;Introducing sgmllib.py">Section&nbsp;8.2, &#8220;Introducing sgmllib.py&#8221;</a>.
                              </li>
                              <li>Tightened up code in <a href="#dialect" title="Chapter&nbsp;8.&nbsp;HTML Processing">Chapter&nbsp;8, <i>HTML Processing</i></a>.
                              </li>
                              <li>Changed code in <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a> to use <tt class="function">items</tt> method instead of <tt class="function">keys</tt>.
                              </li>
                              <li>Moved <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">Section&nbsp;3.4.2, &#8220;Assigning Multiple Values at Once&#8221;</a> section to <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>.
                              </li>
                              <li>Edited note about <tt class="function">join</tt> string method, and provided a link to the new entry in <a href="http://www.python.org/doc/FAQ.html"><i class="citetitle">The Whole <span class="application">Python</span> <span class="acronym">FAQ</span></i></a> that explains <a href="http://www.python.org/cgi-bin/faqw.py?query=4.96&amp;querytype=simple&amp;casefold=yes&amp;req=search">why <tt class="function">join</tt> is a string method</a> instead of a list method.
                              </li>
                              <li>Rewrote <a href="#apihelper.andor" title="4.6.&nbsp;The Peculiar Nature of and and or">Section&nbsp;4.6, &#8220;The Peculiar Nature of and and or&#8221;</a> to emphasize the fundamental nature of <tt class="literal">and</tt> and <tt class="literal">or</tt> and de-emphasize the <tt class="literal">and-or</tt> trick.
                              </li>
                              <li>Reorganized language comparisons into <tt class="sgmltag-element">note</tt>s.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.6</td>
                     <td align="left">2001-02-28</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>The <span class="acronym">PDF</span> and <span class="application">Word</span> versions now have colorized examples, an improved table of contents, and properly indented <tt class="sgmltag-element">tip</tt>s and <tt class="sgmltag-element">note</tt>s.
                              </li>
                              <li>The <span class="application">Word</span> version is now in native <span class="application">Word</span> format, compatible with <span class="application">Word 97</span>.
                              </li>
                              <li>The <span class="acronym">PDF</span> and text versions now have fewer problems with improperly converted special characters (like trademark symbols and curly
                                 quotes).
                              </li>
                              <li>Added link to download <span class="application">Word</span> version for <span class="acronym">UNIX</span>, in case some twisted soul wants to import it into <span class="application">StarOffice</span> or something.
                              </li>
                              <li>Fixed several <tt class="sgmltag-element">note</tt>s which were missing titles.
                              </li>
                              <li>Fixed stylesheets to work around bug in <span class="application">Internet Explorer</span> 5 for <span class="abbrev">Mac</span> <span class="acronym">OS</span> which caused colorized words in the examples to be displayed in the wrong font.  (Hello?!?  Microsoft?  Which part of <tt class="sgmltag-element">&lt;pre&gt;</tt> don't you understand?)
                              </li>
                              <li>Fixed archive corruption in <span class="abbrev">Mac</span> <span class="acronym">OS</span> downloads.
                              </li>
                              <li>In first section of each chapter, added link to download examples.  (My access logs show that people skim or skip the two
                                 pages where they could have downloaded them (the <a href="http://diveintopython.org/" title="Dive Into Python home page">home page</a> and preface), then scramble to find a download link once they actually start reading.)
                              </li>
                              <li>Tightened the <a href="http://diveintopython.org/" title="Dive Into Python home page">home page</a> and preface even more, in the hopes that someday someone will read them.
                              </li>
                              <li>Soon I hope to get back to actually writing this book instead of debugging it.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.5</td>
                     <td align="left">2001-02-23</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#fileinfo.modules" title="6.4.&nbsp;Using sys.modules">Section&nbsp;6.4, &#8220;Using sys.modules&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.os" title="6.5.&nbsp;Working with Directories">Section&nbsp;6.5, &#8220;Working with Directories&#8221;</a>.
                              </li>
                              <li>Moved <a href="#splittingpathnames.example" title="Example&nbsp;6.17.&nbsp;Splitting Pathnames">Example&nbsp;6.17, &#8220;Splitting Pathnames&#8221;</a> from <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">Section&nbsp;3.4.2, &#8220;Assigning Multiple Values at Once&#8221;</a> to <a href="#fileinfo.os" title="6.5.&nbsp;Working with Directories">Section&nbsp;6.5, &#8220;Working with Directories&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.alltogether" title="6.6.&nbsp;Putting It All Together">Section&nbsp;6.6, &#8220;Putting It All Together&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.summary" title="5.10.&nbsp;Summary">Section&nbsp;5.10, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Added <a href="#dialect.divein" title="8.1.&nbsp;Diving in">Section&nbsp;8.1, &#8220;Diving in&#8221;</a>.
                              </li>
                              <li>Fixed program listing in <a href="#dictionaryiter.example" title="Example&nbsp;6.10.&nbsp;Iterating Through a Dictionary">Example&nbsp;6.10, &#8220;Iterating Through a Dictionary&#8221;</a> which was missing a colon.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.4.1</td>
                     <td align="left">2001-02-12</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Changed newsgroup links to use &#8220;<span class="quote">news:</span>&#8221; protocol, now that <tt class="systemitem">deja.com</tt> is defunct.
                              </li>
                              <li>Added file sizes to download links.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.4</td>
                     <td align="left">2001-02-12</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added &#8220;<span class="quote">further reading</span>&#8221; links in most sections, and collated them in <a href="#furtherreading" title="Appendix&nbsp;A.&nbsp;Further reading">Appendix&nbsp;A, <i>Further reading</i></a>.
                              </li>
                              <li>Added <span class="acronym">URL</span>s in parentheses next to external links in text version.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.3</td>
                     <td align="left">2001-02-09</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Rewrote some of the code in <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> to use class attributes and a better example of multi-variable assignment.
                              </li>
                              <li>Reorganized <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> to put the class sections first.
                              </li>
                              <li>Added <a href="#fileinfo.classattributes" title="5.8.&nbsp;Introducing Class Attributes">Section&nbsp;5.8, &#8220;Introducing Class Attributes&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.exception" title="6.1.&nbsp;Handling Exceptions">Section&nbsp;6.1, &#8220;Handling Exceptions&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.files" title="6.2.&nbsp;Working with File Objects">Section&nbsp;6.2, &#8220;Working with File Objects&#8221;</a>.
                              </li>
                              <li>Merged the &#8220;<span class="quote">review</span>&#8221; section in <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> into <a href="#fileinfo.divein" title="5.1.&nbsp;Diving In">Section&nbsp;5.1, &#8220;Diving In&#8221;</a>.
                              </li>
                              <li>Colorized all program listings and examples.</li>
                              <li>Fixed important error in <a href="#odbchelper.funcdef" title="2.2.&nbsp;Declaring Functions">Section&nbsp;2.2, &#8220;Declaring Functions&#8221;</a>: functions that do not explicitly return a value return <tt class="literal">None</tt>, so you <span class="emphasis"><em>can</em></span> assign the return value of such a function to a variable without raising an exception.
                              </li>
                              <li>Added minor clarifications to <a href="#odbchelper.docstring" title="2.3.&nbsp;Documenting Functions">Section&nbsp;2.3, &#8220;Documenting Functions&#8221;</a>, <a href="#odbchelper.objects" title="2.4.&nbsp;Everything Is an Object">Section&nbsp;2.4, &#8220;Everything Is an Object&#8221;</a>, and <a href="#odbchelper.vardef" title="3.4.&nbsp;Declaring variables">Section&nbsp;3.4, &#8220;Declaring variables&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.2</td>
                     <td align="left">2001-02-02</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Edited <a href="#apihelper.getattr" title="4.4.&nbsp;Getting Object References With getattr">Section&nbsp;4.4, &#8220;Getting Object References With getattr&#8221;</a>.
                              </li>
                              <li>Added titles to <tt class="sgmltag-element">xref</tt> tags, so they can have their cute little tooltips too.
                              </li>
                              <li>Changed the look of the revision history page.</li>
                              <li>Fixed problem I introduced yesterday in my <span class="acronym">HTML</span> post-processing script that was causing invalid <span class="acronym">HTML</span> character references and breaking some browsers.
                              </li>
                              <li>Upgraded to version 1.29 of the <span class="application">DocBook</span> <span class="acronym">XSL</span> stylesheets.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.1</td>
                     <td align="left">2001-02-01</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Rewrote the example code of <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a> to use <tt class="function">getattr</tt> instead of <tt class="function">exec</tt> and <tt class="function">eval</tt>, and rewrote explanatory text to match.
                              </li>
                              <li>Added example of list operators in <a href="#odbchelper.list" title="3.2.&nbsp;Introducing Lists">Section&nbsp;3.2, &#8220;Introducing Lists&#8221;</a>.
                              </li>
                              <li>Added links to relevant sections in the summary lists at the end of each chapter (<a href="#odbchelper.summary" title="3.8.&nbsp;Summary">Section&nbsp;3.8, &#8220;Summary&#8221;</a> and <a href="#apihelper.summary" title="4.9.&nbsp;Summary">Section&nbsp;4.9, &#8220;Summary&#8221;</a>).
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 2.0</td>
                     <td align="left">2001-01-31</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Split <a href="#fileinfo.specialmethods" title="5.6.&nbsp;Special Class Methods">Section&nbsp;5.6, &#8220;Special Class Methods&#8221;</a> into three sections, <a href="#fileinfo.userdict" title="5.5.&nbsp;Exploring UserDict: A Wrapper Class">Section&nbsp;5.5, &#8220;Exploring UserDict: A Wrapper Class&#8221;</a>, <a href="#fileinfo.specialmethods" title="5.6.&nbsp;Special Class Methods">Section&nbsp;5.6, &#8220;Special Class Methods&#8221;</a>, and <a href="#fileinfo.morespecial" title="5.7.&nbsp;Advanced Special Class Methods">Section&nbsp;5.7, &#8220;Advanced Special Class Methods&#8221;</a>.
                              </li>
                              <li>Changed notes on <a href="#fileinfo.create" title="5.4.&nbsp;Instantiating Classes">garbage collection</a> to point out that <span class="application">Python</span> 2.0 and later can handle circular references without additional coding.
                              </li>
                              <li>Fixed <span class="acronym">UNIX</span> downloads to include all relevant files.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.9</td>
                     <td align="left">2001-01-15</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Removed introduction to <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>.
                              </li>
                              <li>Removed introduction to <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a>.
                              </li>
                              <li>Removed introduction to <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a>.
                              </li>
                              <li>Edited text ruthlessly.  I tend to ramble.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.8</td>
                     <td align="left">2001-01-12</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added more examples to <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">Section&nbsp;3.4.2, &#8220;Assigning Multiple Values at Once&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.class" title="5.3.&nbsp;Defining Classes">Section&nbsp;5.3, &#8220;Defining Classes&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.create" title="5.4.&nbsp;Instantiating Classes">Section&nbsp;5.4, &#8220;Instantiating Classes&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.specialmethods" title="5.6.&nbsp;Special Class Methods">Section&nbsp;5.6, &#8220;Special Class Methods&#8221;</a>.
                              </li>
                              <li>More minor stylesheet tweaks, including adding titles to <tt class="sgmltag-element">link</tt> tags, which, if your browser is cool enough, will display a description of the link target in a cute little tooltip.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.71</td>
                     <td align="left">2001-01-03</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Made several modifications to stylesheets to improve browser compatibility.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.7</td>
                     <td align="left">2001-01-02</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added introduction to <a href="#odbchelper" title="Chapter&nbsp;2.&nbsp;Your First Python Program">Chapter&nbsp;2, <i>Your First Python Program</i></a>.
                              </li>
                              <li>Added introduction to <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a>.
                              </li>
                              <li>Added review section to <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> [later removed]
                              </li>
                              <li>Added <a href="#fileinfo.private" title="5.9.&nbsp;Private Functions">Section&nbsp;5.9, &#8220;Private Functions&#8221;</a>.
                              </li>
                              <li>Added <a href="#fileinfo.for" title="6.3.&nbsp;Iterating with for Loops">Section&nbsp;6.3, &#8220;Iterating with for Loops&#8221;</a>.
                              </li>
                              <li>Added <a href="#odbchelper.multiassign" title="3.4.2.&nbsp;Assigning Multiple Values at Once">Section&nbsp;3.4.2, &#8220;Assigning Multiple Values at Once&#8221;</a>.
                              </li>
                              <li>Wrote scripts to convert book to new output formats: one single <span class="acronym">HTML</span> file, <span class="acronym">PDF</span>, <span class="application">Microsoft Word 97</span>, and plain text.
                              </li>
                              <li>Registered the <tt class="systemitem">diveintopython.org</tt> domain and moved the book there, along with links to download the book in all available output formats for offline reading.
                              </li>
                              <li>Modified the <span class="acronym">XSL</span> stylesheets to change the header and footer navigation that displays on each page.  The top of each page is branded with
                                 the domain name and book version, followed by a breadcrumb trail to jump back to the chapter table of contents, the main table
                                 of contents, or the site home page.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.6</td>
                     <td align="left">2000-12-11</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#apihelper.alltogether" title="4.8.&nbsp;Putting It All Together">Section&nbsp;4.8, &#8220;Putting It All Together&#8221;</a>.
                              </li>
                              <li>Finished <a href="#apihelper" title="Chapter&nbsp;4.&nbsp;The Power Of Introspection">Chapter&nbsp;4, <i>The Power Of Introspection</i></a> with <a href="#apihelper.summary" title="4.9.&nbsp;Summary">Section&nbsp;4.9, &#8220;Summary&#8221;</a>.
                              </li>
                              <li>Started <a href="#fileinfo" title="Chapter&nbsp;5.&nbsp;Objects and Object-Orientation">Chapter&nbsp;5, <i>Objects and Object-Orientation</i></a> with <a href="#fileinfo.divein" title="5.1.&nbsp;Diving In">Section&nbsp;5.1, &#8220;Diving In&#8221;</a>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.5</td>
                     <td align="left">2000-11-22</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#apihelper.andor" title="4.6.&nbsp;The Peculiar Nature of and and or">Section&nbsp;4.6, &#8220;The Peculiar Nature of and and or&#8221;</a>.
                              </li>
                              <li>Added <a href="#apihelper.lambda" title="4.7.&nbsp;Using lambda Functions">Section&nbsp;4.7, &#8220;Using lambda Functions&#8221;</a>.
                              </li>
                              <li>Added <a href="#abstracts" title="Appendix&nbsp;B.&nbsp;A 5-minute review">appendix that lists section abstracts</a>.
                              </li>
                              <li>Added <a href="#tips" title="Appendix&nbsp;C.&nbsp;Tips and tricks">appendix that lists tips</a>.
                              </li>
                              <li>Added <a href="#examples" title="Appendix&nbsp;D.&nbsp;List of examples">appendix that lists examples</a>.
                              </li>
                              <li>Added <a href="#revhistory" title="Appendix&nbsp;E.&nbsp;Revision history">appendix that lists revision history</a>.
                              </li>
                              <li>Expanded example of mapping lists in <a href="#odbchelper.map" title="3.6.&nbsp;Mapping Lists">Section&nbsp;3.6, &#8220;Mapping Lists&#8221;</a>.
                              </li>
                              <li>Encapsulated several more common phrases into entities.</li>
                              <li>Upgraded to version 1.25 of the <span class="application">DocBook</span> <span class="acronym">XSL</span> stylesheets.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.4</td>
                     <td align="left">2000-11-14</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added <a href="#apihelper.filter" title="4.5.&nbsp;Filtering Lists">Section&nbsp;4.5, &#8220;Filtering Lists&#8221;</a>.
                              </li>
                              <li>Added <tt class="function">dir</tt> documentation to <a href="#apihelper.builtin" title="4.3.&nbsp;Using type, str, dir, and Other Built-In Functions">Section&nbsp;4.3, &#8220;Using type, str, dir, and Other Built-In Functions&#8221;</a>.
                              </li>
                              <li>Added <tt class="function">in</tt> example in <a href="#odbchelper.tuple" title="3.3.&nbsp;Introducing Tuples">Section&nbsp;3.3, &#8220;Introducing Tuples&#8221;</a>.
                              </li>
                              <li>Added additional note about <tt class="literal">if</tt> <tt class="literal">__name__</tt> trick under <span class="application">MacPython</span>.
                              </li>
                              <li>Switched to the <span class="application"><span class="acronym">SAXON</span></span> <span class="acronym">XSLT</span> processor from Michael Kay.
                              </li>
                              <li>Upgraded to version 1.24 of the <span class="application">DocBook</span> <span class="acronym">XSL</span> stylesheets.
                              </li>
                              <li>Added db-html processing instructions with explicit filenames of each chapter and section, to allow deep links to content
                                 even if I add or re-arrange sections later.
                              </li>
                              <li>Made several common phrases into entities for easier reuse.</li>
                              <li>Changed several <tt class="sgmltag-element">literal</tt> tags to <tt class="sgmltag-element">constant</tt>.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.3</td>
                     <td align="left">2000-11-09</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added section on dynamic code execution.</li>
                              <li>Added links to relevant section/example wherever I refer to previously covered concepts.</li>
                              <li>Expanded <a href="#apihelper.divein" title="4.1.&nbsp;Diving In">introduction of chapter 2</a> to explain what the function actually does.
                              </li>
                              <li>Explicitly placed example code under the <span class="acronym">GNU</span> General Public License and added appendix to display license.  [Note 8/16/2001: code has been re-licensed under <span class="acronym">GPL</span>-compatible <span class="application">Python</span> license]
                              </li>
                              <li>Changed links to licenses to use <tt class="sgmltag-element">xref</tt> tags, now that I know how to use them.
                              </li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.2</td>
                     <td align="left">2000-11-06</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Added first four sections of chapter 2.</li>
                              <li>Tightened up preface even more, and added link to <span class="abbrev">Mac</span> <span class="acronym">OS</span> version of <span class="application">Python</span>.
                              </li>
                              <li>Filled out examples in "Mapping lists" and "Joining strings" to show logical progression.</li>
                              <li>Added output in chapter 1 summary.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.1</td>
                     <td align="left">2000-10-31</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Finished chapter 1 with sections on mapping and joining, and a chapter summary.</li>
                              <li>Toned down the preface, added links to introductions for non-programmers.</li>
                              <li>Fixed several typos.</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
                  <tr>
                     <td align="left">Revision 1.0</td>
                     <td align="left">2000-10-30</td>
                  </tr>
                  <tr>
                     <td align="left" colspan="2">
                        
                        <div class="itemizedlist">
                           <ul>
                              <li>Initial publication</li>
                           </ul>
                        </div>
                        
                     </td>
                  </tr>
               </table>
            </div>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="about"></a>Appendix&nbsp;F.&nbsp;About the book
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <p>This book was written in <a href="http://www.oasis-open.org/docbook/" title="DocBook home page"><span class="application">DocBook</span> <span class="acronym">XML</span></a> using <a href="http://www.gnu.org/software/emacs/" title="The One True Editor"><span class="application">Emacs</span></a>, and converted to <span class="acronym">HTML</span> using <a href="http://saxon.sourceforge.net/" title="SAXON home page">the <span class="application"><span class="acronym">SAXON</span></span> <span class="acronym">XSLT</span> processor from Michael Kay</a> with a customized version of <a href="http://www.nwalsh.com/xsl/" title="DocBook XSL home page">Norman Walsh's <span class="acronym">XSL</span> stylesheets</a>.  From there, it was converted to <span class="acronym">PDF</span> using <a href="http://www.easysw.com/htmldoc/" title="HTMLDOC home page"><span class="application">HTMLDoc</span></a>, and to plain text using <a href="http://ei5nazha.yz.yamagata-u.ac.jp/~aito/w3m/eng/" title="w3m home page"><span class="application">w3m</span></a>.  Program listings and examples were colorized using an updated version of Just van Rossum's <tt class="filename">pyfontify.py</tt>, which is included in the example scripts.
            </p>
            <p>If you're interested in learning more about <span class="application">DocBook</span> for technical writing, you can <a href="http://diveintopython.org/download/diveintopython-xml-5.4.zip" title="Download XML source files">download the <span class="acronym">XML</span> source</a> and the <a href="http://diveintopython.org/download/diveintopython-common-5.4.zip" title="Download build scripts and auxiliary files">build scripts</a>, which include the customized <span class="acronym">XSL</span> stylesheets used to create all the different formats of the book.  You should also read the canonical book, <a href="http://www.docbook.org/" title="Read DocBook: TDG online"><i class="citetitle"><span class="application">DocBook</span>: The Definitive Guide</i></a>.  If you're going to do any serious writing in <span class="application">DocBook</span>, I would recommend subscribing to the <a href="http://lists.oasis-open.org/archives/" title="Subscribe to DocBook and/or DocBook-Apps"><span class="application">DocBook</span> mailing lists</a>.
            </p>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="gfdl"></a>Appendix&nbsp;G.&nbsp;<span class="acronym">GNU</span> Free Documentation License
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <p>Version 1.1, March 2000</p>
            <div class="blockquote">
               <blockquote class="blockquote">
                  <p>Copyright (C) 2000  Free Software Foundation, Inc.
                     59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
                     Everyone is permitted to copy and distribute verbatim copies
                     of this license document, but changing it is not allowed.
                  </p>
               </blockquote>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40006"></a>G.0.&nbsp;Preamble
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>The purpose of this License is to make a manual, textbook,
                  or other written document "free" in the sense of freedom: to
                  assure everyone the effective freedom to copy and redistribute it,
                  with or without modifying it, either commercially or
                  noncommercially.  Secondarily, this License preserves for the
                  author and publisher a way to get credit for their work, while not
                  being considered responsible for modifications made by
                  others.
               </p>
               <p>This License is a kind of "copyleft", which means that
                  derivative works of the document must themselves be free in the
                  same sense.  It complements the GNU General Public License, which
                  is a copyleft license designed for free software.
               </p>
               <p>We have designed this License in order to use it for manuals
                  for free software, because free software needs free documentation:
                  a free program should come with manuals providing the same
                  freedoms that the software does.  But this License is not limited
                  to software manuals; it can be used for any textual work,
                  regardless of subject matter or whether it is published as a
                  printed book.  We recommend this License principally for works
                  whose purpose is instruction or reference.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40015"></a>G.1.&nbsp;Applicability and definitions
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>This License applies to any manual or other work that
                  contains a notice placed by the copyright holder saying it can be
                  distributed under the terms of this License.  The "Document",
                  below, refers to any such manual or work.  Any member of the
                  public is a licensee, and is addressed as "you".
               </p>
               <p>A "Modified Version" of the Document means any work
                  containing the Document or a portion of it, either copied
                  verbatim, or with modifications and/or translated into another
                  language.
               </p>
               <p>A "Secondary Section" is a named appendix or a front-matter
                  section of the Document that deals exclusively with the
                  relationship of the publishers or authors of the Document to the
                  Document's overall subject (or to related matters) and contains
                  nothing that could fall directly within that overall subject.
                  (For example, if the Document is in part a textbook of
                  mathematics, a Secondary Section may not explain any mathematics.)
                  The relationship could be a matter of historical connection with
                  the subject or with related matters, or of legal, commercial,
                  philosophical, ethical or political position regarding
                  them.
               </p>
               <p>The "Invariant Sections" are certain Secondary Sections
                  whose titles are designated, as being those of Invariant Sections,
                  in the notice that says that the Document is released under this
                  License.
               </p>
               <p>The "Cover Texts" are certain short passages of text that
                  are listed, as Front-Cover Texts or Back-Cover Texts, in the
                  notice that says that the Document is released under this
                  License.
               </p>
               <p>A "Transparent" copy of the Document means a
                  machine-readable copy, represented in a format whose specification
                  is available to the general public, whose contents can be viewed
                  and edited directly and straightforwardly with generic text
                  editors or (for images composed of pixels) generic paint programs
                  or (for drawings) some widely available drawing editor, and that
                  is suitable for input to text formatters or for automatic
                  translation to a variety of formats suitable for input to text
                  formatters.  A copy made in an otherwise Transparent file format
                  whose markup has been designed to thwart or discourage subsequent
                  modification by readers is not Transparent.  A copy that is not
                  "Transparent" is called "Opaque".
               </p>
               <p>Examples of suitable formats for Transparent copies include
                  plain ASCII without markup, Texinfo input format, LaTeX input
                  format, SGML or XML using a publicly available DTD, and
                  standard-conforming simple HTML designed for human modification.
                  Opaque formats include PostScript, PDF, proprietary formats that
                  can be read and edited only by proprietary word processors, SGML
                  or XML for which the DTD and/or processing tools are not generally
                  available, and the machine-generated HTML produced by some word
                  processors for output purposes only.
               </p>
               <p>The "Title Page" means, for a printed book, the title page
                  itself, plus such following pages as are needed to hold, legibly,
                  the material this License requires to appear in the title page.
                  For works in formats which do not have any title page as such,
                  "Title Page" means the text near the most prominent appearance of
                  the work's title, preceding the beginning of the body of the
                  text.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40035"></a>G.2.&nbsp;Verbatim copying
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>You may copy and distribute the Document in any medium,
                  either commercially or noncommercially, provided that this
                  License, the copyright notices, and the license notice saying this
                  License applies to the Document are reproduced in all copies, and
                  that you add no other conditions whatsoever to those of this
                  License.  You may not use technical measures to obstruct or
                  control the reading or further copying of the copies you make or
                  distribute.  However, you may accept compensation in exchange for
                  copies.  If you distribute a large enough number of copies you
                  must also follow the conditions in section 3.
               </p>
               <p>You may also lend copies, under the same conditions stated
                  above, and you may publicly display copies.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40043"></a>G.3.&nbsp;Copying in quantity
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>If you publish printed copies of the Document numbering more
                  than 100, and the Document's license notice requires Cover Texts,
                  you must enclose the copies in covers that carry, clearly and
                  legibly, all these Cover Texts: Front-Cover Texts on the front
                  cover, and Back-Cover Texts on the back cover.  Both covers must
                  also clearly and legibly identify you as the publisher of these
                  copies.  The front cover must present the full title with all
                  words of the title equally prominent and visible.  You may add
                  other material on the covers in addition.  Copying with changes
                  limited to the covers, as long as they preserve the title of the
                  Document and satisfy these conditions, can be treated as verbatim
                  copying in other respects.
               </p>
               <p>If the required texts for either cover are too voluminous to
                  fit legibly, you should put the first ones listed (as many as fit
                  reasonably) on the actual cover, and continue the rest onto
                  adjacent pages.
               </p>
               <p>If you publish or distribute Opaque copies of the Document
                  numbering more than 100, you must either include a
                  machine-readable Transparent copy along with each Opaque copy, or
                  state in or with each Opaque copy a publicly-accessible
                  computer-network location containing a complete Transparent copy
                  of the Document, free of added material, which the general
                  network-using public has access to download anonymously at no
                  charge using public-standard network protocols.  If you use the
                  latter option, you must take reasonably prudent steps, when you
                  begin distribution of Opaque copies in quantity, to ensure that
                  this Transparent copy will remain thus accessible at the stated
                  location until at least one year after the last time you
                  distribute an Opaque copy (directly or through your agents or
                  retailers) of that edition to the public.
               </p>
               <p>It is requested, but not required, that you contact the
                  authors of the Document well before redistributing any large
                  number of copies, to give them a chance to provide you with an
                  updated version of the Document.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40055"></a>G.4.&nbsp;Modifications
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>You may copy and distribute a Modified Version of the
                  Document under the conditions of sections 2 and 3 above, provided
                  that you release the Modified Version under precisely this
                  License, with the Modified Version filling the role of the
                  Document, thus licensing distribution and modification of the
                  Modified Version to whoever possesses a copy of it.  In addition,
                  you must do these things in the Modified Version:
               </p>
               <div class="orderedlist">
                  <ol type="A">
                     <li>Use in the Title Page
                              (and on the covers, if any) a title distinct from that of the
                              Document, and from those of previous versions (which should, if
                              there were any, be listed in the History section of the
                              Document).  You may use the same title as a previous version if
                              the original publisher of that version gives permission.
                     </li>
                     <li>List on the Title Page,
                              as authors, one or more persons or entities responsible for
                              authorship of the modifications in the Modified Version,
                              together with at least five of the principal authors of the
                              Document (all of its principal authors, if it has less than
                              five).
                     </li>
                     <li>State on the Title page
                              the name of the publisher of the Modified Version, as the
                              publisher.
                     </li>
                     <li>Preserve all the
                              copyright notices of the Document.
                     </li>
                     <li>Add an appropriate
                              copyright notice for your modifications adjacent to the other
                              copyright notices.
                     </li>
                     <li>Include, immediately
                              after the copyright notices, a license notice giving the public
                              permission to use the Modified Version under the terms of this
                              License, in the form shown in the Addendum below.
                     </li>
                     <li>Preserve in that license
                              notice the full lists of Invariant Sections and required Cover
                              Texts given in the Document's license notice.
                     </li>
                     <li>Include an unaltered
                              copy of this License.
                     </li>
                     <li>Preserve the section
                              entitled "History", and its title, and add to it an item stating
                              at least the title, year, new authors, and publisher of the
                              Modified Version as given on the Title Page.  If there is no
                              section entitled "History" in the Document, create one stating
                              the title, year, authors, and publisher of the Document as given
                              on its Title Page, then add an item describing the Modified
                              Version as stated in the previous sentence.
                     </li>
                     <li>Preserve the network
                              location, if any, given in the Document for public access to a
                              Transparent copy of the Document, and likewise the network
                              locations given in the Document for previous versions it was
                              based on.  These may be placed in the "History" section.  You
                              may omit a network location for a work that was published at
                              least four years before the Document itself, or if the original
                              publisher of the version it refers to gives permission.
                     </li>
                     <li>In any section entitled
                              "Acknowledgements" or "Dedications", preserve the section's
                              title, and preserve in the section all the substance and tone of
                              each of the contributor acknowledgements and/or dedications
                              given therein.
                     </li>
                     <li>Preserve all the
                              Invariant Sections of the Document, unaltered in their text and
                              in their titles.  Section numbers or the equivalent are not
                              considered part of the section titles.
                     </li>
                     <li>Delete any section
                              entitled "Endorsements".  Such a section may not be included in
                              the Modified Version.
                     </li>
                     <li>Do not retitle any
                              existing section as "Endorsements" or to conflict in title with
                              any Invariant Section.
                     </li>
                  </ol>
               </div>
               <p>If the Modified Version includes new front-matter sections
                  or appendices that qualify as Secondary Sections and contain no
                  material copied from the Document, you may at your option
                  designate some or all of these sections as invariant.  To do this,
                  add their titles to the list of Invariant Sections in the Modified
                  Version's license notice.  These titles must be distinct from any
                  other section titles.
               </p>
               <p>You may add a section entitled "Endorsements", provided it
                  contains nothing but endorsements of your Modified Version by
                  various parties--for example, statements of peer review or that
                  the text has been approved by an organization as the authoritative
                  definition of a standard.
               </p>
               <p>You may add a passage of up to five words as a Front-Cover
                  Text, and a passage of up to 25 words as a Back-Cover Text, to the
                  end of the list of Cover Texts in the Modified Version.  Only one
                  passage of Front-Cover Text and one of Back-Cover Text may be
                  added by (or through arrangements made by) any one entity.  If the
                  Document already includes a cover text for the same cover,
                  previously added by you or by arrangement made by the same entity
                  you are acting on behalf of, you may not add another; but you may
                  replace the old one, on explicit permission from the previous
                  publisher that added the old one.
               </p>
               <p>The author(s) and publisher(s) of the Document do not by
                  this License give permission to use their names for publicity for
                  or to assert or imply endorsement of any Modified Version.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40112"></a>G.5.&nbsp;Combining documents
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>You may combine the Document with other documents released
                  under this License, under the terms defined in section 4 above for
                  modified versions, provided that you include in the combination
                  all of the Invariant Sections of all of the original documents,
                  unmodified, and list them all as Invariant Sections of your
                  combined work in its license notice.
               </p>
               <p>The combined work need only contain one copy of this
                  License, and multiple identical Invariant Sections may be replaced
                  with a single copy.  If there are multiple Invariant Sections with
                  the same name but different contents, make the title of each such
                  section unique by adding at the end of it, in parentheses, the
                  name of the original author or publisher of that section if known,
                  or else a unique number.  Make the same adjustment to the section
                  titles in the list of Invariant Sections in the license notice of
                  the combined work.
               </p>
               <p>In the combination, you must combine any sections entitled
                  "History" in the various original documents, forming one section
                  entitled "History"; likewise combine any sections entitled
                  "Acknowledgements", and any sections entitled "Dedications".  You
                  must delete all sections entitled "Endorsements."
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40122"></a>G.6.&nbsp;Collections of documents
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>You may make a collection consisting of the Document and
                  other documents released under this License, and replace the
                  individual copies of this License in the various documents with a
                  single copy that is included in the collection, provided that you
                  follow the rules of this License for verbatim copying of each of
                  the documents in all other respects.
               </p>
               <p>You may extract a single document from such a collection,
                  and distribute it individually under this License, provided you
                  insert a copy of this License into the extracted document, and
                  follow this License in all other respects regarding verbatim
                  copying of that document.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40130"></a>G.7.&nbsp;Aggregation with independent works
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>A compilation of the Document or its derivatives with other
                  separate and independent documents or works, in or on a volume of
                  a storage or distribution medium, does not as a whole count as a
                  Modified Version of the Document, provided no compilation
                  copyright is claimed for the compilation.  Such a compilation is
                  called an "aggregate", and this License does not apply to the
                  other self-contained works thus compiled with the Document, on
                  account of their being thus compiled, if they are not themselves
                  derivative works of the Document.
               </p>
               <p>If the Cover Text requirement of section 3 is applicable to
                  these copies of the Document, then if the Document is less than
                  one quarter of the entire aggregate, the Document's Cover Texts
                  may be placed on covers that surround only the Document within the
                  aggregate.  Otherwise they must appear on covers around the whole
                  aggregate.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40138"></a>G.8.&nbsp;Translation
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>Translation is considered a kind of modification, so you may
                  distribute translations of the Document under the terms of section
                  4.  Replacing Invariant Sections with translations requires
                  special permission from their copyright holders, but you may
                  include translations of some or all Invariant Sections in addition
                  to the original versions of these Invariant Sections.  You may
                  include a translation of this License provided that you also
                  include the original English version of this License.  In case of
                  a disagreement between the translation and the original English
                  version of this License, the original English version will
                  prevail.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40144"></a>G.9.&nbsp;Termination
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>You may not copy, modify, sublicense, or distribute the
                  Document except as expressly provided for under this License.  Any
                  other attempt to copy, modify, sublicense or distribute the
                  Document is void, and will automatically terminate your rights
                  under this License.  However, parties who have received copies, or
                  rights, from you under this License will not have their licenses
                  terminated so long as such parties remain in full
                  compliance.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40150"></a>G.10.&nbsp;Future revisions of this license
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>The Free Software Foundation may publish new, revised
                  versions of the GNU Free Documentation License from time to time.
                  Such new versions will be similar in spirit to the present
                  version, but may differ in detail to address new problems or
                  concerns.  See <a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.
               </p>
               <p>Each version of the License is given a distinguishing
                  version number.  If the Document specifies that a particular
                  numbered version of this License "or any later version" applies to
                  it, you have the option of following the terms and conditions
                  either of that specified version or of any later version that has
                  been published (not as a draft) by the Free Software Foundation.
                  If the Document does not specify a version number of this License,
                  you may choose any version ever published (not as a draft) by the
                  Free Software Foundation.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40161"></a>G.11.&nbsp;How to use this License for your documents
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>To use this License in a document you have written, include
                  a copy of the License in the document and put the following
                  copyright and license notices just after the title page:
               </p>
               <div class="blockquote">
                  <blockquote class="blockquote">
                     <p>
                        Copyright (c)  YEAR  YOUR NAME.
                        Permission is granted to copy, distribute and/or modify this document
                        under the terms of the GNU Free Documentation License, Version 1.1
                        or any later version published by the Free Software Foundation;
                        with the Invariant Sections being LIST THEIR TITLES, with the
                        Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.
                        A copy of the license is included in the section entitled "GNU
                        Free Documentation License".
                        
                     </p>
                  </blockquote>
               </div>
               <p>If you have no Invariant Sections, write "with no Invariant
                  Sections" instead of saying which ones are invariant.  If you have
                  no Front-Cover Texts, write "no Front-Cover Texts" instead of
                  "Front-Cover Texts being LIST"; likewise for Back-Cover
                  Texts.
               </p>
               <p>If your document contains nontrivial examples of program
                  code, we recommend releasing these examples in parallel under your
                  choice of free software license, such as the GNU General Public
                  License, to permit their use in free software.
               </p>
            </div>
         </div>
         <div class="appendix" lang="en">
            <div class="titlepage">
               <div>
                  <div>
                     <h2 class="title"><a name="license"></a>Appendix&nbsp;H.&nbsp;<span class="application">Python</span> license
                     </h2>
                  </div>
               </div>
               <div></div>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40180"></a>H.A.&nbsp;History of the software
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <p>Python was created in the early 1990s by Guido van Rossum at Stichting
                  Mathematisch Centrum (CWI) in the Netherlands as a successor of a
                  language called ABC.  Guido is Python's principal author, although it
                  includes many contributions from others.  The last version released
                  from CWI was Python 1.2.  In 1995, Guido continued his work on Python
                  at the Corporation for National Research Initiatives (CNRI) in Reston,
                  Virginia where he released several versions of the software.  Python
                  1.6 was the last of the versions released by CNRI.  In 2000, Guido and
                  the Python core development team moved to BeOpen.com to form the
                  BeOpen PythonLabs team.  Python 2.0 was the first and only release
                  from BeOpen.com.
               </p>
               <p>Following the release of Python 1.6, and after Guido van Rossum left
                  CNRI to work with commercial software developers, it became clear that
                  the ability to use Python with software available under the GNU Public
                  License (GPL) was very desirable.  CNRI and the Free Software
                  Foundation (FSF) interacted to develop enabling wording changes to the
                  Python license.  Python 1.6.1 is essentially the same as Python 1.6,
                  with a few minor bug fixes, and with a different license that enables
                  later versions to be GPL-compatible.  Python 2.1 is a derivative work
                  of Python 1.6.1, as well as of Python 2.0.
               </p>
               <p>After Python 2.0 was released by BeOpen.com, Guido van Rossum and the
                  other PythonLabs developers joined Digital Creations.  All
                  intellectual property added from this point on, starting with Python
                  2.1 and its alpha and beta releases, is owned by the Python Software
                  Foundation (PSF), a non-profit modeled after the Apache Software
                  Foundation.  See http://www.python.org/psf/ for more information about
                  the PSF.
               </p>
               <p>Thanks to the many outside volunteers who have worked under Guido's
                  direction to make these releases possible.
               </p>
            </div>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="d0e40191"></a>H.B.&nbsp;Terms and conditions for accessing or otherwise using Python
                        </h2>
                     </div>
                  </div>
                  <div></div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e40195"></a>H.B.1.&nbsp;PSF license agreement
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="orderedlist">
                     <ol type="1">
                        <li>This LICENSE AGREEMENT is between the Python Software Foundation
                           ("PSF"), and the Individual or Organization ("Licensee") accessing and
                           otherwise using Python 2.1.1 software in source or binary form and its
                           associated documentation.
                        </li>
                        <li>Subject to the terms and conditions of this License Agreement, PSF
                           hereby grants Licensee a nonexclusive, royalty-free, world-wide
                           license to reproduce, analyze, test, perform and/or display publicly,
                           prepare derivative works, distribute, and otherwise use Python 2.1.1
                           alone or in any derivative version, provided, however, that PSF's
                           License Agreement and PSF's notice of copyright, i.e., "Copyright (c)
                           2001 Python Software Foundation; All Rights Reserved" are retained in
                           Python 2.1.1 alone or in any derivative version prepared by Licensee.
                        </li>
                        <li>In the event Licensee prepares a derivative work that is based on
                           or incorporates Python 2.1.1 or any part thereof, and wants to make
                           the derivative work available to others as provided herein, then
                           Licensee hereby agrees to include in any such work a brief summary of
                           the changes made to Python 2.1.1.
                        </li>
                        <li>PSF is making Python 2.1.1 available to Licensee on an "AS IS"
                           basis.  PSF MAKES NO REPRESENTATIONS OR WARRANTIES, EXPRESS OR
                           IMPLIED.  BY WAY OF EXAMPLE, BUT NOT LIMITATION, PSF MAKES NO AND
                           DISCLAIMS ANY REPRESENTATION OR WARRANTY OF MERCHANTABILITY OR FITNESS
                           FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF PYTHON 2.1.1 WILL NOT
                           INFRINGE ANY THIRD PARTY RIGHTS.
                        </li>
                        <li>PSF SHALL NOT BE LIABLE TO LICENSEE OR ANY OTHER USERS OF PYTHON
                           2.1.1 FOR ANY INCIDENTAL, SPECIAL, OR CONSEQUENTIAL DAMAGES OR LOSS AS
                           A RESULT OF MODIFYING, DISTRIBUTING, OR OTHERWISE USING PYTHON 2.1.1,
                           OR ANY DERIVATIVE THEREOF, EVEN IF ADVISED OF THE POSSIBILITY THEREOF.
                        </li>
                        <li>This License Agreement will automatically terminate upon a material
                           breach of its terms and conditions.
                        </li>
                        <li>Nothing in this License Agreement shall be deemed to create any
                           relationship of agency, partnership, or joint venture between PSF and
                           Licensee.  This License Agreement does not grant permission to use PSF
                           trademarks or trade name in a trademark sense to endorse or promote
                           products or services of Licensee, or any third party.
                        </li>
                        <li>By copying, installing or otherwise using Python 2.1.1, Licensee
                           agrees to be bound by the terms and conditions of this License
                           Agreement.
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e40223"></a>H.B.2.&nbsp;BeOpen Python open source license agreement version 1
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="orderedlist">
                     <ol type="1">
                        <li>This LICENSE AGREEMENT is between BeOpen.com ("BeOpen"), having an
                           office at 160 Saratoga Avenue, Santa Clara, CA 95051, and the
                           Individual or Organization ("Licensee") accessing and otherwise using
                           this software in source or binary form and its associated
                           documentation ("the Software").
                        </li>
                        <li>Subject to the terms and conditions of this BeOpen Python License
                           Agreement, BeOpen hereby grants Licensee a non-exclusive,
                           royalty-free, world-wide license to reproduce, analyze, test, perform
                           and/or display publicly, prepare derivative works, distribute, and
                           otherwise use the Software alone or in any derivative version,
                           provided, however, that the BeOpen Python License is retained in the
                           Software, alone or in any derivative version prepared by Licensee.
                        </li>
                        <li>BeOpen is making the Software available to Licensee on an "AS IS"
                           basis.  BEOPEN MAKES NO REPRESENTATIONS OR WARRANTIES, EXPRESS OR
                           IMPLIED.  BY WAY OF EXAMPLE, BUT NOT LIMITATION, BEOPEN MAKES NO AND
                           DISCLAIMS ANY REPRESENTATION OR WARRANTY OF MERCHANTABILITY OR FITNESS
                           FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF THE SOFTWARE WILL NOT
                           INFRINGE ANY THIRD PARTY RIGHTS.
                        </li>
                        <li>BEOPEN SHALL NOT BE LIABLE TO LICENSEE OR ANY OTHER USERS OF THE
                           SOFTWARE FOR ANY INCIDENTAL, SPECIAL, OR CONSEQUENTIAL DAMAGES OR LOSS
                           AS A RESULT OF USING, MODIFYING OR DISTRIBUTING THE SOFTWARE, OR ANY
                           DERIVATIVE THEREOF, EVEN IF ADVISED OF THE POSSIBILITY THEREOF.
                        </li>
                        <li>This License Agreement will automatically terminate upon a material
                           breach of its terms and conditions.
                        </li>
                        <li>This License Agreement shall be governed by and interpreted in all
                           respects by the law of the State of California, excluding conflict of
                           law provisions.  Nothing in this License Agreement shall be deemed to
                           create any relationship of agency, partnership, or joint venture
                           between BeOpen and Licensee.  This License Agreement does not grant
                           permission to use BeOpen trademarks or trade names in a trademark
                           sense to endorse or promote products or services of Licensee, or any
                           third party.  As an exception, the "BeOpen Python" logos available at
                           http://www.pythonlabs.com/logos.html may be used according to the
                           permissions granted on that web page.
                        </li>
                        <li>By copying, installing or otherwise using the software, Licensee
                           agrees to be bound by the terms and conditions of this License
                           Agreement.
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e40248"></a>H.B.3.&nbsp;CNRI open source GPL-compatible license agreement
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="orderedlist">
                     <ol type="1">
                        <li>This LICENSE AGREEMENT is between the Corporation for National
                           Research Initiatives, having an office at 1895 Preston White Drive,
                           Reston, VA 20191 ("CNRI"), and the Individual or Organization
                           ("Licensee") accessing and otherwise using Python 1.6.1 software in
                           source or binary form and its associated documentation.
                        </li>
                        <li>Subject to the terms and conditions of this License Agreement, CNRI
                           hereby grants Licensee a nonexclusive, royalty-free, world-wide
                           license to reproduce, analyze, test, perform and/or display publicly,
                           prepare derivative works, distribute, and otherwise use Python 1.6.1
                           alone or in any derivative version, provided, however, that CNRI's
                           License Agreement and CNRI's notice of copyright, i.e., "Copyright (c)
                           1995-2001 Corporation for National Research Initiatives; All Rights
                           Reserved" are retained in Python 1.6.1 alone or in any derivative
                           version prepared by Licensee.  Alternately, in lieu of CNRI's License
                           Agreement, Licensee may substitute the following text (omitting the
                           quotes): "Python 1.6.1 is made available subject to the terms and
                           conditions in CNRI's License Agreement.  This Agreement together with
                           Python 1.6.1 may be located on the Internet using the following
                           unique, persistent identifier (known as a handle): 1895.22/1013.  This
                           Agreement may also be obtained from a proxy server on the Internet
                           using the following URL: http://hdl.handle.net/1895.22/1013".
                        </li>
                        <li>In the event Licensee prepares a derivative work that is based on
                           or incorporates Python 1.6.1 or any part thereof, and wants to make
                           the derivative work available to others as provided herein, then
                           Licensee hereby agrees to include in any such work a brief summary of
                           the changes made to Python 1.6.1.
                        </li>
                        <li>CNRI is making Python 1.6.1 available to Licensee on an "AS IS"
                           basis.  CNRI MAKES NO REPRESENTATIONS OR WARRANTIES, EXPRESS OR
                           IMPLIED.  BY WAY OF EXAMPLE, BUT NOT LIMITATION, CNRI MAKES NO AND
                           DISCLAIMS ANY REPRESENTATION OR WARRANTY OF MERCHANTABILITY OR FITNESS
                           FOR ANY PARTICULAR PURPOSE OR THAT THE USE OF PYTHON 1.6.1 WILL NOT
                           INFRINGE ANY THIRD PARTY RIGHTS.
                        </li>
                        <li>CNRI SHALL NOT BE LIABLE TO LICENSEE OR ANY OTHER USERS OF PYTHON
                           1.6.1 FOR ANY INCIDENTAL, SPECIAL, OR CONSEQUENTIAL DAMAGES OR LOSS AS
                           A RESULT OF MODIFYING, DISTRIBUTING, OR OTHERWISE USING PYTHON 1.6.1,
                           OR ANY DERIVATIVE THEREOF, EVEN IF ADVISED OF THE POSSIBILITY THEREOF.
                        </li>
                        <li>This License Agreement will automatically terminate upon a material
                           breach of its terms and conditions.
                        </li>
                        <li>This License Agreement shall be governed by the federal
                           intellectual property law of the United States, including without
                           limitation the federal copyright law, and, to the extent such
                           U.S. federal law does not apply, by the law of the Commonwealth of
                           Virginia, excluding Virginia's conflict of law provisions.
                           Notwithstanding the foregoing, with regard to derivative works based
                           on Python 1.6.1 that incorporate non-separable material that was
                           previously distributed under the GNU General Public License (GPL), the
                           law of the Commonwealth of Virginia shall govern this License
                           Agreement only as to issues arising under or with respect to
                           Paragraphs 4, 5, and 7 of this License Agreement.  Nothing in this
                           License Agreement shall be deemed to create any relationship of
                           agency, partnership, or joint venture between CNRI and Licensee.  This
                           License Agreement does not grant permission to use CNRI trademarks or
                           trade name in a trademark sense to endorse or promote products or
                           services of Licensee, or any third party.
                        </li>
                        <li>By clicking on the "ACCEPT" button where indicated, or by copying,
                           installing or otherwise using Python 1.6.1, Licensee agrees to be
                           bound by the terms and conditions of this License Agreement.
                        </li>
                     </ol>
                  </div>
               </div>
               <div class="section" lang="en">
                  <div class="titlepage">
                     <div>
                        <div>
                           <h3 class="title"><a name="d0e40276"></a>H.B.4.&nbsp;CWI permissions statement and disclaimer
                           </h3>
                        </div>
                     </div>
                     <div></div>
                  </div>
                  <div class="blockquote">
                     <blockquote class="blockquote">
                        <p>Copyright (c) 1991 - 1995, Stichting Mathematisch Centrum Amsterdam,
                           The Netherlands.  All rights reserved.
                        </p>
                     </blockquote>
                  </div>
                  <p>Permission to use, copy, modify, and distribute this software and its
                     documentation for any purpose and without fee is hereby granted,
                     provided that the above copyright notice appear in all copies and that
                     both that copyright notice and this permission notice appear in
                     supporting documentation, and that the name of Stichting Mathematisch
                     Centrum or CWI not be used in advertising or publicity pertaining to
                     distribution of the software without specific, written prior
                     permission.
                  </p>
                  <p>STICHTING MATHEMATISCH CENTRUM DISCLAIMS ALL WARRANTIES WITH REGARD TO
                     THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
                     FITNESS, IN NO EVENT SHALL STICHTING MATHEMATISCH CENTRUM BE LIABLE
                     FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
                     WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
                     ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
                     OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
                  </p>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>